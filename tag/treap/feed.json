{
    "version": "https://jsonfeed.org/version/1",
    "title": "Cubic YÂ³ â€¢ All posts by \"treap\" tag",
    "description": "Notes, CTF, DIY, thoughts and waifus.\n\nI'm CubicYYY, an undergraduate student majoring in Computer Science at Zhejiang University.\nâ¤â¤â¤ CTF, toy projects, electric guitar\nâœ–âœ–âœ– Technological supremacy\n\nRÃ©sumÃ©ğŸ‘‰ [here](https://latexonline.cc/compile?git=https://github.com/cubicYYY/resume&target=resume.tex&command=xelatex).",
    "home_page_url": "http://cubicy.icu",
    "items": [
        {
            "id": "http://cubicy.icu/2018/08/03/%E6%9B%BF%E7%BD%AA%E7%BE%8A%E6%A0%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/",
            "url": "http://cubicy.icu/2018/08/03/%E6%9B%BF%E7%BD%AA%E7%BE%8A%E6%A0%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/",
            "title": "æ›¿ç½ªç¾Šæ ‘å­¦ä¹ ç¬”è®°",
            "date_published": "2018-08-03T08:53:00.000Z",
            "content_html": "<p>åšå®¢å’•å’•å’•äº†å¥½ä¹…â€¦â€¦æœ€è¿‘ä¼šé€æ­¥ç»§ç»­æ¢å¤æ›´æ–°åšå®¢çš„ã€‚<br>æœ€è¿‘åˆåœ¨å­¦ä¹ äºŒå‰æœç´¢æ ‘ã€‚å®æµ‹å‘ç°æ›¿ç½ªç¾Šæ ‘å¿«çš„é£èµ·(æ—¶é—´çº¦Splayçš„1&#x2F;2)~å†™èµ·æ¥è¿˜æ¯”è¾ƒç®€å•ï¼Œå†³å®šæ¥ä¸€æ³¢ã€‚<br>ï¼ˆé‚£ä¸ºä»€ä¹ˆè¿˜è¦ç”¨Splayå‘¢ï¼Ÿå› ä¸ºSplayæ˜¯åºåˆ—ä¹‹ç‹ï¼è¿˜èƒ½ç»´æŠ¤LCTï¼ï¼ˆä½ è¦ç”¨éæ—‹Treapï¼ˆFHQ-Treapï¼‰æˆ‘ä¹Ÿæ²¡æ„è§ï¼‰ï¼‰<br>æ›¿ç½ªç¾Šæ ‘çš„ä¸»è¦æ€æƒ³å°±æ˜¯å½“å‡ºç°é‡é‡å¤±è¡¡çš„æ—¶å€™ï¼Œ<strong>æŠŠç½ªé­ç¥¸é¦–çš„é‚£ä¸ªå­æ ‘æ‹å‡ºæ¥ï¼Œé‡æ–°æŒ‰æœ€å®Œç¾çš„æ–¹å¼ï¼ˆä¹Ÿå°±æ˜¯è¿‘ä¼¼å®Œå…¨äºŒå‰æ ‘ï¼‰æ„é€ ä¸€éå†æ¥å›å»</strong>ã€‚<br>å¦‚ä½•å®šä¹‰æŸä¸ªå­æ ‘ä¸å¹³è¡¡ï¼šå½“è¿™ä¸ªå­æ ‘çš„å·¦å³å­æ ‘å…¶ä¸­ä¹‹ä¸€çš„â€œé‡é‡â€ï¼ˆèŠ‚ç‚¹ä¸ªæ•°ï¼‰è¶…è¿‡äº†æ•´ä¸ªå­æ ‘çš„Î±*100%æ—¶ï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™ä¸ªå­æ ‘ä¸å¹³è¡¡ã€‚<br>ä¸¾ä¾‹ï¼šÎ±&#x3D;0.75æ—¶ï¼Œå¦‚æœä¸€ä¸ªå­æ ‘å·¦å­æ ‘æœ‰4ä¸ªèŠ‚ç‚¹ï¼Œå³å­æ ‘æœ‰1ä¸ªï¼Œè¿™ä¸ªå­æ ‘å¤§å°å°±æ˜¯4+1+1&#x3D;6ï¼Œå·¦å­æ ‘å æ¯”è¶…è¿‡äº†Î±*100%ï¼ˆå³75%ï¼‰ï¼Œè¿™ä¸ªå­æ ‘ä¸å¹³è¡¡ï¼Œéœ€è¦é‡æ„ã€‚<br>æ˜¾ç„¶ï¼ŒÎ±å–å€¼ä»‹äº0.5è‡³1.0ä¹‹é—´ï¼Œè¶Šå°æ ‘è¶Šå¹³è¡¡ä½†é‡æ„æ¬¡æ•°è¶Šå¤šï¼Œè¶Šå¤§é‡æ„æ¬¡æ•°è¶Šå°‘ä½†æ ‘è¶Šä¸å¹³è¡¡ã€‚å¤ªå¤§å¤ªå°éƒ½ä¼šå‡ºäº‹ã€‚<strong>ä¸€èˆ¬è€Œè¨€ï¼ŒÎ±å–0.75</strong>ã€‚å¦‚æœé¢˜ç›®æŸ¥è¯¢æ¬¡æ•°è¿œå¤§äºæ’å…¥æ¬¡æ•°ï¼Œå¯ç•¥å¾®é™ä½Î±å–å€¼ï¼ˆæ¯”å¦‚Î±&#x3D;0.70ï¼‰ï¼›è‹¥è¿œå°äºï¼Œåˆ™ç•¥å‡é«˜ï¼ˆå¦‚Î±&#x3D;0.80ï¼‰ã€‚<br>ä¸‹é¢ä»¥<a href=\"https://www.luogu.org/problemnew/show/P3369\">æ´›è°·3369ã€æ¨¡æ¿ã€‘æ™®é€šå¹³è¡¡æ ‘</a>ä¸ºä¾‹ï¼š  </p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//è¿™ä¸ªæ¿å­æœ‰æ”¹è¿›ä¹‹å¤„ï¼šæ¯”å¦‚åˆ é™¤èŠ‚ç‚¹å¯ä»¥æ‰“ä¸Šåˆ é™¤æ‡’æ ‡è®°ï¼Œå•ä¸ªèŠ‚ç‚¹å¯ä»¥è®°å½•åŒä¸€æ•°å­—æ•°é‡é¿å…å¤šä½™èŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;cstdlib&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> inf (1&lt;&lt;30)</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> maxn (2100000)</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> db double</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> il inline</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> RG register</span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">const</span> db al=<span class=\"number\">0.75</span>;<span class=\"comment\">//Î±</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">node</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> son[<span class=\"number\">2</span>],fa,size,num;<span class=\"comment\">//å·¦å³å­©å­å‚¨å­˜åœ°å€ï¼ŒèŠ‚ç‚¹çˆ¶äº²ï¼Œä»¥è¯¥èŠ‚ç‚¹ä¸ºæ ¹å­æ ‘çš„é‡é‡ï¼Œè¯¥èŠ‚ç‚¹å‚¨å­˜çš„æ•°å­—</span></span><br><span class=\"line\">&#125; t[maxn];</span><br><span class=\"line\"><span class=\"type\">int</span> n,cnt,root;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">il <span class=\"type\">bool</span> <span class=\"title\">balance</span><span class=\"params\">(RG <span class=\"type\">int</span> id)</span>   <span class=\"comment\">//åˆ¤æ–­å­æ ‘æ˜¯å¦å¹³è¡¡</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (db)(t[id].size*al&gt;=(db)t[ t[id].son[<span class=\"number\">0</span>] ].size) &amp;&amp; (db)( t[id].size*al&gt;=(db)t[t[ id].son[<span class=\"number\">1</span>] ].size);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">int</span> cur[maxn],sum;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">il <span class=\"type\">void</span> <span class=\"title\">recycle</span><span class=\"params\">(RG <span class=\"type\">int</span> id)</span>    <span class=\"comment\">//å‹æ‰ï¼ŒæŠŠéœ€è¦é‡æ„çš„å­æ ‘æ‹å‡ºæ¥å…ˆæ‹æ‰æˆåºåˆ—</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(t[id].son[<span class=\"number\">0</span>]) <span class=\"built_in\">recycle</span>(t[id].son[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    cur[++sum]=id;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(t[id].son[<span class=\"number\">1</span>]) <span class=\"built_in\">recycle</span>(t[id].son[<span class=\"number\">1</span>]);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">il <span class=\"type\">int</span> <span class=\"title\">build</span><span class=\"params\">(RG <span class=\"type\">int</span> l,RG <span class=\"type\">int</span> r)</span>   <span class=\"comment\">//é€’å½’å»ºæ ‘ï¼Œä½¿ç»“æ„æœ€ä¼˜</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(l&gt;r) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    RG <span class=\"type\">int</span> mid=(l+r)&gt;&gt;<span class=\"number\">1</span>,id=cur[mid];</span><br><span class=\"line\">    t[ t[id].son[<span class=\"number\">0</span>]=<span class=\"built_in\">build</span>(l,mid<span class=\"number\">-1</span>) ].fa=id;</span><br><span class=\"line\">    t[ t[id].son[<span class=\"number\">1</span>]=<span class=\"built_in\">build</span>(mid+<span class=\"number\">1</span>,r) ].fa=id;</span><br><span class=\"line\">    t[id].size=t[ t[id].son[<span class=\"number\">0</span>] ].size+t[ t[id].son[<span class=\"number\">1</span>] ].size+<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> id;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">il <span class=\"type\">void</span> <span class=\"title\">rebuild</span><span class=\"params\">(RG <span class=\"type\">int</span> id)</span>   <span class=\"comment\">//é‡æ„å­æ ‘ï¼Œå†â€œæ¥å›å»â€</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    sum=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"built_in\">recycle</span>(id);</span><br><span class=\"line\">    RG <span class=\"type\">int</span> fa=t[id].fa,Son=( t[ t[id].fa ].son[<span class=\"number\">1</span>]==id );</span><br><span class=\"line\">    RG <span class=\"type\">int</span> cur=<span class=\"built_in\">build</span>(<span class=\"number\">1</span>,sum);</span><br><span class=\"line\">    t[ t[fa].son[Son]=cur ].fa=fa;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(id==root) root=cur;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">il <span class=\"type\">void</span> <span class=\"title\">insert</span><span class=\"params\">(RG <span class=\"type\">int</span> x)</span><span class=\"comment\">//æ’å…¥ä¸€ä¸ªæ•°å­—x</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    RG <span class=\"type\">int</span> now=root,cur=++cnt;</span><br><span class=\"line\">    t[cur].size=<span class=\"number\">1</span>,t[cur].num=x;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(<span class=\"number\">1</span>) &#123; <span class=\"comment\">//æ‰¾åˆ°é€‚åˆä½ç½®æ’å…¥</span></span><br><span class=\"line\">        t[now].size++;</span><br><span class=\"line\">        RG <span class=\"type\">bool</span> Son=(x&gt;=t[now].num);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>( t[now].son[Son] ) now=t[now].son[Son];</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            t[ t[now].son[Son]=cur ].fa=now;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    RG <span class=\"type\">int</span> flag=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(RG <span class=\"type\">int</span> i=cur; i; i=t[i].fa) <span class=\"keyword\">if</span>(!<span class=\"built_in\">balance</span>(i)) flag=i;<span class=\"comment\">//æ³¨æ„ï¼šé‡å»ºæ—¶å–æ·±åº¦æœ€æµ…çš„ï¼Œä»¥é¿å…å°å­æ ‘é‡æ„å®Œå¤§å­æ ‘è¿˜é‡æ„ï¼Œæµªè´¹æ—¶é—´</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(flag) <span class=\"built_in\">rebuild</span>(flag); <span class=\"comment\">//æ’å…¥å¾€å¾€ä¼šå¯¼è‡´ä¸å¹³è¡¡,è¿™æ—¶éœ€è¦é‡å»ºä¸å¹³è¡¡çš„å­æ ‘å³å¯</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">il <span class=\"type\">int</span> <span class=\"title\">get_num</span><span class=\"params\">(RG <span class=\"type\">int</span> x)</span>   <span class=\"comment\">//æŸ¥è¯¢ x åœ¨æ ‘ä¸­çš„èŠ‚ç‚¹ç¼–å·ï¼ˆåœ¨æ•°ç»„ä¸­å‚¨å­˜ä½ç½®ä¸‹æ ‡ï¼‰</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    RG <span class=\"type\">int</span> now=root;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(t[now].num==x) <span class=\"keyword\">return</span> now;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> now=t[now].son[ t[now].num&lt;x ];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">il <span class=\"type\">void</span> <span class=\"title\">erase</span><span class=\"params\">(RG <span class=\"type\">int</span> id)</span>   <span class=\"comment\">//åˆ é™¤</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(t[id].son[<span class=\"number\">0</span>] &amp;&amp; t[id].son[<span class=\"number\">1</span>]) &#123;</span><br><span class=\"line\">        RG <span class=\"type\">int</span> cur=t[id].son[<span class=\"number\">0</span>];</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(t[cur].son[<span class=\"number\">1</span>]) cur=t[cur].son[<span class=\"number\">1</span>];</span><br><span class=\"line\">        t[id].num=t[cur].num;</span><br><span class=\"line\">        id=cur;</span><br><span class=\"line\">    &#125; <span class=\"comment\">//åˆ é™¤æ“ä½œéœ€è¦æ‰¾åˆ°å·¦å­æ ‘çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹æˆ–å³å­æ ‘çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ¥é¡¶æ›¿,ä¼˜å…ˆæ‰¾å·¦å­æ ‘</span></span><br><span class=\"line\">    RG <span class=\"type\">int</span> Son=(t[id].son[<span class=\"number\">0</span>]) ? t[id].son[<span class=\"number\">0</span>]:t[id].son[<span class=\"number\">1</span>];</span><br><span class=\"line\">    RG <span class=\"type\">int</span> k=( t[ t[id].fa ].son[<span class=\"number\">1</span>]==id );</span><br><span class=\"line\">    t[ t[ t[id].fa ].son[k]=Son ].fa=t[id].fa;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(RG <span class=\"type\">int</span> i=t[id].fa; i; i=t[i].fa) t[i].size--;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(id==root) root=Son;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">il <span class=\"type\">int</span> <span class=\"title\">get_rank</span><span class=\"params\">(RG <span class=\"type\">int</span> x)</span>   <span class=\"comment\">//æŸ¥ x çš„æ’å</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    RG <span class=\"type\">int</span> now=root,ans=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(now) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(t[now].num&lt;x) ans+=t[ t[now].son[<span class=\"number\">0</span>] ].size+<span class=\"number\">1</span>,now=t[now].son[<span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"keyword\">else</span> now=t[now].son[<span class=\"number\">0</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">il <span class=\"type\">int</span> <span class=\"title\">get_kth</span><span class=\"params\">(RG <span class=\"type\">int</span> x)</span>   <span class=\"comment\">//æŸ¥æ ‘ä¸­çš„ç¬¬ k ä¸ªæ•°</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    RG <span class=\"type\">int</span> now=root;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(t[ t[now].son[<span class=\"number\">0</span>] ].size==x<span class=\"number\">-1</span>) <span class=\"keyword\">return</span> now;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(t[ t[now].son[<span class=\"number\">0</span>] ].size&gt;=x) now=t[now].son[<span class=\"number\">0</span>];</span><br><span class=\"line\">        <span class=\"keyword\">else</span> x-=t[ t[now].son[<span class=\"number\">0</span>] ].size+<span class=\"number\">1</span>,now=t[now].son[<span class=\"number\">1</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> now;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    cnt=<span class=\"number\">2</span>,root=<span class=\"number\">1</span>;</span><br><span class=\"line\">    t[<span class=\"number\">1</span>].num=-inf,t[<span class=\"number\">1</span>].size=<span class=\"number\">2</span>,t[<span class=\"number\">1</span>].son[<span class=\"number\">1</span>]=<span class=\"number\">2</span>;</span><br><span class=\"line\">    t[<span class=\"number\">2</span>].num=inf,t[<span class=\"number\">2</span>].size=<span class=\"number\">1</span>,t[<span class=\"number\">2</span>].fa=<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>,&amp;n);</span><br><span class=\"line\">    RG <span class=\"type\">int</span> type,x;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(RG <span class=\"type\">int</span> i=<span class=\"number\">1</span>; i&lt;=n; i++) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d%d&quot;</span>,&amp;type,&amp;x);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(type==<span class=\"number\">1</span>) <span class=\"built_in\">insert</span>(x);</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(type==<span class=\"number\">2</span>) <span class=\"built_in\">erase</span>( <span class=\"built_in\">get_num</span>(x) );</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(type==<span class=\"number\">3</span>) <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>,<span class=\"built_in\">get_rank</span>(x));</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(type==<span class=\"number\">4</span>) <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>,t[ <span class=\"built_in\">get_kth</span>(x+<span class=\"number\">1</span>) ].num);</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(type==<span class=\"number\">5</span>) <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>,t[<span class=\"built_in\">get_kth</span>(<span class=\"built_in\">get_rank</span>(x))].num);</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(type==<span class=\"number\">6</span>) <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>,t[<span class=\"built_in\">get_kth</span>(<span class=\"built_in\">get_rank</span>(x+<span class=\"number\">1</span>)+<span class=\"number\">1</span>)].num);<span class=\"comment\">//æ³¨æ„æ­¤å¤„ </span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>",
            "tags": [
                "Treap"
            ]
        },
        {
            "id": "http://cubicy.icu/2018/04/09/%E6%B4%9B%E8%B0%B7P1486%20[NOI2004]%E9%83%81%E9%97%B7%E7%9A%84%E5%87%BA%E7%BA%B3%E5%91%98/",
            "url": "http://cubicy.icu/2018/04/09/%E6%B4%9B%E8%B0%B7P1486%20[NOI2004]%E9%83%81%E9%97%B7%E7%9A%84%E5%87%BA%E7%BA%B3%E5%91%98/",
            "title": "æ´›è°·:P1486 [NOI2004]éƒé—·çš„å‡ºçº³å‘˜",
            "date_published": "2018-04-09T14:23:00.000Z",
            "content_html": "<p>åŸé¢˜åœ°å€:<a href=\"https://www.luogu.org/problemnew/show/P1486\">https://www.luogu.org/problemnew/show/P1486</a>  </p>\n<h3 id=\"é¢˜ç›®ç®€è¿°\"><a href=\"#é¢˜ç›®ç®€è¿°\" class=\"headerlink\" title=\"é¢˜ç›®ç®€è¿°\"></a>é¢˜ç›®ç®€è¿°</h3><p>ä¸€ä¸ªåºåˆ—aï¼Œåˆå§‹ä¸ºç©ºã€‚<br>éšæ—¶æ’å…¥ä¸€ä¸ªæ•°ï¼ŒæŸ¥è¯¢ç¬¬kå¤§ï¼Œå…¨ä½“åŠ ï¼Œå…¨ä½“å‡ã€‚<br>ä½†æ˜¯å¦‚æœä»»ä½•æ•°åœ¨ä»»ä½•æ—¶åˆ»ä½äºç»™å®šçš„ä¸‹ç•ŒMINï¼Œåˆ™ç«‹å³ç§»é™¤å‡ºåºåˆ—ã€‚</p>\n<hr>\n<h3 id=\"æ€è·¯\"><a href=\"#æ€è·¯\" class=\"headerlink\" title=\"æ€è·¯\"></a>æ€è·¯</h3><p>æ’å…¥ï¼ŒæŸ¥è¯¢ç¬¬kå¤§ï¼Œå®¹æ˜“å‘ç°æ˜¯BSTé¢˜ã€‚äºæ˜¯ä¸ŠTreapã€‚<br>å…¨ä½“åŠ å…¨ä½“å‡æš´åŠ›åŠ è‚¯å®šä¸è¡Œï¼Œè€ƒè™‘ç”¨å˜é‡deltaå‚¨å­˜å˜åŒ–æƒ…å†µã€‚å…¨ä½“åŠ nå°±æ˜¯delta+&#x3D;nï¼ˆnä¸ºè´Ÿå°±æ˜¯å‡ï¼‰<br>äºæ˜¯æ¯ä¸ªæ•°å®é™…çš„å€¼æ˜¯ï¼šæ ‘é‡Œå‚¨å­˜è¯¥æ•°çš„å€¼+delta  â€”â€”â‘ <br>å‡äº†ä¹‹åå¯èƒ½ä¼šæœ‰æ•°ä½äºä¸‹ç•Œï¼ŒæŸ¥æ‰¾æœ€å°çš„æ•°åˆ¤æ–­æ˜¯ä¸æ˜¯å°äºMINï¼Œæ˜¯çš„è¯åˆ é™¤ï¼Œé‡å¤ç›´åˆ°ä¸å†å°äºMINã€‚<br>æ³¨æ„æ–°æ’å…¥çš„æ•°ä¸åº”è¯¥å—ä¹‹å‰çš„åŠ å‡å½±å“ï¼Œæ‰€ä»¥å°†ä¸€ä¸ªæ•°å­—numæ’å…¥æ ‘ä¸­æ—¶ï¼Œå¦‚æœç›´æ¥æŠŠnumæ’å…¥æ ‘ä¸­ï¼Œå°±å˜æˆnum+deltaäº†ã€‚<br>å®é™…åº”è¯¥æ’å…¥çš„æ˜¯num-deltaï¼Œè¿™æ ·ç»“åˆä¸Šæ–‡â‘ ï¼Œç°åœ¨è¿™ä¸ªæ•°å®é™…çš„å€¼å°±æ˜¯numæœ¬èº«äº†ã€‚<br>æä¾›ä¸€ä¸ªæŒ‡é’ˆå®ç°çš„Treapï¼Œä¸æ¨èä½¿ç”¨å…¶å®ï¼Œè°ƒçš„æ—¶å€™å¿«æŠŠæˆ‘æåè¡€ã€‚</p>\n<hr>\n<h3 id=\"ä»£ç \"><a href=\"#ä»£ç \" class=\"headerlink\" title=\"ä»£ç \"></a>ä»£ç </h3><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdlib&gt;</span></span></span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstring&gt;</span></span></span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;ctime&gt;</span></span></span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cctype&gt;</span></span></span><br><span class=\"line\">    <span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\">    <span class=\"type\">const</span> <span class=\"type\">int</span> MAXN=<span class=\"number\">200010</span>;</span><br><span class=\"line\">    <span class=\"keyword\">struct</span> <span class=\"title class_\">Node</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> d,rnd,size;</span><br><span class=\"line\">        Node *ch[<span class=\"number\">2</span>],*pa;</span><br><span class=\"line\">    &#125;pool[MAXN],*root;</span><br><span class=\"line\">    <span class=\"type\">int</span> tot=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"function\">Node *<span class=\"title\">newnode</span><span class=\"params\">(<span class=\"type\">int</span> d)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        Node *p=&amp;pool[++tot];</span><br><span class=\"line\">        p-&gt;d=d;p-&gt;rnd=<span class=\"built_in\">rand</span>();p-&gt;size=<span class=\"number\">1</span>;</span><br><span class=\"line\">        p-&gt;ch[<span class=\"number\">0</span>]=p-&gt;ch[<span class=\"number\">1</span>]=<span class=\"literal\">NULL</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> p;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">int</span> <span class=\"title\">size</span><span class=\"params\">(Node *p)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> p?p-&gt;size:<span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">update</span><span class=\"params\">(Node *p)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        p-&gt;size=<span class=\"built_in\">size</span>(p-&gt;ch[<span class=\"number\">0</span>])+<span class=\"built_in\">size</span>(p-&gt;ch[<span class=\"number\">1</span>])+<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">rotate</span><span class=\"params\">(Node *p,<span class=\"type\">int</span> t)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        Node *pa=p-&gt;pa,*gp=pa-&gt;pa,*son=p-&gt;ch[t^<span class=\"number\">1</span>];</span><br><span class=\"line\">        pa-&gt;ch[t]=son;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(son)son-&gt;pa=pa;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(gp)gp-&gt;ch[pa==gp-&gt;ch[<span class=\"number\">1</span>]]=p;</span><br><span class=\"line\">        p-&gt;pa=gp;</span><br><span class=\"line\">        p-&gt;ch[t^<span class=\"number\">1</span>]=pa;</span><br><span class=\"line\">        pa-&gt;pa=p;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(pa==root)root=p;</span><br><span class=\"line\">        <span class=\"built_in\">update</span>(pa);</span><br><span class=\"line\">        <span class=\"built_in\">update</span>(p);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">treap</span><span class=\"params\">(Node *p)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(<span class=\"literal\">true</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(p==root || p-&gt;rnd &gt;= p-&gt;pa-&gt;rnd)<span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"built_in\">rotate</span>(p,p==p-&gt;pa-&gt;ch[<span class=\"number\">1</span>]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">insert</span><span class=\"params\">(Node *r,Node *p)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!r)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            root=p;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> f=(p-&gt;d &gt;= r-&gt;d);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!r-&gt;ch[f])</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            r-&gt;ch[f]=p;</span><br><span class=\"line\">            p-&gt;pa=r;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">            <span class=\"built_in\">insert</span>(r-&gt;ch[f],p);</span><br><span class=\"line\">        <span class=\"built_in\">update</span>(r);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\">Node* <span class=\"title\">find</span><span class=\"params\">(Node *r,<span class=\"type\">int</span> x)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x&lt;=<span class=\"built_in\">size</span>(r-&gt;ch[<span class=\"number\">0</span>]))<span class=\"keyword\">return</span> <span class=\"built_in\">find</span>(r-&gt;ch[<span class=\"number\">0</span>],x);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x==<span class=\"built_in\">size</span>(r-&gt;ch[<span class=\"number\">0</span>])+<span class=\"number\">1</span>)<span class=\"keyword\">return</span> r;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">find</span>(r-&gt;ch[<span class=\"number\">1</span>],x-<span class=\"built_in\">size</span>(r-&gt;ch[<span class=\"number\">0</span>])<span class=\"number\">-1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">del</span><span class=\"params\">(Node *p)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!p-&gt;ch[<span class=\"number\">0</span>] &amp;&amp; !p-&gt;ch[<span class=\"number\">1</span>])</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(p==root)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                root=<span class=\"literal\">NULL</span>;</span><br><span class=\"line\">                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            Node *pa=p-&gt;pa;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(pa)</span><br><span class=\"line\">                pa-&gt;ch[p==pa-&gt;ch[<span class=\"number\">1</span>]]=<span class=\"literal\">NULL</span>;</span><br><span class=\"line\">            <span class=\"keyword\">while</span>(p!=root)</span><br><span class=\"line\">                <span class=\"built_in\">update</span>(p=p-&gt;pa);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(p-&gt;ch[<span class=\"number\">0</span>] &amp;&amp; p-&gt;ch[<span class=\"number\">1</span>])</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> f=(p-&gt;ch[<span class=\"number\">1</span>]-&gt;rnd &lt; p-&gt;ch[<span class=\"number\">0</span>]-&gt;rnd);</span><br><span class=\"line\">            <span class=\"built_in\">rotate</span>(p-&gt;ch[f],f);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> f=<span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(p-&gt;ch[<span class=\"number\">0</span>])f=<span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"built_in\">rotate</span>(p-&gt;ch[f],f);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">del</span>(p);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">kth</span><span class=\"params\">(Node *r,<span class=\"type\">int</span> x)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x&lt;=<span class=\"built_in\">size</span>(r-&gt;ch[<span class=\"number\">0</span>]))<span class=\"keyword\">return</span> <span class=\"built_in\">kth</span>(r-&gt;ch[<span class=\"number\">0</span>],x);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x==<span class=\"built_in\">size</span>(r-&gt;ch[<span class=\"number\">0</span>])+<span class=\"number\">1</span>)<span class=\"keyword\">return</span> r-&gt;d;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">kth</span>(r-&gt;ch[<span class=\"number\">1</span>],x-<span class=\"built_in\">size</span>(r-&gt;ch[<span class=\"number\">0</span>])<span class=\"number\">-1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">char</span> <span class=\"title\">getUpper</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"type\">char</span> c;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(c=<span class=\"built_in\">getchar</span>())</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"built_in\">isupper</span>(c))</span><br><span class=\"line\">                <span class=\"keyword\">return</span> c;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">srand</span>((<span class=\"type\">int</span>)<span class=\"built_in\">time</span>(<span class=\"literal\">NULL</span>));</span><br><span class=\"line\">        <span class=\"type\">int</span> Q,Min,x;</span><br><span class=\"line\">        <span class=\"type\">char</span> op;</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d%d&quot;</span>,&amp;Q,&amp;Min);</span><br><span class=\"line\">        <span class=\"type\">int</span> ans=<span class=\"number\">0</span>,delta=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(Q--)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            op=<span class=\"built_in\">getUpper</span>();</span><br><span class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>,&amp;x);</span><br><span class=\"line\">            <span class=\"keyword\">switch</span>(op)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&#x27;I&#x27;</span>:</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(x&lt;Min)<span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    Node *p=<span class=\"built_in\">newnode</span>(x-delta);</span><br><span class=\"line\">                    <span class=\"built_in\">insert</span>(root,p);</span><br><span class=\"line\">                    <span class=\"built_in\">treap</span>(p);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&#x27;A&#x27;</span>:</span><br><span class=\"line\">                    delta+=x;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&#x27;S&#x27;</span>:</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    delta-=x;</span><br><span class=\"line\">                    <span class=\"type\">int</span> xtq=<span class=\"built_in\">size</span>(root);</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">1</span>;i&lt;=xtq;i++)</span><br><span class=\"line\">                        <span class=\"keyword\">if</span>(<span class=\"built_in\">kth</span>(root,<span class=\"number\">1</span>)+delta&lt;Min)</span><br><span class=\"line\">                        &#123;</span><br><span class=\"line\">                            <span class=\"built_in\">del</span>(<span class=\"built_in\">find</span>(root,<span class=\"number\">1</span>));</span><br><span class=\"line\">                            ans++;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        <span class=\"keyword\">else</span> <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&#x27;F&#x27;</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(x&gt;<span class=\"built_in\">size</span>(root))<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;-1\\n&quot;</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">else</span> <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>,<span class=\"built_in\">kth</span>(root,<span class=\"built_in\">size</span>(root)-x+<span class=\"number\">1</span>)+delta);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>,ans);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>",
            "tags": [
                "Treap",
                "BST"
            ]
        },
        {
            "id": "http://cubicy.icu/2018/04/09/%E6%B4%9B%E8%B0%B7P3384%20[HNOI2004]%E5%AE%A0%E7%89%A9%E6%94%B6%E5%85%BB%E5%9C%BA/",
            "url": "http://cubicy.icu/2018/04/09/%E6%B4%9B%E8%B0%B7P3384%20[HNOI2004]%E5%AE%A0%E7%89%A9%E6%94%B6%E5%85%BB%E5%9C%BA/",
            "title": "æ´›è°·:P3384 [HNOI2004]å® ç‰©æ”¶å…»åœº",
            "date_published": "2018-04-09T14:05:00.000Z",
            "content_html": "<p>åŸé¢˜åœ°å€:<a href>https://www.luogu.org/problemnew/show/P3384</a>  </p>\n<h3 id=\"é¢˜ç›®ç®€è¿°\"><a href=\"#é¢˜ç›®ç®€è¿°\" class=\"headerlink\" title=\"é¢˜ç›®ç®€è¿°\"></a>é¢˜ç›®ç®€è¿°</h3><p>ç»™å®šä¸€äº›åºåˆ—<strong>ï¼ˆæ²¡æœ‰é‡å¤æ•°å­—ï¼‰</strong>ï¼Œæ¯ä¸ªåºåˆ—æ”¯æŒï¼š<br>ç»™å®šä¸€äº›æ•°k<strong>ï¼ˆå¯¹äºæ¯ä¸ªåºåˆ—ä¸é‡å¤ï¼‰</strong>ï¼Œæ¯æ¬¡åœ¨åºåˆ—é‡Œæ‰¾åˆ°æœ€æ¥è¿‘kçš„æ•°åˆ é™¤ï¼ˆå¦‚æœæœ‰2ä¸ªæ•°å­—ä¸kå·®ä¸€æ ·ï¼Œå³åˆ†åˆ«æ˜¯k-bå’Œk+bï¼Œåˆ™é€‰æ‹©è¾ƒå°çš„k-bï¼‰ï¼Œç´¯åŠ ä¸kçš„å·®ï¼Œè¾“å‡ºã€‚</p>\n<hr>\n<h3 id=\"æ€è·¯\"><a href=\"#æ€è·¯\" class=\"headerlink\" title=\"æ€è·¯\"></a>æ€è·¯</h3><p>å…¶å®å…³é”®å°±æ˜¯ç»´æŠ¤ä¸€ä¸ªæœ‰åºåºåˆ—ï¼Œæ”¯æŒæ’å…¥ï¼ŒæŸ¥è¯¢å‰ç»§åç»§ï¼Œåˆ é™¤æŒ‡å®šæ•°å­—ã€‚<br>è‡ªç„¶æˆ‘ä»¬ä¼šæƒ³åˆ°æ‰‹æ‰“å¹³è¡¡æ ‘ï¼ŒTreap&#x2F;Splayçš†å¯ã€‚ï¼ˆè¿™é‡Œåªæœ‰æ—‹è½¬å®ç°çš„Treapï¼Œéæ—‹Treapï¼ˆSplit+Mergeï¼‰å’ŒSplayæ—¥ååŠ ä¸Šï¼‰<br>Tips:ä¸ºäº†é˜²æ­¢è¶Šç•Œç­‰é—®é¢˜ä»¥åŠæ–¹ä¾¿æå–åŒºé—´ï¼ˆå°¤å…¶æ˜¯Splayï¼‰ï¼Œåºåˆ—å‰åä¸€èˆ¬å¡ä¸Šä¸€ä¸ª-INFå’ŒINF<br>ç„¶è€Œä½œä¸ºC++é€‰æ‰‹ï¼Œæˆ‘ä»¬åº”è¯¥å¦™ç”¨STLã€‚setå¯ä»¥å®ç°è¿™æ ·çš„åŠŸèƒ½ï¼Œå†…éƒ¨æ˜¯çº¢é»‘æ ‘å®ç°çš„ä¹Ÿå¾ˆå¿«ã€‚</p>\n<hr>\n<h3 id=\"ä»£ç \"><a href=\"#ä»£ç \" class=\"headerlink\" title=\"ä»£ç \"></a>ä»£ç </h3><ol>\n<li>æ—‹è½¬å®ç°çš„Treap(160ms,3.03MB)<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdlib&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cmath&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;ctime&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">int</span> INF=<span class=\"number\">1e9</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">int</span> <span class=\"title\">randad</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">static</span> <span class=\"type\">int</span> seed=<span class=\"number\">114514</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> seed=<span class=\"built_in\">int</span>(seed*<span class=\"number\">48271LL</span>%<span class=\"number\">2147483647</span>);<span class=\"comment\">//48271ä½¿å¾—éšæœºæ•°æœ‰å®Œå…¨å‘¨æœŸï¼Œå³2147483647å†…å–éä¸é‡å¤ </span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">int</span> delta=<span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">node</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> pri,val,ch[<span class=\"number\">2</span>],size,tot;</span><br><span class=\"line\"><span class=\"comment\">//pri:Treapçš„éšæœºæ•°</span></span><br><span class=\"line\"><span class=\"comment\">//val:æ•°å­—</span></span><br><span class=\"line\"><span class=\"comment\">//ch[0,1]:å·¦å­©å­å³å­©å­</span></span><br><span class=\"line\"><span class=\"comment\">//size:ä»¥è¯¥èŠ‚ç‚¹ä¸ºæ ¹çš„å­æ ‘é‡Œæœ‰å‡ ä¸ªæ•°å­—</span></span><br><span class=\"line\"><span class=\"comment\">//tot:è¿™ä¸ªæ•°å­—å‡ºç°äº†å‡ æ¬¡ï¼ˆæœ¬é¢˜æ— ç”¨ï¼‰</span></span><br><span class=\"line\">&#125;T[<span class=\"number\">111111</span>];</span><br><span class=\"line\"><span class=\"type\">int</span> k,size=<span class=\"number\">0</span>,ANS,ans;<span class=\"comment\">//k:æ ¹èŠ‚ç‚¹ï¼Œsize:æ ‘çš„å¤§å°,ANS:ä¸´æ—¶ï¼Œans:èµ¶èµ°äº†å‡ ä¸ªäºº</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">update</span><span class=\"params\">(<span class=\"type\">int</span> k)</span></span>&#123;T[k].size=T[T[k].ch[<span class=\"number\">0</span>]].size+T[T[k].ch[<span class=\"number\">1</span>]].size+T[k].tot;&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">rturn</span><span class=\"params\">(<span class=\"type\">int</span> &amp;k)</span><span class=\"comment\">//å³æ—‹ï¼ŒæŠŠkæ—‹åˆ°å³è¾¹ï¼Œkå·¦å­©å­æåˆ°æ ¹</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> t=T[k].ch[<span class=\"number\">0</span>];</span><br><span class=\"line\">    T[k].ch[<span class=\"number\">0</span>]=T[t].ch[<span class=\"number\">1</span>];</span><br><span class=\"line\">    T[t].ch[<span class=\"number\">1</span>]=k;</span><br><span class=\"line\">    T[t].size=T[k].size;</span><br><span class=\"line\">    <span class=\"built_in\">update</span>(k);</span><br><span class=\"line\">    k=t;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">lturn</span><span class=\"params\">(<span class=\"type\">int</span> &amp;k)</span><span class=\"comment\">//å·¦æ—‹ï¼ŒæŠŠkæ—‹åˆ°å·¦è¾¹ï¼Œkå³å­©å­æåˆ°æ ¹</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> t=T[k].ch[<span class=\"number\">1</span>];</span><br><span class=\"line\">    T[k].ch[<span class=\"number\">1</span>]=T[t].ch[<span class=\"number\">0</span>];</span><br><span class=\"line\">    T[t].ch[<span class=\"number\">0</span>]=k;</span><br><span class=\"line\">    T[t].size=T[k].size;</span><br><span class=\"line\">    <span class=\"built_in\">update</span>(k);</span><br><span class=\"line\">    k=t;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">ins</span><span class=\"params\">(<span class=\"type\">int</span> &amp;k,<span class=\"type\">int</span> val)</span> <span class=\"comment\">//æ’å…¥</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (k==<span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        size++;</span><br><span class=\"line\">        k=size;</span><br><span class=\"line\">        T[k].pri=<span class=\"built_in\">randad</span>();</span><br><span class=\"line\">        T[k].val=val;</span><br><span class=\"line\">        T[k].size=T[k].tot=<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    T[k].size++;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (T[k].val==val) T[k].tot++;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (val&gt;T[k].val) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">ins</span>(T[k].ch[<span class=\"number\">1</span>],val);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (T[T[k].ch[<span class=\"number\">1</span>]].pri&lt;T[k].pri) <span class=\"built_in\">lturn</span>(k);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">ins</span>(T[k].ch[<span class=\"number\">0</span>],val);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (T[T[k].ch[<span class=\"number\">0</span>]].pri&lt;T[k].pri) <span class=\"built_in\">rturn</span>(k);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">del</span><span class=\"params\">(<span class=\"type\">int</span> &amp;k,<span class=\"type\">int</span> val)</span><span class=\"comment\">//åˆ é™¤å€¼ä¸ºvalçš„æ•°</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (k==<span class=\"number\">0</span>) <span class=\"keyword\">return</span> ;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (T[k].val==val) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (T[k].tot&gt;<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            T[k].tot--;</span><br><span class=\"line\">            T[k].size--;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> ;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (T[k].ch[<span class=\"number\">0</span>]==<span class=\"number\">0</span>||T[k].ch[<span class=\"number\">1</span>]==<span class=\"number\">0</span>) k=T[k].ch[<span class=\"number\">0</span>]+T[k].ch[<span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(T[T[k].ch[<span class=\"number\">0</span>]].pri&lt;T[T[k].ch[<span class=\"number\">1</span>]].pri) <span class=\"built_in\">rturn</span>(k),<span class=\"built_in\">del</span>(k,val);</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"built_in\">lturn</span>(k),<span class=\"built_in\">del</span>(k,val);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(val&gt;T[k].val) T[k].size--,<span class=\"built_in\">del</span>(T[k].ch[<span class=\"number\">1</span>],val);</span><br><span class=\"line\">    <span class=\"keyword\">else</span> T[k].size--,<span class=\"built_in\">del</span>(T[k].ch[<span class=\"number\">0</span>],val);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">xth</span><span class=\"params\">(<span class=\"type\">int</span> &amp;k,<span class=\"type\">int</span> x)</span><span class=\"comment\">//æŸ¥è¯¢ç¬¬xå°çš„æ•°æ˜¯ä»€ä¹ˆ </span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(k==<span class=\"number\">0</span>||x==<span class=\"number\">0</span>)<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(x&lt;=T[T[k].ch[<span class=\"number\">0</span>]].size) <span class=\"keyword\">return</span> <span class=\"built_in\">xth</span>(T[k].ch[<span class=\"number\">0</span>],x);</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(x&gt;T[T[k].ch[<span class=\"number\">0</span>]].size+T[k].tot) <span class=\"keyword\">return</span> <span class=\"built_in\">xth</span>(T[k].ch[<span class=\"number\">1</span>],x-T[T[k].ch[<span class=\"number\">0</span>]].size-T[k].tot);</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">return</span> T[k].val;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">find</span><span class=\"params\">(<span class=\"type\">int</span> &amp;k,<span class=\"type\">int</span> x)</span><span class=\"comment\">//æŸ¥è¯¢ç¬¬xå°æ•°åœ¨æ ‘ä¸­ä½ç½® </span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (k==<span class=\"number\">0</span>||x==<span class=\"number\">0</span>) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(x&lt;=T[T[k].ch[<span class=\"number\">0</span>]].size)<span class=\"keyword\">return</span> <span class=\"built_in\">find</span>(T[k].ch[<span class=\"number\">0</span>],x);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(x==T[T[k].ch[<span class=\"number\">0</span>]].size+<span class=\"number\">1</span>)<span class=\"keyword\">return</span> k;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">find</span>(T[k].ch[<span class=\"number\">1</span>],x-T[T[k].ch[<span class=\"number\">0</span>]].size<span class=\"number\">-1</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">pre</span><span class=\"params\">(<span class=\"type\">int</span> k,<span class=\"type\">int</span> x)</span><span class=\"comment\">//æŸ¥è¯¢ä¸æ¯”xå¤§çš„ä¸”æœ€æ¥è¿‘xçš„æ•°æ‰€åœ¨ä½ç½®ï¼ˆxå‰ç»§ï¼‰</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(k==<span class=\"number\">0</span>)<span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(T[k].val&lt;x) ANS=k,<span class=\"built_in\">pre</span>(T[k].ch[<span class=\"number\">1</span>],x);</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"built_in\">pre</span>(T[k].ch[<span class=\"number\">0</span>],x);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">next</span><span class=\"params\">(<span class=\"type\">int</span> k,<span class=\"type\">int</span> x)</span><span class=\"comment\">//æŸ¥è¯¢ä¸æ¯”xå°çš„ä¸”æœ€æ¥è¿‘xçš„æ•°æ‰€åœ¨ä½ç½®ï¼ˆxåç»§ï¼‰</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(k==<span class=\"number\">0</span>)<span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(T[k].val&gt;x) ANS=k,<span class=\"built_in\">next</span>(T[k].ch[<span class=\"number\">0</span>],x);</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"built_in\">next</span>(T[k].ch[<span class=\"number\">1</span>],x);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">Catch</span><span class=\"params\">(<span class=\"type\">int</span> num)</span><span class=\"comment\">//åŒ¹é…å® ç‰©å’Œé¥²å…»äºº</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> a,b;</span><br><span class=\"line\">    <span class=\"built_in\">pre</span>(k,num),a=T[ANS].val; </span><br><span class=\"line\">    <span class=\"built_in\">next</span>(k,num), b=T[ANS].val;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(num-a&lt;=b-num &amp;&amp; a != -INF) &#123;</span><br><span class=\"line\">            ans += num-a;</span><br><span class=\"line\">            <span class=\"built_in\">del</span>(k,a);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            ans += b-num;</span><br><span class=\"line\">            <span class=\"built_in\">del</span>(k,b);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ans %= <span class=\"number\">1000000</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> n;</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;n);</span><br><span class=\"line\">        <span class=\"type\">int</span> cur;</span><br><span class=\"line\">        <span class=\"built_in\">ins</span>(k,-INF),<span class=\"built_in\">ins</span>(k,INF);</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">1</span>; i &lt;= n; i++) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> a, b;</span><br><span class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d%d&quot;</span>, &amp;a, &amp;b);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(T[k].size == <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">                cur=a;<span class=\"comment\">//curï¼šå½“å‰æ˜¯å® ç‰©ç­‰äººè®¤é¢†è¿˜æ˜¯äººåœ¨ç­‰ç€æ¥å—å® ç‰©ï¼ˆçœ‹åŸé¢˜ï¼Œä¸ç„¶è°çœ‹å¾—æ‡‚å•Š= =ï¼‰</span></span><br><span class=\"line\">                <span class=\"built_in\">ins</span>(k,b);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(a == cur) <span class=\"built_in\">ins</span>(k,b);</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"built_in\">Catch</span>(b);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>, ans);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">```  </span><br><span class=\"line\"><span class=\"number\">2.</span> setå®ç°(<span class=\"number\">304</span>ms,<span class=\"number\">2.57</span>MB)  </span><br><span class=\"line\">```cpp</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdlib&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cmath&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;ctime&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;set&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">int</span> maxn = <span class=\"number\">1111111</span>;</span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">int</span> INF = <span class=\"number\">1000000000</span>;</span><br><span class=\"line\"><span class=\"type\">int</span> n, ans;</span><br><span class=\"line\">set &lt;<span class=\"type\">int</span>&gt; s;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">find</span><span class=\"params\">(<span class=\"type\">int</span> x)</span> </span>&#123;</span><br><span class=\"line\">    set&lt;<span class=\"type\">int</span>&gt;::iterator left=--s.<span class=\"built_in\">lower_bound</span>(x),right=s.<span class=\"built_in\">lower_bound</span>(x);<span class=\"comment\">//lower_boundçš„å®ç°æ˜¯äºŒåˆ†æŸ¥æ‰¾ï¼Œè¿­ä»£å™¨æŒ‡å‘ä¸æ¯”xå°çš„ä¸”æœ€æ¥è¿‘xçš„æ•°çš„ä½ç½®ï¼Œæ‰€ä»¥leftå°±æ˜¯å‰ç»§ï¼Œrightå°±æ˜¯åç»§</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(x-*left&lt;=*right-x&amp;&amp;*left!=-INF) &#123;</span><br><span class=\"line\">        ans+=x-*left;</span><br><span class=\"line\">        s.<span class=\"built_in\">erase</span>(left);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        ans+=*right-x;</span><br><span class=\"line\">        s.<span class=\"built_in\">erase</span>(right);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ans%=<span class=\"number\">1000000</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>,&amp;n);</span><br><span class=\"line\">    <span class=\"type\">int</span> cur;</span><br><span class=\"line\">    s.<span class=\"built_in\">insert</span>(-INF),s.<span class=\"built_in\">insert</span>(INF);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;i++) &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> a,b;</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d%d&quot;</span>, &amp;a, &amp;b);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(s.<span class=\"built_in\">size</span>()==<span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">            cur=a;</span><br><span class=\"line\">            s.<span class=\"built_in\">insert</span>(b);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(a==cur) s.<span class=\"built_in\">insert</span>(b);</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"built_in\">find</span>(b);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>, ans);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ol>\n",
            "tags": [
                "Treap",
                "Splay"
            ]
        },
        {
            "id": "http://cubicy.icu/2018/02/27/%E6%B4%9B%E8%B0%B7P2234%20%20[HNOI2002]%E8%90%A5%E4%B8%9A%E9%A2%9D%E7%BB%9F%E8%AE%A1/",
            "url": "http://cubicy.icu/2018/02/27/%E6%B4%9B%E8%B0%B7P2234%20%20[HNOI2002]%E8%90%A5%E4%B8%9A%E9%A2%9D%E7%BB%9F%E8%AE%A1/",
            "title": "æ´›è°·:P2234  [HNOI2002]è¥ä¸šé¢ç»Ÿè®¡",
            "date_published": "2018-02-27T15:58:00.000Z",
            "content_html": "<p>åŸé¢˜åœ°å€ï¼š<a href=\"//www.luogu.org/problemnew/show/P2234\">https://www.luogu.org/problemnew/show/P2234</a></p>\n<h3 id=\"é¢˜ç›®ç®€è¿°\"><a href=\"#é¢˜ç›®ç®€è¿°\" class=\"headerlink\" title=\"é¢˜ç›®ç®€è¿°\"></a>é¢˜ç›®ç®€è¿°</h3><p>ç»™å®šä¸€ä¸ªåºåˆ—ï¼Œå¯¹äºæ¯ä¸€ä¸ªæ•°éƒ½è¦æŸ¥è¯¢ï¼šåºåˆ—ä¸­åœ¨è¿™ä¸ªæ•°å‰ä¸è¿™ä¸ªæ•°æœ€æ¥è¿‘çš„æ•°æ˜¯ä»€ä¹ˆï¼Ÿç„¶åå°†æœ€æ¥è¿‘çš„æ•°å­—ä¸è¿™ä¸ªæ•°å­—çš„å·®ç´¯åŠ ã€‚ï¼ˆåºåˆ—ç¬¬ä¸€ä¸ªæ•°å­—ç›´æ¥åŠ è‡ªå·±ï¼‰  </p>\n<h3 id=\"æ€è·¯\"><a href=\"#æ€è·¯\" class=\"headerlink\" title=\"æ€è·¯\"></a>æ€è·¯</h3><p>æŸ¥è¯¢åœ¨è¿™ä¸ªæ•°ä¹‹å‰ä¸è¿™ä¸ªæ•°æœ€æ¥è¿‘çš„æ•°ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°ç”¨äºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰æ¥åšã€‚<br><del>è™½ç„¶æ•°æ®ç•¥æ°´æš´åŠ›æ’åºæ¯æ¬¡æŸ¥è¯¢ä»ä¸€ä¸ªæ•°å¾€å·¦å³æ‰¾ä¹Ÿèƒ½è¿‡ã€‚</del><br>æ¯æ¬¡æ’å…¥ä¸€ä¸ªæ•°å­—ï¼Œç„¶åæŸ¥è¯¢ï¼Œæˆ‘ç”¨Treapå®ç°ï¼ˆè¿˜æ˜¯å¼±åŒ–ç‰ˆçš„ï¼Œåªæœ‰æ’å…¥æŸ¥è¯¢ï¼‰ã€‚<br>Treapçš„æ ¸å¿ƒå…¶å®å°±æ˜¯æ‰“ä¹±é¡ºåºæ’å…¥é˜²æ­¢è¢«å¡ï¼ˆç²—ç³™ç†è§£ï¼‰ã€‚å…·ä½“å®ç°æ–¹æ³•ä¸éš¾ï¼Œè¯·ç™¾åº¦ã€‚ï¼ˆæˆ‘ä¹‹åä¼šå†™ä¸€ç¯‡ä¸“é—¨ä»‹ç»ä¸‹å„ç§BSTçš„ã€‚ï¼‰<br>PSï¼šTreapæ ‘å®Œæ•´ç‰ˆä¹‹åå†™ã€‚è¿™é¢˜ç”¨STLçš„vectorä¹Ÿè¡Œï¼Œvectorç†è®ºæ¯æ¬¡æ’å…¥æ¸è¿›æ—¶é—´å¤æ‚åº¦æ˜¯O(n)ä½†æ˜¯å¬è¯´å®é™…æ˜¯å¯¹æ•°çº§åˆ«çš„ï¼Ÿ   </p>\n<h3 id=\"ä»£ç \"><a href=\"#ä»£ç \" class=\"headerlink\" title=\"ä»£ç \"></a>ä»£ç </h3><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdlib&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cmath&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstring&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">int</span> <span class=\"title\">randad</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">static</span> <span class=\"type\">int</span> seed=<span class=\"number\">114</span>; <span class=\"comment\">//seedå¯ä»¥éšä¾¿å–</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> seed=<span class=\"built_in\">int</span>(seed*<span class=\"number\">48271LL</span>%<span class=\"number\">2147483647</span>);<span class=\"comment\">//48271ä½¿å¾—å…¶æœ‰å®Œå…¨å‘¨æœŸï¼Œå³2147483647å†…å–éä¸é‡å¤ </span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Treap</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> key,pri,son[<span class=\"number\">2</span>];</span><br><span class=\"line\">&#125;T[<span class=\"number\">33333</span>];</span><br><span class=\"line\"><span class=\"type\">int</span> cnt=<span class=\"number\">1</span>,rt=<span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">rotate</span><span class=\"params\">(<span class=\"type\">int</span> p,<span class=\"type\">int</span> &amp;rt)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> y=T[rt].son[p];</span><br><span class=\"line\">    T[rt].son[p]=T[y].son[!p];</span><br><span class=\"line\">    T[y].son[!p]=rt;</span><br><span class=\"line\">    rt=y;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">ins</span><span class=\"params\">(<span class=\"type\">int</span> key,<span class=\"type\">int</span> &amp;rt)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(rt==<span class=\"number\">0</span>)</span><br><span class=\"line\">    \tT[rt=cnt++] = (Treap)&#123;key,<span class=\"built_in\">randad</span>()&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> p=key&gt;T[rt].key;</span><br><span class=\"line\">        <span class=\"built_in\">ins</span>(key,T[rt].son[p]);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(T[T[rt].son[p]].pri&gt;T[rt].pri)</span><br><span class=\"line\">        \t<span class=\"built_in\">rotate</span>(p,rt);   </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">nowMin</span><span class=\"params\">(<span class=\"type\">int</span> key,<span class=\"type\">int</span> rt)</span><span class=\"comment\">//æŸ¥è¯¢ç°åœ¨æœ€æ¥è¿‘keyçš„æ•°</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(rt==<span class=\"number\">0</span>) <span class=\"keyword\">return</span> <span class=\"number\">666666666</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> res=<span class=\"built_in\">abs</span>(key-T[rt].key);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(key&gt;T[rt].key) res=<span class=\"built_in\">min</span>(res,<span class=\"built_in\">nowMin</span>(key,T[rt].son[<span class=\"number\">1</span>]));</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(key&lt;T[rt].key) res=<span class=\"built_in\">min</span>(res,<span class=\"built_in\">nowMin</span>(key,T[rt].son[<span class=\"number\">0</span>]));</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">int</span> n,tot=<span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>,&amp;n);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;i++) &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> num;</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>,&amp;num);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (i==<span class=\"number\">1</span>) tot+=num;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> tot+=<span class=\"built_in\">nowMin</span>(num,rt);<span class=\"comment\">//rtæ˜¯å½“å‰æ ¹</span></span><br><span class=\"line\">        <span class=\"built_in\">ins</span>(num,rt);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d&quot;</span>,tot);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>",
            "tags": [
                "Treap"
            ]
        }
    ]
}