{
    "version": "https://jsonfeed.org/version/1",
    "title": "Cubic YÂ³ â€¢ All posts by \"oi\" category",
    "description": "Notes, CTF, DIY, thoughts and waifus.\n\nI'm CubicYYY, an undergraduate student majoring in Computer Science at Zhejiang University.\nâ¤â¤â¤ CTF, toy projects, electric guitar\nâœ–âœ–âœ– Technological supremacy\n\nRÃ©sumÃ©ğŸ‘‰ [here](https://latexonline.cc/compile?git=https://github.com/cubicYYY/resume&target=resume.tex&command=xelatex).",
    "home_page_url": "http://cubicy.icu",
    "items": [
        {
            "id": "http://cubicy.icu/2019/10/08/%E6%B4%9B%E8%B0%B7P5072%20[Ynoi2015]%E7%9B%BC%E5%90%9B%E5%8B%BF%E5%BF%98/",
            "url": "http://cubicy.icu/2019/10/08/%E6%B4%9B%E8%B0%B7P5072%20[Ynoi2015]%E7%9B%BC%E5%90%9B%E5%8B%BF%E5%BF%98/",
            "title": "æ´›è°·:P5072 [Ynoi2015]ç›¼å›å‹¿å¿˜",
            "date_published": "2019-10-08T12:13:00.000Z",
            "content_html": "<p>åŸé¢˜åœ°å€:<a href=\"https://www.luogu.org/problem/P5072\">https://www.luogu.org/problem/P5072</a>  </p>\n<h3 id=\"é¢˜ç›®ç®€è¿°\"><a href=\"#é¢˜ç›®ç®€è¿°\" class=\"headerlink\" title=\"é¢˜ç›®ç®€è¿°\"></a>é¢˜ç›®ç®€è¿°</h3><p>ç»™å®šä¸€ä¸ªåºåˆ—ï¼Œæ¯æ¬¡æŸ¥è¯¢ä¸€ä¸ªåŒºé—´[l,r]ä¸­æ‰€æœ‰å­åºåˆ—åˆ†åˆ«å»é‡åçš„å’Œmod p</p>\n<hr>\n<h3 id=\"æ€è·¯\"><a href=\"#æ€è·¯\" class=\"headerlink\" title=\"æ€è·¯\"></a>æ€è·¯</h3><p>æˆ‘ä»¬è€ƒè™‘æ¯ä¸ªæ•°çš„è´¡çŒ®ã€‚å³è¯¥åŒºé—´å†…å«æœ‰è¿™ä¸ªæ•°çš„å­åºåˆ—ä¸ªæ•°ã€‚ç”¨è¡¥é›†è½¬åŒ–ä¸ºä¸å«è¿™ä¸ªæ•°çš„å­åºåˆ—ä¸ªæ•°ã€‚<br>é‚£ä¹ˆï¼Œå‡è®¾è¿™ä¸ªæ•°åœ¨[l,r]å†…å‡ºç°äº†kæ¬¡ï¼Œåˆ™ä¸€å…±æœ‰2^(r-l+1) -2^(r-l+1-k)ä¸ªå­åºåˆ—åŒ…å«è¿™ä¸ªæ•°ã€‚<br>æœ¬é¢˜å¯ä»¥ç¦»çº¿ï¼Œå› æ­¤é€‰æ‹©ä½¿ç”¨è«é˜Ÿï¼Œè¿‡ç¨‹ä¸­ç»´æŠ¤cnt[k]è¡¨ç¤ºåŒºé—´å†…æ°å¥½å‡ºç°kæ¬¡çš„æ•°å­—ä¸ªæ•°ï¼Œç»´æŠ¤sum[j]è¡¨ç¤ºåŒºé—´å†…æ°å¥½å‡ºç°jæ¬¡çš„æ•°å­—ä¹‹å’Œï¼ˆåŒºé—´å†…å‡ºç°æ¬¡æ•°ç›¸åŒçš„æ•°ï¼Œå¯¹äºè¿™äº›æ•°ï¼ŒåŒºé—´ä¸­åŒ…å«è¿™äº›æ•°çš„å­åºåˆ—ä¸ªæ•°éƒ½ç›¸åŒï¼Œå› æ­¤å­˜æ•°å­—ä¹‹å’Œå°±è¡Œï¼‰ã€‚<br>ç„¶è€Œè¿™æ ·æ—¶é—´å¤æ‚åº¦ä¸ºO(è¯¢é—®æ¬¡æ•°*å•æ¬¡è¯¢é—®å¤æ‚åº¦)&#x3D;O(n*max(sqrt(n),n))&#x3D;O(nm)ï¼Œå¹¶ä¸å¯è¡Œã€‚æˆ‘ä»¬å‘ç°æ—¶é—´ç“¶é¢ˆä¸åœ¨è«é˜Ÿçš„sqrt(n)ï¼Œè€Œæ˜¯åœ¨å•æ¬¡æŸ¥è¯¢ä¸­æ±‚è§£çš„å¤æ‚åº¦nã€‚<br>æœ‰2ä¸ªå¥—è·¯å¯ä¾›ä½¿ç”¨ï¼šå‡ºç°æ¬¡æ•°å¤§äºsqrt(n)çš„æ•°ä¸è¶…è¿‡sqrt(n)ä¸ªï¼Œå€¼ä¸ä¸º0çš„cnt[k]å°‘äº2*sqrt(n)ä¸ªï¼ˆåè¯æ˜“å¾—ï¼Œæœ¬è´¨ç±»ä¼¼ï¼‰ã€‚ </p>\n<ul>\n<li>å¯¹äºç¬¬ä¸€ä¸ªå¥—è·¯ï¼Œæˆ‘ä»¬åˆ†ç±»è®¨è®ºï¼šå‡ºç°æ¬¡æ•°å°äºç­‰äºsqrt(n)ï¼Œåˆ™ç»Ÿè®¡æ¯ä¸ªå‡ºç°æ¬¡æ•°çš„æ•°å­—ä¹‹å’Œï¼›å¤§äºsqrt(n)çš„ç”¨å“ˆå¸Œè¡¨(unordered_set,C++11)å­˜ä¸‹å…·ä½“çš„æ•°å­—å’Œå…¶å‡ºç°æ¬¡æ•°ã€‚è¿™æ ·æ¯æ¬¡æŸ¥è¯¢æ˜¯sqrt(n)ã€‚  </li>\n<li>ç¬”è€…ä½¿ç”¨çš„åˆ™æ˜¯ç¬¬äºŒä¸ªå¥—è·¯ï¼šval[x]è¡¨ç¤ºå‡ºç°æ¬¡æ•°æ°å¥½ä¸ºxçš„æ•°å­—ä¹‹å’Œï¼ˆåŒä¸Šæ–‡çš„sum[j]ï¼‰ã€‚éšç€è«é˜Ÿl,ræŒ‡é’ˆçš„ç§»åŠ¨ï¼ŒæŠŠæ‰€æœ‰å¯èƒ½å˜ä¸ºé0çš„val[x]è®°ä¸‹æ¥ï¼ŒæŒ‡é’ˆç§»åŠ¨å®Œæ¯•åå†å¯¹å…¶è¿›è¡Œç­›é€‰ï¼ŒæŠŠç¡®å®é0çš„val[x]ä¿ç•™ï¼Œå…¶ä»–å»é™¤ã€‚è¿™æ ·è®¡ç®—å•æ¬¡ç­”æ¡ˆçš„å¤æ‚åº¦å°±ç­‰åŒäºå•æ¬¡æŸ¥è¯¢ä¸­è«é˜ŸæŒ‡é’ˆç§»åŠ¨çš„å¹³å‡æ­¥æ•°ï¼šéƒ½æ˜¯sqrt(n)çº§åˆ«ã€‚è¿™æ ·åšä¸éœ€è¦ç”¨åˆ°å“ˆå¸Œè¡¨ä¹‹ç±»çš„ï¼Œå¸¸æ•°å°äº†å¾ˆå¤šï¼Œç”šè‡³ä¸éœ€è¦è¯»å…¥ä¼˜åŒ–ä¹Ÿèƒ½è½»æ¾è¿‡ã€‚</li>\n</ul>\n<p>è¿˜æ²¡å®Œã€‚æˆ‘ä»¬å‘ç°æ¨¡æ•°æ˜¯ä¸å®šçš„ï¼Œä¸ºäº†ä¿è¯å•æ¬¡æŸ¥è¯¢çš„å¤æ‚åº¦å‹åœ¨sqrt(n)ä»¥å†…ï¼Œæˆ‘ä»¬è¿˜æœ‰æœ€åä¸€ä»¶äº‹æƒ…è¦åšï¼šåœ¨sqrt(n)çš„æ—¶é—´å†…æ±‚å‡º2^(r-l+1) å’Œæ‰€æœ‰çš„2^(r-l+1-k)ã€‚è¿™é‡Œå®‰åˆ©ä¸€ä¸ªç¥å¥‡çš„æ–¹å¼ï¼šæ¯æ¬¡æŸ¥è¯¢åªéœ€è¦åšä¸€æ¬¡æ—¶é—´å¤æ‚åº¦ä¸ºsqrt(n)çš„é¢„å¤„ç†å°±å¯ä»¥O(1)æŸ¥è¯¢äº†ã€‚<br>å‡è®¾æŸ¥è¯¢åŒºé—´é•¿åº¦ä¸ºlen(len&#x3D;r-l+1)ï¼Œæˆ‘ä»¬è®°siz&#x3D;sqrt(len)ï¼Œè€Œåè®¡ç®—2^0 , 2^1 , 2^2 â€¦ 2^sqrt(len)ï¼Œå­˜åœ¨æ•°ç»„pow1ä¸­ï¼›å†è®¡ç®—2^sqrt(len) , 2^(2*sqrt(len)) , 2^(3*sqrt(len)) , 2^(4*sqrt(len))â€¦ , 2^(sqrt(len)*sqrt(len))ï¼Œå­˜åœ¨æ•°ç»„pow[2]ä¸­ã€‚ä»¥ä¸Šè®¡ç®—éƒ½åœ¨mod pæ„ä¹‰ä¸‹è¿›è¡Œã€‚<br>è¿™æ ·æ±‚2çš„ä»»æ„æ¬¡æ–¹éƒ½å¯ä»¥O(1)å‡ºè§£:2^k &#x3D;2^(k&#x2F;siz) *2^(k%siz)&#x3D;pow2[k&#x2F;siz]*pow1[k%siz]ï¼ˆè®°å¾—æ¨¡pï¼‰ã€‚</p>\n<hr>\n<h3 id=\"ä»£ç \"><a href=\"#ä»£ç \" class=\"headerlink\" title=\"ä»£ç \"></a>ä»£ç </h3><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;bits/stdc++.h&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> MAXN 100005 </span></span><br><span class=\"line\"><span class=\"type\">int</span> n,m;</span><br><span class=\"line\"><span class=\"type\">int</span> a[MAXN],val[MAXN*<span class=\"number\">2</span>],cnt[MAXN],ans[MAXN];</span><br><span class=\"line\"><span class=\"type\">int</span> tot,blosiz,powsiz;</span><br><span class=\"line\"><span class=\"type\">int</span> bel[MAXN],pow1[MAXN],pow2[MAXN];</span><br><span class=\"line\"><span class=\"type\">bool</span> calced[MAXN];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">long</span> <span class=\"type\">long</span> sum[MAXN];</span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">query</span> &#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> id,l,r,p;</span><br><span class=\"line\">\t<span class=\"type\">bool</span> <span class=\"keyword\">operator</span>&lt;(<span class=\"type\">const</span> query &amp;sb) <span class=\"type\">const</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> bel[l]!=bel[sb.l] ? bel[l]&lt;bel[sb.l] : (bel[l]&amp;<span class=\"number\">1</span> ? r&lt;sb.r : r&gt;sb.r);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125; q[MAXN];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"type\">int</span> x)</span> </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tsum[cnt[x]]-=x;</span><br><span class=\"line\">\tcnt[x]++;</span><br><span class=\"line\">\tsum[cnt[x]]+=x;</span><br><span class=\"line\">\t++tot;</span><br><span class=\"line\">\tval[tot]=cnt[x];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">del</span><span class=\"params\">(<span class=\"type\">int</span> x)</span> </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tsum[cnt[x]]-=x;</span><br><span class=\"line\">\tcnt[x]--;</span><br><span class=\"line\">\tsum[cnt[x]]+=x;</span><br><span class=\"line\">\t++tot;</span><br><span class=\"line\">\tval[tot]=cnt[x];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">power</span><span class=\"params\">(<span class=\"type\">int</span> x,<span class=\"type\">int</span> p)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">1LL</span>*pow1[x%powsiz]*pow2[x/powsiz]%p;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class=\"line\">\tblosiz=<span class=\"built_in\">sqrt</span>(n);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;i++) </span><br><span class=\"line\">\t\t<span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>,&amp;a[i]),bel[i]=(i<span class=\"number\">-1</span>)/blosiz;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i=<span class=\"number\">1</span>;i&lt;=m;i++) </span><br><span class=\"line\">\t\t<span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d%d%d&quot;</span>,&amp;q[i].l,&amp;q[i].r,&amp;q[i].p),q[i].id=i;</span><br><span class=\"line\">\t<span class=\"built_in\">sort</span>(q+<span class=\"number\">1</span>,q+m+<span class=\"number\">1</span>);</span><br><span class=\"line\">\t<span class=\"type\">int</span> l=<span class=\"number\">1</span>,r=<span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i=<span class=\"number\">1</span>;i&lt;=m;i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (l&gt;q[i].l) <span class=\"built_in\">add</span>(a[--l]);</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (r&lt;q[i].r) <span class=\"built_in\">add</span>(a[++r]);</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (l&lt;q[i].l) <span class=\"built_in\">del</span>(a[l++]);</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (r&gt;q[i].r) <span class=\"built_in\">del</span>(a[r--]);</span><br><span class=\"line\">        </span><br><span class=\"line\">\t\t<span class=\"type\">int</span> newtot=<span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t<span class=\"type\">int</span> len=r-l+<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> j=<span class=\"number\">1</span>;j&lt;=tot;j++) </span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (val[j]&amp;&amp;sum[val[j]]!=<span class=\"number\">0</span>&amp;&amp;!calced[val[j]]) </span><br><span class=\"line\">\t\t\t\tcalced[val[j]]=<span class=\"number\">1</span>,val[++newtot]=val[j];</span><br><span class=\"line\">\t\ttot=newtot;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tpowsiz=<span class=\"built_in\">sqrt</span>(len)+<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\tpow1[<span class=\"number\">0</span>]=pow2[<span class=\"number\">0</span>]=<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> j=<span class=\"number\">1</span>;j&lt;=powsiz;j++) </span><br><span class=\"line\">\t\t\tpow1[j]=(pow1[j<span class=\"number\">-1</span>]+pow1[j<span class=\"number\">-1</span>])%q[i].p;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> j=<span class=\"number\">1</span>;j*powsiz&lt;=len;j++) </span><br><span class=\"line\">\t\t\tpow2[j]=<span class=\"number\">1LL</span>*pow2[j<span class=\"number\">-1</span>]*pow1[powsiz]%q[i].p;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t<span class=\"type\">int</span> powLen=<span class=\"built_in\">power</span>(len,q[i].p);</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> j=<span class=\"number\">1</span>;j&lt;=tot;j++) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"type\">long</span> <span class=\"type\">long</span> num=sum[val[j]]%q[i].p;</span><br><span class=\"line\">\t\t\tans[q[i].id]=(ans[q[i].id]+num*(powLen-<span class=\"built_in\">power</span>(len-val[j],q[i].p)))%q[i].p;</span><br><span class=\"line\">\t\t\tcalced[val[j]]=<span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tans[q[i].id]+=q[i].p;</span><br><span class=\"line\">\t\tans[q[i].id]%=q[i].p;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i=<span class=\"number\">1</span>;i&lt;=m;i++) </span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>,ans[i]);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>",
            "tags": [
                "åˆ†å—",
                "å“ˆå¸Œ"
            ]
        },
        {
            "id": "http://cubicy.icu/2018/10/28/%E6%B4%9B%E8%B0%B7P3950%20%E9%83%A8%E8%90%BD%E5%86%B2%E7%AA%81/",
            "url": "http://cubicy.icu/2018/10/28/%E6%B4%9B%E8%B0%B7P3950%20%E9%83%A8%E8%90%BD%E5%86%B2%E7%AA%81/",
            "title": "æ´›è°·:P3950 éƒ¨è½å†²çª",
            "date_published": "2018-10-28T12:00:00.000Z",
            "content_html": "<p>åŸé¢˜åœ°å€:<a href=\"https://www.luogu.org/problemnew/show/P3950\">https://www.luogu.org/problemnew/show/P3950</a>  </p>\n<h3 id=\"é¢˜ç›®ç®€è¿°\"><a href=\"#é¢˜ç›®ç®€è¿°\" class=\"headerlink\" title=\"é¢˜ç›®ç®€è¿°\"></a>é¢˜ç›®ç®€è¿°</h3><p>ç»™å®šä¸€æ£µæ ‘ï¼Œæ¯æ¬¡ç»™å®šä¸€ä¸ªæ“ä½œï¼Œæœ‰å¦‚ä¸‹ä¸¤ç§ï¼š  </p>\n<ol>\n<li>å°†æŸæ¡è¾¹æŸ“é»‘<br>2.è¯¢é—®ç»™å®šçš„u,vä¸¤ç‚¹é—´æ˜¯å¦æœ‰è¾¹è¢«æŸ“é»‘</li>\n</ol>\n<hr>\n<p>###æ€è·¯<br>è¯¢é—®ä¸¤ç‚¹é—´æ˜¯å¦æœ‰è¾¹è¢«æŸ“é»‘åªéœ€è¦åœ¨æ±‚LCAæ—¶åˆ¤ä¸€ä¸‹å°±è¡Œã€‚æ‰€ä»¥ç›´æ¥ä¸Šæ ‘é“¾å‰–åˆ†å³å¯ã€‚<br>æœ¬é¢˜ä¸éœ€è¦ä½¿ç”¨çº¿æ®µæ ‘ï¼Œä½¿ç”¨æ ‘çŠ¶æ•°ç»„æŸ¥è¯¢è·¯å¾„ä¸Šæ˜¯å¦æœ‰ä»»æ„ä¸€æ®µåŒºé—´å’Œä¸ä¸º0å³å¯ã€‚</p>\n<hr>\n<h3 id=\"ä»£ç \"><a href=\"#ä»£ç \" class=\"headerlink\" title=\"ä»£ç \"></a>ä»£ç </h3><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;bits/stdc++.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> lowbit(x) x&amp;-x</span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"keyword\">typedef</span> pair&lt;<span class=\"type\">int</span>, <span class=\"type\">int</span>&gt; P;</span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">int</span> maxn = <span class=\"number\">1000000</span>;</span><br><span class=\"line\">P war[maxn];</span><br><span class=\"line\"><span class=\"type\">int</span> fa[maxn], dep[maxn], val[maxn], sz[maxn], top[maxn], son[maxn];</span><br><span class=\"line\"><span class=\"type\">int</span> tre[maxn];</span><br><span class=\"line\"><span class=\"type\">int</span> tot;</span><br><span class=\"line\"><span class=\"type\">int</span> cntw;</span><br><span class=\"line\"><span class=\"type\">int</span> n, m;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">int</span> <span class=\"title\">read</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> ch, x = <span class=\"number\">0</span>, f = <span class=\"number\">1</span>;ch = <span class=\"built_in\">getchar</span>();</span><br><span class=\"line\">    <span class=\"keyword\">while</span>((ch &lt; <span class=\"string\">&#x27;0&#x27;</span> || ch &gt; <span class=\"string\">&#x27;9&#x27;</span>) &amp;&amp; ch != <span class=\"string\">&#x27;-&#x27;</span>) ch = <span class=\"built_in\">getchar</span>();</span><br><span class=\"line\">    ch == <span class=\"string\">&#x27;-&#x27;</span> ? f = <span class=\"number\">-1</span>, ch = <span class=\"built_in\">getchar</span>() : <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(ch &gt;= <span class=\"string\">&#x27;0&#x27;</span> &amp;&amp; ch &lt;= <span class=\"string\">&#x27;9&#x27;</span>) &#123;</span><br><span class=\"line\">        x = x * <span class=\"number\">10</span> + ch - <span class=\"string\">&#x27;0&#x27;</span>;</span><br><span class=\"line\">        ch = <span class=\"built_in\">getchar</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> f * x;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Edge</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> to, len, nxt;</span><br><span class=\"line\">    <span class=\"built_in\">Edge</span>() &#123;&#125;</span><br><span class=\"line\">    <span class=\"built_in\">Edge</span>(<span class=\"type\">int</span> _to, <span class=\"type\">int</span> _len, <span class=\"type\">int</span> _nxt):<span class=\"built_in\">to</span>(_to), <span class=\"built_in\">len</span>(_len), <span class=\"built_in\">nxt</span>(_nxt) &#123;&#125;</span><br><span class=\"line\">&#125;E[maxn];</span><br><span class=\"line\"><span class=\"type\">int</span> h[maxn], cnte;</span><br><span class=\"line\"><span class=\"type\">int</span> L[maxn], R[maxn];</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">update</span><span class=\"params\">(<span class=\"type\">int</span> x, <span class=\"type\">int</span> add)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = x;i &lt;= maxn; i += <span class=\"built_in\">lowbit</span>(i)) tre[i] += add;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">query</span><span class=\"params\">(<span class=\"type\">int</span> x)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> ans = <span class=\"number\">0</span>; <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = x; i; i -= <span class=\"built_in\">lowbit</span>(i)) ans += tre[i]; <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">add_edge</span><span class=\"params\">(<span class=\"type\">int</span> u, <span class=\"type\">int</span> v, <span class=\"type\">int</span> w)</span> </span>&#123;</span><br><span class=\"line\">    E[++cnte] = <span class=\"built_in\">Edge</span>(v, w, h[u]), h[u] = cnte;</span><br><span class=\"line\">    E[++cnte] = <span class=\"built_in\">Edge</span>(u, w, h[v]), h[v] = cnte;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs1</span><span class=\"params\">(<span class=\"type\">int</span> x)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    sz[x] = <span class=\"number\">1</span>; dep[x] = dep[fa[x]] + <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = h[x]; i; i = E[i].nxt) &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> to = E[i].to;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(to == fa[x]) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        fa[to] = x;val[x] = E[i].len;</span><br><span class=\"line\">        <span class=\"built_in\">dfs1</span>(to);</span><br><span class=\"line\">        sz[x] += sz[to];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(sz[to] &gt; sz[son[x]]) son[x] = to;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs2</span><span class=\"params\">(<span class=\"type\">int</span> x)</span> </span>&#123;</span><br><span class=\"line\">    L[x] = ++tot;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(x == son[fa[x]]) top[x] = top[fa[x]];</span><br><span class=\"line\">    <span class=\"keyword\">else</span> top[x] = x;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(son[x]) <span class=\"built_in\">dfs2</span>(son[x]);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = h[x]; i; i = E[i].nxt) &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> to = E[i].to;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(to == fa[x] || to == son[x]) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        <span class=\"built_in\">dfs2</span>(to);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    R[x] = tot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">cut</span><span class=\"params\">(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(L[x] &lt; L[y]) <span class=\"built_in\">swap</span>(x, y);</span><br><span class=\"line\">    <span class=\"built_in\">update</span>(L[x], <span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">connect</span><span class=\"params\">(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(L[x] &lt; L[y]) <span class=\"built_in\">swap</span>(x, y);</span><br><span class=\"line\">    <span class=\"built_in\">update</span>(L[x], <span class=\"number\">-1</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">qsum</span><span class=\"params\">(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y)</span> </span>&#123;<span class=\"comment\">//å…¶å®å¯ä»¥æŸ¥åˆ°æœ‰1å°±é€€å‡ºï¼Œä¸ç”¨æŸ¥å®Œå’Œ</span></span><br><span class=\"line\">    <span class=\"type\">int</span> ans = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(top[x] != top[y])</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(dep[top[x]] &lt; dep[top[y]])<span class=\"built_in\">swap</span>(x, y);</span><br><span class=\"line\">        ans += (<span class=\"built_in\">query</span>(L[x]) - <span class=\"built_in\">query</span>(L[top[x]] - <span class=\"number\">1</span>));</span><br><span class=\"line\">        x = fa[top[x]];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(dep[x] &lt; dep[y])<span class=\"built_in\">swap</span>(x, y);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (x!=y)</span><br><span class=\"line\">\t\tans += (<span class=\"built_in\">query</span>(L[x]) - <span class=\"built_in\">query</span>(L[y]));</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">signed</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">1</span>; i &lt; n; i++) <span class=\"built_in\">add_edge</span>(<span class=\"built_in\">read</span>(), <span class=\"built_in\">read</span>(), <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"built_in\">dfs1</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"built_in\">dfs2</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">1</span>;i &lt;= m; i++) &#123;</span><br><span class=\"line\">        <span class=\"type\">char</span> s[<span class=\"number\">50</span>];</span><br><span class=\"line\">        cin &gt;&gt; s;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(s[<span class=\"number\">0</span>] == <span class=\"string\">&#x27;C&#x27;</span>) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> u = <span class=\"built_in\">read</span>(), v = <span class=\"built_in\">read</span>();</span><br><span class=\"line\">            <span class=\"built_in\">cut</span>(u, v);</span><br><span class=\"line\">            war[++cntw] = <span class=\"built_in\">P</span>(u, v);</span><br><span class=\"line\">        &#125; </span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(s[<span class=\"number\">0</span>] == <span class=\"string\">&#x27;U&#x27;</span>) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> w = <span class=\"built_in\">read</span>();</span><br><span class=\"line\">            <span class=\"built_in\">connect</span>(war[w].first, war[w].second);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"built_in\">qsum</span>(<span class=\"built_in\">read</span>(), <span class=\"built_in\">read</span>()) != <span class=\"number\">0</span>) <span class=\"built_in\">puts</span>(<span class=\"string\">&quot;No&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"built_in\">puts</span>(<span class=\"string\">&quot;Yes&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>",
            "tags": [
                "æ•°é“¾å‰–åˆ†",
                "æ ‘çŠ¶æ•°ç»„",
                "LCA"
            ]
        },
        {
            "id": "http://cubicy.icu/2018/09/28/%E6%B4%9B%E8%B0%B7P1967%20%E8%B4%A7%E8%BD%A6%E8%BF%90%E8%BE%93/",
            "url": "http://cubicy.icu/2018/09/28/%E6%B4%9B%E8%B0%B7P1967%20%E8%B4%A7%E8%BD%A6%E8%BF%90%E8%BE%93/",
            "title": "æ´›è°·:P1967 è´§è½¦è¿è¾“",
            "date_published": "2018-09-28T05:48:00.000Z",
            "content_html": "<p>åŸé¢˜åœ°å€:<a href>https://www.luogu.org/problemnew/show/P1902</a>  </p>\n<h3 id=\"é¢˜ç›®ç®€è¿°\"><a href=\"#é¢˜ç›®ç®€è¿°\" class=\"headerlink\" title=\"é¢˜ç›®ç®€è¿°\"></a>é¢˜ç›®ç®€è¿°</h3><p>ç»™å®šä¸€ä¸ªnä¸ªç‚¹mæ¡è¾¹çš„æ— å‘å¸¦æƒå›¾ï¼Œæ¯æ¬¡è¯¢é—®2ç‚¹u,vçš„è”é€šæƒ…å†µï¼Œä¸è”é€šåˆ™è¾“å‡º-1ã€‚<br>å¦‚æœè”é€šï¼Œä¸å¦¨å°†ä¸€æ¡è”é€šu,vçš„è·¯å¾„ä¸Šçš„æœ€å°æƒå€¼è®°ä¸ºwï¼Œåˆ™è¯¥æ¬¡è¯¢é—®è¾“å‡ºæ‰€æœ‰å¯èƒ½çš„wä¸­çš„æœ€å¤§å€¼ã€‚<br>å…±æœ‰qæ¬¡è¯¢é—®ã€‚</p>\n<hr>\n<h3 id=\"æ€è·¯\"><a href=\"#æ€è·¯\" class=\"headerlink\" title=\"æ€è·¯\"></a>æ€è·¯</h3><p>å¯¹äºä»»æ„ä¸¤ç‚¹u&amp;vï¼Œæˆ‘ä»¬éœ€è¦æ‰¾å‡ºèƒ½ä½¿å¾—wæœ€å¤§çš„ä¸€æ¡æœ€ä¼˜è·¯å¾„ã€‚<br>å› æ­¤éœ€è¦ç”Ÿæˆä¸€ä¸ªæ–°å›¾ï¼Œä½¿å¾—åŸå›¾ä¸­è”é€š<strong>ä»»æ„ä¸¤ç‚¹ä¹‹é—´åªå­˜åœ¨ä¸€æ¡</strong>èƒ½ä½¿å¾—wæœ€å¤§çš„æœ€ä¼˜è·¯å¾„ã€‚<br>å› æ­¤è¿™æ˜¯ä¸€æ£µæ ‘â€¦â€¦<br>åˆå› ä¸ºè¦ä½¿wæœ€å¤§ï¼Œåº”å°½é‡é€‰æ‹©è¾¹æƒå¤§çš„è¾¹ä½œä¸ºè·¯å¾„â€¦â€¦  ç„¶åå°±çªç„¶å‘è§‰ï¼šè¿™ä¸å°±æ˜¯Kruskalç®—æ³•çš„è¿‡ç¨‹å—ï¼Ÿåªä¸è¿‡æœ€å°ç”Ÿæˆæ ‘ä¼˜å…ˆé€‰æ‹©è¾¹æƒå°çš„è¾¹ï¼Œæ­¤æ—¶ä¼˜å…ˆé€‰æ‹©è¾¹æƒå¤§çš„ã€‚<br>å› æ­¤è¦æ±‚çš„æ–°å›¾å°±æ˜¯ä¸€é¢—<strong>æœ€å¤§ç”Ÿæˆæ ‘</strong>â€¦â€¦Kruskalå¯ç ´ã€‚<br>ç„¶åå°±æ˜¯æ±‚ä»»æ„ä¸¤ç‚¹LCAäº†ã€‚æ­¤å¤„ä½¿ç”¨å€å¢ï¼Œä¹Ÿæ–¹ä¾¿ç»´æŠ¤æŸèŠ‚ç‚¹å‘æ ‘æ ¹çˆ¬çš„æ—¶å€™è·¯ä¸Šçš„æœ€å°æƒå€¼ã€‚<br>ï¼ˆç”¨æ ‘é“¾å‰–åˆ†+çº¿æ®µæ ‘ç»´æŠ¤ä¹Ÿè¡Œâ€¦â€¦â€¦â€¦ï¼‰<br>æ›´å…·ä½“çš„çœ‹ä»£ç æ³¨é‡Šã€‚</p>\n<hr>\n<h3 id=\"ä»£ç \"><a href=\"#ä»£ç \" class=\"headerlink\" title=\"ä»£ç \"></a>ä»£ç </h3><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;bits/stdc++.h&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> inf 1000000005</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Node</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> u,v,w;<span class=\"comment\">//ä¸¤ç‚¹u&amp;vä»¥åŠè¾¹æƒ</span></span><br><span class=\"line\">    <span class=\"type\">bool</span> <span class=\"keyword\">operator</span> &lt; (<span class=\"type\">const</span> Node &amp;b) <span class=\"type\">const</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> w&lt;b.w;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">vector &lt;Node&gt; e[<span class=\"number\">50005</span>];<span class=\"comment\">//e[u]å‚¨å­˜èŠ‚ç‚¹uç›¸è¿çš„è¾¹é›†ã€‚</span></span><br><span class=\"line\">priority_queue &lt;Node&gt; Q;<span class=\"comment\">//è¾¹æƒè¶Šå¤§çš„ä¼˜å…ˆçº§è¶Šé«˜</span></span><br><span class=\"line\"><span class=\"type\">int</span> fa[<span class=\"number\">50005</span>];<span class=\"comment\">//Kruskalçš„å¾¡ç”¨å¹¶æŸ¥é›†ï¼Œfa[u]ä»£è¡¨uç‚¹æ‰€å¤„é›†åˆ</span></span><br><span class=\"line\"><span class=\"type\">bool</span> vis[<span class=\"number\">50005</span>];<span class=\"comment\">//æ˜¯å¦å·²ç»è¢«dfsè¿‡ç¨‹è®¿é—®è¿‡</span></span><br><span class=\"line\"><span class=\"type\">int</span> fas[<span class=\"number\">50005</span>][<span class=\"number\">21</span>],minw[<span class=\"number\">50005</span>][<span class=\"number\">21</span>],deep[<span class=\"number\">50005</span>];</span><br><span class=\"line\"><span class=\"comment\">//fas[u][j]ä»£è¡¨uç‚¹åœ¨æ‰€å¤„æ ‘ä¸­çš„ç¬¬2^jçº§çˆ¶äº²ç¼–å·</span></span><br><span class=\"line\"><span class=\"comment\">//minw[u][j]ä»£è¡¨uç‚¹åœ¨æ‰€å¤„æ ‘ä¸­è‡³ç¬¬2^jçº§çˆ¶äº²çš„è·¯å¾„ä¸Šæœ€å°è¾¹æƒ</span></span><br><span class=\"line\"><span class=\"comment\">//deep[u]ä»£è¡¨uç‚¹åœ¨æ‰€å¤„æ ‘ä¸­æ·±åº¦</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">find</span><span class=\"params\">(<span class=\"type\">int</span> x)</span><span class=\"comment\">//æŸ¥æ‰¾xæ‰€åœ¨é›†åˆç¼–å·</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (x==fa[x]) <span class=\"keyword\">return</span> x;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">return</span> fa[x]=<span class=\"built_in\">find</span>(fa[x]);<span class=\"comment\">//è·¯å¾„å‹ç¼©</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">uni</span><span class=\"params\">(<span class=\"type\">int</span> a,<span class=\"type\">int</span> b)</span> <span class=\"comment\">//åˆå¹¶a,bæ‰€åœ¨é›†åˆ</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    fa[<span class=\"built_in\">find</span>(a)]=<span class=\"built_in\">find</span>(b);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"type\">int</span> u,<span class=\"type\">int</span> v,<span class=\"type\">int</span> w)</span> <span class=\"comment\">//æ·»åŠ æ–°å›¾è¾¹</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    Node one;</span><br><span class=\"line\">    one.u=u;</span><br><span class=\"line\">    one.v=v;</span><br><span class=\"line\">    one.w=w;</span><br><span class=\"line\">    e[u].<span class=\"built_in\">push_back</span>(one);</span><br><span class=\"line\">    <span class=\"built_in\">uni</span>(u,v);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(<span class=\"type\">int</span> u,<span class=\"type\">int</span> f,<span class=\"type\">int</span> k)</span><span class=\"comment\">//dfsï¼Œuä»£è¡¨å½“å‰ç‚¹ï¼Œfä¸ºå½“å‰ç‚¹çˆ¶äº²ï¼Œkä¸ºæ·±åº¦</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    vis[u]=<span class=\"number\">1</span>;</span><br><span class=\"line\">    deep[u]=k;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;e[u].<span class=\"built_in\">size</span>();i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (e[u][i].v==f) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">dfs</span>(e[u][i].v,u,k+<span class=\"number\">1</span>);</span><br><span class=\"line\">            fas[e[u][i].v][<span class=\"number\">0</span>]=u;</span><br><span class=\"line\">            minw[e[u][i].v][<span class=\"number\">0</span>]=e[u][i].w;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">int</span> n,m,q;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">Kruskal</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> linked=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(!Q.<span class=\"built_in\">empty</span>()&amp;&amp;linked&lt;n<span class=\"number\">-1</span>) &#123;<span class=\"comment\">//è¾¹æ•°må¯èƒ½å°‘äºn-1ï¼Œå› æ­¤éœ€è¦æ³¨æ„Qæ˜¯å¦ä¸ºç©º</span></span><br><span class=\"line\">        Node now=Q.<span class=\"built_in\">top</span>();</span><br><span class=\"line\">        Q.<span class=\"built_in\">pop</span>();</span><br><span class=\"line\">        <span class=\"type\">int</span> a=now.u,b=now.v;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">find</span>(a)==<span class=\"built_in\">find</span>(b)) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            linked++;</span><br><span class=\"line\">            <span class=\"built_in\">add</span>(a,b,now.w);</span><br><span class=\"line\">            <span class=\"built_in\">add</span>(b,a,now.w);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">lca</span><span class=\"params\">(<span class=\"type\">int</span> x,<span class=\"type\">int</span> y)</span><span class=\"comment\">//æ±‚xï¼Œyçš„lca</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">find</span>(x)!=<span class=\"built_in\">find</span>(y)) <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;<span class=\"comment\">//ä¸åœ¨ä¸€ä¸ªæ ‘é‡Œ</span></span><br><span class=\"line\">    <span class=\"type\">int</span> ans=inf;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (deep[y] &gt;deep[x]) <span class=\"built_in\">swap</span>(x,y);<span class=\"comment\">//è¾ƒæ·±çš„æ ‡è®°ä¸ºx</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">20</span>;i&gt;=<span class=\"number\">0</span>;i--)<span class=\"comment\">//ä»¤xè·³åˆ°ä¸yç›¸åŒé«˜åº¦</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(deep[fas[x][i]]&gt;=deep[y])&#123;</span><br><span class=\"line\">            ans=<span class=\"built_in\">min</span>(ans,minw[x][i]);</span><br><span class=\"line\">            x=fas[x][i];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (x==y) <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">20</span>; i&gt;=<span class=\"number\">0</span>; i--)<span class=\"comment\">//è®©x,yä¸€èµ·è·³åˆ°lcaèŠ‚ç‚¹ä¸‹æ–¹</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(fas[x][i]!=fas[y][i])&#123;</span><br><span class=\"line\">            ans=<span class=\"built_in\">min</span>(ans,<span class=\"built_in\">min</span>(minw[x][i],minw[y][i]));</span><br><span class=\"line\">            x=fas[x][i]; </span><br><span class=\"line\">            y=fas[y][i];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ans=<span class=\"built_in\">min</span>(ans,<span class=\"built_in\">min</span>(minw[x][<span class=\"number\">0</span>],minw[y][<span class=\"number\">0</span>]));<span class=\"comment\">//ç»Ÿè®¡æœ€å°è¾¹æƒ</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;i++)</span><br><span class=\"line\">        fa[i]=i;<span class=\"comment\">//å¹¶æŸ¥é›†é¢„å¤„ç†ï¼Œå„ä¸ªç‚¹éƒ½å¤„äºè‡ªå·±æ‰€ä»£è¡¨çš„é›†åˆ</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i=<span class=\"number\">1</span>;i&lt;=m;i++) &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> x,y,z;</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d%d%d&quot;</span>,&amp;x,&amp;y,&amp;z);</span><br><span class=\"line\">        Node one;</span><br><span class=\"line\">        one.u=x;</span><br><span class=\"line\">        one.v=y;</span><br><span class=\"line\">        one.w=z;</span><br><span class=\"line\">        Q.<span class=\"built_in\">push</span>(one);<span class=\"comment\">//åŠ å…¥Kruskalå¾¡ç”¨é˜Ÿåˆ—Q</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">Kruskal</span>();<span class=\"comment\">//æœ€å¤§ç”Ÿæˆæ ‘</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;i++) &#123;<span class=\"comment\">//å€å¢æ•°ç»„åˆå§‹åŒ–&amp;dfs</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!vis[i]) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">dfs</span>(i,<span class=\"number\">0</span>,<span class=\"number\">1</span>);</span><br><span class=\"line\">            fas[i][<span class=\"number\">0</span>]=i;</span><br><span class=\"line\">            minw[i][<span class=\"number\">0</span>]=inf;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i=<span class=\"number\">1</span>;i&lt;=<span class=\"number\">20</span>;i++) &#123;<span class=\"comment\">//å€å¢é¢„å¤„ç†</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j=<span class=\"number\">1</span>;j&lt;=n;j++) &#123;</span><br><span class=\"line\">            fas[j][i]=fas[fas[j][i<span class=\"number\">-1</span>]][i<span class=\"number\">-1</span>];</span><br><span class=\"line\">            minw[j][i]=<span class=\"built_in\">min</span>(minw[j][i<span class=\"number\">-1</span>],minw[fas[j][i<span class=\"number\">-1</span>]][i<span class=\"number\">-1</span>]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>,&amp;q);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i=<span class=\"number\">1</span>;i&lt;=q;i++) &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> a,b;</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d%d&quot;</span>,&amp;a,&amp;b);</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>,<span class=\"built_in\">lca</span>(a,b));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>",
            "tags": [
                "å›¾è®º",
                "Kruskal"
            ]
        },
        {
            "id": "http://cubicy.icu/2018/09/28/%E6%B4%9B%E8%B0%B7P1901%20%E5%8F%91%E5%B0%84%E7%AB%99/",
            "url": "http://cubicy.icu/2018/09/28/%E6%B4%9B%E8%B0%B7P1901%20%E5%8F%91%E5%B0%84%E7%AB%99/",
            "title": "æ´›è°·:P1901 å‘å°„ç«™",
            "date_published": "2018-09-28T05:11:00.000Z",
            "content_html": "<p>åŸé¢˜åœ°å€:<a href>https://www.luogu.org/problemnew/show/P1901</a>  </p>\n<h3 id=\"é¢˜ç›®ç®€è¿°\"><a href=\"#é¢˜ç›®ç®€è¿°\" class=\"headerlink\" title=\"é¢˜ç›®ç®€è¿°\"></a>é¢˜ç›®ç®€è¿°</h3><p>æœ‰ N ä¸ªèƒ½é‡å‘å°„ç«™æ’æˆä¸€è¡Œï¼Œæ¯ä¸ªéƒ½æœ‰**ä¸ç›¸åŒçš„é«˜åº¦ $H_i$**ï¼Œèƒ½å‘ä¸¤è¾¹ï¼ˆå½“ç„¶ä¸¤ç«¯çš„åªèƒ½å‘ä¸€è¾¹ï¼‰åŒæ—¶å‘å°„èƒ½é‡å€¼ä¸º$V_i$ çš„èƒ½é‡ï¼Œå¹¶ä¸”å‘å‡ºçš„èƒ½é‡åªè¢«ä¸¤è¾¹æœ€è¿‘çš„ä¸”æ¯”å®ƒé«˜çš„å‘å°„ç«™æ¥æ”¶ã€‚</p>\n<p>æ˜¾ç„¶ï¼Œæ¯ä¸ªå‘å°„ç«™å‘æ¥çš„èƒ½é‡æœ‰å¯èƒ½è¢«0æˆ–1æˆ–2ä¸ªå…¶ä»–å‘å°„ç«™æ‰€æ¥å—ï¼Œæ±‚æ¥æ”¶æœ€å¤šèƒ½é‡çš„å‘å°„ç«™æ¥æ”¶çš„èƒ½é‡æ˜¯å¤šå°‘ã€‚</p>\n<hr>\n<h3 id=\"æ€è·¯\"><a href=\"#æ€è·¯\" class=\"headerlink\" title=\"æ€è·¯\"></a>æ€è·¯</h3><p>æ¯ä¸ªèƒ½é‡å¡”å°„å‡ºçš„èƒ½é‡è¢«å·¦å³ç¬¬ä¸€ä¸ªæ¯”å…¶é«˜çš„å¡”æ‰€æ‹¦æˆªã€‚éšéšçº¦çº¦è§‰å¾—å¯ä»¥ç”¨å•è°ƒæ ˆæâ€¦â€¦<br>ç»´æŠ¤ä¸€ä¸ªé«˜åº¦å•è°ƒä¸å‡æ ˆï¼Œè€ƒè™‘<strong>ä¾æ¬¡</strong>å°†èƒ½é‡å¡”iåŠ å…¥æ ˆï¼š  </p>\n<ol>\n<li>å¦‚æœé«˜åº¦æ¯”æ ˆé¡¶å…ƒç´ å¤§æˆ–æ ˆç©ºï¼Œæ ˆé¡¶å…ƒç´ èƒ½é‡åŠ ä¸Š$V_i$ï¼Œå‹å…¥æ ˆ;  </li>\n<li>å¦‚æœé«˜åº¦æ¯”æ ˆé¡¶å…ƒç´ å°ï¼ˆæ ˆé¡¶å…ƒç´ ç¼–å·è®°ä¸ºtopï¼‰ï¼Œå½“å‰èƒ½é‡å¡”iæ¥æ”¶çš„èƒ½é‡åŠ ä¸Š$V_{top}$ï¼Œå¼¹å‡ºæ ˆé¡¶å…ƒç´ ã€‚é‡å¤æ‰§è¡Œç›´åˆ°ç¬¦åˆæƒ…å†µ1ï¼ŒæŒ‰1çš„å¤„ç†æ–¹æ³•å¤„ç†ã€‚<br>æœ€åç›´æ¥æ‰«æä¸€éæœ€å¤§å€¼ï¼Œè¾“å‡ºã€‚</li>\n</ol>\n<hr>\n<h3 id=\"ä»£ç \"><a href=\"#ä»£ç \" class=\"headerlink\" title=\"ä»£ç \"></a>ä»£ç </h3><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;bits/stdc++.h&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"type\">int</span> s1[<span class=\"number\">1000010</span>],h[<span class=\"number\">1000010</span>],v[<span class=\"number\">1000010</span>],sum[<span class=\"number\">1000010</span>],ans,n,top;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>,&amp;n);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;i++) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d%d&quot;</span>,&amp;h[i],&amp;v[i]);</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(top&amp;&amp;h[s1[top]]&lt;h[i])</span><br><span class=\"line\">            sum[i]+=v[s1[top]],top--;</span><br><span class=\"line\">        sum[s1[top]]+=v[i];</span><br><span class=\"line\">        top++;</span><br><span class=\"line\">        s1[top]=i;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;i++)</span><br><span class=\"line\">        ans=<span class=\"built_in\">max</span>(ans,sum[i]);</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d&quot;</span>,ans);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>",
            "tags": [
                "Stack"
            ]
        },
        {
            "id": "http://cubicy.icu/2018/08/03/%E6%9B%BF%E7%BD%AA%E7%BE%8A%E6%A0%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/",
            "url": "http://cubicy.icu/2018/08/03/%E6%9B%BF%E7%BD%AA%E7%BE%8A%E6%A0%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/",
            "title": "æ›¿ç½ªç¾Šæ ‘å­¦ä¹ ç¬”è®°",
            "date_published": "2018-08-03T08:53:00.000Z",
            "content_html": "<p>åšå®¢å’•å’•å’•äº†å¥½ä¹…â€¦â€¦æœ€è¿‘ä¼šé€æ­¥ç»§ç»­æ¢å¤æ›´æ–°åšå®¢çš„ã€‚<br>æœ€è¿‘åˆåœ¨å­¦ä¹ äºŒå‰æœç´¢æ ‘ã€‚å®æµ‹å‘ç°æ›¿ç½ªç¾Šæ ‘å¿«çš„é£èµ·(æ—¶é—´çº¦Splayçš„1&#x2F;2)~å†™èµ·æ¥è¿˜æ¯”è¾ƒç®€å•ï¼Œå†³å®šæ¥ä¸€æ³¢ã€‚<br>ï¼ˆé‚£ä¸ºä»€ä¹ˆè¿˜è¦ç”¨Splayå‘¢ï¼Ÿå› ä¸ºSplayæ˜¯åºåˆ—ä¹‹ç‹ï¼è¿˜èƒ½ç»´æŠ¤LCTï¼ï¼ˆä½ è¦ç”¨éæ—‹Treapï¼ˆFHQ-Treapï¼‰æˆ‘ä¹Ÿæ²¡æ„è§ï¼‰ï¼‰<br>æ›¿ç½ªç¾Šæ ‘çš„ä¸»è¦æ€æƒ³å°±æ˜¯å½“å‡ºç°é‡é‡å¤±è¡¡çš„æ—¶å€™ï¼Œ<strong>æŠŠç½ªé­ç¥¸é¦–çš„é‚£ä¸ªå­æ ‘æ‹å‡ºæ¥ï¼Œé‡æ–°æŒ‰æœ€å®Œç¾çš„æ–¹å¼ï¼ˆä¹Ÿå°±æ˜¯è¿‘ä¼¼å®Œå…¨äºŒå‰æ ‘ï¼‰æ„é€ ä¸€éå†æ¥å›å»</strong>ã€‚<br>å¦‚ä½•å®šä¹‰æŸä¸ªå­æ ‘ä¸å¹³è¡¡ï¼šå½“è¿™ä¸ªå­æ ‘çš„å·¦å³å­æ ‘å…¶ä¸­ä¹‹ä¸€çš„â€œé‡é‡â€ï¼ˆèŠ‚ç‚¹ä¸ªæ•°ï¼‰è¶…è¿‡äº†æ•´ä¸ªå­æ ‘çš„Î±*100%æ—¶ï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™ä¸ªå­æ ‘ä¸å¹³è¡¡ã€‚<br>ä¸¾ä¾‹ï¼šÎ±&#x3D;0.75æ—¶ï¼Œå¦‚æœä¸€ä¸ªå­æ ‘å·¦å­æ ‘æœ‰4ä¸ªèŠ‚ç‚¹ï¼Œå³å­æ ‘æœ‰1ä¸ªï¼Œè¿™ä¸ªå­æ ‘å¤§å°å°±æ˜¯4+1+1&#x3D;6ï¼Œå·¦å­æ ‘å æ¯”è¶…è¿‡äº†Î±*100%ï¼ˆå³75%ï¼‰ï¼Œè¿™ä¸ªå­æ ‘ä¸å¹³è¡¡ï¼Œéœ€è¦é‡æ„ã€‚<br>æ˜¾ç„¶ï¼ŒÎ±å–å€¼ä»‹äº0.5è‡³1.0ä¹‹é—´ï¼Œè¶Šå°æ ‘è¶Šå¹³è¡¡ä½†é‡æ„æ¬¡æ•°è¶Šå¤šï¼Œè¶Šå¤§é‡æ„æ¬¡æ•°è¶Šå°‘ä½†æ ‘è¶Šä¸å¹³è¡¡ã€‚å¤ªå¤§å¤ªå°éƒ½ä¼šå‡ºäº‹ã€‚<strong>ä¸€èˆ¬è€Œè¨€ï¼ŒÎ±å–0.75</strong>ã€‚å¦‚æœé¢˜ç›®æŸ¥è¯¢æ¬¡æ•°è¿œå¤§äºæ’å…¥æ¬¡æ•°ï¼Œå¯ç•¥å¾®é™ä½Î±å–å€¼ï¼ˆæ¯”å¦‚Î±&#x3D;0.70ï¼‰ï¼›è‹¥è¿œå°äºï¼Œåˆ™ç•¥å‡é«˜ï¼ˆå¦‚Î±&#x3D;0.80ï¼‰ã€‚<br>ä¸‹é¢ä»¥<a href=\"https://www.luogu.org/problemnew/show/P3369\">æ´›è°·3369ã€æ¨¡æ¿ã€‘æ™®é€šå¹³è¡¡æ ‘</a>ä¸ºä¾‹ï¼š  </p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//è¿™ä¸ªæ¿å­æœ‰æ”¹è¿›ä¹‹å¤„ï¼šæ¯”å¦‚åˆ é™¤èŠ‚ç‚¹å¯ä»¥æ‰“ä¸Šåˆ é™¤æ‡’æ ‡è®°ï¼Œå•ä¸ªèŠ‚ç‚¹å¯ä»¥è®°å½•åŒä¸€æ•°å­—æ•°é‡é¿å…å¤šä½™èŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;cstdlib&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> inf (1&lt;&lt;30)</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> maxn (2100000)</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> db double</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> il inline</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> RG register</span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">const</span> db al=<span class=\"number\">0.75</span>;<span class=\"comment\">//Î±</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">node</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> son[<span class=\"number\">2</span>],fa,size,num;<span class=\"comment\">//å·¦å³å­©å­å‚¨å­˜åœ°å€ï¼ŒèŠ‚ç‚¹çˆ¶äº²ï¼Œä»¥è¯¥èŠ‚ç‚¹ä¸ºæ ¹å­æ ‘çš„é‡é‡ï¼Œè¯¥èŠ‚ç‚¹å‚¨å­˜çš„æ•°å­—</span></span><br><span class=\"line\">&#125; t[maxn];</span><br><span class=\"line\"><span class=\"type\">int</span> n,cnt,root;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">il <span class=\"type\">bool</span> <span class=\"title\">balance</span><span class=\"params\">(RG <span class=\"type\">int</span> id)</span>   <span class=\"comment\">//åˆ¤æ–­å­æ ‘æ˜¯å¦å¹³è¡¡</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (db)(t[id].size*al&gt;=(db)t[ t[id].son[<span class=\"number\">0</span>] ].size) &amp;&amp; (db)( t[id].size*al&gt;=(db)t[t[ id].son[<span class=\"number\">1</span>] ].size);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">int</span> cur[maxn],sum;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">il <span class=\"type\">void</span> <span class=\"title\">recycle</span><span class=\"params\">(RG <span class=\"type\">int</span> id)</span>    <span class=\"comment\">//å‹æ‰ï¼ŒæŠŠéœ€è¦é‡æ„çš„å­æ ‘æ‹å‡ºæ¥å…ˆæ‹æ‰æˆåºåˆ—</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(t[id].son[<span class=\"number\">0</span>]) <span class=\"built_in\">recycle</span>(t[id].son[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    cur[++sum]=id;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(t[id].son[<span class=\"number\">1</span>]) <span class=\"built_in\">recycle</span>(t[id].son[<span class=\"number\">1</span>]);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">il <span class=\"type\">int</span> <span class=\"title\">build</span><span class=\"params\">(RG <span class=\"type\">int</span> l,RG <span class=\"type\">int</span> r)</span>   <span class=\"comment\">//é€’å½’å»ºæ ‘ï¼Œä½¿ç»“æ„æœ€ä¼˜</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(l&gt;r) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    RG <span class=\"type\">int</span> mid=(l+r)&gt;&gt;<span class=\"number\">1</span>,id=cur[mid];</span><br><span class=\"line\">    t[ t[id].son[<span class=\"number\">0</span>]=<span class=\"built_in\">build</span>(l,mid<span class=\"number\">-1</span>) ].fa=id;</span><br><span class=\"line\">    t[ t[id].son[<span class=\"number\">1</span>]=<span class=\"built_in\">build</span>(mid+<span class=\"number\">1</span>,r) ].fa=id;</span><br><span class=\"line\">    t[id].size=t[ t[id].son[<span class=\"number\">0</span>] ].size+t[ t[id].son[<span class=\"number\">1</span>] ].size+<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> id;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">il <span class=\"type\">void</span> <span class=\"title\">rebuild</span><span class=\"params\">(RG <span class=\"type\">int</span> id)</span>   <span class=\"comment\">//é‡æ„å­æ ‘ï¼Œå†â€œæ¥å›å»â€</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    sum=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"built_in\">recycle</span>(id);</span><br><span class=\"line\">    RG <span class=\"type\">int</span> fa=t[id].fa,Son=( t[ t[id].fa ].son[<span class=\"number\">1</span>]==id );</span><br><span class=\"line\">    RG <span class=\"type\">int</span> cur=<span class=\"built_in\">build</span>(<span class=\"number\">1</span>,sum);</span><br><span class=\"line\">    t[ t[fa].son[Son]=cur ].fa=fa;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(id==root) root=cur;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">il <span class=\"type\">void</span> <span class=\"title\">insert</span><span class=\"params\">(RG <span class=\"type\">int</span> x)</span><span class=\"comment\">//æ’å…¥ä¸€ä¸ªæ•°å­—x</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    RG <span class=\"type\">int</span> now=root,cur=++cnt;</span><br><span class=\"line\">    t[cur].size=<span class=\"number\">1</span>,t[cur].num=x;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(<span class=\"number\">1</span>) &#123; <span class=\"comment\">//æ‰¾åˆ°é€‚åˆä½ç½®æ’å…¥</span></span><br><span class=\"line\">        t[now].size++;</span><br><span class=\"line\">        RG <span class=\"type\">bool</span> Son=(x&gt;=t[now].num);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>( t[now].son[Son] ) now=t[now].son[Son];</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            t[ t[now].son[Son]=cur ].fa=now;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    RG <span class=\"type\">int</span> flag=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(RG <span class=\"type\">int</span> i=cur; i; i=t[i].fa) <span class=\"keyword\">if</span>(!<span class=\"built_in\">balance</span>(i)) flag=i;<span class=\"comment\">//æ³¨æ„ï¼šé‡å»ºæ—¶å–æ·±åº¦æœ€æµ…çš„ï¼Œä»¥é¿å…å°å­æ ‘é‡æ„å®Œå¤§å­æ ‘è¿˜é‡æ„ï¼Œæµªè´¹æ—¶é—´</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(flag) <span class=\"built_in\">rebuild</span>(flag); <span class=\"comment\">//æ’å…¥å¾€å¾€ä¼šå¯¼è‡´ä¸å¹³è¡¡,è¿™æ—¶éœ€è¦é‡å»ºä¸å¹³è¡¡çš„å­æ ‘å³å¯</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">il <span class=\"type\">int</span> <span class=\"title\">get_num</span><span class=\"params\">(RG <span class=\"type\">int</span> x)</span>   <span class=\"comment\">//æŸ¥è¯¢ x åœ¨æ ‘ä¸­çš„èŠ‚ç‚¹ç¼–å·ï¼ˆåœ¨æ•°ç»„ä¸­å‚¨å­˜ä½ç½®ä¸‹æ ‡ï¼‰</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    RG <span class=\"type\">int</span> now=root;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(t[now].num==x) <span class=\"keyword\">return</span> now;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> now=t[now].son[ t[now].num&lt;x ];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">il <span class=\"type\">void</span> <span class=\"title\">erase</span><span class=\"params\">(RG <span class=\"type\">int</span> id)</span>   <span class=\"comment\">//åˆ é™¤</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(t[id].son[<span class=\"number\">0</span>] &amp;&amp; t[id].son[<span class=\"number\">1</span>]) &#123;</span><br><span class=\"line\">        RG <span class=\"type\">int</span> cur=t[id].son[<span class=\"number\">0</span>];</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(t[cur].son[<span class=\"number\">1</span>]) cur=t[cur].son[<span class=\"number\">1</span>];</span><br><span class=\"line\">        t[id].num=t[cur].num;</span><br><span class=\"line\">        id=cur;</span><br><span class=\"line\">    &#125; <span class=\"comment\">//åˆ é™¤æ“ä½œéœ€è¦æ‰¾åˆ°å·¦å­æ ‘çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹æˆ–å³å­æ ‘çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ¥é¡¶æ›¿,ä¼˜å…ˆæ‰¾å·¦å­æ ‘</span></span><br><span class=\"line\">    RG <span class=\"type\">int</span> Son=(t[id].son[<span class=\"number\">0</span>]) ? t[id].son[<span class=\"number\">0</span>]:t[id].son[<span class=\"number\">1</span>];</span><br><span class=\"line\">    RG <span class=\"type\">int</span> k=( t[ t[id].fa ].son[<span class=\"number\">1</span>]==id );</span><br><span class=\"line\">    t[ t[ t[id].fa ].son[k]=Son ].fa=t[id].fa;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(RG <span class=\"type\">int</span> i=t[id].fa; i; i=t[i].fa) t[i].size--;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(id==root) root=Son;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">il <span class=\"type\">int</span> <span class=\"title\">get_rank</span><span class=\"params\">(RG <span class=\"type\">int</span> x)</span>   <span class=\"comment\">//æŸ¥ x çš„æ’å</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    RG <span class=\"type\">int</span> now=root,ans=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(now) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(t[now].num&lt;x) ans+=t[ t[now].son[<span class=\"number\">0</span>] ].size+<span class=\"number\">1</span>,now=t[now].son[<span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"keyword\">else</span> now=t[now].son[<span class=\"number\">0</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">il <span class=\"type\">int</span> <span class=\"title\">get_kth</span><span class=\"params\">(RG <span class=\"type\">int</span> x)</span>   <span class=\"comment\">//æŸ¥æ ‘ä¸­çš„ç¬¬ k ä¸ªæ•°</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    RG <span class=\"type\">int</span> now=root;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(t[ t[now].son[<span class=\"number\">0</span>] ].size==x<span class=\"number\">-1</span>) <span class=\"keyword\">return</span> now;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(t[ t[now].son[<span class=\"number\">0</span>] ].size&gt;=x) now=t[now].son[<span class=\"number\">0</span>];</span><br><span class=\"line\">        <span class=\"keyword\">else</span> x-=t[ t[now].son[<span class=\"number\">0</span>] ].size+<span class=\"number\">1</span>,now=t[now].son[<span class=\"number\">1</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> now;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    cnt=<span class=\"number\">2</span>,root=<span class=\"number\">1</span>;</span><br><span class=\"line\">    t[<span class=\"number\">1</span>].num=-inf,t[<span class=\"number\">1</span>].size=<span class=\"number\">2</span>,t[<span class=\"number\">1</span>].son[<span class=\"number\">1</span>]=<span class=\"number\">2</span>;</span><br><span class=\"line\">    t[<span class=\"number\">2</span>].num=inf,t[<span class=\"number\">2</span>].size=<span class=\"number\">1</span>,t[<span class=\"number\">2</span>].fa=<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>,&amp;n);</span><br><span class=\"line\">    RG <span class=\"type\">int</span> type,x;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(RG <span class=\"type\">int</span> i=<span class=\"number\">1</span>; i&lt;=n; i++) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d%d&quot;</span>,&amp;type,&amp;x);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(type==<span class=\"number\">1</span>) <span class=\"built_in\">insert</span>(x);</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(type==<span class=\"number\">2</span>) <span class=\"built_in\">erase</span>( <span class=\"built_in\">get_num</span>(x) );</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(type==<span class=\"number\">3</span>) <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>,<span class=\"built_in\">get_rank</span>(x));</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(type==<span class=\"number\">4</span>) <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>,t[ <span class=\"built_in\">get_kth</span>(x+<span class=\"number\">1</span>) ].num);</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(type==<span class=\"number\">5</span>) <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>,t[<span class=\"built_in\">get_kth</span>(<span class=\"built_in\">get_rank</span>(x))].num);</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(type==<span class=\"number\">6</span>) <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>,t[<span class=\"built_in\">get_kth</span>(<span class=\"built_in\">get_rank</span>(x+<span class=\"number\">1</span>)+<span class=\"number\">1</span>)].num);<span class=\"comment\">//æ³¨æ„æ­¤å¤„ </span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>",
            "tags": [
                "Treap"
            ]
        },
        {
            "id": "http://cubicy.icu/2018/04/09/%E6%B4%9B%E8%B0%B7P1486%20[NOI2004]%E9%83%81%E9%97%B7%E7%9A%84%E5%87%BA%E7%BA%B3%E5%91%98/",
            "url": "http://cubicy.icu/2018/04/09/%E6%B4%9B%E8%B0%B7P1486%20[NOI2004]%E9%83%81%E9%97%B7%E7%9A%84%E5%87%BA%E7%BA%B3%E5%91%98/",
            "title": "æ´›è°·:P1486 [NOI2004]éƒé—·çš„å‡ºçº³å‘˜",
            "date_published": "2018-04-09T14:23:00.000Z",
            "content_html": "<p>åŸé¢˜åœ°å€:<a href=\"https://www.luogu.org/problemnew/show/P1486\">https://www.luogu.org/problemnew/show/P1486</a>  </p>\n<h3 id=\"é¢˜ç›®ç®€è¿°\"><a href=\"#é¢˜ç›®ç®€è¿°\" class=\"headerlink\" title=\"é¢˜ç›®ç®€è¿°\"></a>é¢˜ç›®ç®€è¿°</h3><p>ä¸€ä¸ªåºåˆ—aï¼Œåˆå§‹ä¸ºç©ºã€‚<br>éšæ—¶æ’å…¥ä¸€ä¸ªæ•°ï¼ŒæŸ¥è¯¢ç¬¬kå¤§ï¼Œå…¨ä½“åŠ ï¼Œå…¨ä½“å‡ã€‚<br>ä½†æ˜¯å¦‚æœä»»ä½•æ•°åœ¨ä»»ä½•æ—¶åˆ»ä½äºç»™å®šçš„ä¸‹ç•ŒMINï¼Œåˆ™ç«‹å³ç§»é™¤å‡ºåºåˆ—ã€‚</p>\n<hr>\n<h3 id=\"æ€è·¯\"><a href=\"#æ€è·¯\" class=\"headerlink\" title=\"æ€è·¯\"></a>æ€è·¯</h3><p>æ’å…¥ï¼ŒæŸ¥è¯¢ç¬¬kå¤§ï¼Œå®¹æ˜“å‘ç°æ˜¯BSTé¢˜ã€‚äºæ˜¯ä¸ŠTreapã€‚<br>å…¨ä½“åŠ å…¨ä½“å‡æš´åŠ›åŠ è‚¯å®šä¸è¡Œï¼Œè€ƒè™‘ç”¨å˜é‡deltaå‚¨å­˜å˜åŒ–æƒ…å†µã€‚å…¨ä½“åŠ nå°±æ˜¯delta+&#x3D;nï¼ˆnä¸ºè´Ÿå°±æ˜¯å‡ï¼‰<br>äºæ˜¯æ¯ä¸ªæ•°å®é™…çš„å€¼æ˜¯ï¼šæ ‘é‡Œå‚¨å­˜è¯¥æ•°çš„å€¼+delta  â€”â€”â‘ <br>å‡äº†ä¹‹åå¯èƒ½ä¼šæœ‰æ•°ä½äºä¸‹ç•Œï¼ŒæŸ¥æ‰¾æœ€å°çš„æ•°åˆ¤æ–­æ˜¯ä¸æ˜¯å°äºMINï¼Œæ˜¯çš„è¯åˆ é™¤ï¼Œé‡å¤ç›´åˆ°ä¸å†å°äºMINã€‚<br>æ³¨æ„æ–°æ’å…¥çš„æ•°ä¸åº”è¯¥å—ä¹‹å‰çš„åŠ å‡å½±å“ï¼Œæ‰€ä»¥å°†ä¸€ä¸ªæ•°å­—numæ’å…¥æ ‘ä¸­æ—¶ï¼Œå¦‚æœç›´æ¥æŠŠnumæ’å…¥æ ‘ä¸­ï¼Œå°±å˜æˆnum+deltaäº†ã€‚<br>å®é™…åº”è¯¥æ’å…¥çš„æ˜¯num-deltaï¼Œè¿™æ ·ç»“åˆä¸Šæ–‡â‘ ï¼Œç°åœ¨è¿™ä¸ªæ•°å®é™…çš„å€¼å°±æ˜¯numæœ¬èº«äº†ã€‚<br>æä¾›ä¸€ä¸ªæŒ‡é’ˆå®ç°çš„Treapï¼Œä¸æ¨èä½¿ç”¨å…¶å®ï¼Œè°ƒçš„æ—¶å€™å¿«æŠŠæˆ‘æåè¡€ã€‚</p>\n<hr>\n<h3 id=\"ä»£ç \"><a href=\"#ä»£ç \" class=\"headerlink\" title=\"ä»£ç \"></a>ä»£ç </h3><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdlib&gt;</span></span></span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstring&gt;</span></span></span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;ctime&gt;</span></span></span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cctype&gt;</span></span></span><br><span class=\"line\">    <span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\">    <span class=\"type\">const</span> <span class=\"type\">int</span> MAXN=<span class=\"number\">200010</span>;</span><br><span class=\"line\">    <span class=\"keyword\">struct</span> <span class=\"title class_\">Node</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> d,rnd,size;</span><br><span class=\"line\">        Node *ch[<span class=\"number\">2</span>],*pa;</span><br><span class=\"line\">    &#125;pool[MAXN],*root;</span><br><span class=\"line\">    <span class=\"type\">int</span> tot=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"function\">Node *<span class=\"title\">newnode</span><span class=\"params\">(<span class=\"type\">int</span> d)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        Node *p=&amp;pool[++tot];</span><br><span class=\"line\">        p-&gt;d=d;p-&gt;rnd=<span class=\"built_in\">rand</span>();p-&gt;size=<span class=\"number\">1</span>;</span><br><span class=\"line\">        p-&gt;ch[<span class=\"number\">0</span>]=p-&gt;ch[<span class=\"number\">1</span>]=<span class=\"literal\">NULL</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> p;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">int</span> <span class=\"title\">size</span><span class=\"params\">(Node *p)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> p?p-&gt;size:<span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">update</span><span class=\"params\">(Node *p)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        p-&gt;size=<span class=\"built_in\">size</span>(p-&gt;ch[<span class=\"number\">0</span>])+<span class=\"built_in\">size</span>(p-&gt;ch[<span class=\"number\">1</span>])+<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">rotate</span><span class=\"params\">(Node *p,<span class=\"type\">int</span> t)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        Node *pa=p-&gt;pa,*gp=pa-&gt;pa,*son=p-&gt;ch[t^<span class=\"number\">1</span>];</span><br><span class=\"line\">        pa-&gt;ch[t]=son;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(son)son-&gt;pa=pa;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(gp)gp-&gt;ch[pa==gp-&gt;ch[<span class=\"number\">1</span>]]=p;</span><br><span class=\"line\">        p-&gt;pa=gp;</span><br><span class=\"line\">        p-&gt;ch[t^<span class=\"number\">1</span>]=pa;</span><br><span class=\"line\">        pa-&gt;pa=p;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(pa==root)root=p;</span><br><span class=\"line\">        <span class=\"built_in\">update</span>(pa);</span><br><span class=\"line\">        <span class=\"built_in\">update</span>(p);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">treap</span><span class=\"params\">(Node *p)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(<span class=\"literal\">true</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(p==root || p-&gt;rnd &gt;= p-&gt;pa-&gt;rnd)<span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"built_in\">rotate</span>(p,p==p-&gt;pa-&gt;ch[<span class=\"number\">1</span>]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">insert</span><span class=\"params\">(Node *r,Node *p)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!r)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            root=p;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> f=(p-&gt;d &gt;= r-&gt;d);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!r-&gt;ch[f])</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            r-&gt;ch[f]=p;</span><br><span class=\"line\">            p-&gt;pa=r;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">            <span class=\"built_in\">insert</span>(r-&gt;ch[f],p);</span><br><span class=\"line\">        <span class=\"built_in\">update</span>(r);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\">Node* <span class=\"title\">find</span><span class=\"params\">(Node *r,<span class=\"type\">int</span> x)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x&lt;=<span class=\"built_in\">size</span>(r-&gt;ch[<span class=\"number\">0</span>]))<span class=\"keyword\">return</span> <span class=\"built_in\">find</span>(r-&gt;ch[<span class=\"number\">0</span>],x);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x==<span class=\"built_in\">size</span>(r-&gt;ch[<span class=\"number\">0</span>])+<span class=\"number\">1</span>)<span class=\"keyword\">return</span> r;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">find</span>(r-&gt;ch[<span class=\"number\">1</span>],x-<span class=\"built_in\">size</span>(r-&gt;ch[<span class=\"number\">0</span>])<span class=\"number\">-1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">del</span><span class=\"params\">(Node *p)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!p-&gt;ch[<span class=\"number\">0</span>] &amp;&amp; !p-&gt;ch[<span class=\"number\">1</span>])</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(p==root)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                root=<span class=\"literal\">NULL</span>;</span><br><span class=\"line\">                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            Node *pa=p-&gt;pa;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(pa)</span><br><span class=\"line\">                pa-&gt;ch[p==pa-&gt;ch[<span class=\"number\">1</span>]]=<span class=\"literal\">NULL</span>;</span><br><span class=\"line\">            <span class=\"keyword\">while</span>(p!=root)</span><br><span class=\"line\">                <span class=\"built_in\">update</span>(p=p-&gt;pa);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(p-&gt;ch[<span class=\"number\">0</span>] &amp;&amp; p-&gt;ch[<span class=\"number\">1</span>])</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> f=(p-&gt;ch[<span class=\"number\">1</span>]-&gt;rnd &lt; p-&gt;ch[<span class=\"number\">0</span>]-&gt;rnd);</span><br><span class=\"line\">            <span class=\"built_in\">rotate</span>(p-&gt;ch[f],f);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> f=<span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(p-&gt;ch[<span class=\"number\">0</span>])f=<span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"built_in\">rotate</span>(p-&gt;ch[f],f);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">del</span>(p);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">kth</span><span class=\"params\">(Node *r,<span class=\"type\">int</span> x)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x&lt;=<span class=\"built_in\">size</span>(r-&gt;ch[<span class=\"number\">0</span>]))<span class=\"keyword\">return</span> <span class=\"built_in\">kth</span>(r-&gt;ch[<span class=\"number\">0</span>],x);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x==<span class=\"built_in\">size</span>(r-&gt;ch[<span class=\"number\">0</span>])+<span class=\"number\">1</span>)<span class=\"keyword\">return</span> r-&gt;d;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">kth</span>(r-&gt;ch[<span class=\"number\">1</span>],x-<span class=\"built_in\">size</span>(r-&gt;ch[<span class=\"number\">0</span>])<span class=\"number\">-1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">char</span> <span class=\"title\">getUpper</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"type\">char</span> c;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(c=<span class=\"built_in\">getchar</span>())</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"built_in\">isupper</span>(c))</span><br><span class=\"line\">                <span class=\"keyword\">return</span> c;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">srand</span>((<span class=\"type\">int</span>)<span class=\"built_in\">time</span>(<span class=\"literal\">NULL</span>));</span><br><span class=\"line\">        <span class=\"type\">int</span> Q,Min,x;</span><br><span class=\"line\">        <span class=\"type\">char</span> op;</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d%d&quot;</span>,&amp;Q,&amp;Min);</span><br><span class=\"line\">        <span class=\"type\">int</span> ans=<span class=\"number\">0</span>,delta=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(Q--)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            op=<span class=\"built_in\">getUpper</span>();</span><br><span class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>,&amp;x);</span><br><span class=\"line\">            <span class=\"keyword\">switch</span>(op)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&#x27;I&#x27;</span>:</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(x&lt;Min)<span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    Node *p=<span class=\"built_in\">newnode</span>(x-delta);</span><br><span class=\"line\">                    <span class=\"built_in\">insert</span>(root,p);</span><br><span class=\"line\">                    <span class=\"built_in\">treap</span>(p);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&#x27;A&#x27;</span>:</span><br><span class=\"line\">                    delta+=x;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&#x27;S&#x27;</span>:</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    delta-=x;</span><br><span class=\"line\">                    <span class=\"type\">int</span> xtq=<span class=\"built_in\">size</span>(root);</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">1</span>;i&lt;=xtq;i++)</span><br><span class=\"line\">                        <span class=\"keyword\">if</span>(<span class=\"built_in\">kth</span>(root,<span class=\"number\">1</span>)+delta&lt;Min)</span><br><span class=\"line\">                        &#123;</span><br><span class=\"line\">                            <span class=\"built_in\">del</span>(<span class=\"built_in\">find</span>(root,<span class=\"number\">1</span>));</span><br><span class=\"line\">                            ans++;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        <span class=\"keyword\">else</span> <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"string\">&#x27;F&#x27;</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(x&gt;<span class=\"built_in\">size</span>(root))<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;-1\\n&quot;</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">else</span> <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>,<span class=\"built_in\">kth</span>(root,<span class=\"built_in\">size</span>(root)-x+<span class=\"number\">1</span>)+delta);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>,ans);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>",
            "tags": [
                "Treap",
                "BST"
            ]
        },
        {
            "id": "http://cubicy.icu/2018/04/09/%E6%B4%9B%E8%B0%B7P3384%20[HNOI2004]%E5%AE%A0%E7%89%A9%E6%94%B6%E5%85%BB%E5%9C%BA/",
            "url": "http://cubicy.icu/2018/04/09/%E6%B4%9B%E8%B0%B7P3384%20[HNOI2004]%E5%AE%A0%E7%89%A9%E6%94%B6%E5%85%BB%E5%9C%BA/",
            "title": "æ´›è°·:P3384 [HNOI2004]å® ç‰©æ”¶å…»åœº",
            "date_published": "2018-04-09T14:05:00.000Z",
            "content_html": "<p>åŸé¢˜åœ°å€:<a href>https://www.luogu.org/problemnew/show/P3384</a>  </p>\n<h3 id=\"é¢˜ç›®ç®€è¿°\"><a href=\"#é¢˜ç›®ç®€è¿°\" class=\"headerlink\" title=\"é¢˜ç›®ç®€è¿°\"></a>é¢˜ç›®ç®€è¿°</h3><p>ç»™å®šä¸€äº›åºåˆ—<strong>ï¼ˆæ²¡æœ‰é‡å¤æ•°å­—ï¼‰</strong>ï¼Œæ¯ä¸ªåºåˆ—æ”¯æŒï¼š<br>ç»™å®šä¸€äº›æ•°k<strong>ï¼ˆå¯¹äºæ¯ä¸ªåºåˆ—ä¸é‡å¤ï¼‰</strong>ï¼Œæ¯æ¬¡åœ¨åºåˆ—é‡Œæ‰¾åˆ°æœ€æ¥è¿‘kçš„æ•°åˆ é™¤ï¼ˆå¦‚æœæœ‰2ä¸ªæ•°å­—ä¸kå·®ä¸€æ ·ï¼Œå³åˆ†åˆ«æ˜¯k-bå’Œk+bï¼Œåˆ™é€‰æ‹©è¾ƒå°çš„k-bï¼‰ï¼Œç´¯åŠ ä¸kçš„å·®ï¼Œè¾“å‡ºã€‚</p>\n<hr>\n<h3 id=\"æ€è·¯\"><a href=\"#æ€è·¯\" class=\"headerlink\" title=\"æ€è·¯\"></a>æ€è·¯</h3><p>å…¶å®å…³é”®å°±æ˜¯ç»´æŠ¤ä¸€ä¸ªæœ‰åºåºåˆ—ï¼Œæ”¯æŒæ’å…¥ï¼ŒæŸ¥è¯¢å‰ç»§åç»§ï¼Œåˆ é™¤æŒ‡å®šæ•°å­—ã€‚<br>è‡ªç„¶æˆ‘ä»¬ä¼šæƒ³åˆ°æ‰‹æ‰“å¹³è¡¡æ ‘ï¼ŒTreap&#x2F;Splayçš†å¯ã€‚ï¼ˆè¿™é‡Œåªæœ‰æ—‹è½¬å®ç°çš„Treapï¼Œéæ—‹Treapï¼ˆSplit+Mergeï¼‰å’ŒSplayæ—¥ååŠ ä¸Šï¼‰<br>Tips:ä¸ºäº†é˜²æ­¢è¶Šç•Œç­‰é—®é¢˜ä»¥åŠæ–¹ä¾¿æå–åŒºé—´ï¼ˆå°¤å…¶æ˜¯Splayï¼‰ï¼Œåºåˆ—å‰åä¸€èˆ¬å¡ä¸Šä¸€ä¸ª-INFå’ŒINF<br>ç„¶è€Œä½œä¸ºC++é€‰æ‰‹ï¼Œæˆ‘ä»¬åº”è¯¥å¦™ç”¨STLã€‚setå¯ä»¥å®ç°è¿™æ ·çš„åŠŸèƒ½ï¼Œå†…éƒ¨æ˜¯çº¢é»‘æ ‘å®ç°çš„ä¹Ÿå¾ˆå¿«ã€‚</p>\n<hr>\n<h3 id=\"ä»£ç \"><a href=\"#ä»£ç \" class=\"headerlink\" title=\"ä»£ç \"></a>ä»£ç </h3><ol>\n<li>æ—‹è½¬å®ç°çš„Treap(160ms,3.03MB)<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdlib&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cmath&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;ctime&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">int</span> INF=<span class=\"number\">1e9</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">int</span> <span class=\"title\">randad</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">static</span> <span class=\"type\">int</span> seed=<span class=\"number\">114514</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> seed=<span class=\"built_in\">int</span>(seed*<span class=\"number\">48271LL</span>%<span class=\"number\">2147483647</span>);<span class=\"comment\">//48271ä½¿å¾—éšæœºæ•°æœ‰å®Œå…¨å‘¨æœŸï¼Œå³2147483647å†…å–éä¸é‡å¤ </span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">int</span> delta=<span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">node</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> pri,val,ch[<span class=\"number\">2</span>],size,tot;</span><br><span class=\"line\"><span class=\"comment\">//pri:Treapçš„éšæœºæ•°</span></span><br><span class=\"line\"><span class=\"comment\">//val:æ•°å­—</span></span><br><span class=\"line\"><span class=\"comment\">//ch[0,1]:å·¦å­©å­å³å­©å­</span></span><br><span class=\"line\"><span class=\"comment\">//size:ä»¥è¯¥èŠ‚ç‚¹ä¸ºæ ¹çš„å­æ ‘é‡Œæœ‰å‡ ä¸ªæ•°å­—</span></span><br><span class=\"line\"><span class=\"comment\">//tot:è¿™ä¸ªæ•°å­—å‡ºç°äº†å‡ æ¬¡ï¼ˆæœ¬é¢˜æ— ç”¨ï¼‰</span></span><br><span class=\"line\">&#125;T[<span class=\"number\">111111</span>];</span><br><span class=\"line\"><span class=\"type\">int</span> k,size=<span class=\"number\">0</span>,ANS,ans;<span class=\"comment\">//k:æ ¹èŠ‚ç‚¹ï¼Œsize:æ ‘çš„å¤§å°,ANS:ä¸´æ—¶ï¼Œans:èµ¶èµ°äº†å‡ ä¸ªäºº</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">update</span><span class=\"params\">(<span class=\"type\">int</span> k)</span></span>&#123;T[k].size=T[T[k].ch[<span class=\"number\">0</span>]].size+T[T[k].ch[<span class=\"number\">1</span>]].size+T[k].tot;&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">rturn</span><span class=\"params\">(<span class=\"type\">int</span> &amp;k)</span><span class=\"comment\">//å³æ—‹ï¼ŒæŠŠkæ—‹åˆ°å³è¾¹ï¼Œkå·¦å­©å­æåˆ°æ ¹</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> t=T[k].ch[<span class=\"number\">0</span>];</span><br><span class=\"line\">    T[k].ch[<span class=\"number\">0</span>]=T[t].ch[<span class=\"number\">1</span>];</span><br><span class=\"line\">    T[t].ch[<span class=\"number\">1</span>]=k;</span><br><span class=\"line\">    T[t].size=T[k].size;</span><br><span class=\"line\">    <span class=\"built_in\">update</span>(k);</span><br><span class=\"line\">    k=t;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">lturn</span><span class=\"params\">(<span class=\"type\">int</span> &amp;k)</span><span class=\"comment\">//å·¦æ—‹ï¼ŒæŠŠkæ—‹åˆ°å·¦è¾¹ï¼Œkå³å­©å­æåˆ°æ ¹</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> t=T[k].ch[<span class=\"number\">1</span>];</span><br><span class=\"line\">    T[k].ch[<span class=\"number\">1</span>]=T[t].ch[<span class=\"number\">0</span>];</span><br><span class=\"line\">    T[t].ch[<span class=\"number\">0</span>]=k;</span><br><span class=\"line\">    T[t].size=T[k].size;</span><br><span class=\"line\">    <span class=\"built_in\">update</span>(k);</span><br><span class=\"line\">    k=t;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">ins</span><span class=\"params\">(<span class=\"type\">int</span> &amp;k,<span class=\"type\">int</span> val)</span> <span class=\"comment\">//æ’å…¥</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (k==<span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        size++;</span><br><span class=\"line\">        k=size;</span><br><span class=\"line\">        T[k].pri=<span class=\"built_in\">randad</span>();</span><br><span class=\"line\">        T[k].val=val;</span><br><span class=\"line\">        T[k].size=T[k].tot=<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    T[k].size++;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (T[k].val==val) T[k].tot++;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (val&gt;T[k].val) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">ins</span>(T[k].ch[<span class=\"number\">1</span>],val);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (T[T[k].ch[<span class=\"number\">1</span>]].pri&lt;T[k].pri) <span class=\"built_in\">lturn</span>(k);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">ins</span>(T[k].ch[<span class=\"number\">0</span>],val);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (T[T[k].ch[<span class=\"number\">0</span>]].pri&lt;T[k].pri) <span class=\"built_in\">rturn</span>(k);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">del</span><span class=\"params\">(<span class=\"type\">int</span> &amp;k,<span class=\"type\">int</span> val)</span><span class=\"comment\">//åˆ é™¤å€¼ä¸ºvalçš„æ•°</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (k==<span class=\"number\">0</span>) <span class=\"keyword\">return</span> ;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (T[k].val==val) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (T[k].tot&gt;<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            T[k].tot--;</span><br><span class=\"line\">            T[k].size--;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> ;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (T[k].ch[<span class=\"number\">0</span>]==<span class=\"number\">0</span>||T[k].ch[<span class=\"number\">1</span>]==<span class=\"number\">0</span>) k=T[k].ch[<span class=\"number\">0</span>]+T[k].ch[<span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(T[T[k].ch[<span class=\"number\">0</span>]].pri&lt;T[T[k].ch[<span class=\"number\">1</span>]].pri) <span class=\"built_in\">rturn</span>(k),<span class=\"built_in\">del</span>(k,val);</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"built_in\">lturn</span>(k),<span class=\"built_in\">del</span>(k,val);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(val&gt;T[k].val) T[k].size--,<span class=\"built_in\">del</span>(T[k].ch[<span class=\"number\">1</span>],val);</span><br><span class=\"line\">    <span class=\"keyword\">else</span> T[k].size--,<span class=\"built_in\">del</span>(T[k].ch[<span class=\"number\">0</span>],val);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">xth</span><span class=\"params\">(<span class=\"type\">int</span> &amp;k,<span class=\"type\">int</span> x)</span><span class=\"comment\">//æŸ¥è¯¢ç¬¬xå°çš„æ•°æ˜¯ä»€ä¹ˆ </span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(k==<span class=\"number\">0</span>||x==<span class=\"number\">0</span>)<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(x&lt;=T[T[k].ch[<span class=\"number\">0</span>]].size) <span class=\"keyword\">return</span> <span class=\"built_in\">xth</span>(T[k].ch[<span class=\"number\">0</span>],x);</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(x&gt;T[T[k].ch[<span class=\"number\">0</span>]].size+T[k].tot) <span class=\"keyword\">return</span> <span class=\"built_in\">xth</span>(T[k].ch[<span class=\"number\">1</span>],x-T[T[k].ch[<span class=\"number\">0</span>]].size-T[k].tot);</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">return</span> T[k].val;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">find</span><span class=\"params\">(<span class=\"type\">int</span> &amp;k,<span class=\"type\">int</span> x)</span><span class=\"comment\">//æŸ¥è¯¢ç¬¬xå°æ•°åœ¨æ ‘ä¸­ä½ç½® </span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (k==<span class=\"number\">0</span>||x==<span class=\"number\">0</span>) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(x&lt;=T[T[k].ch[<span class=\"number\">0</span>]].size)<span class=\"keyword\">return</span> <span class=\"built_in\">find</span>(T[k].ch[<span class=\"number\">0</span>],x);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(x==T[T[k].ch[<span class=\"number\">0</span>]].size+<span class=\"number\">1</span>)<span class=\"keyword\">return</span> k;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">find</span>(T[k].ch[<span class=\"number\">1</span>],x-T[T[k].ch[<span class=\"number\">0</span>]].size<span class=\"number\">-1</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">pre</span><span class=\"params\">(<span class=\"type\">int</span> k,<span class=\"type\">int</span> x)</span><span class=\"comment\">//æŸ¥è¯¢ä¸æ¯”xå¤§çš„ä¸”æœ€æ¥è¿‘xçš„æ•°æ‰€åœ¨ä½ç½®ï¼ˆxå‰ç»§ï¼‰</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(k==<span class=\"number\">0</span>)<span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(T[k].val&lt;x) ANS=k,<span class=\"built_in\">pre</span>(T[k].ch[<span class=\"number\">1</span>],x);</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"built_in\">pre</span>(T[k].ch[<span class=\"number\">0</span>],x);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">next</span><span class=\"params\">(<span class=\"type\">int</span> k,<span class=\"type\">int</span> x)</span><span class=\"comment\">//æŸ¥è¯¢ä¸æ¯”xå°çš„ä¸”æœ€æ¥è¿‘xçš„æ•°æ‰€åœ¨ä½ç½®ï¼ˆxåç»§ï¼‰</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(k==<span class=\"number\">0</span>)<span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(T[k].val&gt;x) ANS=k,<span class=\"built_in\">next</span>(T[k].ch[<span class=\"number\">0</span>],x);</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"built_in\">next</span>(T[k].ch[<span class=\"number\">1</span>],x);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">Catch</span><span class=\"params\">(<span class=\"type\">int</span> num)</span><span class=\"comment\">//åŒ¹é…å® ç‰©å’Œé¥²å…»äºº</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> a,b;</span><br><span class=\"line\">    <span class=\"built_in\">pre</span>(k,num),a=T[ANS].val; </span><br><span class=\"line\">    <span class=\"built_in\">next</span>(k,num), b=T[ANS].val;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(num-a&lt;=b-num &amp;&amp; a != -INF) &#123;</span><br><span class=\"line\">            ans += num-a;</span><br><span class=\"line\">            <span class=\"built_in\">del</span>(k,a);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            ans += b-num;</span><br><span class=\"line\">            <span class=\"built_in\">del</span>(k,b);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ans %= <span class=\"number\">1000000</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> n;</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;n);</span><br><span class=\"line\">        <span class=\"type\">int</span> cur;</span><br><span class=\"line\">        <span class=\"built_in\">ins</span>(k,-INF),<span class=\"built_in\">ins</span>(k,INF);</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">1</span>; i &lt;= n; i++) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> a, b;</span><br><span class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d%d&quot;</span>, &amp;a, &amp;b);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(T[k].size == <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">                cur=a;<span class=\"comment\">//curï¼šå½“å‰æ˜¯å® ç‰©ç­‰äººè®¤é¢†è¿˜æ˜¯äººåœ¨ç­‰ç€æ¥å—å® ç‰©ï¼ˆçœ‹åŸé¢˜ï¼Œä¸ç„¶è°çœ‹å¾—æ‡‚å•Š= =ï¼‰</span></span><br><span class=\"line\">                <span class=\"built_in\">ins</span>(k,b);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(a == cur) <span class=\"built_in\">ins</span>(k,b);</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"built_in\">Catch</span>(b);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>, ans);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">```  </span><br><span class=\"line\"><span class=\"number\">2.</span> setå®ç°(<span class=\"number\">304</span>ms,<span class=\"number\">2.57</span>MB)  </span><br><span class=\"line\">```cpp</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdlib&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cmath&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;ctime&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;set&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">int</span> maxn = <span class=\"number\">1111111</span>;</span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">int</span> INF = <span class=\"number\">1000000000</span>;</span><br><span class=\"line\"><span class=\"type\">int</span> n, ans;</span><br><span class=\"line\">set &lt;<span class=\"type\">int</span>&gt; s;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">find</span><span class=\"params\">(<span class=\"type\">int</span> x)</span> </span>&#123;</span><br><span class=\"line\">    set&lt;<span class=\"type\">int</span>&gt;::iterator left=--s.<span class=\"built_in\">lower_bound</span>(x),right=s.<span class=\"built_in\">lower_bound</span>(x);<span class=\"comment\">//lower_boundçš„å®ç°æ˜¯äºŒåˆ†æŸ¥æ‰¾ï¼Œè¿­ä»£å™¨æŒ‡å‘ä¸æ¯”xå°çš„ä¸”æœ€æ¥è¿‘xçš„æ•°çš„ä½ç½®ï¼Œæ‰€ä»¥leftå°±æ˜¯å‰ç»§ï¼Œrightå°±æ˜¯åç»§</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(x-*left&lt;=*right-x&amp;&amp;*left!=-INF) &#123;</span><br><span class=\"line\">        ans+=x-*left;</span><br><span class=\"line\">        s.<span class=\"built_in\">erase</span>(left);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        ans+=*right-x;</span><br><span class=\"line\">        s.<span class=\"built_in\">erase</span>(right);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ans%=<span class=\"number\">1000000</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>,&amp;n);</span><br><span class=\"line\">    <span class=\"type\">int</span> cur;</span><br><span class=\"line\">    s.<span class=\"built_in\">insert</span>(-INF),s.<span class=\"built_in\">insert</span>(INF);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;i++) &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> a,b;</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d%d&quot;</span>, &amp;a, &amp;b);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(s.<span class=\"built_in\">size</span>()==<span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">            cur=a;</span><br><span class=\"line\">            s.<span class=\"built_in\">insert</span>(b);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(a==cur) s.<span class=\"built_in\">insert</span>(b);</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"built_in\">find</span>(b);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>, ans);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ol>\n",
            "tags": [
                "Treap",
                "Splay"
            ]
        },
        {
            "id": "http://cubicy.icu/2018/02/27/%E6%B4%9B%E8%B0%B7P2234%20%20[HNOI2002]%E8%90%A5%E4%B8%9A%E9%A2%9D%E7%BB%9F%E8%AE%A1/",
            "url": "http://cubicy.icu/2018/02/27/%E6%B4%9B%E8%B0%B7P2234%20%20[HNOI2002]%E8%90%A5%E4%B8%9A%E9%A2%9D%E7%BB%9F%E8%AE%A1/",
            "title": "æ´›è°·:P2234  [HNOI2002]è¥ä¸šé¢ç»Ÿè®¡",
            "date_published": "2018-02-27T15:58:00.000Z",
            "content_html": "<p>åŸé¢˜åœ°å€ï¼š<a href=\"//www.luogu.org/problemnew/show/P2234\">https://www.luogu.org/problemnew/show/P2234</a></p>\n<h3 id=\"é¢˜ç›®ç®€è¿°\"><a href=\"#é¢˜ç›®ç®€è¿°\" class=\"headerlink\" title=\"é¢˜ç›®ç®€è¿°\"></a>é¢˜ç›®ç®€è¿°</h3><p>ç»™å®šä¸€ä¸ªåºåˆ—ï¼Œå¯¹äºæ¯ä¸€ä¸ªæ•°éƒ½è¦æŸ¥è¯¢ï¼šåºåˆ—ä¸­åœ¨è¿™ä¸ªæ•°å‰ä¸è¿™ä¸ªæ•°æœ€æ¥è¿‘çš„æ•°æ˜¯ä»€ä¹ˆï¼Ÿç„¶åå°†æœ€æ¥è¿‘çš„æ•°å­—ä¸è¿™ä¸ªæ•°å­—çš„å·®ç´¯åŠ ã€‚ï¼ˆåºåˆ—ç¬¬ä¸€ä¸ªæ•°å­—ç›´æ¥åŠ è‡ªå·±ï¼‰  </p>\n<h3 id=\"æ€è·¯\"><a href=\"#æ€è·¯\" class=\"headerlink\" title=\"æ€è·¯\"></a>æ€è·¯</h3><p>æŸ¥è¯¢åœ¨è¿™ä¸ªæ•°ä¹‹å‰ä¸è¿™ä¸ªæ•°æœ€æ¥è¿‘çš„æ•°ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°ç”¨äºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰æ¥åšã€‚<br><del>è™½ç„¶æ•°æ®ç•¥æ°´æš´åŠ›æ’åºæ¯æ¬¡æŸ¥è¯¢ä»ä¸€ä¸ªæ•°å¾€å·¦å³æ‰¾ä¹Ÿèƒ½è¿‡ã€‚</del><br>æ¯æ¬¡æ’å…¥ä¸€ä¸ªæ•°å­—ï¼Œç„¶åæŸ¥è¯¢ï¼Œæˆ‘ç”¨Treapå®ç°ï¼ˆè¿˜æ˜¯å¼±åŒ–ç‰ˆçš„ï¼Œåªæœ‰æ’å…¥æŸ¥è¯¢ï¼‰ã€‚<br>Treapçš„æ ¸å¿ƒå…¶å®å°±æ˜¯æ‰“ä¹±é¡ºåºæ’å…¥é˜²æ­¢è¢«å¡ï¼ˆç²—ç³™ç†è§£ï¼‰ã€‚å…·ä½“å®ç°æ–¹æ³•ä¸éš¾ï¼Œè¯·ç™¾åº¦ã€‚ï¼ˆæˆ‘ä¹‹åä¼šå†™ä¸€ç¯‡ä¸“é—¨ä»‹ç»ä¸‹å„ç§BSTçš„ã€‚ï¼‰<br>PSï¼šTreapæ ‘å®Œæ•´ç‰ˆä¹‹åå†™ã€‚è¿™é¢˜ç”¨STLçš„vectorä¹Ÿè¡Œï¼Œvectorç†è®ºæ¯æ¬¡æ’å…¥æ¸è¿›æ—¶é—´å¤æ‚åº¦æ˜¯O(n)ä½†æ˜¯å¬è¯´å®é™…æ˜¯å¯¹æ•°çº§åˆ«çš„ï¼Ÿ   </p>\n<h3 id=\"ä»£ç \"><a href=\"#ä»£ç \" class=\"headerlink\" title=\"ä»£ç \"></a>ä»£ç </h3><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdlib&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cmath&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstring&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">int</span> <span class=\"title\">randad</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">static</span> <span class=\"type\">int</span> seed=<span class=\"number\">114</span>; <span class=\"comment\">//seedå¯ä»¥éšä¾¿å–</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> seed=<span class=\"built_in\">int</span>(seed*<span class=\"number\">48271LL</span>%<span class=\"number\">2147483647</span>);<span class=\"comment\">//48271ä½¿å¾—å…¶æœ‰å®Œå…¨å‘¨æœŸï¼Œå³2147483647å†…å–éä¸é‡å¤ </span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Treap</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> key,pri,son[<span class=\"number\">2</span>];</span><br><span class=\"line\">&#125;T[<span class=\"number\">33333</span>];</span><br><span class=\"line\"><span class=\"type\">int</span> cnt=<span class=\"number\">1</span>,rt=<span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">rotate</span><span class=\"params\">(<span class=\"type\">int</span> p,<span class=\"type\">int</span> &amp;rt)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> y=T[rt].son[p];</span><br><span class=\"line\">    T[rt].son[p]=T[y].son[!p];</span><br><span class=\"line\">    T[y].son[!p]=rt;</span><br><span class=\"line\">    rt=y;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">ins</span><span class=\"params\">(<span class=\"type\">int</span> key,<span class=\"type\">int</span> &amp;rt)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(rt==<span class=\"number\">0</span>)</span><br><span class=\"line\">    \tT[rt=cnt++] = (Treap)&#123;key,<span class=\"built_in\">randad</span>()&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> p=key&gt;T[rt].key;</span><br><span class=\"line\">        <span class=\"built_in\">ins</span>(key,T[rt].son[p]);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(T[T[rt].son[p]].pri&gt;T[rt].pri)</span><br><span class=\"line\">        \t<span class=\"built_in\">rotate</span>(p,rt);   </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">nowMin</span><span class=\"params\">(<span class=\"type\">int</span> key,<span class=\"type\">int</span> rt)</span><span class=\"comment\">//æŸ¥è¯¢ç°åœ¨æœ€æ¥è¿‘keyçš„æ•°</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(rt==<span class=\"number\">0</span>) <span class=\"keyword\">return</span> <span class=\"number\">666666666</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> res=<span class=\"built_in\">abs</span>(key-T[rt].key);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(key&gt;T[rt].key) res=<span class=\"built_in\">min</span>(res,<span class=\"built_in\">nowMin</span>(key,T[rt].son[<span class=\"number\">1</span>]));</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(key&lt;T[rt].key) res=<span class=\"built_in\">min</span>(res,<span class=\"built_in\">nowMin</span>(key,T[rt].son[<span class=\"number\">0</span>]));</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">int</span> n,tot=<span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>,&amp;n);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;i++) &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> num;</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>,&amp;num);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (i==<span class=\"number\">1</span>) tot+=num;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> tot+=<span class=\"built_in\">nowMin</span>(num,rt);<span class=\"comment\">//rtæ˜¯å½“å‰æ ¹</span></span><br><span class=\"line\">        <span class=\"built_in\">ins</span>(num,rt);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d&quot;</span>,tot);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>",
            "tags": [
                "Treap"
            ]
        },
        {
            "id": "http://cubicy.icu/2018/02/22/%E6%B4%9B%E8%B0%B7P3391%20%E3%80%90%E6%A8%A1%E6%9D%BF%E3%80%91%E6%96%87%E8%89%BA%E5%B9%B3%E8%A1%A1%E6%A0%91%EF%BC%88Splay%EF%BC%89/",
            "url": "http://cubicy.icu/2018/02/22/%E6%B4%9B%E8%B0%B7P3391%20%E3%80%90%E6%A8%A1%E6%9D%BF%E3%80%91%E6%96%87%E8%89%BA%E5%B9%B3%E8%A1%A1%E6%A0%91%EF%BC%88Splay%EF%BC%89/",
            "title": "æ´›è°·:P3391 ã€æ¨¡æ¿ã€‘æ–‡è‰ºå¹³è¡¡æ ‘ï¼ˆSplayï¼‰",
            "date_published": "2018-02-22T15:43:00.000Z",
            "content_html": "<p>åŸé¢˜åœ°å€:<a href=\"//www.luogu.org/problemnew/show/P3391\">https://www.luogu.org/problemnew/show/P3391</a>  </p>\n<h3 id=\"é¢˜ç›®ç®€è¿°\"><a href=\"#é¢˜ç›®ç®€è¿°\" class=\"headerlink\" title=\"é¢˜ç›®ç®€è¿°\"></a>é¢˜ç›®ç®€è¿°</h3><p>æ‚¨éœ€è¦å†™ä¸€ç§æ•°æ®ç»“æ„ï¼ˆå¯å‚è€ƒé¢˜ç›®æ ‡é¢˜ï¼‰ï¼Œæ¥ç»´æŠ¤ä¸€ä¸ªæœ‰åºæ•°åˆ—ï¼Œå…¶ä¸­éœ€è¦æä¾›ä»¥ä¸‹æ“ä½œï¼š<br>ç¿»è½¬ä¸€ä¸ªåŒºé—´ï¼Œä¾‹å¦‚åŸæœ‰åºåºåˆ—æ˜¯5 4 3 2 1ï¼Œç¿»è½¬åŒºé—´æ˜¯[2,4]çš„è¯ï¼Œç»“æœæ˜¯5 2 3 4 1</p>\n<hr>\n<h3 id=\"æ€è·¯\"><a href=\"#æ€è·¯\" class=\"headerlink\" title=\"æ€è·¯\"></a>æ€è·¯</h3><p>Splayæ˜¯ä¸€ç§äºŒå‰æœç´¢æ ‘ã€‚å¦‚æœä¸çŸ¥é“çš„è¯â€¦â€¦    </p>\n<p><img src=\"https://images2018.cnblogs.com/blog/1335480/201802/1335480-20180223172651966-1911354100.png\" alt=\"ç™¾åº¦å•Š\" loading=\"lazy\"><br>ç™¾åº¦ç™¾ç§‘å¯¹BSTçš„ä»‹ç»ï¼š  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBinary Search Treeï¼‰ï¼Œï¼ˆåˆï¼šäºŒå‰æœç´¢æ ‘ï¼ŒäºŒå‰æ’åºæ ‘ï¼‰å®ƒæˆ–è€…æ˜¯ä¸€æ£µç©ºæ ‘ï¼Œæˆ–è€…æ˜¯å…·æœ‰ä¸‹åˆ—æ€§è´¨çš„äºŒå‰æ ‘ï¼š è‹¥å®ƒçš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼› è‹¥å®ƒçš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼› å®ƒçš„å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æ’åºæ ‘ã€‚</span><br></pre></td></tr></table></figure>\n<p>é¦–å…ˆæ˜ç™½Splayæ¯”èµ·çº¿æ®µæ ‘èƒ½å¤šå¹²ä»€ä¹ˆï¼š</p>\n<ul>\n<li>å¯ä»¥åœ¨ä¸€ä¸ªæœ‰åºåºåˆ—ä¸­ä»»æ„æ•°åé¢åŠ¨æ€æ’å…¥ä¸€ä¸²æ•°ï¼ˆä¸èƒ½æ¯”aåé¢ä¸€ä¸ªæ•°è¿˜å¤§ï¼‰  </li>\n<li>å¯ä»¥åˆ é™¤ä¸€æ®µåŒºé—´</li>\n</ul>\n<p>å¯èƒ½æè¿°ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œå…·ä½“çœ‹è¿™é‡Œé¢ç»™çš„è®ºæ–‡é“¾æ¥ï¼š<a href=\"//www.cnblogs.com/yyy2015c01/p/8457795.html\">ä¿¡æ¯å­¦ç«èµ›ç›¸å…³ä¼˜ç§€æ–‡ç« åˆé›†</a><br>æˆ–è€…ç›´æ¥çœ‹è¿™é‡Œï¼š<a href=\"//files.cnblogs.com/files/yyy2015c01/%E8%BF%90%E7%94%A8%E4%BC%B8%E5%B1%95%E6%A0%91%E8%A7%A3%E5%86%B3%E6%95%B0%E5%88%97%E7%BB%B4%E6%8A%A4%E9%97%AE%E9%A2%98.pdf\">è¿ç”¨ä¼¸å±•æ ‘è§£å†³æ•°åˆ—ç»´æŠ¤é—®é¢˜.pdf</a><br>å¦‚æœæä¸æ‡‚å·¦æ—‹å³æ—‹æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥å…ˆçœ‹<a href=\"//www.cnblogs.com/yyy2015c01/p/8457795.html\">ä¿¡æ¯å­¦ç«èµ›ç›¸å…³ä¼˜ç§€æ–‡ç« åˆé›†</a>é‡Œçš„AVLæ ‘ä»‹ç»ã€‚<br>å¯¹äºAVLæ ‘æ˜¯ä¸€ç§ä¸ºäº†é˜²æ­¢æ ‘ç»“æ„ä¸å¤Ÿä¼˜å¯¼è‡´æ·±åº¦è¿‡æ·±æ—¶é—´å¤æ‚åº¦é€€åŒ–ï¼Œåœ¨ä¿æŒäºŒå‰æœç´¢æ ‘æ€§è´¨ä¸å˜çš„å‰æä¸‹è¿›è¡Œçš„ä¸€ç§å˜æ¢ã€‚ç®€å•è¯´å°±æ˜¯æŠŠå¾€ä¸€è¾¹æ²‰çš„æ ‘å¼„çš„ä¸¤è¾¹å¹³è¡¡äº›ã€‚<br>è€Œåœ¨Splayä¸­ï¼Œå°†ç‰¹å®šç‚¹æ—‹è½¬åˆ°ä¸€å®šä½ç½®å¯ä»¥è¿›è¡Œæå–åŒºé—´ç­‰æ“ä½œï¼ŒåŒæ—¶å„ç§æ—‹è½¬é—´æ¥çš„ä½¿æ ‘**åŸºæœ¬å¹³è¡¡(æ˜¯çš„ï¼Œå¯ä»¥æ„é€ æ•°æ®å¡æ‰ã€‚Treapæ ‘å¯¹æ­¤è¡¨ç¤ºåŒæƒ…)**ã€‚  </p>\n<hr>\n<p>å·¦æ—‹ï¼ˆä¸‹é¢ä»£ç é‡Œçš„è¡¨è¾¾:æŠŠSå¾€ä¸Šè½¬ä¸€æ¬¡ï¼‰â†’<img src=\"https://images2018.cnblogs.com/blog/1335480/201802/1335480-20180222235430206-1994690340.gif\" alt=\"å·¦æ—‹\" loading=\"lazy\">  </p>\n<hr>\n<p>å³æ—‹ï¼ˆä¸‹é¢ä»£ç é‡Œçš„è¡¨è¾¾:æŠŠEå¾€ä¸Šè½¬ä¸€æ¬¡ï¼‰â†’<img src=\"https://images2018.cnblogs.com/blog/1335480/201802/1335480-20180222235503124-141509937.gif\" alt=\"å³æ—‹\" loading=\"lazy\">  </p>\n<hr>\n<p>å›¾ç‰‡æ¥æºï¼š<a href=\"//blog.csdn.net/sun_tttt/article/details/65445754\">http://blog.csdn.net/sun_tttt&#x2F;article&#x2F;details&#x2F;65445754</a><br>(æ–‡ç« æ˜¯ä»‹ç»çº¢é»‘æ ‘çš„ä½†æ˜¯è¿™ä¸ªå·¦æ—‹å³æ—‹æ“ä½œäºŒå‰æœç´¢æ ‘é€šç”¨)<br>è®ºæ–‡é‡Œè®²çš„å¾ˆè¯¦ç»†~<br>å…·ä½“åˆ°è¿™é“é¢˜ï¼Œå¼•ç”¨ä¸€ä¸‹zcyskyåœ¨é¢˜è§£é‡Œç»™å‡ºçš„è§£é‡Šï¼š  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Splayå¯ä»¥ç”¨æ¥ç»´æŠ¤åºåˆ—ã€‚è¿™æ ·çš„è¯æ˜¯æŠŠSplayå½“ä½œä¸€æ£µåŒºé—´æ ‘ã€‚  </span><br><span class=\"line\">æ‰€è°“åŒºé—´æ ‘å’Œæƒå€¼æ ‘çš„åŒºåˆ«ï¼Œå¤§æ¦‚å°±æ˜¯åŒºé—´æ ‘æ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨çš„æ˜¯ä¸€æ®µåŒºé—´ï¼ˆå…¸å‹ä»£è¡¨å°±æ˜¯ä¸€èˆ¬çš„çº¿æ®µæ ‘ï¼‰  </span><br><span class=\"line\">æƒå€¼æ ‘å¥½ç†è§£ä¸€ç‚¹ï¼Œå°±æ˜¯æ¯ä¸ªç‚¹çœŸçš„ä»£è¡¨ä¸€ä¸ªç‚¹ã€‚  </span><br><span class=\"line\">è‡³äºç¿»è½¬æ“ä½œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨Splayçš„è¿‡ç¨‹å®ç°ã€‚è¯¦è§ä»£ç ã€‚(Splayèƒ½ç»´æŠ¤åºåˆ—åè½¬ä¹Ÿæ˜¯å®ƒä½œä¸ºLCTçš„è¾…åŠ©æ ‘çš„æ¡ä»¶ä¹‹ä¸€)</span><br></pre></td></tr></table></figure>\n<p>ä½œä¸ºæ¨¡æ¿é¢˜æ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚è¿™è¾¹æ–‡ç« ä¸»è¦è®°å½•æ¿å­ç”¨ã€‚æ„Ÿè°¢zcyskyçš„æ¿å­ã€‚   </p>\n<h2 id><a href=\"#\" class=\"headerlink\" title></a><img src=\"https://images2018.cnblogs.com/blog/1335480/201802/1335480-20180223172902355-916514534.gif\" loading=\"lazy\"></h2><h3 id=\"ä»£ç \"><a href=\"#ä»£ç \" class=\"headerlink\" title=\"ä»£ç \"></a>ä»£ç </h3><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;bits/stdc++.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> N 100005</span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"type\">int</span> n,m; </span><br><span class=\"line\"><span class=\"type\">int</span> fa[N],ch[N][<span class=\"number\">2</span>],size[N],rev[N],rt;<span class=\"comment\">//fa[a]è¡¨ç¤ºaçš„çˆ¶äº²</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">pushup</span><span class=\"params\">(<span class=\"type\">int</span> x)</span><span class=\"comment\">//ç»´æŠ¤èŠ‚ç‚¹å¤§å°</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    size[x]=size[ch[x][<span class=\"number\">0</span>]]+size[ch[x][<span class=\"number\">1</span>]]+<span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">pushdown</span><span class=\"params\">(<span class=\"type\">int</span> x)</span><span class=\"comment\">//æ ‡è®°ä¸‹ä¼ </span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(rev[x])&#123;<span class=\"comment\">//æ˜¯å¦ç¿»è½¬äº†åŒºé—´</span></span><br><span class=\"line\">        <span class=\"built_in\">swap</span>(ch[x][<span class=\"number\">0</span>],ch[x][<span class=\"number\">1</span>]);</span><br><span class=\"line\">        rev[ch[x][<span class=\"number\">0</span>]]^=<span class=\"number\">1</span>;rev[ch[x][<span class=\"number\">1</span>]]^=<span class=\"number\">1</span>;rev[x]=<span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">bool</span> <span class=\"title\">isLeft</span><span class=\"params\">(<span class=\"type\">int</span> x)</span> </span>&#123;<span class=\"keyword\">return</span> ch[fa[x]][<span class=\"number\">0</span>] == x;&#125;<span class=\"comment\">//åˆ¤æ–­xæ˜¯ä¸æ˜¯å·¦å„¿å­</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">rotate</span><span class=\"params\">(<span class=\"type\">int</span> x,<span class=\"type\">int</span> &amp;k)</span><span class=\"comment\">//æ—‹è½¬</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> y=fa[x],z=fa[y];</span><br><span class=\"line\">\t<span class=\"type\">int</span> kind=<span class=\"built_in\">isLeft</span>(x);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(y==k)</span><br><span class=\"line\">        k=x;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        ch[z][!<span class=\"built_in\">isLeft</span>(y)]=x;</span><br><span class=\"line\">    ch[y][!kind]=ch[x][kind];</span><br><span class=\"line\">    </span><br><span class=\"line\">    fa[ch[y][!kind]]=y;</span><br><span class=\"line\">    ch[x][kind]=y;</span><br><span class=\"line\">    fa[y]=x;fa[x]=z;</span><br><span class=\"line\">    <span class=\"built_in\">pushup</span>(x);<span class=\"built_in\">pushup</span>(y);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">splay</span><span class=\"params\">(<span class=\"type\">int</span> x,<span class=\"type\">int</span> &amp;k)</span><span class=\"comment\">//ä¼¸å±•æ“ä½œï¼Œå°†xä¸€ç›´æ—‹è½¬ç›´åˆ°xå°±æ˜¯k</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(x!=k)&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> y=fa[x],z=fa[y];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(y!=k)</span><br><span class=\"line\">        \t<span class=\"built_in\">isLeft</span>(x)^<span class=\"built_in\">isLeft</span>(y) ? <span class=\"built_in\">rotate</span>(x,k):<span class=\"built_in\">rotate</span>(y,k);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//è¯¥èŠ‚ç‚¹ä¸çˆ¶äº²åˆ†åˆ«æ˜¯ä»–ä»¬çˆ¸çš„å·¦å­©å­\\å³å­©å­æˆ–è€…æ˜¯å³å­©å­\\å·¦å­©å­æ—‹è½¬2æ¬¡x</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">//è¯¥èŠ‚ç‚¹ä¸çˆ¶äº²åŒæ˜¯ä»–ä»¬çˆ¸çš„å·¦å­©å­æˆ–åŒæ˜¯å³å­©å­å…ˆæ—‹è½¬ä¸€æ¬¡yå†æ—‹è½¬ä¸€æ¬¡x</span></span><br><span class=\"line\">        <span class=\"built_in\">rotate</span>(x,k);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">build</span><span class=\"params\">(<span class=\"type\">int</span> l,<span class=\"type\">int</span> r,<span class=\"type\">int</span> f)</span> <span class=\"comment\">//å»ºç«‹ä¸€é¢—å®Œå…¨å¹³è¡¡çš„äºŒå‰æ ‘</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(l&gt;r)</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> mid=(l+r)/<span class=\"number\">2</span>;</span><br><span class=\"line\">    ch[f][!(mid&lt;f)]=mid;</span><br><span class=\"line\">    fa[mid]=f;</span><br><span class=\"line\">    size[mid]=<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(l==r)</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"built_in\">build</span>(l,mid<span class=\"number\">-1</span>,mid);</span><br><span class=\"line\">    <span class=\"built_in\">build</span>(mid+<span class=\"number\">1</span>,r,mid);</span><br><span class=\"line\">    <span class=\"built_in\">pushup</span>(mid);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">find</span><span class=\"params\">(<span class=\"type\">int</span> x,<span class=\"type\">int</span> k)</span><span class=\"comment\">//å¯»æ‰¾ä»¥xä¸ºæ ¹çš„å­æ ‘é‡Œç¬¬kå¤§çš„</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">pushdown</span>(x);</span><br><span class=\"line\">    <span class=\"type\">int</span> s=size[ch[x][<span class=\"number\">0</span>]];</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(k==s+<span class=\"number\">1</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(k&lt;=s)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">find</span>(ch[x][<span class=\"number\">0</span>],k);</span><br><span class=\"line\">    <span class=\"keyword\">else</span> </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">find</span>(ch[x][<span class=\"number\">1</span>],k-s<span class=\"number\">-1</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">rever</span><span class=\"params\">(<span class=\"type\">int</span> l,<span class=\"type\">int</span> r)</span><span class=\"comment\">//å…³äºå¦‚ä½•ä»Splayä¸­æå–åŒºé—´è¯·çœ‹ä¸Šæ–‡æ€è·¯ä¸­çš„è®ºæ–‡</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> x=<span class=\"built_in\">find</span>(rt,l),y=<span class=\"built_in\">find</span>(rt,r+<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"built_in\">splay</span>(x,rt);</span><br><span class=\"line\">    <span class=\"built_in\">splay</span>(y,ch[x][<span class=\"number\">1</span>]);</span><br><span class=\"line\">    <span class=\"type\">int</span> z=ch[y][<span class=\"number\">0</span>];</span><br><span class=\"line\">    rev[z]^=<span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class=\"line\">    rt=(n+<span class=\"number\">3</span>)/<span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"built_in\">build</span>(<span class=\"number\">1</span>,n+<span class=\"number\">2</span>,rt);<span class=\"comment\">//åŒºé—´å·¦å³å„å¤šåŠ 1ä¸ªæ•°æ–¹ä¾¿æå–åŒºé—´</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">1</span>;i&lt;=m;i++)&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> L,R;</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d%d&quot;</span>,&amp;L,&amp;R);</span><br><span class=\"line\">        <span class=\"built_in\">rever</span>(L,R);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">2</span>;i&lt;=n+<span class=\"number\">1</span>;i++)</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d &quot;</span>,<span class=\"built_in\">find</span>(rt,i)<span class=\"number\">-1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>",
            "tags": [
                "Splay"
            ]
        },
        {
            "id": "http://cubicy.icu/2018/02/22/%E6%B4%9B%E8%B0%B7P3384%20%E3%80%90%E6%A8%A1%E6%9D%BF%E3%80%91%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86/",
            "url": "http://cubicy.icu/2018/02/22/%E6%B4%9B%E8%B0%B7P3384%20%E3%80%90%E6%A8%A1%E6%9D%BF%E3%80%91%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86/",
            "title": "æ´›è°·:P3384 ã€æ¨¡æ¿ã€‘æ ‘é“¾å‰–åˆ†",
            "date_published": "2018-02-21T16:08:00.000Z",
            "content_html": "<p>åŸé¢˜åœ°å€:<a href=\"//www.luogu.org/problemnew/show/P3384\">https://www.luogu.org/problemnew/show/P3384</a>  </p>\n<h3 id=\"é¢˜ç›®ç®€è¿°\"><a href=\"#é¢˜ç›®ç®€è¿°\" class=\"headerlink\" title=\"é¢˜ç›®ç®€è¿°\"></a>é¢˜ç›®ç®€è¿°</h3><p>å·²çŸ¥ä¸€æ£µåŒ…å«Nä¸ªç»“ç‚¹çš„æ ‘ï¼ˆè¿é€šä¸”æ— ç¯ï¼‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸ŠåŒ…å«ä¸€ä¸ªæ•°å€¼ï¼Œéœ€è¦æ”¯æŒä»¥ä¸‹æ“ä½œï¼š  </p>\n<ol>\n<li>æ ¼å¼ï¼š 1 x y z è¡¨ç¤ºå°†æ ‘ä»xåˆ°yç»“ç‚¹æœ€çŸ­è·¯å¾„ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½åŠ ä¸Šz  </li>\n<li>æ ¼å¼ï¼š 2 x y è¡¨ç¤ºæ±‚æ ‘ä»xåˆ°yç»“ç‚¹æœ€çŸ­è·¯å¾„ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼ä¹‹å’Œ  </li>\n<li>æ ¼å¼ï¼š 3 x z è¡¨ç¤ºå°†ä»¥xä¸ºæ ¹èŠ‚ç‚¹çš„å­æ ‘å†…æ‰€æœ‰èŠ‚ç‚¹å€¼éƒ½åŠ ä¸Šz  </li>\n<li>æ ¼å¼ï¼š 4 x è¡¨ç¤ºæ±‚ä»¥xä¸ºæ ¹èŠ‚ç‚¹çš„å­æ ‘å†…æ‰€æœ‰èŠ‚ç‚¹å€¼ä¹‹å’Œ</li>\n</ol>\n<hr>\n<h3 id=\"æ€è·¯\"><a href=\"#æ€è·¯\" class=\"headerlink\" title=\"æ€è·¯\"></a>æ€è·¯</h3><p>æ ‘é“¾å‰–åˆ†è£¸é¢˜ã€‚åšé¢˜æ—¶çœ‹åˆ°ä¸å››ç§æ“ä½œä¸­çš„ä»»ä½•ä¸€ç§æä¸ºç›¸ä¼¼çš„æ“ä½œï¼Œå°±åº”è¯¥ç«‹åˆ»æƒ³åˆ°æ ‘é“¾å‰–åˆ†ï¼ˆå¹¶ä¸”è€ƒè™‘æ˜¯å¦ç»“åˆçº¿æ®µæ ‘è§£ç­”ï¼‰ã€‚<br>å…³äºæ ‘é“¾å‰–åˆ†çš„ä»‹ç»è¯·çœ‹æ­¤å¤„ï¼š<a href=\"//www.cnblogs.com/yyy2015c01/p/8457795.html\">ä¿¡æ¯å­¦ç«èµ›ç›¸å…³ä¼˜ç§€æ–‡ç« åˆé›†</a>  </p>\n<hr>\n<h3 id=\"ä»£ç \"><a href=\"#ä»£ç \" class=\"headerlink\" title=\"ä»£ç \"></a>ä»£ç </h3><p>å…·ä½“ä»‹ç»åœ¨æ³¨é‡Šé‡Œã€‚<br>æ¥æºï¼šæ´›è°·ç”¨æˆ·<a href=\"//www.luogu.org/space/show?uid=47062\">@zengqinyi</a>  </p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;cstdlib&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;cstring&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> Rint register int</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mem(a,b) memset(a,(b),sizeof(a))</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> Temp template<span class=\"string\">&lt;typename T&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"type\">long</span> <span class=\"type\">long</span> LL;</span><br><span class=\"line\"><span class=\"function\">Temp <span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">read</span><span class=\"params\">(T &amp;x)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    x=<span class=\"number\">0</span>;T w=<span class=\"number\">1</span>,ch=<span class=\"built_in\">getchar</span>();</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(!<span class=\"built_in\">isdigit</span>(ch)&amp;&amp;ch!=<span class=\"string\">&#x27;-&#x27;</span>)ch=<span class=\"built_in\">getchar</span>();</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(ch==<span class=\"string\">&#x27;-&#x27;</span>)w=<span class=\"number\">-1</span>,ch=<span class=\"built_in\">getchar</span>();</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(<span class=\"built_in\">isdigit</span>(ch))x=(x&lt;&lt;<span class=\"number\">3</span>)+(x&lt;&lt;<span class=\"number\">1</span>)+(ch^<span class=\"string\">&#x27;0&#x27;</span>),ch=<span class=\"built_in\">getchar</span>();</span><br><span class=\"line\">    x=x*w;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mid ((l+r)&gt;&gt;1)</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> lson rt&lt;&lt;1,l,mid</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> rson rt&lt;&lt;1|1,mid+1,r</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> len (r-l+1)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">int</span> maxn=<span class=\"number\">200000</span>+<span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"type\">int</span> n,m,r,mod;</span><br><span class=\"line\"><span class=\"comment\">//è§é¢˜æ„ </span></span><br><span class=\"line\"><span class=\"type\">int</span> e,beg[maxn],nex[maxn],to[maxn],w[maxn],wt[maxn];</span><br><span class=\"line\"><span class=\"comment\">//é“¾å¼å‰å‘æ˜Ÿæ•°ç»„ï¼Œw[]ã€wt[]åˆå§‹ç‚¹æƒæ•°ç»„ </span></span><br><span class=\"line\"><span class=\"type\">int</span> a[maxn&lt;&lt;<span class=\"number\">2</span>],laz[maxn&lt;&lt;<span class=\"number\">2</span>];</span><br><span class=\"line\"><span class=\"comment\">//çº¿æ®µæ ‘æ•°ç»„ã€lazyæ“ä½œ </span></span><br><span class=\"line\"><span class=\"type\">int</span> son[maxn],id[maxn],fa[maxn],cnt,dep[maxn],siz[maxn],top[maxn]; </span><br><span class=\"line\"><span class=\"comment\">//son[]é‡å„¿å­ç¼–å·,id[]æ–°ç¼–å·,fa[]çˆ¶äº²èŠ‚ç‚¹,cnt dfs_clock/dfsåº,dep[]æ·±åº¦,siz[]å­æ ‘å¤§å°,top[]å½“å‰é“¾é¡¶ç«¯èŠ‚ç‚¹ </span></span><br><span class=\"line\"><span class=\"type\">int</span> res=<span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"comment\">//æŸ¥è¯¢ç­”æ¡ˆ </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"type\">int</span> x,<span class=\"type\">int</span> y)</span> <span class=\"comment\">//é“¾å¼å‰å‘æ˜ŸåŠ è¾¹ </span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    to[++e]=y;</span><br><span class=\"line\">    nex[e]=beg[x];</span><br><span class=\"line\">    beg[x]=e;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//-------------------------------------- ä»¥ä¸‹ä¸ºçº¿æ®µæ ‘ </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">pushdown</span><span class=\"params\">(<span class=\"type\">int</span> rt,<span class=\"type\">int</span> lenn)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    laz[rt&lt;&lt;<span class=\"number\">1</span>]+=laz[rt];</span><br><span class=\"line\">    laz[rt&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+=laz[rt];</span><br><span class=\"line\">    a[rt&lt;&lt;<span class=\"number\">1</span>]+=laz[rt]*(lenn-(lenn&gt;&gt;<span class=\"number\">1</span>));</span><br><span class=\"line\">    a[rt&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+=laz[rt]*(lenn&gt;&gt;<span class=\"number\">1</span>);</span><br><span class=\"line\">    a[rt&lt;&lt;<span class=\"number\">1</span>]%=mod;</span><br><span class=\"line\">    a[rt&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]%=mod;</span><br><span class=\"line\">    laz[rt]=<span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">build</span><span class=\"params\">(<span class=\"type\">int</span> rt,<span class=\"type\">int</span> l,<span class=\"type\">int</span> r)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(l==r)&#123;</span><br><span class=\"line\">        a[rt]=wt[l];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(a[rt]&gt;mod)a[rt]%=mod;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">build</span>(lson);</span><br><span class=\"line\">    <span class=\"built_in\">build</span>(rson);</span><br><span class=\"line\">    a[rt]=(a[rt&lt;&lt;<span class=\"number\">1</span>]+a[rt&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>])%mod;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">query</span><span class=\"params\">(<span class=\"type\">int</span> rt,<span class=\"type\">int</span> l,<span class=\"type\">int</span> r,<span class=\"type\">int</span> L,<span class=\"type\">int</span> R)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(L&lt;=l&amp;&amp;r&lt;=R) &#123;</span><br><span class=\"line\">    \tres+=a[rt];</span><br><span class=\"line\">    \tres%=mod;</span><br><span class=\"line\">    \t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(laz[rt])<span class=\"built_in\">pushdown</span>(rt,len);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(L&lt;=mid)<span class=\"built_in\">query</span>(lson,L,R);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(R&gt;mid)<span class=\"built_in\">query</span>(rson,L,R);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">update</span><span class=\"params\">(<span class=\"type\">int</span> rt,<span class=\"type\">int</span> l,<span class=\"type\">int</span> r,<span class=\"type\">int</span> L,<span class=\"type\">int</span> R,<span class=\"type\">int</span> k)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(L&lt;=l&amp;&amp;r&lt;=R) &#123;</span><br><span class=\"line\">        laz[rt]+=k;</span><br><span class=\"line\">        a[rt]+=k*len;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(laz[rt])<span class=\"built_in\">pushdown</span>(rt,len);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(L&lt;=mid)<span class=\"built_in\">update</span>(lson,L,R,k);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(R&gt;mid)<span class=\"built_in\">update</span>(rson,L,R,k);</span><br><span class=\"line\">        a[rt]=(a[rt&lt;&lt;<span class=\"number\">1</span>]+a[rt&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>])%mod;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//---------------------------------ä»¥ä¸Šä¸ºçº¿æ®µæ ‘ </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">int</span> <span class=\"title\">qRange</span><span class=\"params\">(<span class=\"type\">int</span> x,<span class=\"type\">int</span> y)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> ans=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(top[x]!=top[y]) &#123;<span class=\"comment\">//å½“ä¸¤ä¸ªç‚¹ä¸åœ¨åŒä¸€æ¡é“¾ä¸Š </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(dep[top[x]]&lt;dep[top[y]])</span><br><span class=\"line\">        \t<span class=\"built_in\">swap</span>(x,y);<span class=\"comment\">//æŠŠxç‚¹æ”¹ä¸ºæ‰€åœ¨é“¾é¡¶ç«¯çš„æ·±åº¦æ›´æ·±çš„é‚£ä¸ªç‚¹</span></span><br><span class=\"line\">        res=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"built_in\">query</span>(<span class=\"number\">1</span>,<span class=\"number\">1</span>,n,id[top[x]],id[x]);<span class=\"comment\">//ansåŠ ä¸Šxç‚¹åˆ°xæ‰€åœ¨é“¾é¡¶ç«¯ è¿™ä¸€æ®µåŒºé—´çš„ç‚¹æƒå’Œ</span></span><br><span class=\"line\">        ans+=res;</span><br><span class=\"line\">        ans%=mod;<span class=\"comment\">//æŒ‰é¢˜æ„å–æ¨¡ </span></span><br><span class=\"line\">        x=fa[top[x]];<span class=\"comment\">//æŠŠxè·³åˆ°xæ‰€åœ¨é“¾é¡¶ç«¯çš„é‚£ä¸ªç‚¹çš„ä¸Šé¢ä¸€ä¸ªç‚¹</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//ç›´åˆ°ä¸¤ä¸ªç‚¹å¤„äºä¸€æ¡é“¾ä¸Š</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(dep[x]&gt;dep[y])<span class=\"built_in\">swap</span>(x,y);<span class=\"comment\">//æŠŠxç‚¹æ·±åº¦æ›´æ·±çš„é‚£ä¸ªç‚¹</span></span><br><span class=\"line\">    res=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"built_in\">query</span>(<span class=\"number\">1</span>,<span class=\"number\">1</span>,n,id[x],id[y]);<span class=\"comment\">//è¿™æ—¶å†åŠ ä¸Šæ­¤æ—¶ä¸¤ä¸ªç‚¹çš„åŒºé—´å’Œå³å¯</span></span><br><span class=\"line\">    ans+=res;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ans%mod;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">updRange</span><span class=\"params\">(<span class=\"type\">int</span> x,<span class=\"type\">int</span> y,<span class=\"type\">int</span> k)</span> <span class=\"comment\">//åŒä¸Š</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123; </span><br><span class=\"line\">    k%=mod;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(top[x]!=top[y])&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(dep[top[x]]&lt;dep[top[y]])</span><br><span class=\"line\">        \t<span class=\"built_in\">swap</span>(x,y);</span><br><span class=\"line\">        <span class=\"built_in\">update</span>(<span class=\"number\">1</span>,<span class=\"number\">1</span>,n,id[top[x]],id[x],k);</span><br><span class=\"line\">        x=fa[top[x]];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(dep[x]&gt;dep[y])<span class=\"built_in\">swap</span>(x,y);</span><br><span class=\"line\">    <span class=\"built_in\">update</span>(<span class=\"number\">1</span>,<span class=\"number\">1</span>,n,id[x],id[y],k);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">int</span> <span class=\"title\">qSon</span><span class=\"params\">(<span class=\"type\">int</span> x)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    res=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"built_in\">query</span>(<span class=\"number\">1</span>,<span class=\"number\">1</span>,n,id[x],id[x]+siz[x]<span class=\"number\">-1</span>);<span class=\"comment\">//å­æ ‘åŒºé—´å³ç«¯ç‚¹ä¸ºid[x]+siz[x]-1 </span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">updSon</span><span class=\"params\">(<span class=\"type\">int</span> x,<span class=\"type\">int</span> k)</span> <span class=\"comment\">//åŒä¸Š</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123; </span><br><span class=\"line\">    <span class=\"built_in\">update</span>(<span class=\"number\">1</span>,<span class=\"number\">1</span>,n,id[x],id[x]+siz[x]<span class=\"number\">-1</span>,k);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">dfs1</span><span class=\"params\">(<span class=\"type\">int</span> x,<span class=\"type\">int</span> f,<span class=\"type\">int</span> deep)</span> <span class=\"comment\">//xå½“å‰èŠ‚ç‚¹ï¼Œfçˆ¶äº²ï¼Œdeepæ·±åº¦ </span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123; </span><br><span class=\"line\">    dep[x]=deep;<span class=\"comment\">//æ ‡è®°æ¯ä¸ªç‚¹çš„æ·±åº¦ </span></span><br><span class=\"line\">    fa[x]=f;<span class=\"comment\">//æ ‡è®°æ¯ä¸ªç‚¹çš„çˆ¶äº² </span></span><br><span class=\"line\">    siz[x]=<span class=\"number\">1</span>;<span class=\"comment\">//æ ‡è®°æ¯ä¸ªéå¶å­èŠ‚ç‚¹çš„å­æ ‘å¤§å° </span></span><br><span class=\"line\">    <span class=\"type\">int</span> maxson=<span class=\"number\">-1</span>;<span class=\"comment\">//è®°å½•é‡å„¿å­çš„å„¿å­æ•° </span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(Rint i=beg[x];i;i=nex[i]) &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> y=to[i];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(y==f)</span><br><span class=\"line\">        \t<span class=\"keyword\">continue</span>;<span class=\"comment\">//è‹¥ä¸ºçˆ¶äº²åˆ™continue </span></span><br><span class=\"line\">        <span class=\"built_in\">dfs1</span>(y,x,deep+<span class=\"number\">1</span>);<span class=\"comment\">//dfså…¶å„¿å­ </span></span><br><span class=\"line\">        siz[x]+=siz[y];<span class=\"comment\">//æŠŠå®ƒçš„å„¿å­æ•°åŠ åˆ°å®ƒèº«ä¸Š </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(siz[y]&gt;maxson)son[x]=y,maxson=siz[y];<span class=\"comment\">//æ ‡è®°æ¯ä¸ªéå¶å­èŠ‚ç‚¹çš„é‡å„¿å­ç¼–å· </span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">dfs2</span><span class=\"params\">(<span class=\"type\">int</span> x,<span class=\"type\">int</span> topf)</span> <span class=\"comment\">//xå½“å‰èŠ‚ç‚¹ï¼Œtopfå½“å‰é“¾çš„æœ€é¡¶ç«¯çš„èŠ‚ç‚¹ </span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    id[x]=++cnt;<span class=\"comment\">//æ ‡è®°æ¯ä¸ªç‚¹çš„æ–°ç¼–å· </span></span><br><span class=\"line\">    wt[cnt]=w[x];<span class=\"comment\">//æŠŠæ¯ä¸ªç‚¹çš„åˆå§‹å€¼èµ‹åˆ°æ–°ç¼–å·ä¸Šæ¥ </span></span><br><span class=\"line\">    top[x]=topf;<span class=\"comment\">//è¿™ä¸ªç‚¹æ‰€åœ¨é“¾çš„é¡¶ç«¯ </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!son[x])</span><br><span class=\"line\">    \t<span class=\"keyword\">return</span>;<span class=\"comment\">//å¦‚æœæ²¡æœ‰å„¿å­åˆ™è¿”å› </span></span><br><span class=\"line\">    <span class=\"built_in\">dfs2</span>(son[x],topf);<span class=\"comment\">//æŒ‰å…ˆå¤„ç†é‡å„¿å­ï¼Œå†å¤„ç†è½»å„¿å­çš„é¡ºåºé€’å½’å¤„ç† </span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(Rint i=beg[x];i;i=nex[i]) &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> y=to[i];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(y==fa[x]||y==son[x])<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        <span class=\"built_in\">dfs2</span>(y,y);<span class=\"comment\">//å¯¹äºæ¯ä¸€ä¸ªè½»å„¿å­éƒ½æœ‰ä¸€æ¡ä»å®ƒè‡ªå·±å¼€å§‹çš„é“¾ </span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">read</span>(n);</span><br><span class=\"line\">    <span class=\"built_in\">read</span>(m);</span><br><span class=\"line\">    <span class=\"built_in\">read</span>(r);</span><br><span class=\"line\">    <span class=\"built_in\">read</span>(mod);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(Rint i=<span class=\"number\">1</span>;i&lt;=n;i++)</span><br><span class=\"line\">        <span class=\"built_in\">read</span>(w[i]);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(Rint i=<span class=\"number\">1</span>;i&lt;n;i++) &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> a,b;</span><br><span class=\"line\">        <span class=\"built_in\">read</span>(a);<span class=\"built_in\">read</span>(b);</span><br><span class=\"line\">        <span class=\"built_in\">add</span>(a,b);<span class=\"built_in\">add</span>(b,a);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">dfs1</span>(r,<span class=\"number\">0</span>,<span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"built_in\">dfs2</span>(r,r);</span><br><span class=\"line\">    <span class=\"built_in\">build</span>(<span class=\"number\">1</span>,<span class=\"number\">1</span>,n);</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(m--) &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> k,x,y,z;</span><br><span class=\"line\">        <span class=\"built_in\">read</span>(k);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(k==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">read</span>(x);<span class=\"built_in\">read</span>(y);<span class=\"built_in\">read</span>(z);</span><br><span class=\"line\">            <span class=\"built_in\">updRange</span>(x,y,z);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(k==<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">read</span>(x);<span class=\"built_in\">read</span>(y);</span><br><span class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>,<span class=\"built_in\">qRange</span>(x,y));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(k==<span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">read</span>(x);<span class=\"built_in\">read</span>(y);</span><br><span class=\"line\">            <span class=\"built_in\">updSon</span>(x,y);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">read</span>(x);</span><br><span class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>,<span class=\"built_in\">qSon</span>(x));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>",
            "tags": [
                "æ•°é“¾å‰–åˆ†"
            ]
        },
        {
            "id": "http://cubicy.icu/2018/02/21/%E4%BF%A1%E6%81%AF%E5%AD%A6%E7%AB%9E%E8%B5%9B%E7%9B%B8%E5%85%B3%E4%BC%98%E7%A7%80%E6%96%87%E7%AB%A0%E5%90%88%E9%9B%86/",
            "url": "http://cubicy.icu/2018/02/21/%E4%BF%A1%E6%81%AF%E5%AD%A6%E7%AB%9E%E8%B5%9B%E7%9B%B8%E5%85%B3%E4%BC%98%E7%A7%80%E6%96%87%E7%AB%A0%E5%90%88%E9%9B%86/",
            "title": "ä¿¡æ¯å­¦ç«èµ›ç›¸å…³ä¼˜ç§€æ–‡ç« åˆé›†",
            "date_published": "2018-02-21T15:36:00.000Z",
            "content_html": "<p><a href=\"//blog.csdn.net/zearot/article/details/48299459\">çº¿æ®µæ ‘è¯¦è§£ ï¼ˆåŸç†ï¼Œå®ç°ä¸åº”ç”¨ï¼‰</a><br><a href=\"//blog.csdn.net/lyd_7_29/article/details/51405469\">å¯æŒä¹…åŒ–çº¿æ®µæ ‘ ç®€ä»‹</a>  </p>\n<p><a href=\"//files.cnblogs.com/files/yyy2015c01/%E8%BF%90%E7%94%A8%E4%BC%B8%E5%B1%95%E6%A0%91%E8%A7%A3%E5%86%B3%E6%95%B0%E5%88%97%E7%BB%B4%E6%8A%A4%E9%97%AE%E9%A2%98.pdf\">è¿ç”¨ä¼¸å±•æ ‘è§£å†³æ•°åˆ—ç»´æŠ¤é—®é¢˜.pdf</a><br><a href=\"//oi.men.ci/splay-notes-1/\">Splay å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰</a><br><a href=\"//oi.men.ci/splay-notes-2/\">Splay å­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰</a><br><a href=\"//oi.men.ci/splay-notes-3/\">Splay å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰</a>   </p>\n<p><a href=\"//lib.csdn.net/article/datastructure/9204\">è¯·è¦ç›¸ä¿¡æˆ‘ï¼Œ30åˆ†é’Ÿè®©ä½ æŒæ¡AVLæ ‘ï¼ˆå¹³è¡¡äºŒå‰æ ‘ï¼‰</a><br><a href=\"//blog.csdn.net/sun_tttt/article/details/65445754\">æœ€å®¹æ˜“æ‡‚çš„çº¢é»‘æ ‘</a><br><a href=\"//www.cnblogs.com/Mathics/p/3971220.html\">ä¸‰å¤§å¹³è¡¡æ ‘ï¼ˆTreap + Splay + SBTï¼‰æ€»ç»“+æ¨¡æ¿</a><br><a href=\"//oi.men.ci/link-cut-tree-notes/\">Link-Cut Tree å­¦ä¹ ç¬”è®°</a><br><a href=\"//files.cnblogs.com/files/yyy2015c01/%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%A0%94%E7%A9%B6.pdf\">å¯æŒä¹…åŒ–æ•°æ®ç»“æ„ç ”ç©¶.pdf</a>  </p>\n<p><a href=\"//www.cnblogs.com/dalt/p/8206664.html\">æ ‘é“¾å‰–åˆ†è¯¦è§£</a><br><a href=\"//www.cnblogs.com/chinhhh/p/7965433.html\">æ ‘é“¾å‰–åˆ†è¯¦è§£ï¼ˆæ´›è°·æ¨¡æ¿ P3384ï¼‰</a>  </p>\n<p><a href=\"//blog.csdn.net/PomeCat/article/details/72832494\">åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰ä¼˜åŒ–ä¹‹æ–œç‡ä¼˜åŒ–è®²è§£</a><br><a href=\"//www.cnblogs.com/MashiroSky/p/6009685.html\">æ–œç‡ä¼˜åŒ–å­¦ä¹ ç¬”è®°</a><br><a href=\"//www.cnblogs.com/mlystdcall/p/6525962.html\">å››è¾¹å½¢ä¸ç­‰å¼å­¦ä¹ ç¬”è®°</a><br><a href=\"//www.yhzq-blog.cc/%E6%8F%92%E5%A4%B4dp-%E4%BB%8E%E4%B8%8D%E4%BC%9A%E5%88%B0%E5%B4%A9%E6%BA%83/\">æ’å¤´dpå…¥é—¨</a>  </p>\n<p><a href=\"//segmentfault.com/a/1190000003914228\">æœ€é•¿å›æ–‡å­ä¸²â€”â€”Manacher ç®—æ³•ï¼ˆäººç§°â€œé©¬æ‹‰è½¦ç®—æ³•â€ï¼‰</a>  </p>\n<p><a href=\"//www.cnblogs.com/mlystdcall/p/6734852.html\">ä¸Šä¸‹ç•Œç½‘ç»œæµå»ºæ¨¡æ–¹æ³•æ€»ç»“</a>   </p>\n<p><a href=\"//www.gatevin.moe/acm/fft%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/\">FFTç®—æ³•å­¦ä¹ ç¬”è®°</a><br><a href=\"//www.cnblogs.com/tmzbot/p/4668158.html\">Fast Walsh-Hadamard Transformï¼ˆå¿«é€Ÿæ²ƒå°”ä»€å˜æ¢ï¼‰</a>  </p>\n<p><a href=\"//www.cnblogs.com/mlystdcall/p/6219421.html\">ç®€æ˜“CDQåˆ†æ²»æ•™ç¨‹&amp;å­¦ä¹ ç¬”è®°</a><br><a href=\"//www.cnblogs.com/mlystdcall/p/6232324.html\">å››ç»´ååº(CDQå¥—CDQ)</a></p>\n",
            "tags": []
        },
        {
            "id": "http://cubicy.icu/2018/02/20/%E6%B4%9B%E8%B0%B7P3919%20%E3%80%90%E6%A8%A1%E6%9D%BF%E3%80%91%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E6%95%B0%E7%BB%84/",
            "url": "http://cubicy.icu/2018/02/20/%E6%B4%9B%E8%B0%B7P3919%20%E3%80%90%E6%A8%A1%E6%9D%BF%E3%80%91%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E6%95%B0%E7%BB%84/",
            "title": "æ´›è°·:P3919 ã€æ¨¡æ¿ã€‘å¯æŒä¹…åŒ–æ•°ç»„ï¼ˆå¯æŒä¹…åŒ–çº¿æ®µæ ‘/å¹³è¡¡æ ‘ï¼‰",
            "date_published": "2018-02-20T15:36:00.000Z",
            "content_html": "<p>åŸé¢˜åœ°å€:<a href=\"//www.luogu.org/problemnew/show/P3919\">https://www.luogu.org/problemnew/show/P3919</a></p>\n<h3 id=\"é¢˜ç›®ç®€è¿°\"><a href=\"#é¢˜ç›®ç®€è¿°\" class=\"headerlink\" title=\"é¢˜ç›®ç®€è¿°\"></a>é¢˜ç›®ç®€è¿°</h3><p>ç»´æŠ¤ä¸€ä¸ªé•¿åº¦ä¸ºNçš„æ•°ç»„ï¼Œæ”¯æŒå¦‚ä¸‹å‡ ç§æ“ä½œï¼š  </p>\n<ol>\n<li>åœ¨æŸä¸ªå†å²ç‰ˆæœ¬ä¸Šä¿®æ”¹æŸä¸€ä¸ªä½ç½®ä¸Šçš„å€¼  </li>\n<li>è®¿é—®æŸä¸ªå†å²ç‰ˆæœ¬ä¸Šçš„æŸä¸€ä½ç½®çš„å€¼<br>æ­¤å¤–ï¼Œæ¯è¿›è¡Œä¸€æ¬¡æ“ä½œï¼ˆå¯¹äºæ“ä½œ2ï¼Œå³ä¸ºç”Ÿæˆä¸€ä¸ªå®Œå…¨ä¸€æ ·çš„ç‰ˆæœ¬ï¼Œä¸ä½œä»»ä½•æ”¹åŠ¨ï¼‰ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ã€‚ç‰ˆæœ¬ç¼–å·å³ä¸ºå½“å‰æ“ä½œçš„ç¼–å·ï¼ˆä»1å¼€å§‹ç¼–å·ï¼Œç‰ˆæœ¬0è¡¨ç¤ºåˆå§‹çŠ¶æ€æ•°ç»„ï¼‰</li>\n</ol>\n<hr>\n<h3 id=\"æ€è·¯\"><a href=\"#æ€è·¯\" class=\"headerlink\" title=\"æ€è·¯\"></a>æ€è·¯</h3><p>é¦–å…ˆæ„Ÿè°¢æ¥è‡ª<a href=\"https://www.luogu.org/space/show?uid=2978\">@zcysky</a>çš„æ¨¡æ¿ã€‚å†™çš„éå¸¸æ¼‚äº®ï¼Œå°è£…ä¹Ÿå¾ˆç²¾è‡´ã€‚<br>è¿™é¢˜æ˜¯è£¸é¢˜ï¼Œäºæ˜¯ç›´æ¥ä¸Šæ¨¡æ¿å°±è¡Œäº†ã€‚æ³¨æ„æ­¤é¢˜è¾“å…¥æ•°æ®å¤§ï¼Œéœ€è¦è¯»å…¥ä¼˜åŒ–ã€‚<br>å…³äºå¯æŒä¹…åŒ–çº¿æ®µæ ‘çš„ä»‹ç»ä¸æ€»ç»“ï¼Œä¹‹åæŠŠå‘å¡«ä¸Šã€‚  </p>\n<hr>\n<h3 id=\"ä»£ç \"><a href=\"#ä»£ç \" class=\"headerlink\" title=\"ä»£ç \"></a>ä»£ç </h3><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;bits/stdc++.h&gt;</span></span></span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">int</span> N=<span class=\"number\">1000005</span>;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"type\">int</span> a[N],n,q,rt[N*<span class=\"number\">20</span>];<span class=\"comment\">//ç©ºé—´å¤æ‚åº¦O(mlogn) </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> MAXB 50000000</span></span><br><span class=\"line\"><span class=\"type\">char</span> buf[MAXB],*cp=buf;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">int</span> <span class=\"title\">read</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> f=<span class=\"number\">1</span>,x=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(*cp&lt;<span class=\"string\">&#x27;0&#x27;</span>||*cp&gt;<span class=\"string\">&#x27;9&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(*cp==<span class=\"string\">&#x27;-&#x27;</span>)</span><br><span class=\"line\">            f=<span class=\"number\">-1</span>;</span><br><span class=\"line\">        cp++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(*cp&gt;=<span class=\"string\">&#x27;0&#x27;</span>&amp;&amp;*cp&lt;=<span class=\"string\">&#x27;9&#x27;</span>) &#123;</span><br><span class=\"line\">        x=x*<span class=\"number\">10</span>+*cp-<span class=\"string\">&#x27;0&#x27;</span>; </span><br><span class=\"line\">        cp++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> f*x;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Persistable_Segment_Tree</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> lc[N*<span class=\"number\">20</span>],rc[N*<span class=\"number\">20</span>],val[N*<span class=\"number\">20</span>],cnt;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">build</span><span class=\"params\">(<span class=\"type\">int</span> &amp;o,<span class=\"type\">int</span> l,<span class=\"type\">int</span> r)</span></span>&#123;</span><br><span class=\"line\">        o=++cnt;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(l==r) &#123;</span><br><span class=\"line\">            val[o]=a[l];</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> mid=(l+r)&gt;&gt;<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"built_in\">build</span>(lc[o],l,mid);</span><br><span class=\"line\">        <span class=\"built_in\">build</span>(rc[o],mid+<span class=\"number\">1</span>,r);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">void</span> <span class=\"title\">ins</span><span class=\"params\">(<span class=\"type\">int</span> &amp;o,<span class=\"type\">int</span> pre,<span class=\"type\">int</span> l,<span class=\"type\">int</span> r,<span class=\"type\">int</span> q,<span class=\"type\">int</span> v)</span></span>&#123;</span><br><span class=\"line\">        o=++cnt;</span><br><span class=\"line\">        lc[o]=lc[pre];</span><br><span class=\"line\">        rc[o]=rc[pre];</span><br><span class=\"line\">        val[o]=val[pre];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(l==r) &#123;</span><br><span class=\"line\">            val[o]=v;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> mid=(l+r)&gt;&gt;<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(q&lt;=mid)</span><br><span class=\"line\">            <span class=\"built_in\">ins</span>(lc[o],lc[pre],l,mid,q,v);</span><br><span class=\"line\">        <span class=\"keyword\">else</span> </span><br><span class=\"line\">            <span class=\"built_in\">ins</span>(rc[o],rc[pre],mid+<span class=\"number\">1</span>,r,q,v);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">int</span> <span class=\"title\">query</span><span class=\"params\">(<span class=\"type\">int</span> o,<span class=\"type\">int</span> l,<span class=\"type\">int</span> r,<span class=\"type\">int</span> q)</span></span>&#123;<span class=\"comment\">//ç±»ä¼¼äºŒåˆ†çš„æŸ¥è¯¢ </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(l==r)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> val[o];</span><br><span class=\"line\">        <span class=\"type\">int</span> mid=(l+r)&gt;&gt;<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(q&lt;=mid)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">query</span>(lc[o],l,mid,q);</span><br><span class=\"line\">        <span class=\"keyword\">else</span> </span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">query</span>(rc[o],mid+<span class=\"number\">1</span>,r,q);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;T;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">fread</span>(buf,<span class=\"number\">1</span>,MAXB,stdin);</span><br><span class=\"line\">    n=<span class=\"built_in\">read</span>();</span><br><span class=\"line\">    <span class=\"type\">int</span> m=<span class=\"built_in\">read</span>();</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;i++)</span><br><span class=\"line\">        a[i]=<span class=\"built_in\">read</span>();</span><br><span class=\"line\">    T.<span class=\"built_in\">build</span>(rt[<span class=\"number\">0</span>],<span class=\"number\">1</span>,n);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">1</span>;i&lt;=m;i++)&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> pre=<span class=\"built_in\">read</span>(),opt=<span class=\"built_in\">read</span>(),x=<span class=\"built_in\">read</span>();</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(opt==<span class=\"number\">1</span>) &#123;<span class=\"comment\">//æ“ä½œ1:åœ¨ç‰ˆæœ¬preçš„åŸºç¡€ä¸Šå°†ç¬¬xä¸ªæ•°ä¿®æ”¹ä¸ºv </span></span><br><span class=\"line\">            <span class=\"type\">int</span> v=<span class=\"built_in\">read</span>();</span><br><span class=\"line\">            T.<span class=\"built_in\">ins</span>(rt[i],rt[pre],<span class=\"number\">1</span>,n,x,v);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(opt==<span class=\"number\">2</span>) &#123;<span class=\"comment\">//æ“ä½œ2:è®¿é—®ç‰ˆæœ¬preä¸­ç¬¬xä¸ªæ•°çš„å€¼ </span></span><br><span class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>,T.<span class=\"built_in\">query</span>(rt[pre],<span class=\"number\">1</span>,n,x));</span><br><span class=\"line\">            rt[i]=rt[pre];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>",
            "tags": [
                "æŒä¹…åŒ–",
                "çº¿æ®µæ ‘"
            ]
        },
        {
            "id": "http://cubicy.icu/2018/02/20/OI%E4%B8%AD%E7%9A%84IO%E4%BC%98%E5%8C%96/",
            "url": "http://cubicy.icu/2018/02/20/OI%E4%B8%AD%E7%9A%84IO%E4%BC%98%E5%8C%96/",
            "title": "OIä¸­çš„IOä¼˜åŒ–",
            "date_published": "2018-02-20T13:09:00.000Z",
            "content_html": "<p>æœ¬æ–‡ä¸»è¦è®²è¿°å¸¸ç”¨çš„2ç§è¯»å…¥ä¼˜åŒ–æ–¹æ³•ã€‚<br>è¾“å‡ºä¼˜åŒ–å¾ˆå°‘ä½¿ç”¨ï¼Œåœ¨æ­¤ç®€å•æä¸€ä¸‹ï¼šä¹Ÿå°±æ˜¯æŠŠè¾“å‡ºçš„ä¸œè¥¿å…ˆæ”¾è¿›å­—ç¬¦ä¸²ï¼Œå†ä¸€æ¬¡æ€§puts\\printfå‡ºå»ã€‚æå‡ä¸å¤§ï¼Œä¸å¸¸ç”¨ã€‚<br>é¦–å…ˆå½“ç„¶éœ€è¦å…ˆçŸ¥é“ï¼Œscanf&#x2F;printfæ¯”cin&#x2F;coutå¿«ä¸å°‘ã€‚<br>è¯»å…¥ä¼˜åŒ–ï¼š </p>\n<ol>\n<li>getchar<br>ä½¿ç”¨getcharä¸€ä¸ªä¸€ä¸ªè¯»å…¥å­—ç¬¦ï¼Œè½¬åŒ–æˆæ•°å­—ã€‚æ¯”scanfå¿«ä¸€äº›ã€‚<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">int</span> <span class=\"title\">read</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> f=<span class=\"number\">1</span>,x=<span class=\"number\">0</span>;<span class=\"comment\">//fæ˜¯æ­£è´Ÿçš„æ ‡è¯†</span></span><br><span class=\"line\">    <span class=\"type\">char</span> ch;</span><br><span class=\"line\">    <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">        ch=<span class=\"built_in\">getchar</span>();</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(ch==<span class=\"string\">&#x27;-&#x27;</span>)</span><br><span class=\"line\">            f=<span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">while</span>(ch&lt;<span class=\"string\">&#x27;0&#x27;</span>||ch&gt;<span class=\"string\">&#x27;9&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">        x=x*<span class=\"number\">10</span>+ch-<span class=\"string\">&#x27;0&#x27;</span>;</span><br><span class=\"line\">        ch=<span class=\"built_in\">getchar</span>();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">while</span>(ch&gt;=<span class=\"string\">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class=\"string\">&#x27;9&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> f*x;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n2.fread  ï¼ˆéå¸¸å¿«ï¼ï¼‰<br>freadå°†stdiné‡Œçš„å†…å®¹è¯»åˆ°å­—ç¬¦ä¸²é‡Œï¼Œç„¶ååˆ©ç”¨æŒ‡é’ˆå¤„ç†ã€‚<br>é¦–å…ˆå®šä¹‰æŒ‡é’ˆå’Œè¯»å…¥çš„æ•°ç»„ï¼š  <figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> MAXB 10000000</span></span><br><span class=\"line\"><span class=\"comment\">//å®šä¹‰è¯»å…¥æœ€é•¿çš„é•¿åº¦</span></span><br><span class=\"line\">    <span class=\"type\">char</span> buf[MAXB],*cp=buf;</span><br></pre></td></tr></table></figure>\næ¥ä¸‹æ¥æ˜¯è¯»å…¥ï¼š  <figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">fread</span>(buf,<span class=\"number\">1</span>,MAXB,stdin);<span class=\"comment\">//å‡½æ•°å…·ä½“å‚æ•°å«ä¹‰è¯·å–„ç”¨æœç´¢å¼•æ“</span></span><br></pre></td></tr></table></figure>\næœ€åæ˜¯ä»ä¸­å¤„ç†å‡ºæ•°æ®ï¼ˆç°åœ¨è¿™ä¸ªå‡½æ•°æ˜¯ä¸ºäº†å¤„ç†intæ•´å‹è€Œè®¾è®¡ï¼‰  <figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"type\">int</span> <span class=\"title\">read</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> f=<span class=\"number\">1</span>,x=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(*cp&lt;<span class=\"string\">&#x27;0&#x27;</span>||*cp&gt;<span class=\"string\">&#x27;9&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(*cp==<span class=\"string\">&#x27;-&#x27;</span>)</span><br><span class=\"line\">            f=<span class=\"number\">-1</span>;</span><br><span class=\"line\">        cp++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(*cp&gt;=<span class=\"string\">&#x27;0&#x27;</span>&amp;&amp;*cp&lt;=<span class=\"string\">&#x27;9&#x27;</span>) &#123;</span><br><span class=\"line\">        x=x*<span class=\"number\">10</span>+*cp-<span class=\"string\">&#x27;0&#x27;</span>; </span><br><span class=\"line\">        cp++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> f*x;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ol>\n",
            "tags": []
        }
    ]
}